var k=Object.defineProperty;var P=(t,s,e)=>s in t?k(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e;var n=(t,s,e)=>(P(t,typeof s!="symbol"?s+"":s,e),e);import{A as w,W as M}from"./index.esm-ac4cb3bc.js";import{j as b}from"./jsx-runtime-670450c2.js";import{r as a}from"./index-f1f749bf.js";function x(t){return typeof t=="function"?t():t}function l(t,...s){Object.defineProperties(t,[...s,"_constructor-name_"].reduce((e,i)=>(e[i]={writable:!0,enumerable:!1},e),{}))}class R{constructor(){n(this,"_events",new Map);n(this,"_once",new WeakMap);l(this,"_events","_once")}getListeners(s){return this._events.get(s)||[]}on(s,e){const i=this._events.get(s)||[];i.includes(e)||i.push(e),this._events.set(s,i)}once(s,e){const i=(...o)=>{this.off(s,i),e(...o)};this._once.set(e,i),this.on(s,i)}off(s,e){e=this._once.get(e)||e;const i=this._events.get(s)||[],o=i.indexOf(e);o>-1&&i.splice(o,1),this._events.set(s,i)}removeAllListeners(s){s?this._events.delete(s):this._events.clear()}dispatch(s,...e){var i;(i=this._events.get(s))==null||i.forEach(o=>o(...e))}}class f extends R{constructor({trackMediaType:e="video",trackId:i=w()}={}){super();n(this,"_trackId");n(this,"trackMediaType");n(this,"isPlaying",!1);this.trackMediaType=e,this._trackId=i,l(this,"_trackId")}static create(e){return new f(e)}getTrackId(){return this._trackId}getMediaStreamTrack(){throw new Error("Method not implemented.")}play(e){this.isPlaying=!0,console.log("[FakeTrack]: play",e)}stop(){this.isPlaying=!1}}class d extends f{constructor({label:e=M(),enabled:i=!0,muted:o=!1,...r}={}){super(r);n(this,"_label");n(this,"muted");n(this,"enabled");this._label=e,this.enabled=i,this.muted=o,l(this,"_label")}static create(e){return new d(e)}async setEnabled(e){e!==this.enabled&&(this.enabled=e,e?this.play():this.stop())}getStats(){throw new Error("Method not implemented.")}getTrackLabel(){return this._label}async setMuted(e){this.muted=e}close(){this.stop()}}const I=""+new URL("ipad-2988-6d019a26.mp4",import.meta.url).href;class p extends d{constructor({videoURI:e=I,...i}={}){super({...i,trackMediaType:"video"});n(this,"_videoURI");n(this,"_config");n(this,"_videoEl");this._videoURI=e,l(this,"_config","_videoEl","_videoURI")}static create(e){return new p(e)}play(e,i){var r;this._config=i;const o=typeof e=="string"?document.getElementById(e):e;if(this._videoEl||(this._videoEl=document.createElement("video"),this._videoEl.style.width="100%",this._videoEl.style.height="100%",this._videoEl.loop=!0,this._videoEl.muted=!0),this._videoEl.src=this._videoURI,this._videoEl.style.objectFit=((r=this._config)==null?void 0:r.fit)||"cover",this._videoEl.style.opacity="1",o){for(;o.firstChild;)o.removeChild(o.firstChild);o.appendChild(this._videoEl)}this.enabled&&this._videoEl&&(this.isPlaying=!0,this._videoEl.play().catch(console.log))}stop(){this.isPlaying&&this._videoEl&&(this.isPlaying=!1,this._videoEl.style.opacity="0",this._videoEl.pause())}}const U=""+new URL("quick-mechanical-keyboard-14391-2499954b.mp3",import.meta.url).href;class _ extends d{constructor({audioURI:e=U,volume:i=100,...o}={}){super({...o,trackMediaType:"audio"});n(this,"_audioURI");n(this,"_audioEl");n(this,"_volume");this._volume=Math.max(0,Math.min(100,i)),this._audioURI=e,l(this,"_audioEl","_volume","_audioURI")}static create(e){return new _(e)}play(){this._audioEl||(this._audioEl=document.createElement("audio"),this._audioEl.loop=!0,document.body.appendChild(this._audioEl)),this._audioEl.src=this._audioURI,this._audioEl.muted=this.muted,this._audioEl.volume=this._volume/100,this.enabled&&this._audioEl&&(this.isPlaying=!0,this._audioEl.play().catch(console.log))}stop(){this.isPlaying&&this._audioEl&&(this.isPlaying=!1,this._audioEl.pause())}async setMuted(e){super.setMuted(e),this._audioEl&&(this._audioEl.muted=e)}setVolume(e){e=Math.max(0,Math.min(100,e)),this._volume!==e&&(this._volume=e,this._audioEl&&(this._audioEl.volume=e/100))}getVolumeLevel(){return this._volume/100}async setPlaybackDevice(e){console.log("[FakeLocalAudioTrack]: setPlaybackDevice",e)}}class y extends p{static create(s){return new y(s)}async setDevice(s){console.log("[FakeCameraVideoTrack]: setDevice",s)}}class m extends _{static create(s){return new m(s)}async setDevice(s){console.log("[FakeMicrophoneAudioTrack]: setDevice",s)}}x({createMicrophoneAudioTrack:async()=>m.create(),createCameraVideoTrack:async()=>y.create()});function C(t){try{return t()}catch(s){console.error(s)}}function N(t){return()=>t.forEach(C)}function q(t,s){const e=setInterval(t,s);return()=>clearInterval(e)}function A(t,s){const e=setTimeout(t,s);return()=>clearTimeout(e)}function z(){let t,s,e;function i(){if(s){const c=s;s=void 0,c()}}async function o(){if(e){const c=e;e=void 0;try{await c()}catch(h){console.error(h)}}}async function r(c){t=!0,await o();try{e=await c()}catch(h){console.error(h)}t=!1,i()}async function u(){t=!0,await o(),t=!1,i()}function g(c){t?s=()=>r(c):r(c)}function T(){t?s=u:u()}return{run:g,dispose:T}}const E=typeof document<"u"?a.useLayoutEffect:a.useEffect;function L(t){return t!=null&&typeof t.then=="function"}function B(){const t=a.useRef(!1);return a.useEffect(()=>(t.current=!1,()=>{t.current=!0}),[]),t}function j(){const t=B();function s(e,i){return new Promise(async(o,r)=>{try{const u=await e;t.current||o(u)}catch(u){t.current?i&&i(u):r(u)}})}return a.useCallback(s,[t])}function G(t){const s=j(),[e,i]=a.useState();return E(()=>{L(t)?s(t).then(i):i(t)},[t,s]),e}function D(){const t=new Map,s=1500;return{onMount:e=>{const i=t.get(e);i&&(i(),t.delete(e))},onUnmount:e=>{const i=t.get(e);i&&i(),t.set(e,A(()=>{e.isPlaying&&e.stop(),t.delete(e)},s))},dispose:()=>{for(const[e,i]of t)e.isPlaying&&e.stop(),i&&i();t.clear()}}}const v=a.createContext(void 0);function F({children:t}){const[s]=a.useState(D);return a.useEffect(()=>s.dispose,[s]),b(v.Provider,{value:s,children:t})}function H(t,s,e){const i=a.useContext(v);a.useEffect(()=>{if(t)return e&&s?t.play(e):t.stop(),i?(i.onMount(t),()=>i.onUnmount(t)):()=>{t.isPlaying&&t.stop()}},[t,e,s,i])}function J(t,s){const e=a.useContext(v);E(()=>{if(t)return s?t.play():t.stop(),e?(e.onMount(t),()=>e.onUnmount(t)):()=>{t.isPlaying&&t.stop()}},[t,s,e])}F.__docgenInfo={description:`Delegates track stop of descendant Track Players.
This prevents track stops on Track Players unmounts due to re-layout.

@example
\`\`\`jsx
<TrackBoundary>
  <RemoteUser user={user1} />
  <RemoteUser user={user2} />
</TrackBoundary>
\`\`\`

@example
\`\`\`jsx
<TrackBoundary>
  <RemoteVideoTrack track={track1} />
  <RemoteVideoTrack track={track2} />
</TrackBoundary>
\`\`\``,methods:[],displayName:"TrackBoundary"};export{y as F,F as T,_ as a,H as b,J as c,m as d,R as e,f,p as g,l as h,I as i,q as j,U as k,N as l,z as m,A as t,G as u};
//# sourceMappingURL=TrackBoundary-a2d0821a.js.map
