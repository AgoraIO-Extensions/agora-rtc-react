var w=Object.defineProperty;var U=(t,e,s)=>e in t?w(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var h=(t,e,s)=>(U(t,typeof e!="symbol"?e+"":e,s),s);import{j as p}from"./jsx-runtime-94f6e698.js";import{u as j,F as D,a as q}from"./styles-8e94b0fb.js";import{R as P}from"./RemoteAudioTrack-065fc39a.js";import{R as O}from"./RemoteVideoTrack-3358619e.js";import{u as I,U as _}from"./useRTCClient-c3e6f1e0.js";import{r as l}from"./index-8db94870.js";import{j as A,t as L,l as M}from"./TrackBoundary-b755f9d3.js";function b(t,e,s){return t.on(e,s),()=>t.off(e,s)}function V(t){const e=I(t),[s,r]=l.useState(e?e.connectionState==="CONNECTED":!1);return l.useEffect(()=>{if(e){r(e.connectionState==="CONNECTED");let o;return A([b(e,"connection-state-change",u=>{o==null||o(),o=L(()=>r(u==="CONNECTED"),0)}),()=>o==null?void 0:o()])}else r(!1)},[e]),s}class x extends Error{constructor(s,r){var e=(...args)=>{super(...args);h(this,"rtcMethod");h(this,"rtcError");h(this,"name","AgoraRTCReactException")};e(typeof r=="string"?r:r.message),this.rtcMethod=s,this.rtcError=r}log(s){console[s](this)}}function E(t,e,s){const r=I(s),o=e==="audio"?"audioTrack":"videoTrack",[u,f]=l.useState(t&&t[o]),g=V(),m=l.useRef(),[C,d]=l.useState(!1),[T,k]=l.useState(null);return l.useEffect(()=>{if(!t||!g)return;let a=!1;a||k(null);const N=e==="audio"?"hasAudio":"hasVideo",y=t.uid,S=async(n,c)=>{if(n[o]&&r.remoteUsers.some(({uid:i})=>n.uid===i))try{a||d(!0),await r.unsubscribe(n,c)}catch(i){a||k(new x("IAgoraRTCClient.unsubscribe",i)),console.error(i)}a||(f(void 0),d(!1))},v=async(n,c)=>{try{!n[o]&&r.remoteUsers.some(({uid:i})=>n.uid===i)&&(a||d(!0),await r.subscribe(n,c)),a||f(n[o])}catch(i){a||k(new x("IAgoraRTCClient.subscribe",i)),console.error(i)}a||d(!1)},R=m.current||(m.current=M());return!t[o]&&t[N]?R.run(()=>v(t,e)):f(t[o]),A([()=>{a=!0,R.dispose()},b(r,"user-published",(n,c)=>{n.uid===y&&c===e&&R.run(()=>v(n,e))}),b(r,"user-unpublished",(n,c)=>{n.uid===y&&c===e&&R.run(()=>S(n,e))})])},[g,r,t,e,o]),{track:u,isLoading:C,error:T}}function F({user:t,playVideo:e,playAudio:s,playbackDeviceId:r,volume:o,cover:u,style:f,children:g,...m}){const C=j(q,f),{track:d}=E(t,"video"),{track:T}=E(t,"audio");return e=e??(t==null?void 0:t.hasVideo),s=s??(t==null?void 0:t.hasAudio),p.jsxs("div",{...m,style:C,children:[p.jsx(O,{play:e,track:d}),p.jsx(P,{play:s,playbackDeviceId:r,track:T,volume:o}),u&&!e&&p.jsx(_,{cover:u}),p.jsx("div",{style:D,children:g})]})}F.__docgenInfo={description:"该组件用于播放远端用户的视频和音频轨道，并且仅支持指定使用的音频设备、不支持指定使用的视频设备。",methods:[],displayName:"RemoteUser",props:{user:{required:!1,tsType:{name:"IAgoraRTCRemoteUser"},description:"远端用户对象。详见 [IAgoraRTCRemoteUser](https://docportal.shengwang.cn/cn/live-streaming-premium-4.x/API%20Reference/web_ng/interfaces/iagorartcremoteuser.html)。"},playVideo:{required:!1,tsType:{name:"boolean"},description:"`true`：播放远端用户的视频轨道。`false`：停止播放远端用户的视频轨道。"},playAudio:{required:!1,tsType:{name:"boolean"},description:"`true`：播放远端用户的音频轨道。`false`：停止播放远端用户的音频轨道。"},playbackDeviceId:{required:!1,tsType:{name:"string"},description:"要使用的播放设备 ID，例如扬声器。设备 ID 通过 [getPlaybackDevices](https://docportal.shengwang.cn/cn/live-streaming-premium-4.x/API%20Reference/web_ng/interfaces/iagorartc.html#getplaybackdevices) 获取。该属性仅支持桌面端的 Chrome 浏览器，在其它浏览器上修改该属性的值将会抛出 `NOT_SUPPORTED` 错误。"},volume:{required:!1,tsType:{name:"number"},description:"音量大小。取值范围 [0, 100]，0 代表静音，100 代表原始音量。"},cover:{required:!1,tsType:{name:"union",raw:"string | (() => ReactNode)",elements:[{name:"string"},{name:"unknown"}]},description:"当 `playVideo` 为 `false`时要渲染的封面图片或自定义组件，用于替代视频画面显示。支持传入在线图片的 URL 或本地图片的相对路径。"},children:{required:!1,tsType:{name:"ReactNode"},description:"需要展示的 React 节点。"}},composes:["HTMLProps"]};export{F as R};
//# sourceMappingURL=RemoteUser-5c1cb3bf.js.map
