{"version":3,"file":"LocalUser.stories-2e9c8b99.js","sources":["../../src/components/LocalUser.tsx","../../src/stories/LocalUser.stories.tsx"],"sourcesContent":["import type { ILocalAudioTrack, ILocalVideoTrack } from \"agora-rtc-sdk-ng\";\nimport type { HTMLProps, ReactNode } from \"react\";\n\nimport { FloatBoxStyle, VideoTrackWrapperStyle, useMergedStyle } from \"../assets/styles\";\nimport type { MaybePromiseOrNull } from \"../misc/utils\";\n\nimport { LocalAudioTrack } from \"./LocalAudioTrack\";\nimport { LocalVideoTrack } from \"./LocalVideoTrack\";\nimport { UserCover } from \"./UserCover\";\n\nexport interface LocalUserProps extends HTMLProps<HTMLDivElement> {\n  /**\n   * `true`：打开本地用户的麦克风。`false`：关闭本地用户的麦克风。\n   */\n  readonly micOn?: boolean;\n\n  /**\n   * `true`：打开本地用户的摄像头。`false`：关闭本地用户的摄像头。\n   */\n  readonly cameraOn?: boolean;\n\n  /**\n   * 要播放的麦克风音频轨道。通过 [useLocalMicrophoneTrack](./hooks#uselocalmicrophonetrack) 创建。\n   */\n  readonly audioTrack?: MaybePromiseOrNull<ILocalAudioTrack>;\n\n  /**\n   * 要播放的摄像头视频轨道。通过 [useLocalCameraTrack](./hooks#uselocalcameratrack) 创建。\n   */\n  readonly videoTrack?: MaybePromiseOrNull<ILocalVideoTrack>;\n\n  /**\n   * `true`：播放本地用户的音频轨道。`false`：停止播放本地用户的音频轨道。\n   */\n  readonly playAudio?: boolean;\n\n  /**\n   * `true`：播放本地用户的视频轨道。`false`：停止播放本地用户的视频轨道。\n   */\n  readonly playVideo?: boolean;\n\n  /**\n   * 音量大小。取值范围 [0, 1000]，0 代表静音，100 代表原始音量。100 以上会使用 [Web Audio API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API) 进行音量增益。\n   */\n  readonly volume?: number;\n\n  /**\n   * 当 `playVideo` 为 `false`时要渲染的封面图片，用于替代视频画面显示。支持传入在线图片的 URL 或本地图片的相对路径。\n   */\n  readonly cover?: string;\n\n  /**\n   * 需要展示的 React 节点。\n   */\n  readonly children?: ReactNode;\n}\n\n/**\n * 该组件用于播放本地用户的摄像头视频轨道和麦克风音频轨道（不支持指定使用的媒体设备）。\n */\nexport function LocalUser({\n  micOn,\n  cameraOn,\n  audioTrack,\n  videoTrack,\n  playAudio,\n  playVideo,\n  volume,\n  cover,\n  children,\n  style,\n  ...props\n}: LocalUserProps) {\n  const mergedStyle = useMergedStyle(VideoTrackWrapperStyle, style);\n  playVideo = playVideo ?? !!cameraOn;\n  playAudio = playAudio ?? !!micOn;\n  return (\n    <div {...props} style={mergedStyle}>\n      <LocalVideoTrack disabled={!cameraOn} play={playVideo} track={videoTrack} />\n      <LocalAudioTrack disabled={!micOn} play={playAudio} track={audioTrack} volume={volume} />\n      {cover && !cameraOn && <UserCover cover={cover} />}\n      <div style={FloatBoxStyle}>{children}</div>\n    </div>\n  );\n}\n","import { action } from \"@storybook/addon-actions\";\nimport type { Meta, StoryObj } from \"@storybook/react\";\nimport type { LocalMicrophoneAndCameraUserProps } from \"agora-rtc-react-ui/src/components/LocalMicrophoneAndCameraUser\";\nimport { FakeCameraVideoTrack, FakeMicrophoneAudioTrack, FakeRTCClient } from \"fake-agora-rtc\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { LocalUser } from \"../components\";\nimport { AgoraRTCProvider } from \"../hooks\";\nconst meta: Meta<LocalMicrophoneAndCameraUserProps> = {\n  title: \"User/LocalUser\",\n  component: LocalUser,\n  tags: [\"autodocs\"],\n  parameters: {\n    backgrounds: {\n      default: \"light\"\n    }\n  }\n};\nexport default meta;\ninterface OverviewProps {\n  micOn: boolean;\n  cameraOn: boolean;\n}\ntype OverviewArgs = OverviewProps & Omit<LocalMicrophoneAndCameraUserProps, keyof OverviewProps>;\nexport const Overview: StoryObj<OverviewArgs> = {\n  args: {\n    micOn: false,\n    cameraOn: false,\n    playVideo: false,\n    playAudio: false,\n    cover: \"https://www.agora.io/en/wp-content/uploads/2022/10/3d-spatial-audio-icon.svg\",\n    style: {\n      width: 288,\n      height: 216\n    }\n  },\n  render: function RenderLocalUser({\n    micOn,\n    cameraOn,\n    ...args\n  }: OverviewArgs) {\n    const [client] = useState(() => FakeRTCClient.create({\n      publish: async () => {\n        action(\"IAgoraRTCClient.publish()\")();\n      }\n    }));\n    const audioTrack = useMemo(() => {\n      return micOn ? FakeMicrophoneAudioTrack.create() : null;\n    }, [micOn]);\n    const videoTrack = useMemo(() => {\n      return cameraOn ? FakeCameraVideoTrack.create() : null;\n    }, [cameraOn]);\n    useEffect(() => {\n      if (client && audioTrack) {\n        client.publish(audioTrack);\n      }\n    }, [client, audioTrack]);\n    useEffect(() => {\n      if (client && videoTrack) {\n        client.publish(videoTrack);\n      }\n    }, [client, videoTrack]);\n    return <AgoraRTCProvider client={client}>\n        <LocalUser audioTrack={audioTrack} cameraOn={cameraOn} micOn={micOn} videoTrack={videoTrack} {...args} />\n      </AgoraRTCProvider>;\n  }\n};\nOverview.parameters = {\n  ...Overview.parameters,\n  docs: {\n    ...Overview.parameters?.docs,\n    source: {\n      originalSource: \"{\\n  args: {\\n    micOn: false,\\n    cameraOn: false,\\n    playVideo: false,\\n    playAudio: false,\\n    cover: \\\"https://www.agora.io/en/wp-content/uploads/2022/10/3d-spatial-audio-icon.svg\\\",\\n    style: {\\n      width: 288,\\n      height: 216\\n    }\\n  },\\n  render: function RenderLocalUser({\\n    micOn,\\n    cameraOn,\\n    ...args\\n  }: OverviewArgs) {\\n    const [client] = useState(() => FakeRTCClient.create({\\n      publish: async () => {\\n        action(\\\"IAgoraRTCClient.publish()\\\")();\\n      }\\n    }));\\n    const audioTrack = useMemo(() => {\\n      return micOn ? FakeMicrophoneAudioTrack.create() : null;\\n    }, [micOn]);\\n    const videoTrack = useMemo(() => {\\n      return cameraOn ? FakeCameraVideoTrack.create() : null;\\n    }, [cameraOn]);\\n    useEffect(() => {\\n      if (client && audioTrack) {\\n        client.publish(audioTrack);\\n      }\\n    }, [client, audioTrack]);\\n    useEffect(() => {\\n      if (client && videoTrack) {\\n        client.publish(videoTrack);\\n      }\\n    }, [client, videoTrack]);\\n    return <AgoraRTCProvider client={client}>\\n        <LocalUser audioTrack={audioTrack} cameraOn={cameraOn} micOn={micOn} videoTrack={videoTrack} {...args} />\\n      </AgoraRTCProvider>;\\n  }\\n}\",\n      ...Overview.parameters?.docs?.source\n    }\n  }\n};"],"names":["LocalUser","micOn","cameraOn","audioTrack","videoTrack","playAudio","playVideo","volume","cover","children","style","props","mergedStyle","useMergedStyle","VideoTrackWrapperStyle","jsxs","jsx","LocalVideoTrack","LocalAudioTrack","UserCover","FloatBoxStyle","meta","Overview","args","client","useState","FakeRTCClient","action","useMemo","FakeMicrophoneAudioTrack","FakeCameraVideoTrack","useEffect","AgoraRTCProvider","_a","_c","_b"],"mappings":"okBA4DA,SAAAA,EAAA,CACA,MAAAC,EACA,SAAAC,EACA,WAAAC,EACA,WAAAC,EACA,UAAAC,EACA,UAAAC,EACA,OAAAC,EACA,MAAAC,EACA,SAAAC,EACA,MAAAC,EACA,GAAAC,CACA,EAAA,CACA,MAAAC,EAAAC,EAAAC,EAAAJ,CAAA,EACA,OAAAJ,EAAAA,GAAA,CAAA,CAAAJ,EACAG,EAAAA,GAAA,CAAA,CAAAJ,EAEAc,EAAA,MAAA,CAAA,GAAAJ,EAAA,MAAAC,EACA,SAAA,CAAAI,EAAAC,GAAA,SAAA,CAAAf,EAAA,KAAAI,EAAA,MAAAF,EAAA,EACAY,EAAAE,GAAA,SAAA,CAAAjB,EAAA,KAAAI,EAAA,MAAAF,EAAA,OAAAI,EAAA,EACAC,GAAA,CAAAN,GAAAc,EAAAG,GAAA,MAAAX,CAAA,CAAA,EACAQ,EAAA,MAAA,CAAA,MAAAI,EAAA,SAAAX,CAAA,CAAA,CACA,CAAA,CAAA,CAEA,ovDC7EA,MAAMY,EAAgD,CACpD,MAAO,iBACP,UAAWrB,EACX,KAAM,CAAC,UAAU,EACjB,WAAY,CACV,YAAa,CACX,QAAS,OACX,CACF,CACF,EAOasB,EAAmC,CAC9C,KAAM,CACJ,MAAO,GACP,SAAU,GACV,UAAW,GACX,UAAW,GACX,MAAO,+EACP,MAAO,CACL,MAAO,IACP,OAAQ,GACV,CACF,EACA,OAAQ,SAAyB,CAC/B,MAAArB,EACA,SAAAC,EACA,GAAGqB,CAAA,EACY,CACf,KAAM,CAACC,CAAM,EAAIC,EAAS,SAAA,IAAMC,EAAc,OAAO,CACnD,QAAS,SAAY,CACnBC,EAAO,2BAA2B,GACpC,CACD,CAAA,CAAC,EACIxB,EAAayB,EAAAA,QAAQ,IAClB3B,EAAQ4B,EAAyB,OAAA,EAAW,KAClD,CAAC5B,CAAK,CAAC,EACJG,EAAawB,EAAAA,QAAQ,IAClB1B,EAAW4B,EAAqB,OAAA,EAAW,KACjD,CAAC5B,CAAQ,CAAC,EACb6B,OAAAA,EAAAA,UAAU,IAAM,CACVP,GAAUrB,GACZqB,EAAO,QAAQrB,CAAU,CAC3B,EACC,CAACqB,EAAQrB,CAAU,CAAC,EACvB4B,EAAAA,UAAU,IAAM,CACVP,GAAUpB,GACZoB,EAAO,QAAQpB,CAAU,CAC3B,EACC,CAACoB,EAAQpB,CAAU,CAAC,EAChBY,EAACgB,EAAiB,CAAA,OAAAR,EACrB,SAACR,EAAAhB,EAAA,CAAU,WAAAG,EAAwB,SAAAD,EAAoB,MAAAD,EAAc,WAAAG,EAAyB,GAAGmB,CAAA,CAAM,CACzG,CAAA,CACJ,CACF,YACAD,EAAS,WAAa,CACpB,GAAGA,EAAS,WACZ,KAAM,CACJ,IAAGW,EAAAX,EAAS,aAAT,YAAAW,EAAqB,KACxB,OAAQ,CACN,eAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAChB,IAAGC,GAAAC,EAAAb,EAAS,aAAT,YAAAa,EAAqB,OAArB,YAAAD,EAA2B,MAChC,CACF,CACF"}