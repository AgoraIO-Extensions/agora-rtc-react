var U=Object.defineProperty;var x=(t,e,r)=>e in t?U(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var R=(t,e,r)=>(x(t,typeof e!="symbol"?e+"":e,r),r);import{a as D,j as h}from"./jsx-runtime-670450c2.js";import{u as q,F as P,V as O}from"./styles-2f9d0643.js";import{R as _}from"./RemoteAudioTrack-ad16e331.js";import{R as j}from"./RemoteVideoTrack-a3202365.js";import{u as A,U as L}from"./useRTCClient-8da5010b.js";import{r as l}from"./index-f1f749bf.js";import{l as N,t as M,m as V}from"./TrackBoundary-6e6b0a76.js";function b(t,e,r){return t.on(e,r),()=>t.off(e,r)}function F(t){const e=A(t),[r,s]=l.useState(e?e.connectionState==="CONNECTED":!1);return l.useEffect(()=>{if(e){s(e.connectionState==="CONNECTED");let o;return N([b(e,"connection-state-change",u=>{o==null||o(),o=M(()=>s(u==="CONNECTED"),0)}),()=>o==null?void 0:o()])}else s(!1)},[e]),r}class E extends Error{constructor(r,s){var e=(...args)=>{super(...args);R(this,"rtcMethod");R(this,"rtcError");R(this,"name","AgoraRTCReactException")};e(typeof s=="string"?s:s.message),this.rtcMethod=r,this.rtcError=s}log(r){console[r](this)}}function I(t,e,r){const s=A(r),o=e==="audio"?"audioTrack":"videoTrack",[u,f]=l.useState(t&&t[o]),p=F(),m=l.useRef(),[C,d]=l.useState(!1),[T,k]=l.useState(null);return l.useEffect(()=>{if(!t||!p)return;let a=!1;a||k(null);const S=e==="audio"?"hasAudio":"hasVideo",y=t.uid,w=async(n,c)=>{if(n[o]&&s.remoteUsers.some(({uid:i})=>n.uid===i))try{a||d(!0),await s.unsubscribe(n,c)}catch(i){a||k(new E("IAgoraRTCClient.unsubscribe",i)),console.error(i)}a||(f(void 0),d(!1))},v=async(n,c)=>{try{!n[o]&&s.remoteUsers.some(({uid:i})=>n.uid===i)&&(a||d(!0),await s.subscribe(n,c)),a||f(n[o])}catch(i){a||k(new E("IAgoraRTCClient.subscribe",i)),console.error(i)}a||d(!1)},g=m.current||(m.current=V());return!t[o]&&t[S]?g.run(()=>v(t,e)):f(t[o]),N([()=>{a=!0,g.dispose()},b(s,"user-published",(n,c)=>{n.uid===y&&c===e&&g.run(()=>v(n,e))}),b(s,"user-unpublished",(n,c)=>{n.uid===y&&c===e&&g.run(()=>w(n,e))})])},[p,s,t,e,o]),{track:u,isLoading:C,error:T}}function B({user:t,playVideo:e,playAudio:r,playbackDeviceId:s,volume:o,cover:u,style:f,children:p,...m}){const C=q(O,f),{track:d}=I(t,"video"),{track:T}=I(t,"audio");return e=e??(t==null?void 0:t.hasVideo),r=r??(t==null?void 0:t.hasAudio),D("div",{...m,style:C,children:[h(j,{play:e,track:d}),h(_,{play:r,playbackDeviceId:s,track:T,volume:o}),u&&!e&&h(L,{cover:u}),h("div",{style:P,children:p})]})}B.__docgenInfo={description:"该组件用于播放远端用户的视频和音频轨道，并且仅支持指定使用的音频设备、不支持指定使用的视频设备。",methods:[],displayName:"RemoteUser",props:{user:{required:!1,tsType:{name:"IAgoraRTCRemoteUser"},description:"远端用户对象。详见 [IAgoraRTCRemoteUser](https://docportal.shengwang.cn/cn/live-streaming-premium-4.x/API%20Reference/web_ng/interfaces/iagorartcremoteuser.html)。"},playVideo:{required:!1,tsType:{name:"boolean"},description:"`true`：播放远端用户的视频轨道。`false`：停止播放远端用户的视频轨道。"},playAudio:{required:!1,tsType:{name:"boolean"},description:"`true`：播放远端用户的音频轨道。`false`：停止播放远端用户的音频轨道。"},playbackDeviceId:{required:!1,tsType:{name:"string"},description:"要使用的播放设备 ID，例如扬声器。设备 ID 通过 [getPlaybackDevices](https://docportal.shengwang.cn/cn/live-streaming-premium-4.x/API%20Reference/web_ng/interfaces/iagorartc.html#getplaybackdevices) 获取。该属性仅支持桌面端的 Chrome 浏览器，在其它浏览器上修改该属性的值将会抛出 `NOT_SUPPORTED` 错误。"},volume:{required:!1,tsType:{name:"number"},description:"音量大小。取值范围 [0, 100]，0 代表静音，100 代表原始音量。"},cover:{required:!1,tsType:{name:"union",raw:"string | (() => ReactNode)",elements:[{name:"string"},{name:"unknown"}]},description:"当 `playVideo` 为 `false`时要渲染的封面图片或自定义组件，用于替代视频画面显示。支持传入在线图片的 URL 或本地图片的相对路径。"},children:{required:!1,tsType:{name:"ReactNode"},description:"需要展示的 React 节点。"}},composes:["HTMLProps"]};export{B as R};
//# sourceMappingURL=RemoteUser-bda93cbd.js.map
