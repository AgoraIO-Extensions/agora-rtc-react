import{a as N,j as v}from"./jsx-runtime-670450c2.js";import{R as U}from"./RemoteAudioTrack-f6cbc919.js";import{R as A}from"./RemoteVideoTrack-7670afb5.js";import{u as D,U as I}from"./UserCover-b66f58ee.js";import{u as q,F as x,a as L}from"./styles-7e450fee.js";import{l as w,t as V,m as O,j as P}from"./TrackBoundary-a2d0821a.js";import{r as c}from"./index-f1f749bf.js";function C(e,t,n){return e.on(t,n),()=>e.off(t,n)}function j(e){const t=D(e),[n,s]=c.useState(t?t.connectionState==="CONNECTED":!1);return c.useEffect(()=>{if(t){s(t.connectionState==="CONNECTED");let o;return w([C(t,"connection-state-change",u=>{o==null||o(),o=V(()=>s(u==="CONNECTED"),0)}),()=>o==null?void 0:o()])}else s(!1)},[t]),n}function g(e,t,n){const s=D(n),o=t==="audio"?"audioTrack":"videoTrack",[u,f]=c.useState(e&&e[o]),h=j(),m=c.useRef(),[k,d]=c.useState(!1),[y,b]=c.useState(null);return c.useEffect(()=>{if(!e||!h)return;let a=!1;a||b(null);const S=t==="audio"?"hasAudio":"hasVideo",T=e.uid,E=async(r,l)=>{if(r[o]&&s.remoteUsers.some(({uid:i})=>r.uid===i))try{a||d(!0),await s.unsubscribe(r,l)}catch(i){a||b(i),console.error(i)}a||(f(void 0),d(!1))},R=async(r,l)=>{try{!r[o]&&s.remoteUsers.some(({uid:i})=>r.uid===i)&&(a||d(!0),await s.subscribe(r,l)),a||f(r[o])}catch(i){a||b(i),console.error(i)}a||d(!1)},p=m.current||(m.current=O());return!e[o]&&e[S]?p.run(()=>R(e,t)):f(e[o]),w([()=>{a=!0,p.dispose()},C(s,"user-published",(r,l)=>{r.uid===T&&l===t&&p.run(()=>R(r,t))}),C(s,"user-unpublished",(r,l)=>{r.uid===T&&l===t&&p.run(()=>E(r,t))})])},[h,s,e,t,o]),{track:u,isLoading:k,error:y}}function J(e){const[t,n]=c.useState(0);return c.useEffect(()=>{if(e)return P(()=>{n(e.getVolumeLevel())},1e3)},[e]),t}function W({user:e,playVideo:t,playAudio:n,playbackDeviceId:s,volume:o,cover:u,style:f,children:h,...m}){const k=q(L,f),{track:d}=g(e,"video"),{track:y}=g(e,"audio");return t=t??(e==null?void 0:e.hasVideo),n=n??(e==null?void 0:e.hasAudio),N("div",{...m,style:k,children:[v(A,{play:t,track:d}),v(U,{play:n,playbackDeviceId:s,track:y,volume:o}),u&&!t&&v(I,{cover:u}),v("div",{style:x,children:h})]})}W.__docgenInfo={description:"Subscribe and play remote user video and audio track.\nAn `IAgoraRTCRemoteUser` can only be own by one `RemoteUser`.",methods:[],displayName:"RemoteUser",props:{user:{required:!1,tsType:{name:"IAgoraRTCRemoteUser"},description:"A remote user"},playVideo:{required:!1,tsType:{name:"boolean"},description:"Whether to play the remote user's video track. Default follows `user.hasVideo`."},playAudio:{required:!1,tsType:{name:"boolean"},description:"Whether to play the remote user's audio track. Default follows `user.hasAudio`."},playbackDeviceId:{required:!1,tsType:{name:"string"},description:"Device ID, which can be retrieved by calling `getPlaybackDevices`.\n\nChanges of the ID will invoke `setPlaybackDevice` which sets the audio playback device, for example, the speaker.\n\n> `setPlaybackDevice` supports Chrome on desktop devices only. Other browsers throw a `NOT_SUPPORTED` error when calling the method."},volume:{required:!1,tsType:{name:"number"},description:"The volume. The value ranges from 0 (mute) to 1000 (maximum). A value of 100 is the current volume."},cover:{required:!1,tsType:{name:"union",raw:"string | (() => ReactNode)",elements:[{name:"string"},{name:"unknown"}]},description:"Render cover image if playVideo is off."},children:{required:!1,tsType:{name:"ReactNode"},description:"Children is rendered on top of the video canvas."}},composes:["HTMLProps"]};export{W as R,J as u};
//# sourceMappingURL=RemoteUser-1703880d.js.map
