{"version":3,"file":"TrackBoundary.stories-c7738c0a.js","sources":["../../src/stories/TrackBoundary.stories.tsx"],"sourcesContent":["import { randUuid } from \"@ngneat/falso\";\nimport { action } from \"@storybook/addon-actions\";\nimport type { Meta, StoryObj } from \"@storybook/react\";\nimport type { IAgoraRTCRemoteUser, ITrack } from \"agora-rtc-sdk-ng\";\nimport { FakeRTCClient } from \"fake-agora-rtc\";\nimport { useState } from \"react\";\nimport { RemoteUser, TrackBoundary } from \"../components\";\nimport { AgoraRTCProvider } from \"../hooks\";\ninterface Controls {\n  direction: \"row\" | \"column\";\n  show: boolean;\n}\nconst meta: Meta = {\n  title: \"Tools/TrackBoundary\",\n  tags: [\"autodocs\"],\n  component: TrackBoundary,\n  argTypes: {\n    direction: {\n      name: \"Layout Direction\",\n      description: \"[Demo Only] Horizontal or vertical layout\",\n      table: {\n        defaultValue: {\n          summary: \"row\"\n        }\n      },\n      type: \"string\",\n      options: [\"row\", \"column\"],\n      control: {\n        type: \"select\"\n      }\n    },\n    show: {\n      name: \"Show\",\n      description: \"[Demo Only] Show or hide the entire component\",\n      table: {\n        defaultValue: {\n          summary: \"true\"\n        }\n      },\n      type: \"boolean\",\n      control: {\n        type: \"boolean\"\n      }\n    }\n  },\n  args: {\n    direction: \"row\",\n    show: true\n  },\n  decorators: [Story => {\n    const [client] = useState(() => FakeRTCClient.create(client => {\n      const subscribe = client.subscribe.bind(client);\n      return {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        subscribe: async (user, mediaType): Promise<any> => {\n          const track = await subscribe(user, mediaType);\n          logTrackStop(track, () => action(`${mediaType === \"audio\" ? \"AudioTrack\" : \"VideoTrack\"}.stop()`)(user.uid));\n          return track;\n        }\n      };\n    }));\n    return <AgoraRTCProvider client={client}>{Story()}</AgoraRTCProvider>;\n  }]\n};\nexport default meta;\nexport const LayoutSwitchWithTrackBoundary: StoryObj<Controls> = {\n  parameters: {\n    docs: {\n      description: {\n        story: \"With TrackBoundary, Track Players will not trigger `track.stop()` on unmount. Tracks will be stopped if inactive or TrackBoundary unmounts.\"\n      }\n    }\n  },\n  render: function LayoutSwitchWithTrackBoundary({\n    direction,\n    show\n  }) {\n    const [users] = useState<IAgoraRTCRemoteUser[]>(() => [{\n      uid: randUuid(),\n      hasVideo: true,\n      hasAudio: true\n    }, {\n      uid: randUuid(),\n      hasVideo: true,\n      hasAudio: true\n    }]);\n    return show ? <TrackBoundary>\n        <div style={{\n        display: \"flex\",\n        gap: 8,\n        flexDirection: direction\n      }}>\n          {users.map(user => <RemoteUser key={direction + user.uid} playAudio playVideo user={user} />)}\n        </div>\n      </TrackBoundary> : <></>;\n  }\n};\nexport const LayoutSwitchWithoutTrackBoundary: StoryObj<Controls> = {\n  parameters: {\n    docs: {\n      description: {\n        story: \"Without TrackBoundary, Track Players will trigger `track.stop()` on unmount.\"\n      }\n    }\n  },\n  render: function LayoutSwitchWithoutTrackBoundary({\n    direction,\n    show\n  }) {\n    const [users] = useState<IAgoraRTCRemoteUser[]>(() => [{\n      uid: randUuid(),\n      hasVideo: true,\n      hasAudio: true\n    }, {\n      uid: randUuid(),\n      hasVideo: true,\n      hasAudio: true\n    }]);\n    return show ? <div style={{\n      display: \"flex\",\n      gap: 8,\n      flexDirection: direction\n    }}>\n        {users.map(user => <RemoteUser key={direction + user.uid} playAudio playVideo user={user} />)}\n      </div> : <></>;\n  }\n};\nfunction logTrackStop(track: ITrack, onStop: () => void) {\n  const realStop = track.stop;\n  track.stop = function stop() {\n    onStop();\n    realStop.call(this);\n  };\n}\nLayoutSwitchWithTrackBoundary.parameters = {\n  ...LayoutSwitchWithTrackBoundary.parameters,\n  docs: {\n    ...LayoutSwitchWithTrackBoundary.parameters?.docs,\n    source: {\n      originalSource: \"{\\n  parameters: {\\n    docs: {\\n      description: {\\n        story: \\\"With TrackBoundary, Track Players will not trigger `track.stop()` on unmount. Tracks will be stopped if inactive or TrackBoundary unmounts.\\\"\\n      }\\n    }\\n  },\\n  render: function LayoutSwitchWithTrackBoundary({\\n    direction,\\n    show\\n  }) {\\n    const [users] = useState<IAgoraRTCRemoteUser[]>(() => [{\\n      uid: randUuid(),\\n      hasVideo: true,\\n      hasAudio: true\\n    }, {\\n      uid: randUuid(),\\n      hasVideo: true,\\n      hasAudio: true\\n    }]);\\n    return show ? <TrackBoundary>\\n        <div style={{\\n        display: \\\"flex\\\",\\n        gap: 8,\\n        flexDirection: direction\\n      }}>\\n          {users.map(user => <RemoteUser key={direction + user.uid} playAudio playVideo user={user} />)}\\n        </div>\\n      </TrackBoundary> : <></>;\\n  }\\n}\",\n      ...LayoutSwitchWithTrackBoundary.parameters?.docs?.source\n    }\n  }\n};\nLayoutSwitchWithoutTrackBoundary.parameters = {\n  ...LayoutSwitchWithoutTrackBoundary.parameters,\n  docs: {\n    ...LayoutSwitchWithoutTrackBoundary.parameters?.docs,\n    source: {\n      originalSource: \"{\\n  parameters: {\\n    docs: {\\n      description: {\\n        story: \\\"Without TrackBoundary, Track Players will trigger `track.stop()` on unmount.\\\"\\n      }\\n    }\\n  },\\n  render: function LayoutSwitchWithoutTrackBoundary({\\n    direction,\\n    show\\n  }) {\\n    const [users] = useState<IAgoraRTCRemoteUser[]>(() => [{\\n      uid: randUuid(),\\n      hasVideo: true,\\n      hasAudio: true\\n    }, {\\n      uid: randUuid(),\\n      hasVideo: true,\\n      hasAudio: true\\n    }]);\\n    return show ? <div style={{\\n      display: \\\"flex\\\",\\n      gap: 8,\\n      flexDirection: direction\\n    }}>\\n        {users.map(user => <RemoteUser key={direction + user.uid} playAudio playVideo user={user} />)}\\n      </div> : <></>;\\n  }\\n}\",\n      ...LayoutSwitchWithoutTrackBoundary.parameters?.docs?.source\n    }\n  }\n};"],"names":["meta","TrackBoundary","Story","client","useState","FakeRTCClient","subscribe","user","mediaType","track","logTrackStop","action","jsx","AgoraRTCProvider","LayoutSwitchWithTrackBoundary","direction","show","users","randUuid","RemoteUser","Fragment","LayoutSwitchWithoutTrackBoundary","onStop","realStop","_a","_c","_b"],"mappings":"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"}