var I=Object.defineProperty;var U=(t,e,o)=>e in t?I(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var v=(t,e,o)=>(U(t,typeof e!="symbol"?e+"":e,o),o);import{a as x,j as k}from"./jsx-runtime-670450c2.js";import{R as q}from"./RemoteAudioTrack-f6cbc919.js";import{R as L}from"./RemoteVideoTrack-7670afb5.js";import{u as D,U as V}from"./UserCover-b66f58ee.js";import{u as O,F as P,a as j}from"./styles-7e450fee.js";import{l as A,t as M,m as W,j as _}from"./TrackBoundary-a2d0821a.js";import{r as c}from"./index-f1f749bf.js";function C(t,e,o){return t.on(e,o),()=>t.off(e,o)}class E extends Error{constructor(o,r){var e=(...args)=>{super(...args);v(this,"rtcMethod");v(this,"rtcError");v(this,"name","AgoraRTCReactException")};e(typeof r=="string"?r:r.message),this.rtcMethod=o,this.rtcError=r}print(o){typeof this.rtcError=="string"?console[o](this.rtcError):console[o](this.rtcError.message)}}function F(t){const e=D(t),[o,r]=c.useState(e?e.connectionState==="CONNECTED":!1);return c.useEffect(()=>{if(e){r(e.connectionState==="CONNECTED");let s;return A([C(e,"connection-state-change",u=>{s==null||s(),s=M(()=>r(u==="CONNECTED"),0)}),()=>s==null?void 0:s()])}else r(!1)},[e]),o}function w(t,e,o){const r=D(o),s=e==="audio"?"audioTrack":"videoTrack",[u,f]=c.useState(t&&t[s]),h=F(),m=c.useRef(),[b,d]=c.useState(!1),[g,y]=c.useState(null);return c.useEffect(()=>{if(!t||!h)return;let a=!1;a||y(null);const S=e==="audio"?"hasAudio":"hasVideo",R=t.uid,N=async(n,l)=>{if(n[s]&&r.remoteUsers.some(({uid:i})=>n.uid===i))try{a||d(!0),await r.unsubscribe(n,l)}catch(i){a||y(new E("IAgoraRTCClient.unsubscribe",i)),console.error(i)}a||(f(void 0),d(!1))},T=async(n,l)=>{try{!n[s]&&r.remoteUsers.some(({uid:i})=>n.uid===i)&&(a||d(!0),await r.subscribe(n,l)),a||f(n[s])}catch(i){a||y(new E("IAgoraRTCClient.subscribe",i)),console.error(i)}a||d(!1)},p=m.current||(m.current=W());return!t[s]&&t[S]?p.run(()=>T(t,e)):f(t[s]),A([()=>{a=!0,p.dispose()},C(r,"user-published",(n,l)=>{n.uid===R&&l===e&&p.run(()=>T(n,e))}),C(r,"user-unpublished",(n,l)=>{n.uid===R&&l===e&&p.run(()=>N(n,e))})])},[h,r,t,e,s]),{track:u,isLoading:b,error:g}}function Z(t){const[e,o]=c.useState(0);return c.useEffect(()=>{if(t)return _(()=>{o(t.getVolumeLevel())},1e3)},[t]),e}function B({user:t,playVideo:e,playAudio:o,playbackDeviceId:r,volume:s,cover:u,style:f,children:h,...m}){const b=O(j,f),{track:d}=w(t,"video"),{track:g}=w(t,"audio");return e=e??(t==null?void 0:t.hasVideo),o=o??(t==null?void 0:t.hasAudio),x("div",{...m,style:b,children:[k(L,{play:e,track:d}),k(q,{play:o,playbackDeviceId:r,track:g,volume:s}),u&&!e&&k(V,{cover:u}),k("div",{style:P,children:h})]})}B.__docgenInfo={description:"Subscribe and play remote user video and audio track.\nAn `IAgoraRTCRemoteUser` can only be own by one `RemoteUser`.",methods:[],displayName:"RemoteUser",props:{user:{required:!1,tsType:{name:"IAgoraRTCRemoteUser"},description:"A remote user"},playVideo:{required:!1,tsType:{name:"boolean"},description:"Whether to play the remote user's video track. Default follows `user.hasVideo`."},playAudio:{required:!1,tsType:{name:"boolean"},description:"Whether to play the remote user's audio track. Default follows `user.hasAudio`."},playbackDeviceId:{required:!1,tsType:{name:"string"},description:"Device ID, which can be retrieved by calling `getPlaybackDevices`.\n\nChanges of the ID will invoke `setPlaybackDevice` which sets the audio playback device, for example, the speaker.\n\n> `setPlaybackDevice` supports Chrome on desktop devices only. Other browsers throw a `NOT_SUPPORTED` error when calling the method."},volume:{required:!1,tsType:{name:"number"},description:"The volume. The value ranges from 0 (mute) to 1000 (maximum). A value of 100 is the current volume."},cover:{required:!1,tsType:{name:"union",raw:"string | (() => ReactNode)",elements:[{name:"string"},{name:"unknown"}]},description:"Render cover image if playVideo is off."},children:{required:!1,tsType:{name:"ReactNode"},description:"Children is rendered on top of the video canvas."}},composes:["HTMLProps"]};export{B as R,Z as u};
//# sourceMappingURL=RemoteUser-a3446431.js.map
