var D6=Object.defineProperty;var k6=(r,o,a)=>o in r?D6(r,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[o]=a;var Tt=(r,o,a)=>(k6(r,typeof o!="symbol"?o+"":o,a),a);(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))c(l);new MutationObserver(l=>{for(const f of l)if(f.type==="childList")for(const v of f.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&c(v)}).observe(document,{childList:!0,subtree:!0});function a(l){const f={};return l.integrity&&(f.integrity=l.integrity),l.referrerPolicy&&(f.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?f.credentials="include":l.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function c(l){if(l.ep)return;l.ep=!0;const f=a(l);fetch(l.href,f)}})();var tt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qP(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function L6(r){if(r.__esModule)return r;var o=r.default;if(typeof o=="function"){var a=function c(){if(this instanceof c){var l=[null];l.push.apply(l,arguments);var f=Function.bind.apply(o,l);return new f}return o.apply(this,arguments)};a.prototype=o.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(r).forEach(function(c){var l=Object.getOwnPropertyDescriptor(r,c);Object.defineProperty(a,c,l.get?l:{enumerable:!0,get:function(){return r[c]}})}),a}var qd={},x6={get exports(){return qd},set exports(r){qd=r}},g0={},Ye={},M6={get exports(){return Ye},set exports(r){Ye=r}},It={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vl=Symbol.for("react.element"),U6=Symbol.for("react.portal"),V6=Symbol.for("react.fragment"),B6=Symbol.for("react.strict_mode"),j6=Symbol.for("react.profiler"),F6=Symbol.for("react.provider"),G6=Symbol.for("react.context"),W6=Symbol.for("react.forward_ref"),H6=Symbol.for("react.suspense"),K6=Symbol.for("react.memo"),z6=Symbol.for("react.lazy"),DN=Symbol.iterator;function Y6(r){return r===null||typeof r!="object"?null:(r=DN&&r[DN]||r["@@iterator"],typeof r=="function"?r:null)}var JP={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},XP=Object.assign,QP={};function Ru(r,o,a){this.props=r,this.context=o,this.refs=QP,this.updater=a||JP}Ru.prototype.isReactComponent={};Ru.prototype.setState=function(r,o){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,o,"setState")};Ru.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function $P(){}$P.prototype=Ru.prototype;function Zg(r,o,a){this.props=r,this.context=o,this.refs=QP,this.updater=a||JP}var eS=Zg.prototype=new $P;eS.constructor=Zg;XP(eS,Ru.prototype);eS.isPureReactComponent=!0;var kN=Array.isArray,ZP=Object.prototype.hasOwnProperty,tS={current:null},eD={key:!0,ref:!0,__self:!0,__source:!0};function tD(r,o,a){var c,l={},f=null,v=null;if(o!=null)for(c in o.ref!==void 0&&(v=o.ref),o.key!==void 0&&(f=""+o.key),o)ZP.call(o,c)&&!eD.hasOwnProperty(c)&&(l[c]=o[c]);var R=arguments.length-2;if(R===1)l.children=a;else if(1<R){for(var T=Array(R),C=0;C<R;C++)T[C]=arguments[C+2];l.children=T}if(r&&r.defaultProps)for(c in R=r.defaultProps,R)l[c]===void 0&&(l[c]=R[c]);return{$$typeof:vl,type:r,key:f,ref:v,props:l,_owner:tS.current}}function q6(r,o){return{$$typeof:vl,type:r.type,key:o,ref:r.ref,props:r.props,_owner:r._owner}}function nS(r){return typeof r=="object"&&r!==null&&r.$$typeof===vl}function J6(r){var o={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(a){return o[a]})}var LN=/\/+/g;function dv(r,o){return typeof r=="object"&&r!==null&&r.key!=null?J6(""+r.key):o.toString(36)}function Gp(r,o,a,c,l){var f=typeof r;(f==="undefined"||f==="boolean")&&(r=null);var v=!1;if(r===null)v=!0;else switch(f){case"string":case"number":v=!0;break;case"object":switch(r.$$typeof){case vl:case U6:v=!0}}if(v)return v=r,l=l(v),r=c===""?"."+dv(v,0):c,kN(l)?(a="",r!=null&&(a=r.replace(LN,"$&/")+"/"),Gp(l,o,a,"",function(C){return C})):l!=null&&(nS(l)&&(l=q6(l,a+(!l.key||v&&v.key===l.key?"":(""+l.key).replace(LN,"$&/")+"/")+r)),o.push(l)),1;if(v=0,c=c===""?".":c+":",kN(r))for(var R=0;R<r.length;R++){f=r[R];var T=c+dv(f,R);v+=Gp(f,o,a,T,l)}else if(T=Y6(r),typeof T=="function")for(r=T.call(r),R=0;!(f=r.next()).done;)f=f.value,T=c+dv(f,R++),v+=Gp(f,o,a,T,l);else if(f==="object")throw o=String(r),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return v}function Sp(r,o,a){if(r==null)return r;var c=[],l=0;return Gp(r,c,"","",function(f){return o.call(a,f,l++)}),c}function X6(r){if(r._status===-1){var o=r._result;o=o(),o.then(function(a){(r._status===0||r._status===-1)&&(r._status=1,r._result=a)},function(a){(r._status===0||r._status===-1)&&(r._status=2,r._result=a)}),r._status===-1&&(r._status=0,r._result=o)}if(r._status===1)return r._result.default;throw r._result}var Lr={current:null},Wp={transition:null},Q6={ReactCurrentDispatcher:Lr,ReactCurrentBatchConfig:Wp,ReactCurrentOwner:tS};It.Children={map:Sp,forEach:function(r,o,a){Sp(r,function(){o.apply(this,arguments)},a)},count:function(r){var o=0;return Sp(r,function(){o++}),o},toArray:function(r){return Sp(r,function(o){return o})||[]},only:function(r){if(!nS(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};It.Component=Ru;It.Fragment=V6;It.Profiler=j6;It.PureComponent=Zg;It.StrictMode=B6;It.Suspense=H6;It.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Q6;It.cloneElement=function(r,o,a){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var c=XP({},r.props),l=r.key,f=r.ref,v=r._owner;if(o!=null){if(o.ref!==void 0&&(f=o.ref,v=tS.current),o.key!==void 0&&(l=""+o.key),r.type&&r.type.defaultProps)var R=r.type.defaultProps;for(T in o)ZP.call(o,T)&&!eD.hasOwnProperty(T)&&(c[T]=o[T]===void 0&&R!==void 0?R[T]:o[T])}var T=arguments.length-2;if(T===1)c.children=a;else if(1<T){R=Array(T);for(var C=0;C<T;C++)R[C]=arguments[C+2];c.children=R}return{$$typeof:vl,type:r.type,key:l,ref:f,props:c,_owner:v}};It.createContext=function(r){return r={$$typeof:G6,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:F6,_context:r},r.Consumer=r};It.createElement=tD;It.createFactory=function(r){var o=tD.bind(null,r);return o.type=r,o};It.createRef=function(){return{current:null}};It.forwardRef=function(r){return{$$typeof:W6,render:r}};It.isValidElement=nS;It.lazy=function(r){return{$$typeof:z6,_payload:{_status:-1,_result:r},_init:X6}};It.memo=function(r,o){return{$$typeof:K6,type:r,compare:o===void 0?null:o}};It.startTransition=function(r){var o=Wp.transition;Wp.transition={};try{r()}finally{Wp.transition=o}};It.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};It.useCallback=function(r,o){return Lr.current.useCallback(r,o)};It.useContext=function(r){return Lr.current.useContext(r)};It.useDebugValue=function(){};It.useDeferredValue=function(r){return Lr.current.useDeferredValue(r)};It.useEffect=function(r,o){return Lr.current.useEffect(r,o)};It.useId=function(){return Lr.current.useId()};It.useImperativeHandle=function(r,o,a){return Lr.current.useImperativeHandle(r,o,a)};It.useInsertionEffect=function(r,o){return Lr.current.useInsertionEffect(r,o)};It.useLayoutEffect=function(r,o){return Lr.current.useLayoutEffect(r,o)};It.useMemo=function(r,o){return Lr.current.useMemo(r,o)};It.useReducer=function(r,o,a){return Lr.current.useReducer(r,o,a)};It.useRef=function(r){return Lr.current.useRef(r)};It.useState=function(r){return Lr.current.useState(r)};It.useSyncExternalStore=function(r,o,a){return Lr.current.useSyncExternalStore(r,o,a)};It.useTransition=function(){return Lr.current.useTransition()};It.version="18.2.0";(function(r){r.exports=It})(M6);const yd=qP(Ye);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $6=Ye,Z6=Symbol.for("react.element"),e5=Symbol.for("react.fragment"),t5=Object.prototype.hasOwnProperty,n5=$6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r5={key:!0,ref:!0,__self:!0,__source:!0};function nD(r,o,a){var c,l={},f=null,v=null;a!==void 0&&(f=""+a),o.key!==void 0&&(f=""+o.key),o.ref!==void 0&&(v=o.ref);for(c in o)t5.call(o,c)&&!r5.hasOwnProperty(c)&&(l[c]=o[c]);if(r&&r.defaultProps)for(c in o=r.defaultProps,o)l[c]===void 0&&(l[c]=o[c]);return{$$typeof:Z6,type:r,key:f,ref:v,props:l,_owner:n5.current}}g0.Fragment=e5;g0.jsx=nD;g0.jsxs=nD;(function(r){r.exports=g0})(x6);const S0=qd.Fragment,Re=qd.jsx,Nt=qd.jsxs;var sf={},i5={get exports(){return sf},set exports(r){sf=r}},gi={},Wv={},o5={get exports(){return Wv},set exports(r){Wv=r}},rD={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function o(Te,Me){var ke=Te.length;Te.push(Me);e:for(;0<ke;){var ae=ke-1>>>1,pe=Te[ae];if(0<l(pe,Me))Te[ae]=Me,Te[ke]=pe,ke=ae;else break e}}function a(Te){return Te.length===0?null:Te[0]}function c(Te){if(Te.length===0)return null;var Me=Te[0],ke=Te.pop();if(ke!==Me){Te[0]=ke;e:for(var ae=0,pe=Te.length,ge=pe>>>1;ae<ge;){var me=2*(ae+1)-1,Vt=Te[me],vt=me+1,An=Te[vt];if(0>l(Vt,ke))vt<pe&&0>l(An,Vt)?(Te[ae]=An,Te[vt]=ke,ae=vt):(Te[ae]=Vt,Te[me]=ke,ae=me);else if(vt<pe&&0>l(An,ke))Te[ae]=An,Te[vt]=ke,ae=vt;else break e}}return Me}function l(Te,Me){var ke=Te.sortIndex-Me.sortIndex;return ke!==0?ke:Te.id-Me.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;r.unstable_now=function(){return f.now()}}else{var v=Date,R=v.now();r.unstable_now=function(){return v.now()-R}}var T=[],C=[],O=1,N=null,w=3,B=!1,U=!1,W=!1,q=typeof setTimeout=="function"?setTimeout:null,G=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function M(Te){for(var Me=a(C);Me!==null;){if(Me.callback===null)c(C);else if(Me.startTime<=Te)c(C),Me.sortIndex=Me.expirationTime,o(T,Me);else break;Me=a(C)}}function j(Te){if(W=!1,M(Te),!U)if(a(T)!==null)U=!0,He(K);else{var Me=a(C);Me!==null&&kt(j,Me.startTime-Te)}}function K(Te,Me){U=!1,W&&(W=!1,G($),$=-1),B=!0;var ke=w;try{for(M(Me),N=a(T);N!==null&&(!(N.expirationTime>Me)||Te&&!te());){var ae=N.callback;if(typeof ae=="function"){N.callback=null,w=N.priorityLevel;var pe=ae(N.expirationTime<=Me);Me=r.unstable_now(),typeof pe=="function"?N.callback=pe:N===a(T)&&c(T),M(Me)}else c(T);N=a(T)}if(N!==null)var ge=!0;else{var me=a(C);me!==null&&kt(j,me.startTime-Me),ge=!1}return ge}finally{N=null,w=ke,B=!1}}var Y=!1,Q=null,$=-1,ue=5,J=-1;function te(){return!(r.unstable_now()-J<ue)}function le(){if(Q!==null){var Te=r.unstable_now();J=Te;var Me=!0;try{Me=Q(!0,Te)}finally{Me?he():(Y=!1,Q=null)}}else Y=!1}var he;if(typeof b=="function")he=function(){b(le)};else if(typeof MessageChannel<"u"){var Pe=new MessageChannel,We=Pe.port2;Pe.port1.onmessage=le,he=function(){We.postMessage(null)}}else he=function(){q(le,0)};function He(Te){Q=Te,Y||(Y=!0,he())}function kt(Te,Me){$=q(function(){Te(r.unstable_now())},Me)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(Te){Te.callback=null},r.unstable_continueExecution=function(){U||B||(U=!0,He(K))},r.unstable_forceFrameRate=function(Te){0>Te||125<Te?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ue=0<Te?Math.floor(1e3/Te):5},r.unstable_getCurrentPriorityLevel=function(){return w},r.unstable_getFirstCallbackNode=function(){return a(T)},r.unstable_next=function(Te){switch(w){case 1:case 2:case 3:var Me=3;break;default:Me=w}var ke=w;w=Me;try{return Te()}finally{w=ke}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(Te,Me){switch(Te){case 1:case 2:case 3:case 4:case 5:break;default:Te=3}var ke=w;w=Te;try{return Me()}finally{w=ke}},r.unstable_scheduleCallback=function(Te,Me,ke){var ae=r.unstable_now();switch(typeof ke=="object"&&ke!==null?(ke=ke.delay,ke=typeof ke=="number"&&0<ke?ae+ke:ae):ke=ae,Te){case 1:var pe=-1;break;case 2:pe=250;break;case 5:pe=1073741823;break;case 4:pe=1e4;break;default:pe=5e3}return pe=ke+pe,Te={id:O++,callback:Me,priorityLevel:Te,startTime:ke,expirationTime:pe,sortIndex:-1},ke>ae?(Te.sortIndex=ke,o(C,Te),a(T)===null&&Te===a(C)&&(W?(G($),$=-1):W=!0,kt(j,ke-ae))):(Te.sortIndex=pe,o(T,Te),U||B||(U=!0,He(K))),Te},r.unstable_shouldYield=te,r.unstable_wrapCallback=function(Te){var Me=w;return function(){var ke=w;w=Me;try{return Te.apply(this,arguments)}finally{w=ke}}}})(rD);(function(r){r.exports=rD})(o5);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iD=Ye,vi=Wv;function Ce(r){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+r,a=1;a<arguments.length;a++)o+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+r+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var oD=new Set,Jd={};function Wa(r,o){lu(r,o),lu(r+"Capture",o)}function lu(r,o){for(Jd[r]=o,r=0;r<o.length;r++)oD.add(o[r])}var Zo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Hv=Object.prototype.hasOwnProperty,s5=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,xN={},MN={};function a5(r){return Hv.call(MN,r)?!0:Hv.call(xN,r)?!1:s5.test(r)?MN[r]=!0:(xN[r]=!0,!1)}function c5(r,o,a,c){if(a!==null&&a.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return c?!1:a!==null?!a.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function u5(r,o,a,c){if(o===null||typeof o>"u"||c5(r,o,a,c))return!0;if(c)return!1;if(a!==null)switch(a.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function xr(r,o,a,c,l,f,v){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=c,this.attributeNamespace=l,this.mustUseProperty=a,this.propertyName=r,this.type=o,this.sanitizeURL=f,this.removeEmptyString=v}var pr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){pr[r]=new xr(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var o=r[0];pr[o]=new xr(o,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){pr[r]=new xr(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){pr[r]=new xr(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){pr[r]=new xr(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){pr[r]=new xr(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){pr[r]=new xr(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){pr[r]=new xr(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){pr[r]=new xr(r,5,!1,r.toLowerCase(),null,!1,!1)});var rS=/[\-:]([a-z])/g;function iS(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var o=r.replace(rS,iS);pr[o]=new xr(o,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var o=r.replace(rS,iS);pr[o]=new xr(o,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var o=r.replace(rS,iS);pr[o]=new xr(o,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){pr[r]=new xr(r,1,!1,r.toLowerCase(),null,!1,!1)});pr.xlinkHref=new xr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){pr[r]=new xr(r,1,!1,r.toLowerCase(),null,!0,!0)});function oS(r,o,a,c){var l=pr.hasOwnProperty(o)?pr[o]:null;(l!==null?l.type!==0:c||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(u5(o,a,l,c)&&(a=null),c||l===null?a5(o)&&(a===null?r.removeAttribute(o):r.setAttribute(o,""+a)):l.mustUseProperty?r[l.propertyName]=a===null?l.type===3?!1:"":a:(o=l.attributeName,c=l.attributeNamespace,a===null?r.removeAttribute(o):(l=l.type,a=l===3||l===4&&a===!0?"":""+a,c?r.setAttributeNS(c,o,a):r.setAttribute(o,a))))}var is=iD.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Tp=Symbol.for("react.element"),Wc=Symbol.for("react.portal"),Hc=Symbol.for("react.fragment"),sS=Symbol.for("react.strict_mode"),Kv=Symbol.for("react.profiler"),sD=Symbol.for("react.provider"),aD=Symbol.for("react.context"),aS=Symbol.for("react.forward_ref"),zv=Symbol.for("react.suspense"),Yv=Symbol.for("react.suspense_list"),cS=Symbol.for("react.memo"),ks=Symbol.for("react.lazy"),cD=Symbol.for("react.offscreen"),UN=Symbol.iterator;function Rd(r){return r===null||typeof r!="object"?null:(r=UN&&r[UN]||r["@@iterator"],typeof r=="function"?r:null)}var Rn=Object.assign,lv;function Pd(r){if(lv===void 0)try{throw Error()}catch(a){var o=a.stack.trim().match(/\n( *(at )?)/);lv=o&&o[1]||""}return`
`+lv+r}var hv=!1;function pv(r,o){if(!r||hv)return"";hv=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(C){var c=C}Reflect.construct(r,[],o)}else{try{o.call()}catch(C){c=C}r.call(o.prototype)}else{try{throw Error()}catch(C){c=C}r()}}catch(C){if(C&&c&&typeof C.stack=="string"){for(var l=C.stack.split(`
`),f=c.stack.split(`
`),v=l.length-1,R=f.length-1;1<=v&&0<=R&&l[v]!==f[R];)R--;for(;1<=v&&0<=R;v--,R--)if(l[v]!==f[R]){if(v!==1||R!==1)do if(v--,R--,0>R||l[v]!==f[R]){var T=`
`+l[v].replace(" at new "," at ");return r.displayName&&T.includes("<anonymous>")&&(T=T.replace("<anonymous>",r.displayName)),T}while(1<=v&&0<=R);break}}}finally{hv=!1,Error.prepareStackTrace=a}return(r=r?r.displayName||r.name:"")?Pd(r):""}function d5(r){switch(r.tag){case 5:return Pd(r.type);case 16:return Pd("Lazy");case 13:return Pd("Suspense");case 19:return Pd("SuspenseList");case 0:case 2:case 15:return r=pv(r.type,!1),r;case 11:return r=pv(r.type.render,!1),r;case 1:return r=pv(r.type,!0),r;default:return""}}function qv(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Hc:return"Fragment";case Wc:return"Portal";case Kv:return"Profiler";case sS:return"StrictMode";case zv:return"Suspense";case Yv:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case aD:return(r.displayName||"Context")+".Consumer";case sD:return(r._context.displayName||"Context")+".Provider";case aS:var o=r.render;return r=r.displayName,r||(r=o.displayName||o.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case cS:return o=r.displayName||null,o!==null?o:qv(r.type)||"Memo";case ks:o=r._payload,r=r._init;try{return qv(r(o))}catch{}}return null}function l5(r){var o=r.type;switch(r.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=o.render,r=r.displayName||r.name||"",o.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return qv(o);case 8:return o===sS?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function Js(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function uD(r){var o=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function h5(r){var o=uD(r)?"checked":"value",a=Object.getOwnPropertyDescriptor(r.constructor.prototype,o),c=""+r[o];if(!r.hasOwnProperty(o)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var l=a.get,f=a.set;return Object.defineProperty(r,o,{configurable:!0,get:function(){return l.call(this)},set:function(v){c=""+v,f.call(this,v)}}),Object.defineProperty(r,o,{enumerable:a.enumerable}),{getValue:function(){return c},setValue:function(v){c=""+v},stopTracking:function(){r._valueTracker=null,delete r[o]}}}}function yp(r){r._valueTracker||(r._valueTracker=h5(r))}function dD(r){if(!r)return!1;var o=r._valueTracker;if(!o)return!0;var a=o.getValue(),c="";return r&&(c=uD(r)?r.checked?"true":"false":r.value),r=c,r!==a?(o.setValue(r),!0):!1}function af(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function Jv(r,o){var a=o.checked;return Rn({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??r._wrapperState.initialChecked})}function VN(r,o){var a=o.defaultValue==null?"":o.defaultValue,c=o.checked!=null?o.checked:o.defaultChecked;a=Js(o.value!=null?o.value:a),r._wrapperState={initialChecked:c,initialValue:a,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function lD(r,o){o=o.checked,o!=null&&oS(r,"checked",o,!1)}function Xv(r,o){lD(r,o);var a=Js(o.value),c=o.type;if(a!=null)c==="number"?(a===0&&r.value===""||r.value!=a)&&(r.value=""+a):r.value!==""+a&&(r.value=""+a);else if(c==="submit"||c==="reset"){r.removeAttribute("value");return}o.hasOwnProperty("value")?Qv(r,o.type,a):o.hasOwnProperty("defaultValue")&&Qv(r,o.type,Js(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(r.defaultChecked=!!o.defaultChecked)}function BN(r,o,a){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var c=o.type;if(!(c!=="submit"&&c!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+r._wrapperState.initialValue,a||o===r.value||(r.value=o),r.defaultValue=o}a=r.name,a!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,a!==""&&(r.name=a)}function Qv(r,o,a){(o!=="number"||af(r.ownerDocument)!==r)&&(a==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+a&&(r.defaultValue=""+a))}var Dd=Array.isArray;function iu(r,o,a,c){if(r=r.options,o){o={};for(var l=0;l<a.length;l++)o["$"+a[l]]=!0;for(a=0;a<r.length;a++)l=o.hasOwnProperty("$"+r[a].value),r[a].selected!==l&&(r[a].selected=l),l&&c&&(r[a].defaultSelected=!0)}else{for(a=""+Js(a),o=null,l=0;l<r.length;l++){if(r[l].value===a){r[l].selected=!0,c&&(r[l].defaultSelected=!0);return}o!==null||r[l].disabled||(o=r[l])}o!==null&&(o.selected=!0)}}function $v(r,o){if(o.dangerouslySetInnerHTML!=null)throw Error(Ce(91));return Rn({},o,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function jN(r,o){var a=o.value;if(a==null){if(a=o.children,o=o.defaultValue,a!=null){if(o!=null)throw Error(Ce(92));if(Dd(a)){if(1<a.length)throw Error(Ce(93));a=a[0]}o=a}o==null&&(o=""),a=o}r._wrapperState={initialValue:Js(a)}}function hD(r,o){var a=Js(o.value),c=Js(o.defaultValue);a!=null&&(a=""+a,a!==r.value&&(r.value=a),o.defaultValue==null&&r.defaultValue!==a&&(r.defaultValue=a)),c!=null&&(r.defaultValue=""+c)}function FN(r){var o=r.textContent;o===r._wrapperState.initialValue&&o!==""&&o!==null&&(r.value=o)}function pD(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Zv(r,o){return r==null||r==="http://www.w3.org/1999/xhtml"?pD(o):r==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var Rp,fD=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,a,c,l){MSApp.execUnsafeLocalFunction(function(){return r(o,a,c,l)})}:r}(function(r,o){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=o;else{for(Rp=Rp||document.createElement("div"),Rp.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=Rp.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;o.firstChild;)r.appendChild(o.firstChild)}});function Xd(r,o){if(o){var a=r.firstChild;if(a&&a===r.lastChild&&a.nodeType===3){a.nodeValue=o;return}}r.textContent=o}var Ud={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},p5=["Webkit","ms","Moz","O"];Object.keys(Ud).forEach(function(r){p5.forEach(function(o){o=o+r.charAt(0).toUpperCase()+r.substring(1),Ud[o]=Ud[r]})});function _D(r,o,a){return o==null||typeof o=="boolean"||o===""?"":a||typeof o!="number"||o===0||Ud.hasOwnProperty(r)&&Ud[r]?(""+o).trim():o+"px"}function mD(r,o){r=r.style;for(var a in o)if(o.hasOwnProperty(a)){var c=a.indexOf("--")===0,l=_D(a,o[a],c);a==="float"&&(a="cssFloat"),c?r.setProperty(a,l):r[a]=l}}var f5=Rn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function eg(r,o){if(o){if(f5[r]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(Ce(137,r));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(Ce(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(Ce(61))}if(o.style!=null&&typeof o.style!="object")throw Error(Ce(62))}}function tg(r,o){if(r.indexOf("-")===-1)return typeof o.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ng=null;function uS(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var rg=null,ou=null,su=null;function GN(r){if(r=Tl(r)){if(typeof rg!="function")throw Error(Ce(280));var o=r.stateNode;o&&(o=I0(o),rg(r.stateNode,r.type,o))}}function ED(r){ou?su?su.push(r):su=[r]:ou=r}function vD(){if(ou){var r=ou,o=su;if(su=ou=null,GN(r),o)for(r=0;r<o.length;r++)GN(o[r])}}function gD(r,o){return r(o)}function SD(){}var fv=!1;function TD(r,o,a){if(fv)return r(o,a);fv=!0;try{return gD(r,o,a)}finally{fv=!1,(ou!==null||su!==null)&&(SD(),vD())}}function Qd(r,o){var a=r.stateNode;if(a===null)return null;var c=I0(a);if(c===null)return null;a=c[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(r=r.type,c=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!c;break e;default:r=!1}if(r)return null;if(a&&typeof a!="function")throw Error(Ce(231,o,typeof a));return a}var ig=!1;if(Zo)try{var Cd={};Object.defineProperty(Cd,"passive",{get:function(){ig=!0}}),window.addEventListener("test",Cd,Cd),window.removeEventListener("test",Cd,Cd)}catch{ig=!1}function _5(r,o,a,c,l,f,v,R,T){var C=Array.prototype.slice.call(arguments,3);try{o.apply(a,C)}catch(O){this.onError(O)}}var Vd=!1,cf=null,uf=!1,og=null,m5={onError:function(r){Vd=!0,cf=r}};function E5(r,o,a,c,l,f,v,R,T){Vd=!1,cf=null,_5.apply(m5,arguments)}function v5(r,o,a,c,l,f,v,R,T){if(E5.apply(this,arguments),Vd){if(Vd){var C=cf;Vd=!1,cf=null}else throw Error(Ce(198));uf||(uf=!0,og=C)}}function Ha(r){var o=r,a=r;if(r.alternate)for(;o.return;)o=o.return;else{r=o;do o=r,o.flags&4098&&(a=o.return),r=o.return;while(r)}return o.tag===3?a:null}function yD(r){if(r.tag===13){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function WN(r){if(Ha(r)!==r)throw Error(Ce(188))}function g5(r){var o=r.alternate;if(!o){if(o=Ha(r),o===null)throw Error(Ce(188));return o!==r?null:r}for(var a=r,c=o;;){var l=a.return;if(l===null)break;var f=l.alternate;if(f===null){if(c=l.return,c!==null){a=c;continue}break}if(l.child===f.child){for(f=l.child;f;){if(f===a)return WN(l),r;if(f===c)return WN(l),o;f=f.sibling}throw Error(Ce(188))}if(a.return!==c.return)a=l,c=f;else{for(var v=!1,R=l.child;R;){if(R===a){v=!0,a=l,c=f;break}if(R===c){v=!0,c=l,a=f;break}R=R.sibling}if(!v){for(R=f.child;R;){if(R===a){v=!0,a=f,c=l;break}if(R===c){v=!0,c=f,a=l;break}R=R.sibling}if(!v)throw Error(Ce(189))}}if(a.alternate!==c)throw Error(Ce(190))}if(a.tag!==3)throw Error(Ce(188));return a.stateNode.current===a?r:o}function RD(r){return r=g5(r),r!==null?CD(r):null}function CD(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var o=CD(r);if(o!==null)return o;r=r.sibling}return null}var ID=vi.unstable_scheduleCallback,HN=vi.unstable_cancelCallback,S5=vi.unstable_shouldYield,T5=vi.unstable_requestPaint,Dn=vi.unstable_now,y5=vi.unstable_getCurrentPriorityLevel,dS=vi.unstable_ImmediatePriority,AD=vi.unstable_UserBlockingPriority,df=vi.unstable_NormalPriority,R5=vi.unstable_LowPriority,wD=vi.unstable_IdlePriority,T0=null,Io=null;function C5(r){if(Io&&typeof Io.onCommitFiberRoot=="function")try{Io.onCommitFiberRoot(T0,r,void 0,(r.current.flags&128)===128)}catch{}}var no=Math.clz32?Math.clz32:w5,I5=Math.log,A5=Math.LN2;function w5(r){return r>>>=0,r===0?32:31-(I5(r)/A5|0)|0}var Cp=64,Ip=4194304;function kd(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function lf(r,o){var a=r.pendingLanes;if(a===0)return 0;var c=0,l=r.suspendedLanes,f=r.pingedLanes,v=a&268435455;if(v!==0){var R=v&~l;R!==0?c=kd(R):(f&=v,f!==0&&(c=kd(f)))}else v=a&~l,v!==0?c=kd(v):f!==0&&(c=kd(f));if(c===0)return 0;if(o!==0&&o!==c&&!(o&l)&&(l=c&-c,f=o&-o,l>=f||l===16&&(f&4194240)!==0))return o;if(c&4&&(c|=a&16),o=r.entangledLanes,o!==0)for(r=r.entanglements,o&=c;0<o;)a=31-no(o),l=1<<a,c|=r[a],o&=~l;return c}function O5(r,o){switch(r){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function b5(r,o){for(var a=r.suspendedLanes,c=r.pingedLanes,l=r.expirationTimes,f=r.pendingLanes;0<f;){var v=31-no(f),R=1<<v,T=l[v];T===-1?(!(R&a)||R&c)&&(l[v]=O5(R,o)):T<=o&&(r.expiredLanes|=R),f&=~R}}function sg(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function OD(){var r=Cp;return Cp<<=1,!(Cp&4194240)&&(Cp=64),r}function _v(r){for(var o=[],a=0;31>a;a++)o.push(r);return o}function gl(r,o,a){r.pendingLanes|=o,o!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,o=31-no(o),r[o]=a}function N5(r,o){var a=r.pendingLanes&~o;r.pendingLanes=o,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=o,r.mutableReadLanes&=o,r.entangledLanes&=o,o=r.entanglements;var c=r.eventTimes;for(r=r.expirationTimes;0<a;){var l=31-no(a),f=1<<l;o[l]=0,c[l]=-1,r[l]=-1,a&=~f}}function lS(r,o){var a=r.entangledLanes|=o;for(r=r.entanglements;a;){var c=31-no(a),l=1<<c;l&o|r[c]&o&&(r[c]|=o),a&=~l}}var qt=0;function bD(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var ND,hS,PD,DD,kD,ag=!1,Ap=[],js=null,Fs=null,Gs=null,$d=new Map,Zd=new Map,xs=[],P5="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function KN(r,o){switch(r){case"focusin":case"focusout":js=null;break;case"dragenter":case"dragleave":Fs=null;break;case"mouseover":case"mouseout":Gs=null;break;case"pointerover":case"pointerout":$d.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zd.delete(o.pointerId)}}function Id(r,o,a,c,l,f){return r===null||r.nativeEvent!==f?(r={blockedOn:o,domEventName:a,eventSystemFlags:c,nativeEvent:f,targetContainers:[l]},o!==null&&(o=Tl(o),o!==null&&hS(o)),r):(r.eventSystemFlags|=c,o=r.targetContainers,l!==null&&o.indexOf(l)===-1&&o.push(l),r)}function D5(r,o,a,c,l){switch(o){case"focusin":return js=Id(js,r,o,a,c,l),!0;case"dragenter":return Fs=Id(Fs,r,o,a,c,l),!0;case"mouseover":return Gs=Id(Gs,r,o,a,c,l),!0;case"pointerover":var f=l.pointerId;return $d.set(f,Id($d.get(f)||null,r,o,a,c,l)),!0;case"gotpointercapture":return f=l.pointerId,Zd.set(f,Id(Zd.get(f)||null,r,o,a,c,l)),!0}return!1}function LD(r){var o=Pa(r.target);if(o!==null){var a=Ha(o);if(a!==null){if(o=a.tag,o===13){if(o=yD(a),o!==null){r.blockedOn=o,kD(r.priority,function(){PD(a)});return}}else if(o===3&&a.stateNode.current.memoizedState.isDehydrated){r.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Hp(r){if(r.blockedOn!==null)return!1;for(var o=r.targetContainers;0<o.length;){var a=cg(r.domEventName,r.eventSystemFlags,o[0],r.nativeEvent);if(a===null){a=r.nativeEvent;var c=new a.constructor(a.type,a);ng=c,a.target.dispatchEvent(c),ng=null}else return o=Tl(a),o!==null&&hS(o),r.blockedOn=a,!1;o.shift()}return!0}function zN(r,o,a){Hp(r)&&a.delete(o)}function k5(){ag=!1,js!==null&&Hp(js)&&(js=null),Fs!==null&&Hp(Fs)&&(Fs=null),Gs!==null&&Hp(Gs)&&(Gs=null),$d.forEach(zN),Zd.forEach(zN)}function Ad(r,o){r.blockedOn===o&&(r.blockedOn=null,ag||(ag=!0,vi.unstable_scheduleCallback(vi.unstable_NormalPriority,k5)))}function el(r){function o(l){return Ad(l,r)}if(0<Ap.length){Ad(Ap[0],r);for(var a=1;a<Ap.length;a++){var c=Ap[a];c.blockedOn===r&&(c.blockedOn=null)}}for(js!==null&&Ad(js,r),Fs!==null&&Ad(Fs,r),Gs!==null&&Ad(Gs,r),$d.forEach(o),Zd.forEach(o),a=0;a<xs.length;a++)c=xs[a],c.blockedOn===r&&(c.blockedOn=null);for(;0<xs.length&&(a=xs[0],a.blockedOn===null);)LD(a),a.blockedOn===null&&xs.shift()}var au=is.ReactCurrentBatchConfig,hf=!0;function L5(r,o,a,c){var l=qt,f=au.transition;au.transition=null;try{qt=1,pS(r,o,a,c)}finally{qt=l,au.transition=f}}function x5(r,o,a,c){var l=qt,f=au.transition;au.transition=null;try{qt=4,pS(r,o,a,c)}finally{qt=l,au.transition=f}}function pS(r,o,a,c){if(hf){var l=cg(r,o,a,c);if(l===null)Iv(r,o,c,pf,a),KN(r,c);else if(D5(l,r,o,a,c))c.stopPropagation();else if(KN(r,c),o&4&&-1<P5.indexOf(r)){for(;l!==null;){var f=Tl(l);if(f!==null&&ND(f),f=cg(r,o,a,c),f===null&&Iv(r,o,c,pf,a),f===l)break;l=f}l!==null&&c.stopPropagation()}else Iv(r,o,c,null,a)}}var pf=null;function cg(r,o,a,c){if(pf=null,r=uS(c),r=Pa(r),r!==null)if(o=Ha(r),o===null)r=null;else if(a=o.tag,a===13){if(r=yD(o),r!==null)return r;r=null}else if(a===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null);return pf=r,null}function xD(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(y5()){case dS:return 1;case AD:return 4;case df:case R5:return 16;case wD:return 536870912;default:return 16}default:return 16}}var Us=null,fS=null,Kp=null;function MD(){if(Kp)return Kp;var r,o=fS,a=o.length,c,l="value"in Us?Us.value:Us.textContent,f=l.length;for(r=0;r<a&&o[r]===l[r];r++);var v=a-r;for(c=1;c<=v&&o[a-c]===l[f-c];c++);return Kp=l.slice(r,1<c?1-c:void 0)}function zp(r){var o=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&o===13&&(r=13)):r=o,r===10&&(r=13),32<=r||r===13?r:0}function wp(){return!0}function YN(){return!1}function Si(r){function o(a,c,l,f,v){this._reactName=a,this._targetInst=l,this.type=c,this.nativeEvent=f,this.target=v,this.currentTarget=null;for(var R in r)r.hasOwnProperty(R)&&(a=r[R],this[R]=a?a(f):f[R]);return this.isDefaultPrevented=(f.defaultPrevented!=null?f.defaultPrevented:f.returnValue===!1)?wp:YN,this.isPropagationStopped=YN,this}return Rn(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=wp)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=wp)},persist:function(){},isPersistent:wp}),o}var Cu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_S=Si(Cu),Sl=Rn({},Cu,{view:0,detail:0}),M5=Si(Sl),mv,Ev,wd,y0=Rn({},Sl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mS,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==wd&&(wd&&r.type==="mousemove"?(mv=r.screenX-wd.screenX,Ev=r.screenY-wd.screenY):Ev=mv=0,wd=r),mv)},movementY:function(r){return"movementY"in r?r.movementY:Ev}}),qN=Si(y0),U5=Rn({},y0,{dataTransfer:0}),V5=Si(U5),B5=Rn({},Sl,{relatedTarget:0}),vv=Si(B5),j5=Rn({},Cu,{animationName:0,elapsedTime:0,pseudoElement:0}),F5=Si(j5),G5=Rn({},Cu,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),W5=Si(G5),H5=Rn({},Cu,{data:0}),JN=Si(H5),K5={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},z5={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Y5={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function q5(r){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(r):(r=Y5[r])?!!o[r]:!1}function mS(){return q5}var J5=Rn({},Sl,{key:function(r){if(r.key){var o=K5[r.key]||r.key;if(o!=="Unidentified")return o}return r.type==="keypress"?(r=zp(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?z5[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mS,charCode:function(r){return r.type==="keypress"?zp(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?zp(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),X5=Si(J5),Q5=Rn({},y0,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),XN=Si(Q5),$5=Rn({},Sl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mS}),Z5=Si($5),eG=Rn({},Cu,{propertyName:0,elapsedTime:0,pseudoElement:0}),tG=Si(eG),nG=Rn({},y0,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),rG=Si(nG),iG=[9,13,27,32],ES=Zo&&"CompositionEvent"in window,Bd=null;Zo&&"documentMode"in document&&(Bd=document.documentMode);var oG=Zo&&"TextEvent"in window&&!Bd,UD=Zo&&(!ES||Bd&&8<Bd&&11>=Bd),QN=String.fromCharCode(32),$N=!1;function VD(r,o){switch(r){case"keyup":return iG.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function BD(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Kc=!1;function sG(r,o){switch(r){case"compositionend":return BD(o);case"keypress":return o.which!==32?null:($N=!0,QN);case"textInput":return r=o.data,r===QN&&$N?null:r;default:return null}}function aG(r,o){if(Kc)return r==="compositionend"||!ES&&VD(r,o)?(r=MD(),Kp=fS=Us=null,Kc=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return UD&&o.locale!=="ko"?null:o.data;default:return null}}var cG={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ZN(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o==="input"?!!cG[r.type]:o==="textarea"}function jD(r,o,a,c){ED(c),o=ff(o,"onChange"),0<o.length&&(a=new _S("onChange","change",null,a,c),r.push({event:a,listeners:o}))}var jd=null,tl=null;function uG(r){QD(r,0)}function R0(r){var o=qc(r);if(dD(o))return r}function dG(r,o){if(r==="change")return o}var FD=!1;if(Zo){var gv;if(Zo){var Sv="oninput"in document;if(!Sv){var e1=document.createElement("div");e1.setAttribute("oninput","return;"),Sv=typeof e1.oninput=="function"}gv=Sv}else gv=!1;FD=gv&&(!document.documentMode||9<document.documentMode)}function t1(){jd&&(jd.detachEvent("onpropertychange",GD),tl=jd=null)}function GD(r){if(r.propertyName==="value"&&R0(tl)){var o=[];jD(o,tl,r,uS(r)),TD(uG,o)}}function lG(r,o,a){r==="focusin"?(t1(),jd=o,tl=a,jd.attachEvent("onpropertychange",GD)):r==="focusout"&&t1()}function hG(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return R0(tl)}function pG(r,o){if(r==="click")return R0(o)}function fG(r,o){if(r==="input"||r==="change")return R0(o)}function _G(r,o){return r===o&&(r!==0||1/r===1/o)||r!==r&&o!==o}var so=typeof Object.is=="function"?Object.is:_G;function nl(r,o){if(so(r,o))return!0;if(typeof r!="object"||r===null||typeof o!="object"||o===null)return!1;var a=Object.keys(r),c=Object.keys(o);if(a.length!==c.length)return!1;for(c=0;c<a.length;c++){var l=a[c];if(!Hv.call(o,l)||!so(r[l],o[l]))return!1}return!0}function n1(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function r1(r,o){var a=n1(r);r=0;for(var c;a;){if(a.nodeType===3){if(c=r+a.textContent.length,r<=o&&c>=o)return{node:a,offset:o-r};r=c}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=n1(a)}}function WD(r,o){return r&&o?r===o?!0:r&&r.nodeType===3?!1:o&&o.nodeType===3?WD(r,o.parentNode):"contains"in r?r.contains(o):r.compareDocumentPosition?!!(r.compareDocumentPosition(o)&16):!1:!1}function HD(){for(var r=window,o=af();o instanceof r.HTMLIFrameElement;){try{var a=typeof o.contentWindow.location.href=="string"}catch{a=!1}if(a)r=o.contentWindow;else break;o=af(r.document)}return o}function vS(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o&&(o==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||o==="textarea"||r.contentEditable==="true")}function mG(r){var o=HD(),a=r.focusedElem,c=r.selectionRange;if(o!==a&&a&&a.ownerDocument&&WD(a.ownerDocument.documentElement,a)){if(c!==null&&vS(a)){if(o=c.start,r=c.end,r===void 0&&(r=o),"selectionStart"in a)a.selectionStart=o,a.selectionEnd=Math.min(r,a.value.length);else if(r=(o=a.ownerDocument||document)&&o.defaultView||window,r.getSelection){r=r.getSelection();var l=a.textContent.length,f=Math.min(c.start,l);c=c.end===void 0?f:Math.min(c.end,l),!r.extend&&f>c&&(l=c,c=f,f=l),l=r1(a,f);var v=r1(a,c);l&&v&&(r.rangeCount!==1||r.anchorNode!==l.node||r.anchorOffset!==l.offset||r.focusNode!==v.node||r.focusOffset!==v.offset)&&(o=o.createRange(),o.setStart(l.node,l.offset),r.removeAllRanges(),f>c?(r.addRange(o),r.extend(v.node,v.offset)):(o.setEnd(v.node,v.offset),r.addRange(o)))}}for(o=[],r=a;r=r.parentNode;)r.nodeType===1&&o.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<o.length;a++)r=o[a],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var EG=Zo&&"documentMode"in document&&11>=document.documentMode,zc=null,ug=null,Fd=null,dg=!1;function i1(r,o,a){var c=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;dg||zc==null||zc!==af(c)||(c=zc,"selectionStart"in c&&vS(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Fd&&nl(Fd,c)||(Fd=c,c=ff(ug,"onSelect"),0<c.length&&(o=new _S("onSelect","select",null,o,a),r.push({event:o,listeners:c}),o.target=zc)))}function Op(r,o){var a={};return a[r.toLowerCase()]=o.toLowerCase(),a["Webkit"+r]="webkit"+o,a["Moz"+r]="moz"+o,a}var Yc={animationend:Op("Animation","AnimationEnd"),animationiteration:Op("Animation","AnimationIteration"),animationstart:Op("Animation","AnimationStart"),transitionend:Op("Transition","TransitionEnd")},Tv={},KD={};Zo&&(KD=document.createElement("div").style,"AnimationEvent"in window||(delete Yc.animationend.animation,delete Yc.animationiteration.animation,delete Yc.animationstart.animation),"TransitionEvent"in window||delete Yc.transitionend.transition);function C0(r){if(Tv[r])return Tv[r];if(!Yc[r])return r;var o=Yc[r],a;for(a in o)if(o.hasOwnProperty(a)&&a in KD)return Tv[r]=o[a];return r}var zD=C0("animationend"),YD=C0("animationiteration"),qD=C0("animationstart"),JD=C0("transitionend"),XD=new Map,o1="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function $s(r,o){XD.set(r,o),Wa(o,[r])}for(var yv=0;yv<o1.length;yv++){var Rv=o1[yv],vG=Rv.toLowerCase(),gG=Rv[0].toUpperCase()+Rv.slice(1);$s(vG,"on"+gG)}$s(zD,"onAnimationEnd");$s(YD,"onAnimationIteration");$s(qD,"onAnimationStart");$s("dblclick","onDoubleClick");$s("focusin","onFocus");$s("focusout","onBlur");$s(JD,"onTransitionEnd");lu("onMouseEnter",["mouseout","mouseover"]);lu("onMouseLeave",["mouseout","mouseover"]);lu("onPointerEnter",["pointerout","pointerover"]);lu("onPointerLeave",["pointerout","pointerover"]);Wa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wa("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ld="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),SG=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ld));function s1(r,o,a){var c=r.type||"unknown-event";r.currentTarget=a,v5(c,o,void 0,r),r.currentTarget=null}function QD(r,o){o=(o&4)!==0;for(var a=0;a<r.length;a++){var c=r[a],l=c.event;c=c.listeners;e:{var f=void 0;if(o)for(var v=c.length-1;0<=v;v--){var R=c[v],T=R.instance,C=R.currentTarget;if(R=R.listener,T!==f&&l.isPropagationStopped())break e;s1(l,R,C),f=T}else for(v=0;v<c.length;v++){if(R=c[v],T=R.instance,C=R.currentTarget,R=R.listener,T!==f&&l.isPropagationStopped())break e;s1(l,R,C),f=T}}}if(uf)throw r=og,uf=!1,og=null,r}function pn(r,o){var a=o[_g];a===void 0&&(a=o[_g]=new Set);var c=r+"__bubble";a.has(c)||($D(o,r,2,!1),a.add(c))}function Cv(r,o,a){var c=0;o&&(c|=4),$D(a,r,c,o)}var bp="_reactListening"+Math.random().toString(36).slice(2);function rl(r){if(!r[bp]){r[bp]=!0,oD.forEach(function(a){a!=="selectionchange"&&(SG.has(a)||Cv(a,!1,r),Cv(a,!0,r))});var o=r.nodeType===9?r:r.ownerDocument;o===null||o[bp]||(o[bp]=!0,Cv("selectionchange",!1,o))}}function $D(r,o,a,c){switch(xD(o)){case 1:var l=L5;break;case 4:l=x5;break;default:l=pS}a=l.bind(null,o,a,r),l=void 0,!ig||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(l=!0),c?l!==void 0?r.addEventListener(o,a,{capture:!0,passive:l}):r.addEventListener(o,a,!0):l!==void 0?r.addEventListener(o,a,{passive:l}):r.addEventListener(o,a,!1)}function Iv(r,o,a,c,l){var f=c;if(!(o&1)&&!(o&2)&&c!==null)e:for(;;){if(c===null)return;var v=c.tag;if(v===3||v===4){var R=c.stateNode.containerInfo;if(R===l||R.nodeType===8&&R.parentNode===l)break;if(v===4)for(v=c.return;v!==null;){var T=v.tag;if((T===3||T===4)&&(T=v.stateNode.containerInfo,T===l||T.nodeType===8&&T.parentNode===l))return;v=v.return}for(;R!==null;){if(v=Pa(R),v===null)return;if(T=v.tag,T===5||T===6){c=f=v;continue e}R=R.parentNode}}c=c.return}TD(function(){var C=f,O=uS(a),N=[];e:{var w=XD.get(r);if(w!==void 0){var B=_S,U=r;switch(r){case"keypress":if(zp(a)===0)break e;case"keydown":case"keyup":B=X5;break;case"focusin":U="focus",B=vv;break;case"focusout":U="blur",B=vv;break;case"beforeblur":case"afterblur":B=vv;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":B=qN;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":B=V5;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":B=Z5;break;case zD:case YD:case qD:B=F5;break;case JD:B=tG;break;case"scroll":B=M5;break;case"wheel":B=rG;break;case"copy":case"cut":case"paste":B=W5;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":B=XN}var W=(o&4)!==0,q=!W&&r==="scroll",G=W?w!==null?w+"Capture":null:w;W=[];for(var b=C,M;b!==null;){M=b;var j=M.stateNode;if(M.tag===5&&j!==null&&(M=j,G!==null&&(j=Qd(b,G),j!=null&&W.push(il(b,j,M)))),q)break;b=b.return}0<W.length&&(w=new B(w,U,null,a,O),N.push({event:w,listeners:W}))}}if(!(o&7)){e:{if(w=r==="mouseover"||r==="pointerover",B=r==="mouseout"||r==="pointerout",w&&a!==ng&&(U=a.relatedTarget||a.fromElement)&&(Pa(U)||U[es]))break e;if((B||w)&&(w=O.window===O?O:(w=O.ownerDocument)?w.defaultView||w.parentWindow:window,B?(U=a.relatedTarget||a.toElement,B=C,U=U?Pa(U):null,U!==null&&(q=Ha(U),U!==q||U.tag!==5&&U.tag!==6)&&(U=null)):(B=null,U=C),B!==U)){if(W=qN,j="onMouseLeave",G="onMouseEnter",b="mouse",(r==="pointerout"||r==="pointerover")&&(W=XN,j="onPointerLeave",G="onPointerEnter",b="pointer"),q=B==null?w:qc(B),M=U==null?w:qc(U),w=new W(j,b+"leave",B,a,O),w.target=q,w.relatedTarget=M,j=null,Pa(O)===C&&(W=new W(G,b+"enter",U,a,O),W.target=M,W.relatedTarget=q,j=W),q=j,B&&U)t:{for(W=B,G=U,b=0,M=W;M;M=Fc(M))b++;for(M=0,j=G;j;j=Fc(j))M++;for(;0<b-M;)W=Fc(W),b--;for(;0<M-b;)G=Fc(G),M--;for(;b--;){if(W===G||G!==null&&W===G.alternate)break t;W=Fc(W),G=Fc(G)}W=null}else W=null;B!==null&&a1(N,w,B,W,!1),U!==null&&q!==null&&a1(N,q,U,W,!0)}}e:{if(w=C?qc(C):window,B=w.nodeName&&w.nodeName.toLowerCase(),B==="select"||B==="input"&&w.type==="file")var K=dG;else if(ZN(w))if(FD)K=fG;else{K=hG;var Y=lG}else(B=w.nodeName)&&B.toLowerCase()==="input"&&(w.type==="checkbox"||w.type==="radio")&&(K=pG);if(K&&(K=K(r,C))){jD(N,K,a,O);break e}Y&&Y(r,w,C),r==="focusout"&&(Y=w._wrapperState)&&Y.controlled&&w.type==="number"&&Qv(w,"number",w.value)}switch(Y=C?qc(C):window,r){case"focusin":(ZN(Y)||Y.contentEditable==="true")&&(zc=Y,ug=C,Fd=null);break;case"focusout":Fd=ug=zc=null;break;case"mousedown":dg=!0;break;case"contextmenu":case"mouseup":case"dragend":dg=!1,i1(N,a,O);break;case"selectionchange":if(EG)break;case"keydown":case"keyup":i1(N,a,O)}var Q;if(ES)e:{switch(r){case"compositionstart":var $="onCompositionStart";break e;case"compositionend":$="onCompositionEnd";break e;case"compositionupdate":$="onCompositionUpdate";break e}$=void 0}else Kc?VD(r,a)&&($="onCompositionEnd"):r==="keydown"&&a.keyCode===229&&($="onCompositionStart");$&&(UD&&a.locale!=="ko"&&(Kc||$!=="onCompositionStart"?$==="onCompositionEnd"&&Kc&&(Q=MD()):(Us=O,fS="value"in Us?Us.value:Us.textContent,Kc=!0)),Y=ff(C,$),0<Y.length&&($=new JN($,r,null,a,O),N.push({event:$,listeners:Y}),Q?$.data=Q:(Q=BD(a),Q!==null&&($.data=Q)))),(Q=oG?sG(r,a):aG(r,a))&&(C=ff(C,"onBeforeInput"),0<C.length&&(O=new JN("onBeforeInput","beforeinput",null,a,O),N.push({event:O,listeners:C}),O.data=Q))}QD(N,o)})}function il(r,o,a){return{instance:r,listener:o,currentTarget:a}}function ff(r,o){for(var a=o+"Capture",c=[];r!==null;){var l=r,f=l.stateNode;l.tag===5&&f!==null&&(l=f,f=Qd(r,a),f!=null&&c.unshift(il(r,f,l)),f=Qd(r,o),f!=null&&c.push(il(r,f,l))),r=r.return}return c}function Fc(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function a1(r,o,a,c,l){for(var f=o._reactName,v=[];a!==null&&a!==c;){var R=a,T=R.alternate,C=R.stateNode;if(T!==null&&T===c)break;R.tag===5&&C!==null&&(R=C,l?(T=Qd(a,f),T!=null&&v.unshift(il(a,T,R))):l||(T=Qd(a,f),T!=null&&v.push(il(a,T,R)))),a=a.return}v.length!==0&&r.push({event:o,listeners:v})}var TG=/\r\n?/g,yG=/\u0000|\uFFFD/g;function c1(r){return(typeof r=="string"?r:""+r).replace(TG,`
`).replace(yG,"")}function Np(r,o,a){if(o=c1(o),c1(r)!==o&&a)throw Error(Ce(425))}function _f(){}var lg=null,hg=null;function pg(r,o){return r==="textarea"||r==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var fg=typeof setTimeout=="function"?setTimeout:void 0,RG=typeof clearTimeout=="function"?clearTimeout:void 0,u1=typeof Promise=="function"?Promise:void 0,CG=typeof queueMicrotask=="function"?queueMicrotask:typeof u1<"u"?function(r){return u1.resolve(null).then(r).catch(IG)}:fg;function IG(r){setTimeout(function(){throw r})}function Av(r,o){var a=o,c=0;do{var l=a.nextSibling;if(r.removeChild(a),l&&l.nodeType===8)if(a=l.data,a==="/$"){if(c===0){r.removeChild(l),el(o);return}c--}else a!=="$"&&a!=="$?"&&a!=="$!"||c++;a=l}while(a);el(o)}function Ws(r){for(;r!=null;r=r.nextSibling){var o=r.nodeType;if(o===1||o===3)break;if(o===8){if(o=r.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return r}function d1(r){r=r.previousSibling;for(var o=0;r;){if(r.nodeType===8){var a=r.data;if(a==="$"||a==="$!"||a==="$?"){if(o===0)return r;o--}else a==="/$"&&o++}r=r.previousSibling}return null}var Iu=Math.random().toString(36).slice(2),Ro="__reactFiber$"+Iu,ol="__reactProps$"+Iu,es="__reactContainer$"+Iu,_g="__reactEvents$"+Iu,AG="__reactListeners$"+Iu,wG="__reactHandles$"+Iu;function Pa(r){var o=r[Ro];if(o)return o;for(var a=r.parentNode;a;){if(o=a[es]||a[Ro]){if(a=o.alternate,o.child!==null||a!==null&&a.child!==null)for(r=d1(r);r!==null;){if(a=r[Ro])return a;r=d1(r)}return o}r=a,a=r.parentNode}return null}function Tl(r){return r=r[Ro]||r[es],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function qc(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(Ce(33))}function I0(r){return r[ol]||null}var mg=[],Jc=-1;function Zs(r){return{current:r}}function fn(r){0>Jc||(r.current=mg[Jc],mg[Jc]=null,Jc--)}function cn(r,o){Jc++,mg[Jc]=r.current,r.current=o}var Xs={},Ar=Zs(Xs),Zr=Zs(!1),Ua=Xs;function hu(r,o){var a=r.type.contextTypes;if(!a)return Xs;var c=r.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===o)return c.__reactInternalMemoizedMaskedChildContext;var l={},f;for(f in a)l[f]=o[f];return c&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=o,r.__reactInternalMemoizedMaskedChildContext=l),l}function ei(r){return r=r.childContextTypes,r!=null}function mf(){fn(Zr),fn(Ar)}function l1(r,o,a){if(Ar.current!==Xs)throw Error(Ce(168));cn(Ar,o),cn(Zr,a)}function ZD(r,o,a){var c=r.stateNode;if(o=o.childContextTypes,typeof c.getChildContext!="function")return a;c=c.getChildContext();for(var l in c)if(!(l in o))throw Error(Ce(108,l5(r)||"Unknown",l));return Rn({},a,c)}function Ef(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Xs,Ua=Ar.current,cn(Ar,r),cn(Zr,Zr.current),!0}function h1(r,o,a){var c=r.stateNode;if(!c)throw Error(Ce(169));a?(r=ZD(r,o,Ua),c.__reactInternalMemoizedMergedChildContext=r,fn(Zr),fn(Ar),cn(Ar,r)):fn(Zr),cn(Zr,a)}var zo=null,A0=!1,wv=!1;function ek(r){zo===null?zo=[r]:zo.push(r)}function OG(r){A0=!0,ek(r)}function ea(){if(!wv&&zo!==null){wv=!0;var r=0,o=qt;try{var a=zo;for(qt=1;r<a.length;r++){var c=a[r];do c=c(!0);while(c!==null)}zo=null,A0=!1}catch(l){throw zo!==null&&(zo=zo.slice(r+1)),ID(dS,ea),l}finally{qt=o,wv=!1}}return null}var Xc=[],Qc=0,vf=null,gf=0,Pi=[],Di=0,Va=null,qo=1,Jo="";function ba(r,o){Xc[Qc++]=gf,Xc[Qc++]=vf,vf=r,gf=o}function tk(r,o,a){Pi[Di++]=qo,Pi[Di++]=Jo,Pi[Di++]=Va,Va=r;var c=qo;r=Jo;var l=32-no(c)-1;c&=~(1<<l),a+=1;var f=32-no(o)+l;if(30<f){var v=l-l%5;f=(c&(1<<v)-1).toString(32),c>>=v,l-=v,qo=1<<32-no(o)+l|a<<l|c,Jo=f+r}else qo=1<<f|a<<l|c,Jo=r}function gS(r){r.return!==null&&(ba(r,1),tk(r,1,0))}function SS(r){for(;r===vf;)vf=Xc[--Qc],Xc[Qc]=null,gf=Xc[--Qc],Xc[Qc]=null;for(;r===Va;)Va=Pi[--Di],Pi[Di]=null,Jo=Pi[--Di],Pi[Di]=null,qo=Pi[--Di],Pi[Di]=null}var Ei=null,mi=null,vn=!1,to=null;function nk(r,o){var a=xi(5,null,null,0);a.elementType="DELETED",a.stateNode=o,a.return=r,o=r.deletions,o===null?(r.deletions=[a],r.flags|=16):o.push(a)}function p1(r,o){switch(r.tag){case 5:var a=r.type;return o=o.nodeType!==1||a.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(r.stateNode=o,Ei=r,mi=Ws(o.firstChild),!0):!1;case 6:return o=r.pendingProps===""||o.nodeType!==3?null:o,o!==null?(r.stateNode=o,Ei=r,mi=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(a=Va!==null?{id:qo,overflow:Jo}:null,r.memoizedState={dehydrated:o,treeContext:a,retryLane:1073741824},a=xi(18,null,null,0),a.stateNode=o,a.return=r,r.child=a,Ei=r,mi=null,!0):!1;default:return!1}}function Eg(r){return(r.mode&1)!==0&&(r.flags&128)===0}function vg(r){if(vn){var o=mi;if(o){var a=o;if(!p1(r,o)){if(Eg(r))throw Error(Ce(418));o=Ws(a.nextSibling);var c=Ei;o&&p1(r,o)?nk(c,a):(r.flags=r.flags&-4097|2,vn=!1,Ei=r)}}else{if(Eg(r))throw Error(Ce(418));r.flags=r.flags&-4097|2,vn=!1,Ei=r}}}function f1(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;Ei=r}function Pp(r){if(r!==Ei)return!1;if(!vn)return f1(r),vn=!0,!1;var o;if((o=r.tag!==3)&&!(o=r.tag!==5)&&(o=r.type,o=o!=="head"&&o!=="body"&&!pg(r.type,r.memoizedProps)),o&&(o=mi)){if(Eg(r))throw rk(),Error(Ce(418));for(;o;)nk(r,o),o=Ws(o.nextSibling)}if(f1(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Ce(317));e:{for(r=r.nextSibling,o=0;r;){if(r.nodeType===8){var a=r.data;if(a==="/$"){if(o===0){mi=Ws(r.nextSibling);break e}o--}else a!=="$"&&a!=="$!"&&a!=="$?"||o++}r=r.nextSibling}mi=null}}else mi=Ei?Ws(r.stateNode.nextSibling):null;return!0}function rk(){for(var r=mi;r;)r=Ws(r.nextSibling)}function pu(){mi=Ei=null,vn=!1}function TS(r){to===null?to=[r]:to.push(r)}var bG=is.ReactCurrentBatchConfig;function Zi(r,o){if(r&&r.defaultProps){o=Rn({},o),r=r.defaultProps;for(var a in r)o[a]===void 0&&(o[a]=r[a]);return o}return o}var Sf=Zs(null),Tf=null,$c=null,yS=null;function RS(){yS=$c=Tf=null}function CS(r){var o=Sf.current;fn(Sf),r._currentValue=o}function gg(r,o,a){for(;r!==null;){var c=r.alternate;if((r.childLanes&o)!==o?(r.childLanes|=o,c!==null&&(c.childLanes|=o)):c!==null&&(c.childLanes&o)!==o&&(c.childLanes|=o),r===a)break;r=r.return}}function cu(r,o){Tf=r,yS=$c=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&o&&(Xr=!0),r.firstContext=null)}function Ui(r){var o=r._currentValue;if(yS!==r)if(r={context:r,memoizedValue:o,next:null},$c===null){if(Tf===null)throw Error(Ce(308));$c=r,Tf.dependencies={lanes:0,firstContext:r}}else $c=$c.next=r;return o}var Da=null;function IS(r){Da===null?Da=[r]:Da.push(r)}function ik(r,o,a,c){var l=o.interleaved;return l===null?(a.next=a,IS(o)):(a.next=l.next,l.next=a),o.interleaved=a,ts(r,c)}function ts(r,o){r.lanes|=o;var a=r.alternate;for(a!==null&&(a.lanes|=o),a=r,r=r.return;r!==null;)r.childLanes|=o,a=r.alternate,a!==null&&(a.childLanes|=o),a=r,r=r.return;return a.tag===3?a.stateNode:null}var Ls=!1;function AS(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ok(r,o){r=r.updateQueue,o.updateQueue===r&&(o.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Qo(r,o){return{eventTime:r,lane:o,tag:0,payload:null,callback:null,next:null}}function Hs(r,o,a){var c=r.updateQueue;if(c===null)return null;if(c=c.shared,Pt&2){var l=c.pending;return l===null?o.next=o:(o.next=l.next,l.next=o),c.pending=o,ts(r,a)}return l=c.interleaved,l===null?(o.next=o,IS(c)):(o.next=l.next,l.next=o),c.interleaved=o,ts(r,a)}function Yp(r,o,a){if(o=o.updateQueue,o!==null&&(o=o.shared,(a&4194240)!==0)){var c=o.lanes;c&=r.pendingLanes,a|=c,o.lanes=a,lS(r,a)}}function _1(r,o){var a=r.updateQueue,c=r.alternate;if(c!==null&&(c=c.updateQueue,a===c)){var l=null,f=null;if(a=a.firstBaseUpdate,a!==null){do{var v={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};f===null?l=f=v:f=f.next=v,a=a.next}while(a!==null);f===null?l=f=o:f=f.next=o}else l=f=o;a={baseState:c.baseState,firstBaseUpdate:l,lastBaseUpdate:f,shared:c.shared,effects:c.effects},r.updateQueue=a;return}r=a.lastBaseUpdate,r===null?a.firstBaseUpdate=o:r.next=o,a.lastBaseUpdate=o}function yf(r,o,a,c){var l=r.updateQueue;Ls=!1;var f=l.firstBaseUpdate,v=l.lastBaseUpdate,R=l.shared.pending;if(R!==null){l.shared.pending=null;var T=R,C=T.next;T.next=null,v===null?f=C:v.next=C,v=T;var O=r.alternate;O!==null&&(O=O.updateQueue,R=O.lastBaseUpdate,R!==v&&(R===null?O.firstBaseUpdate=C:R.next=C,O.lastBaseUpdate=T))}if(f!==null){var N=l.baseState;v=0,O=C=T=null,R=f;do{var w=R.lane,B=R.eventTime;if((c&w)===w){O!==null&&(O=O.next={eventTime:B,lane:0,tag:R.tag,payload:R.payload,callback:R.callback,next:null});e:{var U=r,W=R;switch(w=o,B=a,W.tag){case 1:if(U=W.payload,typeof U=="function"){N=U.call(B,N,w);break e}N=U;break e;case 3:U.flags=U.flags&-65537|128;case 0:if(U=W.payload,w=typeof U=="function"?U.call(B,N,w):U,w==null)break e;N=Rn({},N,w);break e;case 2:Ls=!0}}R.callback!==null&&R.lane!==0&&(r.flags|=64,w=l.effects,w===null?l.effects=[R]:w.push(R))}else B={eventTime:B,lane:w,tag:R.tag,payload:R.payload,callback:R.callback,next:null},O===null?(C=O=B,T=N):O=O.next=B,v|=w;if(R=R.next,R===null){if(R=l.shared.pending,R===null)break;w=R,R=w.next,w.next=null,l.lastBaseUpdate=w,l.shared.pending=null}}while(1);if(O===null&&(T=N),l.baseState=T,l.firstBaseUpdate=C,l.lastBaseUpdate=O,o=l.shared.interleaved,o!==null){l=o;do v|=l.lane,l=l.next;while(l!==o)}else f===null&&(l.shared.lanes=0);ja|=v,r.lanes=v,r.memoizedState=N}}function m1(r,o,a){if(r=o.effects,o.effects=null,r!==null)for(o=0;o<r.length;o++){var c=r[o],l=c.callback;if(l!==null){if(c.callback=null,c=a,typeof l!="function")throw Error(Ce(191,l));l.call(c)}}}var sk=new iD.Component().refs;function Sg(r,o,a,c){o=r.memoizedState,a=a(c,o),a=a==null?o:Rn({},o,a),r.memoizedState=a,r.lanes===0&&(r.updateQueue.baseState=a)}var w0={isMounted:function(r){return(r=r._reactInternals)?Ha(r)===r:!1},enqueueSetState:function(r,o,a){r=r._reactInternals;var c=kr(),l=zs(r),f=Qo(c,l);f.payload=o,a!=null&&(f.callback=a),o=Hs(r,f,l),o!==null&&(ro(o,r,l,c),Yp(o,r,l))},enqueueReplaceState:function(r,o,a){r=r._reactInternals;var c=kr(),l=zs(r),f=Qo(c,l);f.tag=1,f.payload=o,a!=null&&(f.callback=a),o=Hs(r,f,l),o!==null&&(ro(o,r,l,c),Yp(o,r,l))},enqueueForceUpdate:function(r,o){r=r._reactInternals;var a=kr(),c=zs(r),l=Qo(a,c);l.tag=2,o!=null&&(l.callback=o),o=Hs(r,l,c),o!==null&&(ro(o,r,c,a),Yp(o,r,c))}};function E1(r,o,a,c,l,f,v){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(c,f,v):o.prototype&&o.prototype.isPureReactComponent?!nl(a,c)||!nl(l,f):!0}function ak(r,o,a){var c=!1,l=Xs,f=o.contextType;return typeof f=="object"&&f!==null?f=Ui(f):(l=ei(o)?Ua:Ar.current,c=o.contextTypes,f=(c=c!=null)?hu(r,l):Xs),o=new o(a,f),r.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=w0,r.stateNode=o,o._reactInternals=r,c&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=l,r.__reactInternalMemoizedMaskedChildContext=f),o}function v1(r,o,a,c){r=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(a,c),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(a,c),o.state!==r&&w0.enqueueReplaceState(o,o.state,null)}function Tg(r,o,a,c){var l=r.stateNode;l.props=a,l.state=r.memoizedState,l.refs=sk,AS(r);var f=o.contextType;typeof f=="object"&&f!==null?l.context=Ui(f):(f=ei(o)?Ua:Ar.current,l.context=hu(r,f)),l.state=r.memoizedState,f=o.getDerivedStateFromProps,typeof f=="function"&&(Sg(r,o,f,a),l.state=r.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof l.getSnapshotBeforeUpdate=="function"||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(o=l.state,typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount(),o!==l.state&&w0.enqueueReplaceState(l,l.state,null),yf(r,a,l,c),l.state=r.memoizedState),typeof l.componentDidMount=="function"&&(r.flags|=4194308)}function Od(r,o,a){if(r=a.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(Ce(309));var c=a.stateNode}if(!c)throw Error(Ce(147,r));var l=c,f=""+r;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===f?o.ref:(o=function(v){var R=l.refs;R===sk&&(R=l.refs={}),v===null?delete R[f]:R[f]=v},o._stringRef=f,o)}if(typeof r!="string")throw Error(Ce(284));if(!a._owner)throw Error(Ce(290,r))}return r}function Dp(r,o){throw r=Object.prototype.toString.call(o),Error(Ce(31,r==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":r))}function g1(r){var o=r._init;return o(r._payload)}function ck(r){function o(G,b){if(r){var M=G.deletions;M===null?(G.deletions=[b],G.flags|=16):M.push(b)}}function a(G,b){if(!r)return null;for(;b!==null;)o(G,b),b=b.sibling;return null}function c(G,b){for(G=new Map;b!==null;)b.key!==null?G.set(b.key,b):G.set(b.index,b),b=b.sibling;return G}function l(G,b){return G=Ys(G,b),G.index=0,G.sibling=null,G}function f(G,b,M){return G.index=M,r?(M=G.alternate,M!==null?(M=M.index,M<b?(G.flags|=2,b):M):(G.flags|=2,b)):(G.flags|=1048576,b)}function v(G){return r&&G.alternate===null&&(G.flags|=2),G}function R(G,b,M,j){return b===null||b.tag!==6?(b=Lv(M,G.mode,j),b.return=G,b):(b=l(b,M),b.return=G,b)}function T(G,b,M,j){var K=M.type;return K===Hc?O(G,b,M.props.children,j,M.key):b!==null&&(b.elementType===K||typeof K=="object"&&K!==null&&K.$$typeof===ks&&g1(K)===b.type)?(j=l(b,M.props),j.ref=Od(G,b,M),j.return=G,j):(j=Zp(M.type,M.key,M.props,null,G.mode,j),j.ref=Od(G,b,M),j.return=G,j)}function C(G,b,M,j){return b===null||b.tag!==4||b.stateNode.containerInfo!==M.containerInfo||b.stateNode.implementation!==M.implementation?(b=xv(M,G.mode,j),b.return=G,b):(b=l(b,M.children||[]),b.return=G,b)}function O(G,b,M,j,K){return b===null||b.tag!==7?(b=xa(M,G.mode,j,K),b.return=G,b):(b=l(b,M),b.return=G,b)}function N(G,b,M){if(typeof b=="string"&&b!==""||typeof b=="number")return b=Lv(""+b,G.mode,M),b.return=G,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Tp:return M=Zp(b.type,b.key,b.props,null,G.mode,M),M.ref=Od(G,null,b),M.return=G,M;case Wc:return b=xv(b,G.mode,M),b.return=G,b;case ks:var j=b._init;return N(G,j(b._payload),M)}if(Dd(b)||Rd(b))return b=xa(b,G.mode,M,null),b.return=G,b;Dp(G,b)}return null}function w(G,b,M,j){var K=b!==null?b.key:null;if(typeof M=="string"&&M!==""||typeof M=="number")return K!==null?null:R(G,b,""+M,j);if(typeof M=="object"&&M!==null){switch(M.$$typeof){case Tp:return M.key===K?T(G,b,M,j):null;case Wc:return M.key===K?C(G,b,M,j):null;case ks:return K=M._init,w(G,b,K(M._payload),j)}if(Dd(M)||Rd(M))return K!==null?null:O(G,b,M,j,null);Dp(G,M)}return null}function B(G,b,M,j,K){if(typeof j=="string"&&j!==""||typeof j=="number")return G=G.get(M)||null,R(b,G,""+j,K);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case Tp:return G=G.get(j.key===null?M:j.key)||null,T(b,G,j,K);case Wc:return G=G.get(j.key===null?M:j.key)||null,C(b,G,j,K);case ks:var Y=j._init;return B(G,b,M,Y(j._payload),K)}if(Dd(j)||Rd(j))return G=G.get(M)||null,O(b,G,j,K,null);Dp(b,j)}return null}function U(G,b,M,j){for(var K=null,Y=null,Q=b,$=b=0,ue=null;Q!==null&&$<M.length;$++){Q.index>$?(ue=Q,Q=null):ue=Q.sibling;var J=w(G,Q,M[$],j);if(J===null){Q===null&&(Q=ue);break}r&&Q&&J.alternate===null&&o(G,Q),b=f(J,b,$),Y===null?K=J:Y.sibling=J,Y=J,Q=ue}if($===M.length)return a(G,Q),vn&&ba(G,$),K;if(Q===null){for(;$<M.length;$++)Q=N(G,M[$],j),Q!==null&&(b=f(Q,b,$),Y===null?K=Q:Y.sibling=Q,Y=Q);return vn&&ba(G,$),K}for(Q=c(G,Q);$<M.length;$++)ue=B(Q,G,$,M[$],j),ue!==null&&(r&&ue.alternate!==null&&Q.delete(ue.key===null?$:ue.key),b=f(ue,b,$),Y===null?K=ue:Y.sibling=ue,Y=ue);return r&&Q.forEach(function(te){return o(G,te)}),vn&&ba(G,$),K}function W(G,b,M,j){var K=Rd(M);if(typeof K!="function")throw Error(Ce(150));if(M=K.call(M),M==null)throw Error(Ce(151));for(var Y=K=null,Q=b,$=b=0,ue=null,J=M.next();Q!==null&&!J.done;$++,J=M.next()){Q.index>$?(ue=Q,Q=null):ue=Q.sibling;var te=w(G,Q,J.value,j);if(te===null){Q===null&&(Q=ue);break}r&&Q&&te.alternate===null&&o(G,Q),b=f(te,b,$),Y===null?K=te:Y.sibling=te,Y=te,Q=ue}if(J.done)return a(G,Q),vn&&ba(G,$),K;if(Q===null){for(;!J.done;$++,J=M.next())J=N(G,J.value,j),J!==null&&(b=f(J,b,$),Y===null?K=J:Y.sibling=J,Y=J);return vn&&ba(G,$),K}for(Q=c(G,Q);!J.done;$++,J=M.next())J=B(Q,G,$,J.value,j),J!==null&&(r&&J.alternate!==null&&Q.delete(J.key===null?$:J.key),b=f(J,b,$),Y===null?K=J:Y.sibling=J,Y=J);return r&&Q.forEach(function(le){return o(G,le)}),vn&&ba(G,$),K}function q(G,b,M,j){if(typeof M=="object"&&M!==null&&M.type===Hc&&M.key===null&&(M=M.props.children),typeof M=="object"&&M!==null){switch(M.$$typeof){case Tp:e:{for(var K=M.key,Y=b;Y!==null;){if(Y.key===K){if(K=M.type,K===Hc){if(Y.tag===7){a(G,Y.sibling),b=l(Y,M.props.children),b.return=G,G=b;break e}}else if(Y.elementType===K||typeof K=="object"&&K!==null&&K.$$typeof===ks&&g1(K)===Y.type){a(G,Y.sibling),b=l(Y,M.props),b.ref=Od(G,Y,M),b.return=G,G=b;break e}a(G,Y);break}else o(G,Y);Y=Y.sibling}M.type===Hc?(b=xa(M.props.children,G.mode,j,M.key),b.return=G,G=b):(j=Zp(M.type,M.key,M.props,null,G.mode,j),j.ref=Od(G,b,M),j.return=G,G=j)}return v(G);case Wc:e:{for(Y=M.key;b!==null;){if(b.key===Y)if(b.tag===4&&b.stateNode.containerInfo===M.containerInfo&&b.stateNode.implementation===M.implementation){a(G,b.sibling),b=l(b,M.children||[]),b.return=G,G=b;break e}else{a(G,b);break}else o(G,b);b=b.sibling}b=xv(M,G.mode,j),b.return=G,G=b}return v(G);case ks:return Y=M._init,q(G,b,Y(M._payload),j)}if(Dd(M))return U(G,b,M,j);if(Rd(M))return W(G,b,M,j);Dp(G,M)}return typeof M=="string"&&M!==""||typeof M=="number"?(M=""+M,b!==null&&b.tag===6?(a(G,b.sibling),b=l(b,M),b.return=G,G=b):(a(G,b),b=Lv(M,G.mode,j),b.return=G,G=b),v(G)):a(G,b)}return q}var fu=ck(!0),uk=ck(!1),yl={},Ao=Zs(yl),sl=Zs(yl),al=Zs(yl);function ka(r){if(r===yl)throw Error(Ce(174));return r}function wS(r,o){switch(cn(al,o),cn(sl,r),cn(Ao,yl),r=o.nodeType,r){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:Zv(null,"");break;default:r=r===8?o.parentNode:o,o=r.namespaceURI||null,r=r.tagName,o=Zv(o,r)}fn(Ao),cn(Ao,o)}function _u(){fn(Ao),fn(sl),fn(al)}function dk(r){ka(al.current);var o=ka(Ao.current),a=Zv(o,r.type);o!==a&&(cn(sl,r),cn(Ao,a))}function OS(r){sl.current===r&&(fn(Ao),fn(sl))}var Tn=Zs(0);function Rf(r){for(var o=r;o!==null;){if(o.tag===13){var a=o.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Ov=[];function bS(){for(var r=0;r<Ov.length;r++)Ov[r]._workInProgressVersionPrimary=null;Ov.length=0}var qp=is.ReactCurrentDispatcher,bv=is.ReactCurrentBatchConfig,Ba=0,yn=null,Jn=null,rr=null,Cf=!1,Gd=!1,cl=0,NG=0;function Rr(){throw Error(Ce(321))}function NS(r,o){if(o===null)return!1;for(var a=0;a<o.length&&a<r.length;a++)if(!so(r[a],o[a]))return!1;return!0}function PS(r,o,a,c,l,f){if(Ba=f,yn=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,qp.current=r===null||r.memoizedState===null?LG:xG,r=a(c,l),Gd){f=0;do{if(Gd=!1,cl=0,25<=f)throw Error(Ce(301));f+=1,rr=Jn=null,o.updateQueue=null,qp.current=MG,r=a(c,l)}while(Gd)}if(qp.current=If,o=Jn!==null&&Jn.next!==null,Ba=0,rr=Jn=yn=null,Cf=!1,o)throw Error(Ce(300));return r}function DS(){var r=cl!==0;return cl=0,r}function yo(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rr===null?yn.memoizedState=rr=r:rr=rr.next=r,rr}function Vi(){if(Jn===null){var r=yn.alternate;r=r!==null?r.memoizedState:null}else r=Jn.next;var o=rr===null?yn.memoizedState:rr.next;if(o!==null)rr=o,Jn=r;else{if(r===null)throw Error(Ce(310));Jn=r,r={memoizedState:Jn.memoizedState,baseState:Jn.baseState,baseQueue:Jn.baseQueue,queue:Jn.queue,next:null},rr===null?yn.memoizedState=rr=r:rr=rr.next=r}return rr}function ul(r,o){return typeof o=="function"?o(r):o}function Nv(r){var o=Vi(),a=o.queue;if(a===null)throw Error(Ce(311));a.lastRenderedReducer=r;var c=Jn,l=c.baseQueue,f=a.pending;if(f!==null){if(l!==null){var v=l.next;l.next=f.next,f.next=v}c.baseQueue=l=f,a.pending=null}if(l!==null){f=l.next,c=c.baseState;var R=v=null,T=null,C=f;do{var O=C.lane;if((Ba&O)===O)T!==null&&(T=T.next={lane:0,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null}),c=C.hasEagerState?C.eagerState:r(c,C.action);else{var N={lane:O,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null};T===null?(R=T=N,v=c):T=T.next=N,yn.lanes|=O,ja|=O}C=C.next}while(C!==null&&C!==f);T===null?v=c:T.next=R,so(c,o.memoizedState)||(Xr=!0),o.memoizedState=c,o.baseState=v,o.baseQueue=T,a.lastRenderedState=c}if(r=a.interleaved,r!==null){l=r;do f=l.lane,yn.lanes|=f,ja|=f,l=l.next;while(l!==r)}else l===null&&(a.lanes=0);return[o.memoizedState,a.dispatch]}function Pv(r){var o=Vi(),a=o.queue;if(a===null)throw Error(Ce(311));a.lastRenderedReducer=r;var c=a.dispatch,l=a.pending,f=o.memoizedState;if(l!==null){a.pending=null;var v=l=l.next;do f=r(f,v.action),v=v.next;while(v!==l);so(f,o.memoizedState)||(Xr=!0),o.memoizedState=f,o.baseQueue===null&&(o.baseState=f),a.lastRenderedState=f}return[f,c]}function lk(){}function hk(r,o){var a=yn,c=Vi(),l=o(),f=!so(c.memoizedState,l);if(f&&(c.memoizedState=l,Xr=!0),c=c.queue,kS(_k.bind(null,a,c,r),[r]),c.getSnapshot!==o||f||rr!==null&&rr.memoizedState.tag&1){if(a.flags|=2048,dl(9,fk.bind(null,a,c,l,o),void 0,null),or===null)throw Error(Ce(349));Ba&30||pk(a,o,l)}return l}function pk(r,o,a){r.flags|=16384,r={getSnapshot:o,value:a},o=yn.updateQueue,o===null?(o={lastEffect:null,stores:null},yn.updateQueue=o,o.stores=[r]):(a=o.stores,a===null?o.stores=[r]:a.push(r))}function fk(r,o,a,c){o.value=a,o.getSnapshot=c,mk(o)&&Ek(r)}function _k(r,o,a){return a(function(){mk(o)&&Ek(r)})}function mk(r){var o=r.getSnapshot;r=r.value;try{var a=o();return!so(r,a)}catch{return!0}}function Ek(r){var o=ts(r,1);o!==null&&ro(o,r,1,-1)}function S1(r){var o=yo();return typeof r=="function"&&(r=r()),o.memoizedState=o.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ul,lastRenderedState:r},o.queue=r,r=r.dispatch=kG.bind(null,yn,r),[o.memoizedState,r]}function dl(r,o,a,c){return r={tag:r,create:o,destroy:a,deps:c,next:null},o=yn.updateQueue,o===null?(o={lastEffect:null,stores:null},yn.updateQueue=o,o.lastEffect=r.next=r):(a=o.lastEffect,a===null?o.lastEffect=r.next=r:(c=a.next,a.next=r,r.next=c,o.lastEffect=r)),r}function vk(){return Vi().memoizedState}function Jp(r,o,a,c){var l=yo();yn.flags|=r,l.memoizedState=dl(1|o,a,void 0,c===void 0?null:c)}function O0(r,o,a,c){var l=Vi();c=c===void 0?null:c;var f=void 0;if(Jn!==null){var v=Jn.memoizedState;if(f=v.destroy,c!==null&&NS(c,v.deps)){l.memoizedState=dl(o,a,f,c);return}}yn.flags|=r,l.memoizedState=dl(1|o,a,f,c)}function T1(r,o){return Jp(8390656,8,r,o)}function kS(r,o){return O0(2048,8,r,o)}function gk(r,o){return O0(4,2,r,o)}function Sk(r,o){return O0(4,4,r,o)}function Tk(r,o){if(typeof o=="function")return r=r(),o(r),function(){o(null)};if(o!=null)return r=r(),o.current=r,function(){o.current=null}}function yk(r,o,a){return a=a!=null?a.concat([r]):null,O0(4,4,Tk.bind(null,o,r),a)}function LS(){}function Rk(r,o){var a=Vi();o=o===void 0?null:o;var c=a.memoizedState;return c!==null&&o!==null&&NS(o,c[1])?c[0]:(a.memoizedState=[r,o],r)}function Ck(r,o){var a=Vi();o=o===void 0?null:o;var c=a.memoizedState;return c!==null&&o!==null&&NS(o,c[1])?c[0]:(r=r(),a.memoizedState=[r,o],r)}function Ik(r,o,a){return Ba&21?(so(a,o)||(a=OD(),yn.lanes|=a,ja|=a,r.baseState=!0),o):(r.baseState&&(r.baseState=!1,Xr=!0),r.memoizedState=a)}function PG(r,o){var a=qt;qt=a!==0&&4>a?a:4,r(!0);var c=bv.transition;bv.transition={};try{r(!1),o()}finally{qt=a,bv.transition=c}}function Ak(){return Vi().memoizedState}function DG(r,o,a){var c=zs(r);if(a={lane:c,action:a,hasEagerState:!1,eagerState:null,next:null},wk(r))Ok(o,a);else if(a=ik(r,o,a,c),a!==null){var l=kr();ro(a,r,c,l),bk(a,o,c)}}function kG(r,o,a){var c=zs(r),l={lane:c,action:a,hasEagerState:!1,eagerState:null,next:null};if(wk(r))Ok(o,l);else{var f=r.alternate;if(r.lanes===0&&(f===null||f.lanes===0)&&(f=o.lastRenderedReducer,f!==null))try{var v=o.lastRenderedState,R=f(v,a);if(l.hasEagerState=!0,l.eagerState=R,so(R,v)){var T=o.interleaved;T===null?(l.next=l,IS(o)):(l.next=T.next,T.next=l),o.interleaved=l;return}}catch{}finally{}a=ik(r,o,l,c),a!==null&&(l=kr(),ro(a,r,c,l),bk(a,o,c))}}function wk(r){var o=r.alternate;return r===yn||o!==null&&o===yn}function Ok(r,o){Gd=Cf=!0;var a=r.pending;a===null?o.next=o:(o.next=a.next,a.next=o),r.pending=o}function bk(r,o,a){if(a&4194240){var c=o.lanes;c&=r.pendingLanes,a|=c,o.lanes=a,lS(r,a)}}var If={readContext:Ui,useCallback:Rr,useContext:Rr,useEffect:Rr,useImperativeHandle:Rr,useInsertionEffect:Rr,useLayoutEffect:Rr,useMemo:Rr,useReducer:Rr,useRef:Rr,useState:Rr,useDebugValue:Rr,useDeferredValue:Rr,useTransition:Rr,useMutableSource:Rr,useSyncExternalStore:Rr,useId:Rr,unstable_isNewReconciler:!1},LG={readContext:Ui,useCallback:function(r,o){return yo().memoizedState=[r,o===void 0?null:o],r},useContext:Ui,useEffect:T1,useImperativeHandle:function(r,o,a){return a=a!=null?a.concat([r]):null,Jp(4194308,4,Tk.bind(null,o,r),a)},useLayoutEffect:function(r,o){return Jp(4194308,4,r,o)},useInsertionEffect:function(r,o){return Jp(4,2,r,o)},useMemo:function(r,o){var a=yo();return o=o===void 0?null:o,r=r(),a.memoizedState=[r,o],r},useReducer:function(r,o,a){var c=yo();return o=a!==void 0?a(o):o,c.memoizedState=c.baseState=o,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:o},c.queue=r,r=r.dispatch=DG.bind(null,yn,r),[c.memoizedState,r]},useRef:function(r){var o=yo();return r={current:r},o.memoizedState=r},useState:S1,useDebugValue:LS,useDeferredValue:function(r){return yo().memoizedState=r},useTransition:function(){var r=S1(!1),o=r[0];return r=PG.bind(null,r[1]),yo().memoizedState=r,[o,r]},useMutableSource:function(){},useSyncExternalStore:function(r,o,a){var c=yn,l=yo();if(vn){if(a===void 0)throw Error(Ce(407));a=a()}else{if(a=o(),or===null)throw Error(Ce(349));Ba&30||pk(c,o,a)}l.memoizedState=a;var f={value:a,getSnapshot:o};return l.queue=f,T1(_k.bind(null,c,f,r),[r]),c.flags|=2048,dl(9,fk.bind(null,c,f,a,o),void 0,null),a},useId:function(){var r=yo(),o=or.identifierPrefix;if(vn){var a=Jo,c=qo;a=(c&~(1<<32-no(c)-1)).toString(32)+a,o=":"+o+"R"+a,a=cl++,0<a&&(o+="H"+a.toString(32)),o+=":"}else a=NG++,o=":"+o+"r"+a.toString(32)+":";return r.memoizedState=o},unstable_isNewReconciler:!1},xG={readContext:Ui,useCallback:Rk,useContext:Ui,useEffect:kS,useImperativeHandle:yk,useInsertionEffect:gk,useLayoutEffect:Sk,useMemo:Ck,useReducer:Nv,useRef:vk,useState:function(){return Nv(ul)},useDebugValue:LS,useDeferredValue:function(r){var o=Vi();return Ik(o,Jn.memoizedState,r)},useTransition:function(){var r=Nv(ul)[0],o=Vi().memoizedState;return[r,o]},useMutableSource:lk,useSyncExternalStore:hk,useId:Ak,unstable_isNewReconciler:!1},MG={readContext:Ui,useCallback:Rk,useContext:Ui,useEffect:kS,useImperativeHandle:yk,useInsertionEffect:gk,useLayoutEffect:Sk,useMemo:Ck,useReducer:Pv,useRef:vk,useState:function(){return Pv(ul)},useDebugValue:LS,useDeferredValue:function(r){var o=Vi();return Jn===null?o.memoizedState=r:Ik(o,Jn.memoizedState,r)},useTransition:function(){var r=Pv(ul)[0],o=Vi().memoizedState;return[r,o]},useMutableSource:lk,useSyncExternalStore:hk,useId:Ak,unstable_isNewReconciler:!1};function mu(r,o){try{var a="",c=o;do a+=d5(c),c=c.return;while(c);var l=a}catch(f){l=`
Error generating stack: `+f.message+`
`+f.stack}return{value:r,source:o,stack:l,digest:null}}function Dv(r,o,a){return{value:r,source:null,stack:a??null,digest:o??null}}function yg(r,o){try{console.error(o.value)}catch(a){setTimeout(function(){throw a})}}var UG=typeof WeakMap=="function"?WeakMap:Map;function Nk(r,o,a){a=Qo(-1,a),a.tag=3,a.payload={element:null};var c=o.value;return a.callback=function(){wf||(wf=!0,Dg=c),yg(r,o)},a}function Pk(r,o,a){a=Qo(-1,a),a.tag=3;var c=r.type.getDerivedStateFromError;if(typeof c=="function"){var l=o.value;a.payload=function(){return c(l)},a.callback=function(){yg(r,o)}}var f=r.stateNode;return f!==null&&typeof f.componentDidCatch=="function"&&(a.callback=function(){yg(r,o),typeof c!="function"&&(Ks===null?Ks=new Set([this]):Ks.add(this));var v=o.stack;this.componentDidCatch(o.value,{componentStack:v!==null?v:""})}),a}function y1(r,o,a){var c=r.pingCache;if(c===null){c=r.pingCache=new UG;var l=new Set;c.set(o,l)}else l=c.get(o),l===void 0&&(l=new Set,c.set(o,l));l.has(a)||(l.add(a),r=QG.bind(null,r,o,a),o.then(r,r))}function R1(r){do{var o;if((o=r.tag===13)&&(o=r.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return r;r=r.return}while(r!==null);return null}function C1(r,o,a,c,l){return r.mode&1?(r.flags|=65536,r.lanes=l,r):(r===o?r.flags|=65536:(r.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(o=Qo(-1,1),o.tag=2,Hs(a,o,1))),a.lanes|=1),r)}var VG=is.ReactCurrentOwner,Xr=!1;function Dr(r,o,a,c){o.child=r===null?uk(o,null,a,c):fu(o,r.child,a,c)}function I1(r,o,a,c,l){a=a.render;var f=o.ref;return cu(o,l),c=PS(r,o,a,c,f,l),a=DS(),r!==null&&!Xr?(o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~l,ns(r,o,l)):(vn&&a&&gS(o),o.flags|=1,Dr(r,o,c,l),o.child)}function A1(r,o,a,c,l){if(r===null){var f=a.type;return typeof f=="function"&&!GS(f)&&f.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(o.tag=15,o.type=f,Dk(r,o,f,c,l)):(r=Zp(a.type,null,c,o,o.mode,l),r.ref=o.ref,r.return=o,o.child=r)}if(f=r.child,!(r.lanes&l)){var v=f.memoizedProps;if(a=a.compare,a=a!==null?a:nl,a(v,c)&&r.ref===o.ref)return ns(r,o,l)}return o.flags|=1,r=Ys(f,c),r.ref=o.ref,r.return=o,o.child=r}function Dk(r,o,a,c,l){if(r!==null){var f=r.memoizedProps;if(nl(f,c)&&r.ref===o.ref)if(Xr=!1,o.pendingProps=c=f,(r.lanes&l)!==0)r.flags&131072&&(Xr=!0);else return o.lanes=r.lanes,ns(r,o,l)}return Rg(r,o,a,c,l)}function kk(r,o,a){var c=o.pendingProps,l=c.children,f=r!==null?r.memoizedState:null;if(c.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},cn(eu,_i),_i|=a;else{if(!(a&1073741824))return r=f!==null?f.baseLanes|a:a,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:r,cachePool:null,transitions:null},o.updateQueue=null,cn(eu,_i),_i|=r,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},c=f!==null?f.baseLanes:a,cn(eu,_i),_i|=c}else f!==null?(c=f.baseLanes|a,o.memoizedState=null):c=a,cn(eu,_i),_i|=c;return Dr(r,o,l,a),o.child}function Lk(r,o){var a=o.ref;(r===null&&a!==null||r!==null&&r.ref!==a)&&(o.flags|=512,o.flags|=2097152)}function Rg(r,o,a,c,l){var f=ei(a)?Ua:Ar.current;return f=hu(o,f),cu(o,l),a=PS(r,o,a,c,f,l),c=DS(),r!==null&&!Xr?(o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~l,ns(r,o,l)):(vn&&c&&gS(o),o.flags|=1,Dr(r,o,a,l),o.child)}function w1(r,o,a,c,l){if(ei(a)){var f=!0;Ef(o)}else f=!1;if(cu(o,l),o.stateNode===null)Xp(r,o),ak(o,a,c),Tg(o,a,c,l),c=!0;else if(r===null){var v=o.stateNode,R=o.memoizedProps;v.props=R;var T=v.context,C=a.contextType;typeof C=="object"&&C!==null?C=Ui(C):(C=ei(a)?Ua:Ar.current,C=hu(o,C));var O=a.getDerivedStateFromProps,N=typeof O=="function"||typeof v.getSnapshotBeforeUpdate=="function";N||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(R!==c||T!==C)&&v1(o,v,c,C),Ls=!1;var w=o.memoizedState;v.state=w,yf(o,c,v,l),T=o.memoizedState,R!==c||w!==T||Zr.current||Ls?(typeof O=="function"&&(Sg(o,a,O,c),T=o.memoizedState),(R=Ls||E1(o,a,R,c,w,T,C))?(N||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(o.flags|=4194308)):(typeof v.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=c,o.memoizedState=T),v.props=c,v.state=T,v.context=C,c=R):(typeof v.componentDidMount=="function"&&(o.flags|=4194308),c=!1)}else{v=o.stateNode,ok(r,o),R=o.memoizedProps,C=o.type===o.elementType?R:Zi(o.type,R),v.props=C,N=o.pendingProps,w=v.context,T=a.contextType,typeof T=="object"&&T!==null?T=Ui(T):(T=ei(a)?Ua:Ar.current,T=hu(o,T));var B=a.getDerivedStateFromProps;(O=typeof B=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(R!==N||w!==T)&&v1(o,v,c,T),Ls=!1,w=o.memoizedState,v.state=w,yf(o,c,v,l);var U=o.memoizedState;R!==N||w!==U||Zr.current||Ls?(typeof B=="function"&&(Sg(o,a,B,c),U=o.memoizedState),(C=Ls||E1(o,a,C,c,w,U,T)||!1)?(O||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(c,U,T),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(c,U,T)),typeof v.componentDidUpdate=="function"&&(o.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof v.componentDidUpdate!="function"||R===r.memoizedProps&&w===r.memoizedState||(o.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||R===r.memoizedProps&&w===r.memoizedState||(o.flags|=1024),o.memoizedProps=c,o.memoizedState=U),v.props=c,v.state=U,v.context=T,c=C):(typeof v.componentDidUpdate!="function"||R===r.memoizedProps&&w===r.memoizedState||(o.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||R===r.memoizedProps&&w===r.memoizedState||(o.flags|=1024),c=!1)}return Cg(r,o,a,c,f,l)}function Cg(r,o,a,c,l,f){Lk(r,o);var v=(o.flags&128)!==0;if(!c&&!v)return l&&h1(o,a,!1),ns(r,o,f);c=o.stateNode,VG.current=o;var R=v&&typeof a.getDerivedStateFromError!="function"?null:c.render();return o.flags|=1,r!==null&&v?(o.child=fu(o,r.child,null,f),o.child=fu(o,null,R,f)):Dr(r,o,R,f),o.memoizedState=c.state,l&&h1(o,a,!0),o.child}function xk(r){var o=r.stateNode;o.pendingContext?l1(r,o.pendingContext,o.pendingContext!==o.context):o.context&&l1(r,o.context,!1),wS(r,o.containerInfo)}function O1(r,o,a,c,l){return pu(),TS(l),o.flags|=256,Dr(r,o,a,c),o.child}var Ig={dehydrated:null,treeContext:null,retryLane:0};function Ag(r){return{baseLanes:r,cachePool:null,transitions:null}}function Mk(r,o,a){var c=o.pendingProps,l=Tn.current,f=!1,v=(o.flags&128)!==0,R;if((R=v)||(R=r!==null&&r.memoizedState===null?!1:(l&2)!==0),R?(f=!0,o.flags&=-129):(r===null||r.memoizedState!==null)&&(l|=1),cn(Tn,l&1),r===null)return vg(o),r=o.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(o.mode&1?r.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(v=c.children,r=c.fallback,f?(c=o.mode,f=o.child,v={mode:"hidden",children:v},!(c&1)&&f!==null?(f.childLanes=0,f.pendingProps=v):f=P0(v,c,0,null),r=xa(r,c,a,null),f.return=o,r.return=o,f.sibling=r,o.child=f,o.child.memoizedState=Ag(a),o.memoizedState=Ig,r):xS(o,v));if(l=r.memoizedState,l!==null&&(R=l.dehydrated,R!==null))return BG(r,o,v,c,R,l,a);if(f){f=c.fallback,v=o.mode,l=r.child,R=l.sibling;var T={mode:"hidden",children:c.children};return!(v&1)&&o.child!==l?(c=o.child,c.childLanes=0,c.pendingProps=T,o.deletions=null):(c=Ys(l,T),c.subtreeFlags=l.subtreeFlags&14680064),R!==null?f=Ys(R,f):(f=xa(f,v,a,null),f.flags|=2),f.return=o,c.return=o,c.sibling=f,o.child=c,c=f,f=o.child,v=r.child.memoizedState,v=v===null?Ag(a):{baseLanes:v.baseLanes|a,cachePool:null,transitions:v.transitions},f.memoizedState=v,f.childLanes=r.childLanes&~a,o.memoizedState=Ig,c}return f=r.child,r=f.sibling,c=Ys(f,{mode:"visible",children:c.children}),!(o.mode&1)&&(c.lanes=a),c.return=o,c.sibling=null,r!==null&&(a=o.deletions,a===null?(o.deletions=[r],o.flags|=16):a.push(r)),o.child=c,o.memoizedState=null,c}function xS(r,o){return o=P0({mode:"visible",children:o},r.mode,0,null),o.return=r,r.child=o}function kp(r,o,a,c){return c!==null&&TS(c),fu(o,r.child,null,a),r=xS(o,o.pendingProps.children),r.flags|=2,o.memoizedState=null,r}function BG(r,o,a,c,l,f,v){if(a)return o.flags&256?(o.flags&=-257,c=Dv(Error(Ce(422))),kp(r,o,v,c)):o.memoizedState!==null?(o.child=r.child,o.flags|=128,null):(f=c.fallback,l=o.mode,c=P0({mode:"visible",children:c.children},l,0,null),f=xa(f,l,v,null),f.flags|=2,c.return=o,f.return=o,c.sibling=f,o.child=c,o.mode&1&&fu(o,r.child,null,v),o.child.memoizedState=Ag(v),o.memoizedState=Ig,f);if(!(o.mode&1))return kp(r,o,v,null);if(l.data==="$!"){if(c=l.nextSibling&&l.nextSibling.dataset,c)var R=c.dgst;return c=R,f=Error(Ce(419)),c=Dv(f,c,void 0),kp(r,o,v,c)}if(R=(v&r.childLanes)!==0,Xr||R){if(c=or,c!==null){switch(v&-v){case 4:l=2;break;case 16:l=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:l=32;break;case 536870912:l=268435456;break;default:l=0}l=l&(c.suspendedLanes|v)?0:l,l!==0&&l!==f.retryLane&&(f.retryLane=l,ts(r,l),ro(c,r,l,-1))}return FS(),c=Dv(Error(Ce(421))),kp(r,o,v,c)}return l.data==="$?"?(o.flags|=128,o.child=r.child,o=$G.bind(null,r),l._reactRetry=o,null):(r=f.treeContext,mi=Ws(l.nextSibling),Ei=o,vn=!0,to=null,r!==null&&(Pi[Di++]=qo,Pi[Di++]=Jo,Pi[Di++]=Va,qo=r.id,Jo=r.overflow,Va=o),o=xS(o,c.children),o.flags|=4096,o)}function b1(r,o,a){r.lanes|=o;var c=r.alternate;c!==null&&(c.lanes|=o),gg(r.return,o,a)}function kv(r,o,a,c,l){var f=r.memoizedState;f===null?r.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:c,tail:a,tailMode:l}:(f.isBackwards=o,f.rendering=null,f.renderingStartTime=0,f.last=c,f.tail=a,f.tailMode=l)}function Uk(r,o,a){var c=o.pendingProps,l=c.revealOrder,f=c.tail;if(Dr(r,o,c.children,a),c=Tn.current,c&2)c=c&1|2,o.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=o.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&b1(r,a,o);else if(r.tag===19)b1(r,a,o);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break e;for(;r.sibling===null;){if(r.return===null||r.return===o)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}c&=1}if(cn(Tn,c),!(o.mode&1))o.memoizedState=null;else switch(l){case"forwards":for(a=o.child,l=null;a!==null;)r=a.alternate,r!==null&&Rf(r)===null&&(l=a),a=a.sibling;a=l,a===null?(l=o.child,o.child=null):(l=a.sibling,a.sibling=null),kv(o,!1,l,a,f);break;case"backwards":for(a=null,l=o.child,o.child=null;l!==null;){if(r=l.alternate,r!==null&&Rf(r)===null){o.child=l;break}r=l.sibling,l.sibling=a,a=l,l=r}kv(o,!0,a,null,f);break;case"together":kv(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Xp(r,o){!(o.mode&1)&&r!==null&&(r.alternate=null,o.alternate=null,o.flags|=2)}function ns(r,o,a){if(r!==null&&(o.dependencies=r.dependencies),ja|=o.lanes,!(a&o.childLanes))return null;if(r!==null&&o.child!==r.child)throw Error(Ce(153));if(o.child!==null){for(r=o.child,a=Ys(r,r.pendingProps),o.child=a,a.return=o;r.sibling!==null;)r=r.sibling,a=a.sibling=Ys(r,r.pendingProps),a.return=o;a.sibling=null}return o.child}function jG(r,o,a){switch(o.tag){case 3:xk(o),pu();break;case 5:dk(o);break;case 1:ei(o.type)&&Ef(o);break;case 4:wS(o,o.stateNode.containerInfo);break;case 10:var c=o.type._context,l=o.memoizedProps.value;cn(Sf,c._currentValue),c._currentValue=l;break;case 13:if(c=o.memoizedState,c!==null)return c.dehydrated!==null?(cn(Tn,Tn.current&1),o.flags|=128,null):a&o.child.childLanes?Mk(r,o,a):(cn(Tn,Tn.current&1),r=ns(r,o,a),r!==null?r.sibling:null);cn(Tn,Tn.current&1);break;case 19:if(c=(a&o.childLanes)!==0,r.flags&128){if(c)return Uk(r,o,a);o.flags|=128}if(l=o.memoizedState,l!==null&&(l.rendering=null,l.tail=null,l.lastEffect=null),cn(Tn,Tn.current),c)break;return null;case 22:case 23:return o.lanes=0,kk(r,o,a)}return ns(r,o,a)}var Vk,wg,Bk,jk;Vk=function(r,o){for(var a=o.child;a!==null;){if(a.tag===5||a.tag===6)r.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break;for(;a.sibling===null;){if(a.return===null||a.return===o)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};wg=function(){};Bk=function(r,o,a,c){var l=r.memoizedProps;if(l!==c){r=o.stateNode,ka(Ao.current);var f=null;switch(a){case"input":l=Jv(r,l),c=Jv(r,c),f=[];break;case"select":l=Rn({},l,{value:void 0}),c=Rn({},c,{value:void 0}),f=[];break;case"textarea":l=$v(r,l),c=$v(r,c),f=[];break;default:typeof l.onClick!="function"&&typeof c.onClick=="function"&&(r.onclick=_f)}eg(a,c);var v;a=null;for(C in l)if(!c.hasOwnProperty(C)&&l.hasOwnProperty(C)&&l[C]!=null)if(C==="style"){var R=l[C];for(v in R)R.hasOwnProperty(v)&&(a||(a={}),a[v]="")}else C!=="dangerouslySetInnerHTML"&&C!=="children"&&C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&C!=="autoFocus"&&(Jd.hasOwnProperty(C)?f||(f=[]):(f=f||[]).push(C,null));for(C in c){var T=c[C];if(R=l!=null?l[C]:void 0,c.hasOwnProperty(C)&&T!==R&&(T!=null||R!=null))if(C==="style")if(R){for(v in R)!R.hasOwnProperty(v)||T&&T.hasOwnProperty(v)||(a||(a={}),a[v]="");for(v in T)T.hasOwnProperty(v)&&R[v]!==T[v]&&(a||(a={}),a[v]=T[v])}else a||(f||(f=[]),f.push(C,a)),a=T;else C==="dangerouslySetInnerHTML"?(T=T?T.__html:void 0,R=R?R.__html:void 0,T!=null&&R!==T&&(f=f||[]).push(C,T)):C==="children"?typeof T!="string"&&typeof T!="number"||(f=f||[]).push(C,""+T):C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&(Jd.hasOwnProperty(C)?(T!=null&&C==="onScroll"&&pn("scroll",r),f||R===T||(f=[])):(f=f||[]).push(C,T))}a&&(f=f||[]).push("style",a);var C=f;(o.updateQueue=C)&&(o.flags|=4)}};jk=function(r,o,a,c){a!==c&&(o.flags|=4)};function bd(r,o){if(!vn)switch(r.tailMode){case"hidden":o=r.tail;for(var a=null;o!==null;)o.alternate!==null&&(a=o),o=o.sibling;a===null?r.tail=null:a.sibling=null;break;case"collapsed":a=r.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?o||r.tail===null?r.tail=null:r.tail.sibling=null:c.sibling=null}}function Cr(r){var o=r.alternate!==null&&r.alternate.child===r.child,a=0,c=0;if(o)for(var l=r.child;l!==null;)a|=l.lanes|l.childLanes,c|=l.subtreeFlags&14680064,c|=l.flags&14680064,l.return=r,l=l.sibling;else for(l=r.child;l!==null;)a|=l.lanes|l.childLanes,c|=l.subtreeFlags,c|=l.flags,l.return=r,l=l.sibling;return r.subtreeFlags|=c,r.childLanes=a,o}function FG(r,o,a){var c=o.pendingProps;switch(SS(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Cr(o),null;case 1:return ei(o.type)&&mf(),Cr(o),null;case 3:return c=o.stateNode,_u(),fn(Zr),fn(Ar),bS(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(r===null||r.child===null)&&(Pp(o)?o.flags|=4:r===null||r.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,to!==null&&(xg(to),to=null))),wg(r,o),Cr(o),null;case 5:OS(o);var l=ka(al.current);if(a=o.type,r!==null&&o.stateNode!=null)Bk(r,o,a,c,l),r.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!c){if(o.stateNode===null)throw Error(Ce(166));return Cr(o),null}if(r=ka(Ao.current),Pp(o)){c=o.stateNode,a=o.type;var f=o.memoizedProps;switch(c[Ro]=o,c[ol]=f,r=(o.mode&1)!==0,a){case"dialog":pn("cancel",c),pn("close",c);break;case"iframe":case"object":case"embed":pn("load",c);break;case"video":case"audio":for(l=0;l<Ld.length;l++)pn(Ld[l],c);break;case"source":pn("error",c);break;case"img":case"image":case"link":pn("error",c),pn("load",c);break;case"details":pn("toggle",c);break;case"input":VN(c,f),pn("invalid",c);break;case"select":c._wrapperState={wasMultiple:!!f.multiple},pn("invalid",c);break;case"textarea":jN(c,f),pn("invalid",c)}eg(a,f),l=null;for(var v in f)if(f.hasOwnProperty(v)){var R=f[v];v==="children"?typeof R=="string"?c.textContent!==R&&(f.suppressHydrationWarning!==!0&&Np(c.textContent,R,r),l=["children",R]):typeof R=="number"&&c.textContent!==""+R&&(f.suppressHydrationWarning!==!0&&Np(c.textContent,R,r),l=["children",""+R]):Jd.hasOwnProperty(v)&&R!=null&&v==="onScroll"&&pn("scroll",c)}switch(a){case"input":yp(c),BN(c,f,!0);break;case"textarea":yp(c),FN(c);break;case"select":case"option":break;default:typeof f.onClick=="function"&&(c.onclick=_f)}c=l,o.updateQueue=c,c!==null&&(o.flags|=4)}else{v=l.nodeType===9?l:l.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=pD(a)),r==="http://www.w3.org/1999/xhtml"?a==="script"?(r=v.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof c.is=="string"?r=v.createElement(a,{is:c.is}):(r=v.createElement(a),a==="select"&&(v=r,c.multiple?v.multiple=!0:c.size&&(v.size=c.size))):r=v.createElementNS(r,a),r[Ro]=o,r[ol]=c,Vk(r,o,!1,!1),o.stateNode=r;e:{switch(v=tg(a,c),a){case"dialog":pn("cancel",r),pn("close",r),l=c;break;case"iframe":case"object":case"embed":pn("load",r),l=c;break;case"video":case"audio":for(l=0;l<Ld.length;l++)pn(Ld[l],r);l=c;break;case"source":pn("error",r),l=c;break;case"img":case"image":case"link":pn("error",r),pn("load",r),l=c;break;case"details":pn("toggle",r),l=c;break;case"input":VN(r,c),l=Jv(r,c),pn("invalid",r);break;case"option":l=c;break;case"select":r._wrapperState={wasMultiple:!!c.multiple},l=Rn({},c,{value:void 0}),pn("invalid",r);break;case"textarea":jN(r,c),l=$v(r,c),pn("invalid",r);break;default:l=c}eg(a,l),R=l;for(f in R)if(R.hasOwnProperty(f)){var T=R[f];f==="style"?mD(r,T):f==="dangerouslySetInnerHTML"?(T=T?T.__html:void 0,T!=null&&fD(r,T)):f==="children"?typeof T=="string"?(a!=="textarea"||T!=="")&&Xd(r,T):typeof T=="number"&&Xd(r,""+T):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(Jd.hasOwnProperty(f)?T!=null&&f==="onScroll"&&pn("scroll",r):T!=null&&oS(r,f,T,v))}switch(a){case"input":yp(r),BN(r,c,!1);break;case"textarea":yp(r),FN(r);break;case"option":c.value!=null&&r.setAttribute("value",""+Js(c.value));break;case"select":r.multiple=!!c.multiple,f=c.value,f!=null?iu(r,!!c.multiple,f,!1):c.defaultValue!=null&&iu(r,!!c.multiple,c.defaultValue,!0);break;default:typeof l.onClick=="function"&&(r.onclick=_f)}switch(a){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}}c&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return Cr(o),null;case 6:if(r&&o.stateNode!=null)jk(r,o,r.memoizedProps,c);else{if(typeof c!="string"&&o.stateNode===null)throw Error(Ce(166));if(a=ka(al.current),ka(Ao.current),Pp(o)){if(c=o.stateNode,a=o.memoizedProps,c[Ro]=o,(f=c.nodeValue!==a)&&(r=Ei,r!==null))switch(r.tag){case 3:Np(c.nodeValue,a,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Np(c.nodeValue,a,(r.mode&1)!==0)}f&&(o.flags|=4)}else c=(a.nodeType===9?a:a.ownerDocument).createTextNode(c),c[Ro]=o,o.stateNode=c}return Cr(o),null;case 13:if(fn(Tn),c=o.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(vn&&mi!==null&&o.mode&1&&!(o.flags&128))rk(),pu(),o.flags|=98560,f=!1;else if(f=Pp(o),c!==null&&c.dehydrated!==null){if(r===null){if(!f)throw Error(Ce(318));if(f=o.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(Ce(317));f[Ro]=o}else pu(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;Cr(o),f=!1}else to!==null&&(xg(to),to=null),f=!0;if(!f)return o.flags&65536?o:null}return o.flags&128?(o.lanes=a,o):(c=c!==null,c!==(r!==null&&r.memoizedState!==null)&&c&&(o.child.flags|=8192,o.mode&1&&(r===null||Tn.current&1?Xn===0&&(Xn=3):FS())),o.updateQueue!==null&&(o.flags|=4),Cr(o),null);case 4:return _u(),wg(r,o),r===null&&rl(o.stateNode.containerInfo),Cr(o),null;case 10:return CS(o.type._context),Cr(o),null;case 17:return ei(o.type)&&mf(),Cr(o),null;case 19:if(fn(Tn),f=o.memoizedState,f===null)return Cr(o),null;if(c=(o.flags&128)!==0,v=f.rendering,v===null)if(c)bd(f,!1);else{if(Xn!==0||r!==null&&r.flags&128)for(r=o.child;r!==null;){if(v=Rf(r),v!==null){for(o.flags|=128,bd(f,!1),c=v.updateQueue,c!==null&&(o.updateQueue=c,o.flags|=4),o.subtreeFlags=0,c=a,a=o.child;a!==null;)f=a,r=c,f.flags&=14680066,v=f.alternate,v===null?(f.childLanes=0,f.lanes=r,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=v.childLanes,f.lanes=v.lanes,f.child=v.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=v.memoizedProps,f.memoizedState=v.memoizedState,f.updateQueue=v.updateQueue,f.type=v.type,r=v.dependencies,f.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),a=a.sibling;return cn(Tn,Tn.current&1|2),o.child}r=r.sibling}f.tail!==null&&Dn()>Eu&&(o.flags|=128,c=!0,bd(f,!1),o.lanes=4194304)}else{if(!c)if(r=Rf(v),r!==null){if(o.flags|=128,c=!0,a=r.updateQueue,a!==null&&(o.updateQueue=a,o.flags|=4),bd(f,!0),f.tail===null&&f.tailMode==="hidden"&&!v.alternate&&!vn)return Cr(o),null}else 2*Dn()-f.renderingStartTime>Eu&&a!==1073741824&&(o.flags|=128,c=!0,bd(f,!1),o.lanes=4194304);f.isBackwards?(v.sibling=o.child,o.child=v):(a=f.last,a!==null?a.sibling=v:o.child=v,f.last=v)}return f.tail!==null?(o=f.tail,f.rendering=o,f.tail=o.sibling,f.renderingStartTime=Dn(),o.sibling=null,a=Tn.current,cn(Tn,c?a&1|2:a&1),o):(Cr(o),null);case 22:case 23:return jS(),c=o.memoizedState!==null,r!==null&&r.memoizedState!==null!==c&&(o.flags|=8192),c&&o.mode&1?_i&1073741824&&(Cr(o),o.subtreeFlags&6&&(o.flags|=8192)):Cr(o),null;case 24:return null;case 25:return null}throw Error(Ce(156,o.tag))}function GG(r,o){switch(SS(o),o.tag){case 1:return ei(o.type)&&mf(),r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 3:return _u(),fn(Zr),fn(Ar),bS(),r=o.flags,r&65536&&!(r&128)?(o.flags=r&-65537|128,o):null;case 5:return OS(o),null;case 13:if(fn(Tn),r=o.memoizedState,r!==null&&r.dehydrated!==null){if(o.alternate===null)throw Error(Ce(340));pu()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 19:return fn(Tn),null;case 4:return _u(),null;case 10:return CS(o.type._context),null;case 22:case 23:return jS(),null;case 24:return null;default:return null}}var Lp=!1,Ir=!1,WG=typeof WeakSet=="function"?WeakSet:Set,Ve=null;function Zc(r,o){var a=r.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(c){In(r,o,c)}else a.current=null}function Og(r,o,a){try{a()}catch(c){In(r,o,c)}}var N1=!1;function HG(r,o){if(lg=hf,r=HD(),vS(r)){if("selectionStart"in r)var a={start:r.selectionStart,end:r.selectionEnd};else e:{a=(a=r.ownerDocument)&&a.defaultView||window;var c=a.getSelection&&a.getSelection();if(c&&c.rangeCount!==0){a=c.anchorNode;var l=c.anchorOffset,f=c.focusNode;c=c.focusOffset;try{a.nodeType,f.nodeType}catch{a=null;break e}var v=0,R=-1,T=-1,C=0,O=0,N=r,w=null;t:for(;;){for(var B;N!==a||l!==0&&N.nodeType!==3||(R=v+l),N!==f||c!==0&&N.nodeType!==3||(T=v+c),N.nodeType===3&&(v+=N.nodeValue.length),(B=N.firstChild)!==null;)w=N,N=B;for(;;){if(N===r)break t;if(w===a&&++C===l&&(R=v),w===f&&++O===c&&(T=v),(B=N.nextSibling)!==null)break;N=w,w=N.parentNode}N=B}a=R===-1||T===-1?null:{start:R,end:T}}else a=null}a=a||{start:0,end:0}}else a=null;for(hg={focusedElem:r,selectionRange:a},hf=!1,Ve=o;Ve!==null;)if(o=Ve,r=o.child,(o.subtreeFlags&1028)!==0&&r!==null)r.return=o,Ve=r;else for(;Ve!==null;){o=Ve;try{var U=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(U!==null){var W=U.memoizedProps,q=U.memoizedState,G=o.stateNode,b=G.getSnapshotBeforeUpdate(o.elementType===o.type?W:Zi(o.type,W),q);G.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var M=o.stateNode.containerInfo;M.nodeType===1?M.textContent="":M.nodeType===9&&M.documentElement&&M.removeChild(M.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ce(163))}}catch(j){In(o,o.return,j)}if(r=o.sibling,r!==null){r.return=o.return,Ve=r;break}Ve=o.return}return U=N1,N1=!1,U}function Wd(r,o,a){var c=o.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var l=c=c.next;do{if((l.tag&r)===r){var f=l.destroy;l.destroy=void 0,f!==void 0&&Og(o,a,f)}l=l.next}while(l!==c)}}function b0(r,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var a=o=o.next;do{if((a.tag&r)===r){var c=a.create;a.destroy=c()}a=a.next}while(a!==o)}}function bg(r){var o=r.ref;if(o!==null){var a=r.stateNode;switch(r.tag){case 5:r=a;break;default:r=a}typeof o=="function"?o(r):o.current=r}}function Fk(r){var o=r.alternate;o!==null&&(r.alternate=null,Fk(o)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(o=r.stateNode,o!==null&&(delete o[Ro],delete o[ol],delete o[_g],delete o[AG],delete o[wG])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function Gk(r){return r.tag===5||r.tag===3||r.tag===4}function P1(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Gk(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Ng(r,o,a){var c=r.tag;if(c===5||c===6)r=r.stateNode,o?a.nodeType===8?a.parentNode.insertBefore(r,o):a.insertBefore(r,o):(a.nodeType===8?(o=a.parentNode,o.insertBefore(r,a)):(o=a,o.appendChild(r)),a=a._reactRootContainer,a!=null||o.onclick!==null||(o.onclick=_f));else if(c!==4&&(r=r.child,r!==null))for(Ng(r,o,a),r=r.sibling;r!==null;)Ng(r,o,a),r=r.sibling}function Pg(r,o,a){var c=r.tag;if(c===5||c===6)r=r.stateNode,o?a.insertBefore(r,o):a.appendChild(r);else if(c!==4&&(r=r.child,r!==null))for(Pg(r,o,a),r=r.sibling;r!==null;)Pg(r,o,a),r=r.sibling}var lr=null,eo=!1;function Ds(r,o,a){for(a=a.child;a!==null;)Wk(r,o,a),a=a.sibling}function Wk(r,o,a){if(Io&&typeof Io.onCommitFiberUnmount=="function")try{Io.onCommitFiberUnmount(T0,a)}catch{}switch(a.tag){case 5:Ir||Zc(a,o);case 6:var c=lr,l=eo;lr=null,Ds(r,o,a),lr=c,eo=l,lr!==null&&(eo?(r=lr,a=a.stateNode,r.nodeType===8?r.parentNode.removeChild(a):r.removeChild(a)):lr.removeChild(a.stateNode));break;case 18:lr!==null&&(eo?(r=lr,a=a.stateNode,r.nodeType===8?Av(r.parentNode,a):r.nodeType===1&&Av(r,a),el(r)):Av(lr,a.stateNode));break;case 4:c=lr,l=eo,lr=a.stateNode.containerInfo,eo=!0,Ds(r,o,a),lr=c,eo=l;break;case 0:case 11:case 14:case 15:if(!Ir&&(c=a.updateQueue,c!==null&&(c=c.lastEffect,c!==null))){l=c=c.next;do{var f=l,v=f.destroy;f=f.tag,v!==void 0&&(f&2||f&4)&&Og(a,o,v),l=l.next}while(l!==c)}Ds(r,o,a);break;case 1:if(!Ir&&(Zc(a,o),c=a.stateNode,typeof c.componentWillUnmount=="function"))try{c.props=a.memoizedProps,c.state=a.memoizedState,c.componentWillUnmount()}catch(R){In(a,o,R)}Ds(r,o,a);break;case 21:Ds(r,o,a);break;case 22:a.mode&1?(Ir=(c=Ir)||a.memoizedState!==null,Ds(r,o,a),Ir=c):Ds(r,o,a);break;default:Ds(r,o,a)}}function D1(r){var o=r.updateQueue;if(o!==null){r.updateQueue=null;var a=r.stateNode;a===null&&(a=r.stateNode=new WG),o.forEach(function(c){var l=ZG.bind(null,r,c);a.has(c)||(a.add(c),c.then(l,l))})}}function $i(r,o){var a=o.deletions;if(a!==null)for(var c=0;c<a.length;c++){var l=a[c];try{var f=r,v=o,R=v;e:for(;R!==null;){switch(R.tag){case 5:lr=R.stateNode,eo=!1;break e;case 3:lr=R.stateNode.containerInfo,eo=!0;break e;case 4:lr=R.stateNode.containerInfo,eo=!0;break e}R=R.return}if(lr===null)throw Error(Ce(160));Wk(f,v,l),lr=null,eo=!1;var T=l.alternate;T!==null&&(T.return=null),l.return=null}catch(C){In(l,o,C)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)Hk(o,r),o=o.sibling}function Hk(r,o){var a=r.alternate,c=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if($i(o,r),To(r),c&4){try{Wd(3,r,r.return),b0(3,r)}catch(W){In(r,r.return,W)}try{Wd(5,r,r.return)}catch(W){In(r,r.return,W)}}break;case 1:$i(o,r),To(r),c&512&&a!==null&&Zc(a,a.return);break;case 5:if($i(o,r),To(r),c&512&&a!==null&&Zc(a,a.return),r.flags&32){var l=r.stateNode;try{Xd(l,"")}catch(W){In(r,r.return,W)}}if(c&4&&(l=r.stateNode,l!=null)){var f=r.memoizedProps,v=a!==null?a.memoizedProps:f,R=r.type,T=r.updateQueue;if(r.updateQueue=null,T!==null)try{R==="input"&&f.type==="radio"&&f.name!=null&&lD(l,f),tg(R,v);var C=tg(R,f);for(v=0;v<T.length;v+=2){var O=T[v],N=T[v+1];O==="style"?mD(l,N):O==="dangerouslySetInnerHTML"?fD(l,N):O==="children"?Xd(l,N):oS(l,O,N,C)}switch(R){case"input":Xv(l,f);break;case"textarea":hD(l,f);break;case"select":var w=l._wrapperState.wasMultiple;l._wrapperState.wasMultiple=!!f.multiple;var B=f.value;B!=null?iu(l,!!f.multiple,B,!1):w!==!!f.multiple&&(f.defaultValue!=null?iu(l,!!f.multiple,f.defaultValue,!0):iu(l,!!f.multiple,f.multiple?[]:"",!1))}l[ol]=f}catch(W){In(r,r.return,W)}}break;case 6:if($i(o,r),To(r),c&4){if(r.stateNode===null)throw Error(Ce(162));l=r.stateNode,f=r.memoizedProps;try{l.nodeValue=f}catch(W){In(r,r.return,W)}}break;case 3:if($i(o,r),To(r),c&4&&a!==null&&a.memoizedState.isDehydrated)try{el(o.containerInfo)}catch(W){In(r,r.return,W)}break;case 4:$i(o,r),To(r);break;case 13:$i(o,r),To(r),l=r.child,l.flags&8192&&(f=l.memoizedState!==null,l.stateNode.isHidden=f,!f||l.alternate!==null&&l.alternate.memoizedState!==null||(VS=Dn())),c&4&&D1(r);break;case 22:if(O=a!==null&&a.memoizedState!==null,r.mode&1?(Ir=(C=Ir)||O,$i(o,r),Ir=C):$i(o,r),To(r),c&8192){if(C=r.memoizedState!==null,(r.stateNode.isHidden=C)&&!O&&r.mode&1)for(Ve=r,O=r.child;O!==null;){for(N=Ve=O;Ve!==null;){switch(w=Ve,B=w.child,w.tag){case 0:case 11:case 14:case 15:Wd(4,w,w.return);break;case 1:Zc(w,w.return);var U=w.stateNode;if(typeof U.componentWillUnmount=="function"){c=w,a=w.return;try{o=c,U.props=o.memoizedProps,U.state=o.memoizedState,U.componentWillUnmount()}catch(W){In(c,a,W)}}break;case 5:Zc(w,w.return);break;case 22:if(w.memoizedState!==null){L1(N);continue}}B!==null?(B.return=w,Ve=B):L1(N)}O=O.sibling}e:for(O=null,N=r;;){if(N.tag===5){if(O===null){O=N;try{l=N.stateNode,C?(f=l.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none"):(R=N.stateNode,T=N.memoizedProps.style,v=T!=null&&T.hasOwnProperty("display")?T.display:null,R.style.display=_D("display",v))}catch(W){In(r,r.return,W)}}}else if(N.tag===6){if(O===null)try{N.stateNode.nodeValue=C?"":N.memoizedProps}catch(W){In(r,r.return,W)}}else if((N.tag!==22&&N.tag!==23||N.memoizedState===null||N===r)&&N.child!==null){N.child.return=N,N=N.child;continue}if(N===r)break e;for(;N.sibling===null;){if(N.return===null||N.return===r)break e;O===N&&(O=null),N=N.return}O===N&&(O=null),N.sibling.return=N.return,N=N.sibling}}break;case 19:$i(o,r),To(r),c&4&&D1(r);break;case 21:break;default:$i(o,r),To(r)}}function To(r){var o=r.flags;if(o&2){try{e:{for(var a=r.return;a!==null;){if(Gk(a)){var c=a;break e}a=a.return}throw Error(Ce(160))}switch(c.tag){case 5:var l=c.stateNode;c.flags&32&&(Xd(l,""),c.flags&=-33);var f=P1(r);Pg(r,f,l);break;case 3:case 4:var v=c.stateNode.containerInfo,R=P1(r);Ng(r,R,v);break;default:throw Error(Ce(161))}}catch(T){In(r,r.return,T)}r.flags&=-3}o&4096&&(r.flags&=-4097)}function KG(r,o,a){Ve=r,Kk(r)}function Kk(r,o,a){for(var c=(r.mode&1)!==0;Ve!==null;){var l=Ve,f=l.child;if(l.tag===22&&c){var v=l.memoizedState!==null||Lp;if(!v){var R=l.alternate,T=R!==null&&R.memoizedState!==null||Ir;R=Lp;var C=Ir;if(Lp=v,(Ir=T)&&!C)for(Ve=l;Ve!==null;)v=Ve,T=v.child,v.tag===22&&v.memoizedState!==null?x1(l):T!==null?(T.return=v,Ve=T):x1(l);for(;f!==null;)Ve=f,Kk(f),f=f.sibling;Ve=l,Lp=R,Ir=C}k1(r)}else l.subtreeFlags&8772&&f!==null?(f.return=l,Ve=f):k1(r)}}function k1(r){for(;Ve!==null;){var o=Ve;if(o.flags&8772){var a=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:Ir||b0(5,o);break;case 1:var c=o.stateNode;if(o.flags&4&&!Ir)if(a===null)c.componentDidMount();else{var l=o.elementType===o.type?a.memoizedProps:Zi(o.type,a.memoizedProps);c.componentDidUpdate(l,a.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var f=o.updateQueue;f!==null&&m1(o,f,c);break;case 3:var v=o.updateQueue;if(v!==null){if(a=null,o.child!==null)switch(o.child.tag){case 5:a=o.child.stateNode;break;case 1:a=o.child.stateNode}m1(o,v,a)}break;case 5:var R=o.stateNode;if(a===null&&o.flags&4){a=R;var T=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":T.autoFocus&&a.focus();break;case"img":T.src&&(a.src=T.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var C=o.alternate;if(C!==null){var O=C.memoizedState;if(O!==null){var N=O.dehydrated;N!==null&&el(N)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ce(163))}Ir||o.flags&512&&bg(o)}catch(w){In(o,o.return,w)}}if(o===r){Ve=null;break}if(a=o.sibling,a!==null){a.return=o.return,Ve=a;break}Ve=o.return}}function L1(r){for(;Ve!==null;){var o=Ve;if(o===r){Ve=null;break}var a=o.sibling;if(a!==null){a.return=o.return,Ve=a;break}Ve=o.return}}function x1(r){for(;Ve!==null;){var o=Ve;try{switch(o.tag){case 0:case 11:case 15:var a=o.return;try{b0(4,o)}catch(T){In(o,a,T)}break;case 1:var c=o.stateNode;if(typeof c.componentDidMount=="function"){var l=o.return;try{c.componentDidMount()}catch(T){In(o,l,T)}}var f=o.return;try{bg(o)}catch(T){In(o,f,T)}break;case 5:var v=o.return;try{bg(o)}catch(T){In(o,v,T)}}}catch(T){In(o,o.return,T)}if(o===r){Ve=null;break}var R=o.sibling;if(R!==null){R.return=o.return,Ve=R;break}Ve=o.return}}var zG=Math.ceil,Af=is.ReactCurrentDispatcher,MS=is.ReactCurrentOwner,Mi=is.ReactCurrentBatchConfig,Pt=0,or=null,Hn=null,hr=0,_i=0,eu=Zs(0),Xn=0,ll=null,ja=0,N0=0,US=0,Hd=null,Jr=null,VS=0,Eu=1/0,Ko=null,wf=!1,Dg=null,Ks=null,xp=!1,Vs=null,Of=0,Kd=0,kg=null,Qp=-1,$p=0;function kr(){return Pt&6?Dn():Qp!==-1?Qp:Qp=Dn()}function zs(r){return r.mode&1?Pt&2&&hr!==0?hr&-hr:bG.transition!==null?($p===0&&($p=OD()),$p):(r=qt,r!==0||(r=window.event,r=r===void 0?16:xD(r.type)),r):1}function ro(r,o,a,c){if(50<Kd)throw Kd=0,kg=null,Error(Ce(185));gl(r,a,c),(!(Pt&2)||r!==or)&&(r===or&&(!(Pt&2)&&(N0|=a),Xn===4&&Ms(r,hr)),ti(r,c),a===1&&Pt===0&&!(o.mode&1)&&(Eu=Dn()+500,A0&&ea()))}function ti(r,o){var a=r.callbackNode;b5(r,o);var c=lf(r,r===or?hr:0);if(c===0)a!==null&&HN(a),r.callbackNode=null,r.callbackPriority=0;else if(o=c&-c,r.callbackPriority!==o){if(a!=null&&HN(a),o===1)r.tag===0?OG(M1.bind(null,r)):ek(M1.bind(null,r)),CG(function(){!(Pt&6)&&ea()}),a=null;else{switch(bD(c)){case 1:a=dS;break;case 4:a=AD;break;case 16:a=df;break;case 536870912:a=wD;break;default:a=df}a=Zk(a,zk.bind(null,r))}r.callbackPriority=o,r.callbackNode=a}}function zk(r,o){if(Qp=-1,$p=0,Pt&6)throw Error(Ce(327));var a=r.callbackNode;if(uu()&&r.callbackNode!==a)return null;var c=lf(r,r===or?hr:0);if(c===0)return null;if(c&30||c&r.expiredLanes||o)o=bf(r,c);else{o=c;var l=Pt;Pt|=2;var f=qk();(or!==r||hr!==o)&&(Ko=null,Eu=Dn()+500,La(r,o));do try{JG();break}catch(R){Yk(r,R)}while(1);RS(),Af.current=f,Pt=l,Hn!==null?o=0:(or=null,hr=0,o=Xn)}if(o!==0){if(o===2&&(l=sg(r),l!==0&&(c=l,o=Lg(r,l))),o===1)throw a=ll,La(r,0),Ms(r,c),ti(r,Dn()),a;if(o===6)Ms(r,c);else{if(l=r.current.alternate,!(c&30)&&!YG(l)&&(o=bf(r,c),o===2&&(f=sg(r),f!==0&&(c=f,o=Lg(r,f))),o===1))throw a=ll,La(r,0),Ms(r,c),ti(r,Dn()),a;switch(r.finishedWork=l,r.finishedLanes=c,o){case 0:case 1:throw Error(Ce(345));case 2:Na(r,Jr,Ko);break;case 3:if(Ms(r,c),(c&130023424)===c&&(o=VS+500-Dn(),10<o)){if(lf(r,0)!==0)break;if(l=r.suspendedLanes,(l&c)!==c){kr(),r.pingedLanes|=r.suspendedLanes&l;break}r.timeoutHandle=fg(Na.bind(null,r,Jr,Ko),o);break}Na(r,Jr,Ko);break;case 4:if(Ms(r,c),(c&4194240)===c)break;for(o=r.eventTimes,l=-1;0<c;){var v=31-no(c);f=1<<v,v=o[v],v>l&&(l=v),c&=~f}if(c=l,c=Dn()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*zG(c/1960))-c,10<c){r.timeoutHandle=fg(Na.bind(null,r,Jr,Ko),c);break}Na(r,Jr,Ko);break;case 5:Na(r,Jr,Ko);break;default:throw Error(Ce(329))}}}return ti(r,Dn()),r.callbackNode===a?zk.bind(null,r):null}function Lg(r,o){var a=Hd;return r.current.memoizedState.isDehydrated&&(La(r,o).flags|=256),r=bf(r,o),r!==2&&(o=Jr,Jr=a,o!==null&&xg(o)),r}function xg(r){Jr===null?Jr=r:Jr.push.apply(Jr,r)}function YG(r){for(var o=r;;){if(o.flags&16384){var a=o.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var c=0;c<a.length;c++){var l=a[c],f=l.getSnapshot;l=l.value;try{if(!so(f(),l))return!1}catch{return!1}}}if(a=o.child,o.subtreeFlags&16384&&a!==null)a.return=o,o=a;else{if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Ms(r,o){for(o&=~US,o&=~N0,r.suspendedLanes|=o,r.pingedLanes&=~o,r=r.expirationTimes;0<o;){var a=31-no(o),c=1<<a;r[a]=-1,o&=~c}}function M1(r){if(Pt&6)throw Error(Ce(327));uu();var o=lf(r,0);if(!(o&1))return ti(r,Dn()),null;var a=bf(r,o);if(r.tag!==0&&a===2){var c=sg(r);c!==0&&(o=c,a=Lg(r,c))}if(a===1)throw a=ll,La(r,0),Ms(r,o),ti(r,Dn()),a;if(a===6)throw Error(Ce(345));return r.finishedWork=r.current.alternate,r.finishedLanes=o,Na(r,Jr,Ko),ti(r,Dn()),null}function BS(r,o){var a=Pt;Pt|=1;try{return r(o)}finally{Pt=a,Pt===0&&(Eu=Dn()+500,A0&&ea())}}function Fa(r){Vs!==null&&Vs.tag===0&&!(Pt&6)&&uu();var o=Pt;Pt|=1;var a=Mi.transition,c=qt;try{if(Mi.transition=null,qt=1,r)return r()}finally{qt=c,Mi.transition=a,Pt=o,!(Pt&6)&&ea()}}function jS(){_i=eu.current,fn(eu)}function La(r,o){r.finishedWork=null,r.finishedLanes=0;var a=r.timeoutHandle;if(a!==-1&&(r.timeoutHandle=-1,RG(a)),Hn!==null)for(a=Hn.return;a!==null;){var c=a;switch(SS(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&mf();break;case 3:_u(),fn(Zr),fn(Ar),bS();break;case 5:OS(c);break;case 4:_u();break;case 13:fn(Tn);break;case 19:fn(Tn);break;case 10:CS(c.type._context);break;case 22:case 23:jS()}a=a.return}if(or=r,Hn=r=Ys(r.current,null),hr=_i=o,Xn=0,ll=null,US=N0=ja=0,Jr=Hd=null,Da!==null){for(o=0;o<Da.length;o++)if(a=Da[o],c=a.interleaved,c!==null){a.interleaved=null;var l=c.next,f=a.pending;if(f!==null){var v=f.next;f.next=l,c.next=v}a.pending=c}Da=null}return r}function Yk(r,o){do{var a=Hn;try{if(RS(),qp.current=If,Cf){for(var c=yn.memoizedState;c!==null;){var l=c.queue;l!==null&&(l.pending=null),c=c.next}Cf=!1}if(Ba=0,rr=Jn=yn=null,Gd=!1,cl=0,MS.current=null,a===null||a.return===null){Xn=1,ll=o,Hn=null;break}e:{var f=r,v=a.return,R=a,T=o;if(o=hr,R.flags|=32768,T!==null&&typeof T=="object"&&typeof T.then=="function"){var C=T,O=R,N=O.tag;if(!(O.mode&1)&&(N===0||N===11||N===15)){var w=O.alternate;w?(O.updateQueue=w.updateQueue,O.memoizedState=w.memoizedState,O.lanes=w.lanes):(O.updateQueue=null,O.memoizedState=null)}var B=R1(v);if(B!==null){B.flags&=-257,C1(B,v,R,f,o),B.mode&1&&y1(f,C,o),o=B,T=C;var U=o.updateQueue;if(U===null){var W=new Set;W.add(T),o.updateQueue=W}else U.add(T);break e}else{if(!(o&1)){y1(f,C,o),FS();break e}T=Error(Ce(426))}}else if(vn&&R.mode&1){var q=R1(v);if(q!==null){!(q.flags&65536)&&(q.flags|=256),C1(q,v,R,f,o),TS(mu(T,R));break e}}f=T=mu(T,R),Xn!==4&&(Xn=2),Hd===null?Hd=[f]:Hd.push(f),f=v;do{switch(f.tag){case 3:f.flags|=65536,o&=-o,f.lanes|=o;var G=Nk(f,T,o);_1(f,G);break e;case 1:R=T;var b=f.type,M=f.stateNode;if(!(f.flags&128)&&(typeof b.getDerivedStateFromError=="function"||M!==null&&typeof M.componentDidCatch=="function"&&(Ks===null||!Ks.has(M)))){f.flags|=65536,o&=-o,f.lanes|=o;var j=Pk(f,R,o);_1(f,j);break e}}f=f.return}while(f!==null)}Xk(a)}catch(K){o=K,Hn===a&&a!==null&&(Hn=a=a.return);continue}break}while(1)}function qk(){var r=Af.current;return Af.current=If,r===null?If:r}function FS(){(Xn===0||Xn===3||Xn===2)&&(Xn=4),or===null||!(ja&268435455)&&!(N0&268435455)||Ms(or,hr)}function bf(r,o){var a=Pt;Pt|=2;var c=qk();(or!==r||hr!==o)&&(Ko=null,La(r,o));do try{qG();break}catch(l){Yk(r,l)}while(1);if(RS(),Pt=a,Af.current=c,Hn!==null)throw Error(Ce(261));return or=null,hr=0,Xn}function qG(){for(;Hn!==null;)Jk(Hn)}function JG(){for(;Hn!==null&&!S5();)Jk(Hn)}function Jk(r){var o=$k(r.alternate,r,_i);r.memoizedProps=r.pendingProps,o===null?Xk(r):Hn=o,MS.current=null}function Xk(r){var o=r;do{var a=o.alternate;if(r=o.return,o.flags&32768){if(a=GG(a,o),a!==null){a.flags&=32767,Hn=a;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{Xn=6,Hn=null;return}}else if(a=FG(a,o,_i),a!==null){Hn=a;return}if(o=o.sibling,o!==null){Hn=o;return}Hn=o=r}while(o!==null);Xn===0&&(Xn=5)}function Na(r,o,a){var c=qt,l=Mi.transition;try{Mi.transition=null,qt=1,XG(r,o,a,c)}finally{Mi.transition=l,qt=c}return null}function XG(r,o,a,c){do uu();while(Vs!==null);if(Pt&6)throw Error(Ce(327));a=r.finishedWork;var l=r.finishedLanes;if(a===null)return null;if(r.finishedWork=null,r.finishedLanes=0,a===r.current)throw Error(Ce(177));r.callbackNode=null,r.callbackPriority=0;var f=a.lanes|a.childLanes;if(N5(r,f),r===or&&(Hn=or=null,hr=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||xp||(xp=!0,Zk(df,function(){return uu(),null})),f=(a.flags&15990)!==0,a.subtreeFlags&15990||f){f=Mi.transition,Mi.transition=null;var v=qt;qt=1;var R=Pt;Pt|=4,MS.current=null,HG(r,a),Hk(a,r),mG(hg),hf=!!lg,hg=lg=null,r.current=a,KG(a),T5(),Pt=R,qt=v,Mi.transition=f}else r.current=a;if(xp&&(xp=!1,Vs=r,Of=l),f=r.pendingLanes,f===0&&(Ks=null),C5(a.stateNode),ti(r,Dn()),o!==null)for(c=r.onRecoverableError,a=0;a<o.length;a++)l=o[a],c(l.value,{componentStack:l.stack,digest:l.digest});if(wf)throw wf=!1,r=Dg,Dg=null,r;return Of&1&&r.tag!==0&&uu(),f=r.pendingLanes,f&1?r===kg?Kd++:(Kd=0,kg=r):Kd=0,ea(),null}function uu(){if(Vs!==null){var r=bD(Of),o=Mi.transition,a=qt;try{if(Mi.transition=null,qt=16>r?16:r,Vs===null)var c=!1;else{if(r=Vs,Vs=null,Of=0,Pt&6)throw Error(Ce(331));var l=Pt;for(Pt|=4,Ve=r.current;Ve!==null;){var f=Ve,v=f.child;if(Ve.flags&16){var R=f.deletions;if(R!==null){for(var T=0;T<R.length;T++){var C=R[T];for(Ve=C;Ve!==null;){var O=Ve;switch(O.tag){case 0:case 11:case 15:Wd(8,O,f)}var N=O.child;if(N!==null)N.return=O,Ve=N;else for(;Ve!==null;){O=Ve;var w=O.sibling,B=O.return;if(Fk(O),O===C){Ve=null;break}if(w!==null){w.return=B,Ve=w;break}Ve=B}}}var U=f.alternate;if(U!==null){var W=U.child;if(W!==null){U.child=null;do{var q=W.sibling;W.sibling=null,W=q}while(W!==null)}}Ve=f}}if(f.subtreeFlags&2064&&v!==null)v.return=f,Ve=v;else e:for(;Ve!==null;){if(f=Ve,f.flags&2048)switch(f.tag){case 0:case 11:case 15:Wd(9,f,f.return)}var G=f.sibling;if(G!==null){G.return=f.return,Ve=G;break e}Ve=f.return}}var b=r.current;for(Ve=b;Ve!==null;){v=Ve;var M=v.child;if(v.subtreeFlags&2064&&M!==null)M.return=v,Ve=M;else e:for(v=b;Ve!==null;){if(R=Ve,R.flags&2048)try{switch(R.tag){case 0:case 11:case 15:b0(9,R)}}catch(K){In(R,R.return,K)}if(R===v){Ve=null;break e}var j=R.sibling;if(j!==null){j.return=R.return,Ve=j;break e}Ve=R.return}}if(Pt=l,ea(),Io&&typeof Io.onPostCommitFiberRoot=="function")try{Io.onPostCommitFiberRoot(T0,r)}catch{}c=!0}return c}finally{qt=a,Mi.transition=o}}return!1}function U1(r,o,a){o=mu(a,o),o=Nk(r,o,1),r=Hs(r,o,1),o=kr(),r!==null&&(gl(r,1,o),ti(r,o))}function In(r,o,a){if(r.tag===3)U1(r,r,a);else for(;o!==null;){if(o.tag===3){U1(o,r,a);break}else if(o.tag===1){var c=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Ks===null||!Ks.has(c))){r=mu(a,r),r=Pk(o,r,1),o=Hs(o,r,1),r=kr(),o!==null&&(gl(o,1,r),ti(o,r));break}}o=o.return}}function QG(r,o,a){var c=r.pingCache;c!==null&&c.delete(o),o=kr(),r.pingedLanes|=r.suspendedLanes&a,or===r&&(hr&a)===a&&(Xn===4||Xn===3&&(hr&130023424)===hr&&500>Dn()-VS?La(r,0):US|=a),ti(r,o)}function Qk(r,o){o===0&&(r.mode&1?(o=Ip,Ip<<=1,!(Ip&130023424)&&(Ip=4194304)):o=1);var a=kr();r=ts(r,o),r!==null&&(gl(r,o,a),ti(r,a))}function $G(r){var o=r.memoizedState,a=0;o!==null&&(a=o.retryLane),Qk(r,a)}function ZG(r,o){var a=0;switch(r.tag){case 13:var c=r.stateNode,l=r.memoizedState;l!==null&&(a=l.retryLane);break;case 19:c=r.stateNode;break;default:throw Error(Ce(314))}c!==null&&c.delete(o),Qk(r,a)}var $k;$k=function(r,o,a){if(r!==null)if(r.memoizedProps!==o.pendingProps||Zr.current)Xr=!0;else{if(!(r.lanes&a)&&!(o.flags&128))return Xr=!1,jG(r,o,a);Xr=!!(r.flags&131072)}else Xr=!1,vn&&o.flags&1048576&&tk(o,gf,o.index);switch(o.lanes=0,o.tag){case 2:var c=o.type;Xp(r,o),r=o.pendingProps;var l=hu(o,Ar.current);cu(o,a),l=PS(null,o,c,r,l,a);var f=DS();return o.flags|=1,typeof l=="object"&&l!==null&&typeof l.render=="function"&&l.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,ei(c)?(f=!0,Ef(o)):f=!1,o.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,AS(o),l.updater=w0,o.stateNode=l,l._reactInternals=o,Tg(o,c,r,a),o=Cg(null,o,c,!0,f,a)):(o.tag=0,vn&&f&&gS(o),Dr(null,o,l,a),o=o.child),o;case 16:c=o.elementType;e:{switch(Xp(r,o),r=o.pendingProps,l=c._init,c=l(c._payload),o.type=c,l=o.tag=tW(c),r=Zi(c,r),l){case 0:o=Rg(null,o,c,r,a);break e;case 1:o=w1(null,o,c,r,a);break e;case 11:o=I1(null,o,c,r,a);break e;case 14:o=A1(null,o,c,Zi(c.type,r),a);break e}throw Error(Ce(306,c,""))}return o;case 0:return c=o.type,l=o.pendingProps,l=o.elementType===c?l:Zi(c,l),Rg(r,o,c,l,a);case 1:return c=o.type,l=o.pendingProps,l=o.elementType===c?l:Zi(c,l),w1(r,o,c,l,a);case 3:e:{if(xk(o),r===null)throw Error(Ce(387));c=o.pendingProps,f=o.memoizedState,l=f.element,ok(r,o),yf(o,c,null,a);var v=o.memoizedState;if(c=v.element,f.isDehydrated)if(f={element:c,isDehydrated:!1,cache:v.cache,pendingSuspenseBoundaries:v.pendingSuspenseBoundaries,transitions:v.transitions},o.updateQueue.baseState=f,o.memoizedState=f,o.flags&256){l=mu(Error(Ce(423)),o),o=O1(r,o,c,a,l);break e}else if(c!==l){l=mu(Error(Ce(424)),o),o=O1(r,o,c,a,l);break e}else for(mi=Ws(o.stateNode.containerInfo.firstChild),Ei=o,vn=!0,to=null,a=uk(o,null,c,a),o.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(pu(),c===l){o=ns(r,o,a);break e}Dr(r,o,c,a)}o=o.child}return o;case 5:return dk(o),r===null&&vg(o),c=o.type,l=o.pendingProps,f=r!==null?r.memoizedProps:null,v=l.children,pg(c,l)?v=null:f!==null&&pg(c,f)&&(o.flags|=32),Lk(r,o),Dr(r,o,v,a),o.child;case 6:return r===null&&vg(o),null;case 13:return Mk(r,o,a);case 4:return wS(o,o.stateNode.containerInfo),c=o.pendingProps,r===null?o.child=fu(o,null,c,a):Dr(r,o,c,a),o.child;case 11:return c=o.type,l=o.pendingProps,l=o.elementType===c?l:Zi(c,l),I1(r,o,c,l,a);case 7:return Dr(r,o,o.pendingProps,a),o.child;case 8:return Dr(r,o,o.pendingProps.children,a),o.child;case 12:return Dr(r,o,o.pendingProps.children,a),o.child;case 10:e:{if(c=o.type._context,l=o.pendingProps,f=o.memoizedProps,v=l.value,cn(Sf,c._currentValue),c._currentValue=v,f!==null)if(so(f.value,v)){if(f.children===l.children&&!Zr.current){o=ns(r,o,a);break e}}else for(f=o.child,f!==null&&(f.return=o);f!==null;){var R=f.dependencies;if(R!==null){v=f.child;for(var T=R.firstContext;T!==null;){if(T.context===c){if(f.tag===1){T=Qo(-1,a&-a),T.tag=2;var C=f.updateQueue;if(C!==null){C=C.shared;var O=C.pending;O===null?T.next=T:(T.next=O.next,O.next=T),C.pending=T}}f.lanes|=a,T=f.alternate,T!==null&&(T.lanes|=a),gg(f.return,a,o),R.lanes|=a;break}T=T.next}}else if(f.tag===10)v=f.type===o.type?null:f.child;else if(f.tag===18){if(v=f.return,v===null)throw Error(Ce(341));v.lanes|=a,R=v.alternate,R!==null&&(R.lanes|=a),gg(v,a,o),v=f.sibling}else v=f.child;if(v!==null)v.return=f;else for(v=f;v!==null;){if(v===o){v=null;break}if(f=v.sibling,f!==null){f.return=v.return,v=f;break}v=v.return}f=v}Dr(r,o,l.children,a),o=o.child}return o;case 9:return l=o.type,c=o.pendingProps.children,cu(o,a),l=Ui(l),c=c(l),o.flags|=1,Dr(r,o,c,a),o.child;case 14:return c=o.type,l=Zi(c,o.pendingProps),l=Zi(c.type,l),A1(r,o,c,l,a);case 15:return Dk(r,o,o.type,o.pendingProps,a);case 17:return c=o.type,l=o.pendingProps,l=o.elementType===c?l:Zi(c,l),Xp(r,o),o.tag=1,ei(c)?(r=!0,Ef(o)):r=!1,cu(o,a),ak(o,c,l),Tg(o,c,l,a),Cg(null,o,c,!0,r,a);case 19:return Uk(r,o,a);case 22:return kk(r,o,a)}throw Error(Ce(156,o.tag))};function Zk(r,o){return ID(r,o)}function eW(r,o,a,c){this.tag=r,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xi(r,o,a,c){return new eW(r,o,a,c)}function GS(r){return r=r.prototype,!(!r||!r.isReactComponent)}function tW(r){if(typeof r=="function")return GS(r)?1:0;if(r!=null){if(r=r.$$typeof,r===aS)return 11;if(r===cS)return 14}return 2}function Ys(r,o){var a=r.alternate;return a===null?(a=xi(r.tag,o,r.key,r.mode),a.elementType=r.elementType,a.type=r.type,a.stateNode=r.stateNode,a.alternate=r,r.alternate=a):(a.pendingProps=o,a.type=r.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=r.flags&14680064,a.childLanes=r.childLanes,a.lanes=r.lanes,a.child=r.child,a.memoizedProps=r.memoizedProps,a.memoizedState=r.memoizedState,a.updateQueue=r.updateQueue,o=r.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},a.sibling=r.sibling,a.index=r.index,a.ref=r.ref,a}function Zp(r,o,a,c,l,f){var v=2;if(c=r,typeof r=="function")GS(r)&&(v=1);else if(typeof r=="string")v=5;else e:switch(r){case Hc:return xa(a.children,l,f,o);case sS:v=8,l|=8;break;case Kv:return r=xi(12,a,o,l|2),r.elementType=Kv,r.lanes=f,r;case zv:return r=xi(13,a,o,l),r.elementType=zv,r.lanes=f,r;case Yv:return r=xi(19,a,o,l),r.elementType=Yv,r.lanes=f,r;case cD:return P0(a,l,f,o);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case sD:v=10;break e;case aD:v=9;break e;case aS:v=11;break e;case cS:v=14;break e;case ks:v=16,c=null;break e}throw Error(Ce(130,r==null?r:typeof r,""))}return o=xi(v,a,o,l),o.elementType=r,o.type=c,o.lanes=f,o}function xa(r,o,a,c){return r=xi(7,r,c,o),r.lanes=a,r}function P0(r,o,a,c){return r=xi(22,r,c,o),r.elementType=cD,r.lanes=a,r.stateNode={isHidden:!1},r}function Lv(r,o,a){return r=xi(6,r,null,o),r.lanes=a,r}function xv(r,o,a){return o=xi(4,r.children!==null?r.children:[],r.key,o),o.lanes=a,o.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},o}function nW(r,o,a,c,l){this.tag=o,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=_v(0),this.expirationTimes=_v(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_v(0),this.identifierPrefix=c,this.onRecoverableError=l,this.mutableSourceEagerHydrationData=null}function WS(r,o,a,c,l,f,v,R,T){return r=new nW(r,o,a,R,T),o===1?(o=1,f===!0&&(o|=8)):o=0,f=xi(3,null,null,o),r.current=f,f.stateNode=r,f.memoizedState={element:c,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},AS(f),r}function rW(r,o,a){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Wc,key:c==null?null:""+c,children:r,containerInfo:o,implementation:a}}function eL(r){if(!r)return Xs;r=r._reactInternals;e:{if(Ha(r)!==r||r.tag!==1)throw Error(Ce(170));var o=r;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(ei(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(Ce(171))}if(r.tag===1){var a=r.type;if(ei(a))return ZD(r,a,o)}return o}function tL(r,o,a,c,l,f,v,R,T){return r=WS(a,c,!0,r,l,f,v,R,T),r.context=eL(null),a=r.current,c=kr(),l=zs(a),f=Qo(c,l),f.callback=o??null,Hs(a,f,l),r.current.lanes=l,gl(r,l,c),ti(r,c),r}function D0(r,o,a,c){var l=o.current,f=kr(),v=zs(l);return a=eL(a),o.context===null?o.context=a:o.pendingContext=a,o=Qo(f,v),o.payload={element:r},c=c===void 0?null:c,c!==null&&(o.callback=c),r=Hs(l,o,v),r!==null&&(ro(r,l,v,f),Yp(r,l,v)),v}function Nf(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function V1(r,o){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var a=r.retryLane;r.retryLane=a!==0&&a<o?a:o}}function HS(r,o){V1(r,o),(r=r.alternate)&&V1(r,o)}function iW(){return null}var nL=typeof reportError=="function"?reportError:function(r){console.error(r)};function KS(r){this._internalRoot=r}k0.prototype.render=KS.prototype.render=function(r){var o=this._internalRoot;if(o===null)throw Error(Ce(409));D0(r,o,null,null)};k0.prototype.unmount=KS.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var o=r.containerInfo;Fa(function(){D0(null,r,null,null)}),o[es]=null}};function k0(r){this._internalRoot=r}k0.prototype.unstable_scheduleHydration=function(r){if(r){var o=DD();r={blockedOn:null,target:r,priority:o};for(var a=0;a<xs.length&&o!==0&&o<xs[a].priority;a++);xs.splice(a,0,r),a===0&&LD(r)}};function zS(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function L0(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function B1(){}function oW(r,o,a,c,l){if(l){if(typeof c=="function"){var f=c;c=function(){var C=Nf(v);f.call(C)}}var v=tL(o,c,r,0,null,!1,!1,"",B1);return r._reactRootContainer=v,r[es]=v.current,rl(r.nodeType===8?r.parentNode:r),Fa(),v}for(;l=r.lastChild;)r.removeChild(l);if(typeof c=="function"){var R=c;c=function(){var C=Nf(T);R.call(C)}}var T=WS(r,0,!1,null,null,!1,!1,"",B1);return r._reactRootContainer=T,r[es]=T.current,rl(r.nodeType===8?r.parentNode:r),Fa(function(){D0(o,T,a,c)}),T}function x0(r,o,a,c,l){var f=a._reactRootContainer;if(f){var v=f;if(typeof l=="function"){var R=l;l=function(){var T=Nf(v);R.call(T)}}D0(o,v,r,l)}else v=oW(a,o,r,l,c);return Nf(v)}ND=function(r){switch(r.tag){case 3:var o=r.stateNode;if(o.current.memoizedState.isDehydrated){var a=kd(o.pendingLanes);a!==0&&(lS(o,a|1),ti(o,Dn()),!(Pt&6)&&(Eu=Dn()+500,ea()))}break;case 13:Fa(function(){var c=ts(r,1);if(c!==null){var l=kr();ro(c,r,1,l)}}),HS(r,1)}};hS=function(r){if(r.tag===13){var o=ts(r,134217728);if(o!==null){var a=kr();ro(o,r,134217728,a)}HS(r,134217728)}};PD=function(r){if(r.tag===13){var o=zs(r),a=ts(r,o);if(a!==null){var c=kr();ro(a,r,o,c)}HS(r,o)}};DD=function(){return qt};kD=function(r,o){var a=qt;try{return qt=r,o()}finally{qt=a}};rg=function(r,o,a){switch(o){case"input":if(Xv(r,a),o=a.name,a.type==="radio"&&o!=null){for(a=r;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<a.length;o++){var c=a[o];if(c!==r&&c.form===r.form){var l=I0(c);if(!l)throw Error(Ce(90));dD(c),Xv(c,l)}}}break;case"textarea":hD(r,a);break;case"select":o=a.value,o!=null&&iu(r,!!a.multiple,o,!1)}};gD=BS;SD=Fa;var sW={usingClientEntryPoint:!1,Events:[Tl,qc,I0,ED,vD,BS]},Nd={findFiberByHostInstance:Pa,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},aW={bundleType:Nd.bundleType,version:Nd.version,rendererPackageName:Nd.rendererPackageName,rendererConfig:Nd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:is.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=RD(r),r===null?null:r.stateNode},findFiberByHostInstance:Nd.findFiberByHostInstance||iW,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Mp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Mp.isDisabled&&Mp.supportsFiber)try{T0=Mp.inject(aW),Io=Mp}catch{}}gi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sW;gi.createPortal=function(r,o){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!zS(o))throw Error(Ce(200));return rW(r,o,null,a)};gi.createRoot=function(r,o){if(!zS(r))throw Error(Ce(299));var a=!1,c="",l=nL;return o!=null&&(o.unstable_strictMode===!0&&(a=!0),o.identifierPrefix!==void 0&&(c=o.identifierPrefix),o.onRecoverableError!==void 0&&(l=o.onRecoverableError)),o=WS(r,1,!1,null,null,a,!1,c,l),r[es]=o.current,rl(r.nodeType===8?r.parentNode:r),new KS(o)};gi.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var o=r._reactInternals;if(o===void 0)throw typeof r.render=="function"?Error(Ce(188)):(r=Object.keys(r).join(","),Error(Ce(268,r)));return r=RD(o),r=r===null?null:r.stateNode,r};gi.flushSync=function(r){return Fa(r)};gi.hydrate=function(r,o,a){if(!L0(o))throw Error(Ce(200));return x0(null,r,o,!0,a)};gi.hydrateRoot=function(r,o,a){if(!zS(r))throw Error(Ce(405));var c=a!=null&&a.hydratedSources||null,l=!1,f="",v=nL;if(a!=null&&(a.unstable_strictMode===!0&&(l=!0),a.identifierPrefix!==void 0&&(f=a.identifierPrefix),a.onRecoverableError!==void 0&&(v=a.onRecoverableError)),o=tL(o,null,r,1,a??null,l,!1,f,v),r[es]=o.current,rl(r),c)for(r=0;r<c.length;r++)a=c[r],l=a._getVersion,l=l(a._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[a,l]:o.mutableSourceEagerHydrationData.push(a,l);return new k0(o)};gi.render=function(r,o,a){if(!L0(o))throw Error(Ce(200));return x0(null,r,o,!1,a)};gi.unmountComponentAtNode=function(r){if(!L0(r))throw Error(Ce(40));return r._reactRootContainer?(Fa(function(){x0(null,null,r,!1,function(){r._reactRootContainer=null,r[es]=null})}),!0):!1};gi.unstable_batchedUpdates=BS;gi.unstable_renderSubtreeIntoContainer=function(r,o,a,c){if(!L0(a))throw Error(Ce(200));if(r==null||r._reactInternals===void 0)throw Error(Ce(38));return x0(r,o,a,!1,c)};gi.version="18.2.0-next-9e3b772b8-20220608";(function(r){function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(a){console.error(a)}}o(),r.exports=gi})(i5);var rL,j1=sf;rL=j1.createRoot,j1.hydrateRoot;function Xo(r,o,a){return r.on(o,a),()=>r.off(o,a)}function cW(r){try{return r()}catch(o){console.error(o)}}function iL(r){return()=>r.forEach(cW)}function uW(r,o){const a=setInterval(r,o);return()=>clearInterval(a)}function dW(r,o){const a=setTimeout(r,o);return()=>clearTimeout(a)}function lW(){let r,o,a;function c(){if(o){const C=o;o=void 0,C()}}async function l(){if(a){const C=a;a=void 0;try{await C()}catch(O){console.error(O)}}}async function f(C){r=!0,await l();try{a=await C()}catch(O){console.error(O)}r=!1,c()}async function v(){r=!0,await l(),r=!1,c()}function R(C){r?o=()=>f(C):f(C)}function T(){r?o=v:v()}return{run:R,dispose:T}}const oL=typeof document<"u"?Ye.useLayoutEffect:Ye.useEffect;function hW(r){return r!=null&&typeof r.then=="function"}function pW(){const r=Ye.useRef(!1);return Ye.useEffect(()=>(r.current=!1,()=>{r.current=!0}),[]),r}function sL(){const r=pW();function o(a,c){return new Promise(async(l,f)=>{try{const v=await a;r.current||l(v)}catch(v){r.current?c&&c(v):f(v)}})}return Ye.useCallback(o,[r])}function M0(r){const o=sL(),[a,c]=Ye.useState();return oL(()=>{hW(r)?o(r).then(c):c(r)},[r,o]),a}var Mg={},fW={get exports(){return Mg},set exports(r){Mg=r}};(function(r,o){(function(a,c){r.exports=c()})(tt,function(){function a(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in e)){var s=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(e)}var c=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof tt<"u"?tt:typeof self<"u"?self:{},l=function(e){try{return!!e()}catch{return!0}},f=!l(function(){var e=function(){}.bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),v=f,R=Function.prototype,T=R.bind,C=R.call,O=v&&T.bind(C,C),N=v?function(e){return e&&O(e)}:function(e){return e&&function(){return C.apply(e,arguments)}},w=N({}.isPrototypeOf),B=function(e){return e&&e.Math==Math&&e},U=B(typeof globalThis=="object"&&globalThis)||B(typeof window=="object"&&window)||B(typeof self=="object"&&self)||B(typeof c=="object"&&c)||function(){return this}()||Function("return this")(),W=f,q=Function.prototype,G=q.apply,b=q.call,M=typeof Reflect=="object"&&Reflect.apply||(W?b.bind(G):function(){return b.apply(G,arguments)}),j=function(e){return typeof e=="function"},K={},Y=!l(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Q=f,$=Function.prototype.call,ue=Q?$.bind($):function(){return $.apply($,arguments)},J={},te={}.propertyIsEnumerable,le=Object.getOwnPropertyDescriptor,he=le&&!te.call({1:2},1);J.f=he?function(e){var t=le(this,e);return!!t&&t.enumerable}:te;var Pe,We,He=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},kt=N,Te=kt({}.toString),Me=kt("".slice),ke=function(e){return Me(Te(e),8,-1)},ae=N,pe=l,ge=ke,me=U.Object,Vt=ae("".split),vt=pe(function(){return!me("z").propertyIsEnumerable(0)})?function(e){return ge(e)=="String"?Vt(e,""):me(e)}:me,An=U.TypeError,st=function(e){if(e==null)throw An("Can't call method on "+e);return e},na=vt,ss=st,Ti=function(e){return na(ss(e))},ra=j,_n=function(e){return typeof e=="object"?e!==null:ra(e)},Cn={},as=Cn,Po=U,Xa=j,cs=function(e){return Xa(e)?e:void 0},Mr=function(e,t){return arguments.length<2?cs(as[e])||cs(Po[e]):as[e]&&as[e][t]||Po[e]&&Po[e][t]},ni=Mr("navigator","userAgent")||"",Ur=U,_r=ni,Bi=Ur.process,ia=Ur.Deno,Pu=Bi&&Bi.versions||ia&&ia.version,Do=Pu&&Pu.v8;Do&&(We=(Pe=Do.split("."))[0]>0&&Pe[0]<4?1:+(Pe[0]+Pe[1])),!We&&_r&&(!(Pe=_r.match(/Edge\/(\d+)/))||Pe[1]>=74)&&(Pe=_r.match(/Chrome\/(\d+)/))&&(We=+Pe[1]);var yi=We,Ll=yi,xl=l,Qa=!!Object.getOwnPropertySymbols&&!xl(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ll&&Ll<41}),ko=Qa&&!Symbol.sham&&typeof Symbol.iterator=="symbol",oa=Mr,z0=j,Ml=w,Ul=ko,Y0=U.Object,Du=Ul?function(e){return typeof e=="symbol"}:function(e){var t=oa("Symbol");return z0(t)&&Ml(t.prototype,Y0(e))},Vl=U.String,$a=function(e){try{return Vl(e)}catch{return"Object"}},Bl=j,q0=$a,jl=U.TypeError,ji=function(e){if(Bl(e))return e;throw jl(q0(e)+" is not a function")},J0=ji,ku=function(e,t){var n=e[t];return n==null?void 0:J0(n)},Za=ue,Lu=j,xu=_n,Fl=U.TypeError,ec={exports:{}},Mu=U,wr=Object.defineProperty,co=function(e,t){try{wr(Mu,e,{value:t,configurable:!0,writable:!0})}catch{Mu[e]=t}return t},Uu="__core-js_shared__",Vu=U[Uu]||co(Uu,{}),oT=Vu;(ec.exports=function(e,t){return oT[e]||(oT[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.20.3",mode:"pure",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.20.3/LICENSE",source:"https://github.com/zloirock/core-js"});var kx=st,Lx=U.Object,us=function(e){return Lx(kx(e))},xx=us,Mx=N({}.hasOwnProperty),Or=Object.hasOwn||function(e,t){return Mx(xx(e),t)},Ux=N,Vx=0,Bx=Math.random(),jx=Ux(1 .toString),X0=function(e){return"Symbol("+(e===void 0?"":e)+")_"+jx(++Vx+Bx,36)},Fx=U,Gx=ec.exports,sT=Or,Wx=X0,aT=Qa,cT=ko,Bu=Gx("wks"),sa=Fx.Symbol,uT=sa&&sa.for,Hx=cT?sa:sa&&sa.withoutSetter||Wx,kn=function(e){if(!sT(Bu,e)||!aT&&typeof Bu[e]!="string"){var t="Symbol."+e;aT&&sT(sa,e)?Bu[e]=sa[e]:Bu[e]=cT&&uT?uT(t):Hx(t)}return Bu[e]},Kx=ue,dT=_n,lT=Du,zx=ku,Yx=function(e,t){var n,i;if(t==="string"&&Lu(n=e.toString)&&!xu(i=Za(n,e))||Lu(n=e.valueOf)&&!xu(i=Za(n,e))||t!=="string"&&Lu(n=e.toString)&&!xu(i=Za(n,e)))return i;throw Fl("Can't convert object to primitive value")},qx=kn,Jx=U.TypeError,Xx=qx("toPrimitive"),Qx=function(e,t){if(!dT(e)||lT(e))return e;var n,i=zx(e,Xx);if(i){if(t===void 0&&(t="default"),n=Kx(i,e,t),!dT(n)||lT(n))return n;throw Jx("Can't convert object to primitive value")}return t===void 0&&(t="number"),Yx(e,t)},$x=Du,Gl=function(e){var t=Qx(e,"string");return $x(t)?t:t+""},hT=_n,Q0=U.document,Zx=hT(Q0)&&hT(Q0.createElement),$0=function(e){return Zx?Q0.createElement(e):{}},eM=$0,pT=!Y&&!l(function(){return Object.defineProperty(eM("div"),"a",{get:function(){return 7}}).a!=7}),tM=Y,nM=ue,rM=J,iM=He,oM=Ti,sM=Gl,aM=Or,cM=pT,fT=Object.getOwnPropertyDescriptor;K.f=tM?fT:function(e,t){if(e=oM(e),t=sM(t),cM)try{return fT(e,t)}catch{}if(aM(e,t))return iM(!nM(rM.f,e,t),e[t])};var uM=l,dM=j,lM=/#|\.prototype\./,ju=function(e,t){var n=pM[hM(e)];return n==_M||n!=fM&&(dM(t)?uM(t):!!t)},hM=ju.normalize=function(e){return String(e).replace(lM,".").toLowerCase()},pM=ju.data={},fM=ju.NATIVE="N",_M=ju.POLYFILL="P",_T=ju,mM=ji,EM=f,vM=N(N.bind),Fu=function(e,t){return mM(e),t===void 0?e:EM?vM(e,t):function(){return e.apply(t,arguments)}},Fi={},mT=Y&&l(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),ET=U,gM=_n,SM=ET.String,TM=ET.TypeError,Gi=function(e){if(gM(e))return e;throw TM(SM(e)+" is not an object")},yM=Y,RM=pT,CM=mT,Wl=Gi,vT=Gl,IM=U.TypeError,Z0=Object.defineProperty,AM=Object.getOwnPropertyDescriptor,wM="enumerable",OM="configurable",bM="writable";Fi.f=yM?CM?function(e,t,n){if(Wl(e),t=vT(t),Wl(n),typeof e=="function"&&t==="prototype"&&"value"in n&&bM in n&&!n.writable){var i=AM(e,t);i&&i.writable&&(e[t]=n.value,n={configurable:OM in n?n.configurable:i.configurable,enumerable:wM in n?n.enumerable:i.enumerable,writable:!1})}return Z0(e,t,n)}:Z0:function(e,t,n){if(Wl(e),t=vT(t),Wl(n),RM)try{return Z0(e,t,n)}catch{}if("get"in n||"set"in n)throw IM("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var NM=Fi,PM=He,aa=Y?function(e,t,n){return NM.f(e,t,PM(1,n))}:function(e,t,n){return e[t]=n,e},Hl=U,DM=M,kM=N,LM=j,xM=K.f,MM=_T,tc=Cn,UM=Fu,nc=aa,gT=Or,VM=function(e){var t=function(n,i,s){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,i)}return new e(n,i,s)}return DM(e,this,arguments)};return t.prototype=e.prototype,t},sr=function(e,t){var n,i,s,u,d,h,p,m,_=e.target,E=e.global,y=e.stat,A=e.proto,k=E?Hl:y?Hl[_]:(Hl[_]||{}).prototype,L=E?tc:tc[_]||nc(tc,_,{})[_],x=L.prototype;for(s in t)n=!MM(E?s:_+(y?".":"#")+s,e.forced)&&k&&gT(k,s),d=L[s],n&&(h=e.noTargetGet?(m=xM(k,s))&&m.value:k[s]),u=n&&h?h:t[s],n&&typeof d==typeof u||(p=e.bind&&n?UM(u,Hl):e.wrap&&n?VM(u):A&&LM(u)?kM(u):u,(e.sham||u&&u.sham||d&&d.sham)&&nc(p,"sham",!0),nc(L,s,p),A&&(gT(tc,i=_+"Prototype")||nc(tc,i,{}),nc(tc[i],s,u),e.real&&x&&!x[s]&&nc(x,s,u)))},BM=Math.ceil,jM=Math.floor,e_=function(e){var t=+e;return t!=t||t===0?0:(t>0?jM:BM)(t)},FM=e_,GM=Math.min,WM=function(e){return e>0?GM(FM(e),9007199254740991):0},ds=function(e){return WM(e.length)},HM=ji,KM=us,zM=vt,YM=ds,qM=U.TypeError,ST=function(e){return function(t,n,i,s){HM(n);var u=KM(t),d=zM(u),h=YM(u),p=e?h-1:0,m=e?-1:1;if(i<2)for(;;){if(p in d){s=d[p],p+=m;break}if(p+=m,e?p<0:h<=p)throw qM("Reduce of empty array with no initial value")}for(;e?p>=0:h>p;p+=m)p in d&&(s=n(s,d[p],p,u));return s}},JM={left:ST(!1),right:ST(!0)},XM=l,t_=function(e,t){var n=[][e];return!!n&&XM(function(){n.call(null,t||function(){throw 1},1)})},Kl=ke(U.process)=="process",QM=JM.left,TT=yi,$M=Kl;sr({target:"Array",proto:!0,forced:!t_("reduce")||!$M&&TT>79&&TT<83},{reduce:function(e){var t=arguments.length;return QM(this,e,t,t>1?arguments[1]:void 0)}});var ZM=Cn,ls=function(e){return ZM[e+"Prototype"]},e2=ls("Array").reduce,t2=w,n2=e2,n_=Array.prototype,yT=function(e){var t=e.reduce;return e===n_||t2(n_,e)&&t===n_.reduce?n2:t},hs=yT;let RT=!0,CT=!0;function zl(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function ca(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(d,h){if(d!==t)return s.apply(this,arguments);const p=m=>{const _=n(m);_&&(h.handleEvent?h.handleEvent(_):h(_))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(h,p),s.apply(this,[d,p])};const u=i.removeEventListener;i.removeEventListener=function(d,h){if(d!==t||!this._eventMap||!this._eventMap[t])return u.apply(this,arguments);if(!this._eventMap[t].has(h))return u.apply(this,arguments);const p=this._eventMap[t].get(h);return this._eventMap[t].delete(h),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[d,p])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(d){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),d&&this.addEventListener(t,this["_on"+t]=d)},enumerable:!0,configurable:!0})}function r2(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(RT=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function i2(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(CT=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function IT(){if(typeof window=="object"){if(RT)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function r_(e,t){CT&&console.warn(e+" is deprecated, please use "+t+" instead.")}function o2(e){const t={browser:null,version:null};if(e===void 0||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=zl(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=zl(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=zl(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function AT(e){return Object.prototype.toString.call(e)==="[object Object]"}function wT(e){var t;return AT(e)?hs(t=Object.keys(e)).call(t,function(n,i){const s=AT(e[i]),u=s?wT(e[i]):e[i],d=s&&!Object.keys(u).length;return u===void 0||d?n:Object.assign(n,{[i]:u})},{}):e}function OT(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",s=new Map;if(t===null)return s;const u=[];return e.forEach(d=>{d.type==="track"&&d.trackIdentifier===t.id&&u.push(d)}),u.forEach(d=>{e.forEach(h=>{h.type===i&&h.trackId===d.id&&function p(m,_,E){_&&!E.has(_.id)&&(E.set(_.id,_),Object.keys(_).forEach(y=>{y.endsWith("Id")?p(m,m.get(_[y]),E):y.endsWith("Ids")&&_[y].forEach(A=>{p(m,m.get(A),E)})}))}(e,h,s)})}),s}var s2=ec.exports,a2=X0,bT=s2("keys"),Yl=function(e){return bT[e]||(bT[e]=a2(e))},c2=!l(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),u2=U,d2=Or,l2=j,h2=us,p2=c2,NT=Yl("IE_PROTO"),i_=u2.Object,f2=i_.prototype,o_=p2?i_.getPrototypeOf:function(e){var t=h2(e);if(d2(t,NT))return t[NT];var n=t.constructor;return l2(n)&&t instanceof n?n.prototype:t instanceof i_?f2:null},PT=U,_2=j,m2=PT.String,E2=PT.TypeError,v2=N,g2=Gi,S2=function(e){if(typeof e=="object"||_2(e))return e;throw E2("Can't set "+m2(e)+" as a prototype")},T2=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=v2(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch{}return function(i,s){return g2(i),S2(s),t?e(i,s):i.__proto__=s,i}}():void 0),ql={},y2=e_,R2=Math.max,C2=Math.min,s_=function(e,t){var n=y2(e);return n<0?R2(n+t,0):C2(n,t)},I2=Ti,A2=s_,w2=ds,DT=function(e){return function(t,n,i){var s,u=I2(t),d=w2(u),h=A2(i,d);if(e&&n!=n){for(;d>h;)if((s=u[h++])!=s)return!0}else for(;d>h;h++)if((e||h in u)&&u[h]===n)return e||h||0;return!e&&-1}},O2={includes:DT(!0),indexOf:DT(!1)},Jl={},a_=Or,b2=Ti,N2=O2.indexOf,P2=Jl,kT=N([].push),LT=function(e,t){var n,i=b2(e),s=0,u=[];for(n in i)!a_(P2,n)&&a_(i,n)&&kT(u,n);for(;t.length>s;)a_(i,n=t[s++])&&(~N2(u,n)||kT(u,n));return u},c_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],D2=LT,k2=c_.concat("length","prototype");ql.f=Object.getOwnPropertyNames||function(e){return D2(e,k2)};var u_={};u_.f=Object.getOwnPropertySymbols;var L2=Mr,x2=ql,M2=u_,U2=Gi,V2=N([].concat),B2=L2("Reflect","ownKeys")||function(e){var t=x2.f(U2(e)),n=M2.f;return n?V2(t,n(e)):t},xT=Or,j2=B2,F2=K,G2=Fi,d_={},W2=LT,H2=c_,l_=Object.keys||function(e){return W2(e,H2)},K2=Y,z2=mT,Y2=Fi,q2=Gi,J2=Ti,X2=l_;d_.f=K2&&!z2?Object.defineProperties:function(e,t){q2(e);for(var n,i=J2(t),s=X2(t),u=s.length,d=0;u>d;)Y2.f(e,n=s[d++],i[n]);return e};var Xl,MT=Mr("document","documentElement"),Q2=Gi,$2=d_,UT=c_,Z2=Jl,eU=MT,tU=$0,VT=Yl("IE_PROTO"),h_=function(){},BT=function(e){return"<script>"+e+"<\/script>"},jT=function(e){e.write(BT("")),e.close();var t=e.parentWindow.Object;return e=null,t},Ql=function(){try{Xl=new ActiveXObject("htmlfile")}catch{}var e,t;Ql=typeof document<"u"?document.domain&&Xl?jT(Xl):((t=tU("iframe")).style.display="none",eU.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(BT("document.F=Object")),e.close(),e.F):jT(Xl);for(var n=UT.length;n--;)delete Ql.prototype[UT[n]];return Ql()};Z2[VT]=!0;var $l=Object.create||function(e,t){var n;return e!==null?(h_.prototype=Q2(e),n=new h_,h_.prototype=null,n[VT]=e):n=Ql(),t===void 0?n:$2.f(n,t)},nU=N("".replace),rU=String(Error("zxcasd").stack),FT=/\n\s*at [^:]*:[^\n]*/,iU=FT.test(rU),oU=_n,sU=aa,rc={},aU=rc,cU=kn("iterator"),uU=Array.prototype,GT={};GT[kn("toStringTag")]="z";var p_=String(GT)==="[object z]",dU=U,lU=p_,hU=j,Zl=ke,pU=kn("toStringTag"),fU=dU.Object,_U=Zl(function(){return arguments}())=="Arguments",ps=lU?Zl:function(e){var t,n,i;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(s,u){try{return s[u]}catch{}}(t=fU(e),pU))=="string"?n:_U?Zl(t):(i=Zl(t))=="Object"&&hU(t.callee)?"Arguments":i},mU=ps,WT=ku,EU=rc,vU=kn("iterator"),HT=function(e){if(e!=null)return WT(e,vU)||WT(e,"@@iterator")||EU[mU(e)]},gU=ue,SU=ji,TU=Gi,yU=$a,RU=HT,CU=U.TypeError,IU=ue,KT=Gi,AU=ku,wU=Fu,OU=ue,bU=Gi,NU=$a,PU=function(e){return e!==void 0&&(aU.Array===e||uU[cU]===e)},DU=ds,zT=w,kU=function(e,t){var n=arguments.length<2?RU(e):t;if(SU(n))return TU(gU(n,e));throw CU(yU(e)+" is not iterable")},LU=HT,YT=function(e,t,n){var i,s;KT(e);try{if(!(i=AU(e,"return"))){if(t==="throw")throw n;return n}i=IU(i,e)}catch(u){s=!0,i=u}if(t==="throw")throw n;if(s)throw i;return KT(i),n},xU=U.TypeError,eh=function(e,t){this.stopped=e,this.result=t},qT=eh.prototype,th=function(e,t,n){var i,s,u,d,h,p,m,_=n&&n.that,E=!(!n||!n.AS_ENTRIES),y=!(!n||!n.IS_ITERATOR),A=!(!n||!n.INTERRUPTED),k=wU(t,_),L=function(z){return i&&YT(i,"normal",z),new eh(!0,z)},x=function(z){return E?(bU(z),A?k(z[0],z[1],L):k(z[0],z[1])):A?k(z,L):k(z)};if(y)i=e;else{if(!(s=LU(e)))throw xU(NU(e)+" is not iterable");if(PU(s)){for(u=0,d=DU(e);d>u;u++)if((h=x(e[u]))&&zT(qT,h))return h;return new eh(!1)}i=kU(e,s)}for(p=i.next;!(m=OU(p,i)).done;){try{h=x(m.value)}catch(z){YT(i,"throw",z)}if(typeof h=="object"&&h&&zT(qT,h))return h}return new eh(!1)},MU=ps,UU=U.String,ic=function(e){if(MU(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return UU(e)},VU=ic,BU=He,jU=!l(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",BU(1,7)),e.stack!==7)}),FU=sr,GU=U,WU=w,HU=o_,nh=T2,KU=function(e,t,n){for(var i=j2(t),s=G2.f,u=F2.f,d=0;d<i.length;d++){var h=i[d];xT(e,h)||n&&xT(n,h)||s(e,h,u(t,h))}},JT=$l,rh=aa,f_=He,zU=function(e,t){if(iU&&typeof e=="string")for(;t--;)e=nU(e,FT,"");return e},YU=function(e,t){oU(t)&&"cause"in t&&sU(e,"cause",t.cause)},qU=th,JU=function(e,t){return e===void 0?arguments.length<2?"":t:VU(e)},XU=jU,QU=kn("toStringTag"),ih=GU.Error,$U=[].push,Gu=function(e,t){var n,i=arguments.length>2?arguments[2]:void 0,s=WU(__,this);nh?n=nh(new ih,s?HU(this):__):(n=s?this:JT(__),rh(n,QU,"Error")),t!==void 0&&rh(n,"message",JU(t)),XU&&rh(n,"stack",zU(n.stack,1)),YU(n,i);var u=[];return qU(e,$U,{that:u}),rh(n,"errors",u),n};nh?nh(Gu,ih):KU(Gu,ih,{name:!0});var __=Gu.prototype=JT(ih.prototype,{constructor:f_(1,Gu),message:f_(1,""),name:f_(1,"AggregateError")});FU({global:!0},{AggregateError:Gu});var ZU=j,m_=Vu,eV=N(Function.toString);ZU(m_.inspectSource)||(m_.inspectSource=function(e){return eV(e)});var oh,Wu,sh,E_=m_.inspectSource,tV=j,nV=E_,XT=U.WeakMap,rV=tV(XT)&&/native code/.test(nV(XT)),QT=U,v_=N,iV=_n,oV=aa,g_=Or,S_=Vu,sV=Yl,aV=Jl,$T="Object already initialized",T_=QT.TypeError,cV=QT.WeakMap;if(rV||S_.state){var ua=S_.state||(S_.state=new cV),uV=v_(ua.get),ZT=v_(ua.has),dV=v_(ua.set);oh=function(e,t){if(ZT(ua,e))throw new T_($T);return t.facade=e,dV(ua,e,t),t},Wu=function(e){return uV(ua,e)||{}},sh=function(e){return ZT(ua,e)}}else{var oc=sV("state");aV[oc]=!0,oh=function(e,t){if(g_(e,oc))throw new T_($T);return t.facade=e,oV(e,oc,t),t},Wu=function(e){return g_(e,oc)?e[oc]:{}},sh=function(e){return g_(e,oc)}}var da,ey,ty,ah={set:oh,get:Wu,has:sh,enforce:function(e){return sh(e)?Wu(e):oh(e,{})},getterFor:function(e){return function(t){var n;if(!iV(t)||(n=Wu(t)).type!==e)throw T_("Incompatible receiver, "+e+" required");return n}}},y_=Y,lV=Or,ny=Function.prototype,hV=y_&&Object.getOwnPropertyDescriptor,R_=lV(ny,"name"),ry={EXISTS:R_,PROPER:R_&&function(){}.name==="something",CONFIGURABLE:R_&&(!y_||y_&&hV(ny,"name").configurable)},pV=aa,ch=function(e,t,n,i){i&&i.enumerable?e[t]=n:pV(e,t,n)},fV=l,_V=j,mV=$l,iy=o_,EV=ch,C_=kn("iterator"),oy=!1;[].keys&&("next"in(ty=[].keys())?(ey=iy(iy(ty)))!==Object.prototype&&(da=ey):oy=!0);var vV=da==null||fV(function(){var e={};return da[C_].call(e)!==e});_V((da=vV?{}:mV(da))[C_])||EV(da,C_,function(){return this});var sy={IteratorPrototype:da,BUGGY_SAFARI_ITERATORS:oy},gV=ps,SV=p_?{}.toString:function(){return"[object "+gV(this)+"]"},TV=p_,yV=Fi.f,RV=aa,CV=Or,IV=SV,ay=kn("toStringTag"),Hu=function(e,t,n,i){if(e){var s=n?e:e.prototype;CV(s,ay)||yV(s,ay,{configurable:!0,value:t}),i&&!TV&&RV(s,"toString",IV)}},AV=sy.IteratorPrototype,wV=$l,OV=He,bV=Hu,NV=rc,PV=function(){return this},DV=sr,kV=ue,LV=function(e,t,n,i){var s=t+" Iterator";return e.prototype=wV(AV,{next:OV(+!i,n)}),bV(e,s,!1,!0),NV[s]=PV,e},xV=o_,MV=Hu,cy=ch,uy=rc,UV=ry.PROPER,uh=sy.BUGGY_SAFARI_ITERATORS,I_=kn("iterator"),dy="keys",dh="values",ly="entries",VV=function(){return this},hy=function(e,t,n,i,s,u,d){LV(n,t,i);var h,p,m,_=function(z){if(z===s&&L)return L;if(!uh&&z in A)return A[z];switch(z){case dy:case dh:case ly:return function(){return new n(this,z)}}return function(){return new n(this)}},E=t+" Iterator",y=!1,A=e.prototype,k=A[I_]||A["@@iterator"]||s&&A[s],L=!uh&&k||_(s),x=t=="Array"&&A.entries||k;if(x&&(h=xV(x.call(new e)))!==Object.prototype&&h.next&&(MV(h,E,!0,!0),uy[E]=VV),UV&&s==dh&&k&&k.name!==dh&&(y=!0,L=function(){return kV(k,this)}),s)if(p={values:_(dh),keys:u?L:_(dy),entries:_(ly)},d)for(m in p)(uh||y||!(m in A))&&cy(A,m,p[m]);else DV({target:t,proto:!0,forced:uh||y},p);return d&&A[I_]!==L&&cy(A,I_,L,{name:s}),uy[t]=L,p},BV=Ti,py=rc,fy=ah;Fi.f;var jV=hy,_y="Array Iterator",FV=fy.set,GV=fy.getterFor(_y);jV(Array,"Array",function(e,t){FV(this,{type:_y,target:BV(e),index:0,kind:t})},function(){var e=GV(this),t=e.target,n=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,{value:void 0,done:!0}):n=="keys"?{value:i,done:!1}:n=="values"?{value:t[i],done:!1}:{value:[i,t[i]],done:!1}},"values"),py.Arguments=py.Array;var my=U.Promise,WV=ch,HV=Mr,KV=Fi,zV=Y,Ey=kn("species"),YV=w,qV=U.TypeError,vy=kn("iterator"),gy=!1;try{var JV=0,Sy={next:function(){return{done:!!JV++}},return:function(){gy=!0}};Sy[vy]=function(){return this},Array.from(Sy,function(){throw 2})}catch{}var XV=N,QV=l,Ty=j,$V=ps,ZV=E_,yy=function(){},eB=[],Ry=Mr("Reflect","construct"),A_=/^\s*(?:class|function)\b/,tB=XV(A_.exec),nB=!A_.exec(yy),Ku=function(e){if(!Ty(e))return!1;try{return Ry(yy,eB,e),!0}catch{return!1}},Cy=function(e){if(!Ty(e))return!1;switch($V(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return nB||!!tB(A_,ZV(e))}catch{return!0}};Cy.sham=!0;var zu,sc,Iy,w_,O_=!Ry||QV(function(){var e;return Ku(Ku.call)||!Ku(Object)||!Ku(function(){e=!0})||e})?Cy:Ku,rB=O_,iB=$a,oB=U.TypeError,Ay=Gi,sB=function(e){if(rB(e))return e;throw oB(iB(e)+" is not a constructor")},aB=kn("species"),wy=function(e,t){var n,i=Ay(e).constructor;return i===void 0||(n=Ay(i)[aB])==null?t:sB(n)},b_=N([].slice),Oy=/(?:ipad|iphone|ipod).*applewebkit/i.test(ni),ri=U,cB=M,uB=Fu,by=j,dB=Or,lB=l,Ny=MT,hB=b_,Py=$0,pB=Oy,fB=Kl,N_=ri.setImmediate,P_=ri.clearImmediate,_B=ri.process,D_=ri.Dispatch,mB=ri.Function,Dy=ri.MessageChannel,EB=ri.String,k_=0,Yu={},vB="onreadystatechange";try{zu=ri.location}catch{}var L_=function(e){if(dB(Yu,e)){var t=Yu[e];delete Yu[e],t()}},x_=function(e){return function(){L_(e)}},ky=function(e){L_(e.data)},Ly=function(e){ri.postMessage(EB(e),zu.protocol+"//"+zu.host)};N_&&P_||(N_=function(e){var t=hB(arguments,1);return Yu[++k_]=function(){cB(by(e)?e:mB(e),void 0,t)},sc(k_),k_},P_=function(e){delete Yu[e]},fB?sc=function(e){_B.nextTick(x_(e))}:D_&&D_.now?sc=function(e){D_.now(x_(e))}:Dy&&!pB?(w_=(Iy=new Dy).port2,Iy.port1.onmessage=ky,sc=uB(w_.postMessage,w_)):ri.addEventListener&&by(ri.postMessage)&&!ri.importScripts&&zu&&zu.protocol!=="file:"&&!lB(Ly)?(sc=Ly,ri.addEventListener("message",ky,!1)):sc=vB in Py("script")?function(e){Ny.appendChild(Py("script")).onreadystatechange=function(){Ny.removeChild(this),L_(e)}}:function(e){setTimeout(x_(e),0)});var qu,la,Ju,ac,M_,U_,V_,xy,My={set:N_,clear:P_},gB=U,SB=/ipad|iphone|ipod/i.test(ni)&&gB.Pebble!==void 0,TB=/web0s(?!.*chrome)/i.test(ni),ha=U,Uy=Fu,yB=K.f,B_=My.set,RB=Oy,CB=SB,IB=TB,j_=Kl,Vy=ha.MutationObserver||ha.WebKitMutationObserver,By=ha.document,jy=ha.process,lh=ha.Promise,Fy=yB(ha,"queueMicrotask"),Gy=Fy&&Fy.value;Gy||(qu=function(){var e,t;for(j_&&(e=jy.domain)&&e.exit();la;){t=la.fn,la=la.next;try{t()}catch(n){throw la?ac():Ju=void 0,n}}Ju=void 0,e&&e.enter()},RB||j_||IB||!Vy||!By?!CB&&lh&&lh.resolve?((V_=lh.resolve(void 0)).constructor=lh,xy=Uy(V_.then,V_),ac=function(){xy(qu)}):j_?ac=function(){jy.nextTick(qu)}:(B_=Uy(B_,ha),ac=function(){B_(qu)}):(M_=!0,U_=By.createTextNode(""),new Vy(qu).observe(U_,{characterData:!0}),ac=function(){U_.data=M_=!M_}));var AB=Gy||function(e){var t={fn:e,next:void 0};Ju&&(Ju.next=t),la||(la=t,ac()),Ju=t},cc={},Wy=ji,wB=function(e){var t,n;this.promise=new e(function(i,s){if(t!==void 0||n!==void 0)throw TypeError("Bad Promise constructor");t=i,n=s}),this.resolve=Wy(t),this.reject=Wy(n)};cc.f=function(e){return new wB(e)};var OB=Gi,bB=_n,NB=cc,Hy=function(e,t){if(OB(e),bB(t)&&t.constructor===e)return t;var n=NB.f(e);return(0,n.resolve)(t),n.promise},PB=U,hh=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Ky=function(){this.head=null,this.tail=null};Ky.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var F_,zy,G_,DB=typeof window=="object",ph=sr,Lo=U,kB=Mr,fs=ue,W_=my,LB=function(e,t,n){for(var i in t)n&&n.unsafe&&e[i]?e[i]=t[i]:WV(e,i,t[i],n);return e},xB=Hu,MB=function(e){var t=HV(e),n=KV.f;zV&&t&&!t[Ey]&&n(t,Ey,{configurable:!0,get:function(){return this}})},H_=ji,fh=j,UB=_n,VB=function(e,t){if(YV(t,e))return e;throw qV("Incorrect invocation")},BB=E_,Yy=th,jB=function(e,t){if(!t&&!gy)return!1;var n=!1;try{var i={};i[vy]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch{}return n},FB=wy,qy=My.set,K_=AB,GB=Hy,WB=function(e,t){var n=PB.console;n&&n.error&&(arguments.length==1?n.error(e):n.error(e,t))},Jy=cc,z_=hh,HB=Ky,Y_=ah,KB=_T,zB=DB,_h=Kl,Xy=yi,YB=kn("species"),uo="Promise",Qy=Y_.getterFor(uo),qB=Y_.set,JB=Y_.getterFor(uo),XB=W_&&W_.prototype,lo=W_,mh=XB,$y=Lo.TypeError,q_=Lo.document,J_=Lo.process,uc=Jy.f,QB=uc,$B=!!(q_&&q_.createEvent&&Lo.dispatchEvent),Zy=fh(Lo.PromiseRejectionEvent),eR="unhandledrejection",Eh=KB(uo,function(){var e=BB(lo),t=e!==String(lo);if(!t&&Xy===66||!mh.finally)return!0;if(Xy>=51&&/native code/.test(e))return!1;var n=new lo(function(s){s(1)}),i=function(s){s(function(){},function(){})};return(n.constructor={})[YB]=i,!(n.then(function(){})instanceof i)||!t&&zB&&!Zy}),ZB=Eh||!jB(function(e){lo.all(e).catch(function(){})}),tR=function(e){var t;return!(!UB(e)||!fh(t=e.then))&&t},nR=function(e,t){var n,i,s,u=t.value,d=t.state==1,h=d?e.ok:e.fail,p=e.resolve,m=e.reject,_=e.domain;try{h?(d||(t.rejection===2&&t4(t),t.rejection=1),h===!0?n=u:(_&&_.enter(),n=h(u),_&&(_.exit(),s=!0)),n===e.promise?m($y("Promise-chain cycle")):(i=tR(n))?fs(i,n,p,m):p(n)):m(u)}catch(E){_&&!s&&_.exit(),m(E)}},rR=function(e,t){e.notified||(e.notified=!0,K_(function(){for(var n,i=e.reactions;n=i.get();)nR(n,e);e.notified=!1,t&&!e.rejection&&e4(e)}))},iR=function(e,t,n){var i,s;$B?((i=q_.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),Lo.dispatchEvent(i)):i={promise:t,reason:n},!Zy&&(s=Lo["on"+e])?s(i):e===eR&&WB("Unhandled promise rejection",n)},e4=function(e){fs(qy,Lo,function(){var t,n=e.facade,i=e.value;if(oR(e)&&(t=z_(function(){_h?J_.emit("unhandledRejection",i,n):iR(eR,n,i)}),e.rejection=_h||oR(e)?2:1,t.error))throw t.value})},oR=function(e){return e.rejection!==1&&!e.parent},t4=function(e){fs(qy,Lo,function(){var t=e.facade;_h?J_.emit("rejectionHandled",t):iR("rejectionhandled",t,e.value)})},dc=function(e,t,n){return function(i){e(t,i,n)}},lc=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,rR(e,!0))},X_=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw $y("Promise can't be resolved itself");var i=tR(t);i?K_(function(){var s={done:!1};try{fs(i,t,dc(X_,s,e),dc(lc,s,e))}catch(u){lc(s,u,e)}}):(e.value=t,e.state=1,rR(e,!1))}catch(s){lc({done:!1},s,e)}}};Eh&&(mh=(lo=function(e){VB(this,mh),H_(e),fs(F_,this);var t=Qy(this);try{e(dc(X_,t),dc(lc,t))}catch(n){lc(t,n)}}).prototype,(F_=function(e){qB(this,{type:uo,done:!1,notified:!1,parent:!1,reactions:new HB,rejection:!1,state:0,value:void 0})}).prototype=LB(mh,{then:function(e,t){var n=JB(this),i=uc(FB(this,lo));return n.parent=!0,i.ok=!fh(e)||e,i.fail=fh(t)&&t,i.domain=_h?J_.domain:void 0,n.state==0?n.reactions.add(i):K_(function(){nR(i,n)}),i.promise},catch:function(e){return this.then(void 0,e)}}),zy=function(){var e=new F_,t=Qy(e);this.promise=e,this.resolve=dc(X_,t),this.reject=dc(lc,t)},Jy.f=uc=function(e){return e===lo||e===G_?new zy(e):QB(e)}),ph({global:!0,wrap:!0,forced:Eh},{Promise:lo}),xB(lo,uo,!1,!0),MB(uo),G_=kB(uo),ph({target:uo,stat:!0,forced:Eh},{reject:function(e){var t=uc(this);return fs(t.reject,void 0,e),t.promise}}),ph({target:uo,stat:!0,forced:!0},{resolve:function(e){return GB(this===G_?lo:this,e)}}),ph({target:uo,stat:!0,forced:ZB},{all:function(e){var t=this,n=uc(t),i=n.resolve,s=n.reject,u=z_(function(){var d=H_(t.resolve),h=[],p=0,m=1;Yy(e,function(_){var E=p++,y=!1;m++,fs(d,t,_).then(function(A){y||(y=!0,h[E]=A,--m||i(h))},s)}),--m||i(h)});return u.error&&s(u.value),n.promise},race:function(e){var t=this,n=uc(t),i=n.reject,s=z_(function(){var u=H_(t.resolve);Yy(e,function(d){fs(u,t,d).then(n.resolve,i)})});return s.error&&i(s.value),n.promise}});var n4=ue,r4=ji,i4=cc,o4=hh,s4=th;sr({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=i4.f(t),i=n.resolve,s=n.reject,u=o4(function(){var d=r4(t.resolve),h=[],p=0,m=1;s4(e,function(_){var E=p++,y=!1;m++,n4(d,t,_).then(function(A){y||(y=!0,h[E]={status:"fulfilled",value:A},--m||i(h))},function(A){y||(y=!0,h[E]={status:"rejected",reason:A},--m||i(h))})}),--m||i(h)});return u.error&&s(u.value),n.promise}});var a4=ji,c4=Mr,u4=ue,d4=cc,l4=hh,h4=th,sR="No one promise resolved";sr({target:"Promise",stat:!0},{any:function(e){var t=this,n=c4("AggregateError"),i=d4.f(t),s=i.resolve,u=i.reject,d=l4(function(){var h=a4(t.resolve),p=[],m=0,_=1,E=!1;h4(e,function(y){var A=m++,k=!1;_++,u4(h,t,y).then(function(L){k||E||(E=!0,s(L))},function(L){k||E||(k=!0,p[A]=L,--_||u(new n(p,sR)))})}),--_||u(new n(p,sR))});return d.error&&u(d.value),i.promise}});var aR=my,p4=Mr,f4=j,_4=wy,cR=Hy;sr({target:"Promise",proto:!0,real:!0,forced:!!aR&&l(function(){aR.prototype.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=_4(this,p4("Promise")),n=f4(e);return this.then(n?function(i){return cR(t,e()).then(function(){return i})}:e,n?function(i){return cR(t,e()).then(function(){throw i})}:e)}});var Q_=N,m4=e_,E4=ic,v4=st,g4=Q_("".charAt),uR=Q_("".charCodeAt),S4=Q_("".slice),dR=function(e){return function(t,n){var i,s,u=E4(v4(t)),d=m4(n),h=u.length;return d<0||d>=h?e?"":void 0:(i=uR(u,d))<55296||i>56319||d+1===h||(s=uR(u,d+1))<56320||s>57343?e?g4(u,d):i:e?S4(u,d,d+2):s-56320+(i-55296<<10)+65536}},T4={codeAt:dR(!1),charAt:dR(!0)}.charAt,y4=ic,lR=ah,R4=hy,hR="String Iterator",C4=lR.set,I4=lR.getterFor(hR);R4(String,"String",function(e){C4(this,{type:hR,string:y4(e),index:0})},function(){var e,t=I4(this),n=t.string,i=t.index;return i>=n.length?{value:void 0,done:!0}:(e=T4(n,i),t.index+=e.length,{value:e,done:!1})});var A4=Cn.Promise,w4={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},O4=U,b4=ps,N4=aa,pR=rc,fR=kn("toStringTag");for(var $_ in w4){var _R=O4[$_],Z_=_R&&_R.prototype;Z_&&b4(Z_)!==fR&&N4(Z_,fR,$_),pR[$_]=pR.Array}var mR=A4,Ee=mR;const ER=IT;function vR(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;const h={};return Object.keys(d).forEach(p=>{if(p==="require"||p==="advanced"||p==="mediaSource")return;const m=typeof d[p]=="object"?d[p]:{ideal:d[p]};m.exact!==void 0&&typeof m.exact=="number"&&(m.min=m.max=m.exact);const _=function(E,y){return E?E+y.charAt(0).toUpperCase()+y.slice(1):y==="deviceId"?"sourceId":y};if(m.ideal!==void 0){h.optional=h.optional||[];let E={};typeof m.ideal=="number"?(E[_("min",p)]=m.ideal,h.optional.push(E),E={},E[_("max",p)]=m.ideal,h.optional.push(E)):(E[_("",p)]=m.ideal,h.optional.push(E))}m.exact!==void 0&&typeof m.exact!="number"?(h.mandatory=h.mandatory||{},h.mandatory[_("",p)]=m.exact):["min","max"].forEach(E=>{m[E]!==void 0&&(h.mandatory=h.mandatory||{},h.mandatory[_(E,p)]=m[E])})}),d.advanced&&(h.optional=(h.optional||[]).concat(d.advanced)),h},s=function(d,h){if(t.version>=61)return h(d);if((d=JSON.parse(JSON.stringify(d)))&&typeof d.audio=="object"){const p=function(m,_,E){_ in m&&!(E in m)&&(m[E]=m[_],delete m[_])};p((d=JSON.parse(JSON.stringify(d))).audio,"autoGainControl","googAutoGainControl"),p(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=i(d.audio)}if(d&&typeof d.video=="object"){let p=d.video.facingMode;p=p&&(typeof p=="object"?p:{ideal:p});const m=t.version<66;if(p&&(p.exact==="user"||p.exact==="environment"||p.ideal==="user"||p.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||m)){let _;if(delete d.video.facingMode,p.exact==="environment"||p.ideal==="environment"?_=["back","rear"]:p.exact!=="user"&&p.ideal!=="user"||(_=["front"]),_)return n.mediaDevices.enumerateDevices().then(E=>{let y=(E=E.filter(A=>A.kind==="videoinput")).find(A=>_.some(k=>A.label.toLowerCase().includes(k)));return!y&&E.length&&_.includes("back")&&(y=E[E.length-1]),y&&(d.video.deviceId=p.exact?{exact:y.deviceId}:{ideal:y.deviceId}),d.video=i(d.video),ER("chrome: "+JSON.stringify(d)),h(d)})}d.video=i(d.video)}return ER("chrome: "+JSON.stringify(d)),h(d)},u=function(d){return t.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(d,h,p){s(d,m=>{n.webkitGetUserMedia(m,h,_=>{p&&p(u(_))})})}.bind(n),n.mediaDevices.getUserMedia){const d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(h){return s(h,p=>d(p).then(m=>{if(p.audio&&!m.getAudioTracks().length||p.video&&!m.getVideoTracks().length)throw m.getTracks().forEach(_=>{_.stop()}),new DOMException("","NotFoundError");return m},m=>Ee.reject(u(m))))}}}function gR(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function SR(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let s;s=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===i.track.id):{track:i.track};const u=new Event("track");u.track=i.track,u.receiver=s,u.transceiver={receiver:s},u.streams=[n.stream],this.dispatchEvent(u)}),n.stream.getTracks().forEach(i=>{let s;s=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===i.id):{track:i};const u=new Event("track");u.track=i,u.receiver=s,u.transceiver={receiver:s},u.streams=[n.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else ca(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function TR(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(s,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=s.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:s}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(d,h){let p=s.apply(this,arguments);return p||(p=t(this,d),this._senders.push(p)),p};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(d){u.apply(this,arguments);const h=this._senders.indexOf(d);h!==-1&&this._senders.splice(h,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(u=>{this._senders.push(t(this,u))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(u=>{const d=this._senders.find(h=>h.track===u);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function yR(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,i,s]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const u=function(h){const p={};return h.result().forEach(m=>{const _={id:m.id,timestamp:m.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[m.type]||m.type};m.names().forEach(E=>{_[E]=m.stat(E)}),p[_.id]=_}),p},d=function(h){return new Map(Object.keys(h).map(p=>[p,h[p]]))};if(arguments.length>=2){const h=function(p){i(d(u(p)))};return t.apply(this,[h,n])}return new Ee((h,p)=>{t.apply(this,[function(m){h(d(u(m)))},p])}).then(i,s)}}function RR(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(u=>u._pc=this),s});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(u=>OT(u,s.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i}),ca(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>OT(s,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let i,s,u;return this.getSenders().forEach(d=>{d.track===n&&(i?u=!0:i=d)}),this.getReceivers().forEach(d=>(d.track===n&&(s?u=!0:s=d),d.track===n)),u||i&&s?Ee.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Ee.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function CR(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,d){if(!d)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const h=t.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(h)===-1&&this._shimmedLocalStreams[d.id].push(h):this._shimmedLocalStreams[d.id]=[d,h],h};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(p=>{if(this.getSenders().find(m=>m.track===p))throw new DOMException("Track already exists.","InvalidAccessError")});const d=this.getSenders();n.apply(this,arguments);const h=this.getSenders().filter(p=>d.indexOf(p)===-1);this._shimmedLocalStreams[u.id]=[u].concat(h)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],i.apply(this,arguments)};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(d=>{const h=this._shimmedLocalStreams[d].indexOf(u);h!==-1&&this._shimmedLocalStreams[d].splice(h,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),s.apply(this,arguments)}}function IR(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return CR(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const m=n.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(_=>this._reverseStreams[_.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(_=>{if(this.getSenders().find(E=>E.track===_))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const _=new e.MediaStream(m.getTracks());this._streams[m.id]=_,this._reverseStreams[_.id]=m,m=_}i.apply(this,[m])};const s=e.RTCPeerConnection.prototype.removeStream;function u(m,_){let E=_.sdp;return Object.keys(m._reverseStreams||[]).forEach(y=>{const A=m._reverseStreams[y],k=m._streams[A.id];E=E.replace(new RegExp(k.id,"g"),A.id)}),new RTCSessionDescription({type:_.type,sdp:E})}function d(m,_){let E=_.sdp;return Object.keys(m._reverseStreams||[]).forEach(y=>{const A=m._reverseStreams[y],k=m._streams[A.id];E=E.replace(new RegExp(A.id,"g"),k.id)}),new RTCSessionDescription({type:_.type,sdp:E})}e.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},e.RTCPeerConnection.prototype.addTrack=function(m,_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const E=[].slice.call(arguments,1);if(E.length!==1||!E[0].getTracks().find(k=>k===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const A=this._streams[_.id];if(A)A.addTrack(m),Ee.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new e.MediaStream([m]);this._streams[_.id]=k,this._reverseStreams[k.id]=_,this.addStream(k)}return this.getSenders().find(k=>k.track===m)},["createOffer","createAnswer"].forEach(function(m){const _=e.RTCPeerConnection.prototype[m],E={[m](){const y=arguments;return arguments.length&&typeof arguments[0]=="function"?_.apply(this,[A=>{const k=u(this,A);y[0].apply(null,[k])},A=>{y[1]&&y[1].apply(null,A)},arguments[2]]):_.apply(this,arguments).then(A=>u(this,A))}};e.RTCPeerConnection.prototype[m]=E[m]});const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=d(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const p=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const m=p.get.apply(this);return m.type===""?m:u(this,m)}}),e.RTCPeerConnection.prototype.removeTrack=function(m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let _;this._streams=this._streams||{},Object.keys(this._streams).forEach(E=>{this._streams[E].getTracks().find(y=>m.track===y)&&(_=this._streams[E])}),_&&(_.getTracks().length===1?this.removeStream(this._reverseStreams[_.id]):_.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function em(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=e.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=s[n]})}function AR(e,t){ca(e,"negotiationneeded",n=>{const i=n.target;if(!(t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var wR=Object.freeze({__proto__:null,shimMediaStream:gR,shimOnTrack:SR,shimGetSendersWithDtmf:TR,shimGetStats:yR,shimSenderReceiverGetStats:RR,shimAddTrackRemoveTrackWithNative:CR,shimAddTrackRemoveTrack:IR,shimPeerConnection:em,fixNegotiationNeeded:AR,shimGetUserMedia:vR,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(i=>{const s=n.video&&n.video.width,u=n.video&&n.video.height,d=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:d||3}},s&&(n.video.mandatory.maxWidth=s),u&&(n.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function OR(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(s,u,d){r_("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(u,d)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(d,h,p){h in d&&!(p in d)&&(d[p]=d[h],delete d[h])},u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(d){return typeof d=="object"&&typeof d.audio=="object"&&(d=JSON.parse(JSON.stringify(d)),s(d.audio,"autoGainControl","mozAutoGainControl"),s(d.audio,"noiseSuppression","mozNoiseSuppression")),u(d)},i&&i.prototype.getSettings){const d=i.prototype.getSettings;i.prototype.getSettings=function(){const h=d.apply(this,arguments);return s(h,"mozAutoGainControl","autoGainControl"),s(h,"mozNoiseSuppression","noiseSuppression"),h}}if(i&&i.prototype.applyConstraints){const d=i.prototype.applyConstraints;i.prototype.applyConstraints=function(h){return this.kind==="audio"&&typeof h=="object"&&(h=JSON.parse(JSON.stringify(h)),s(h,"autoGainControl","mozAutoGainControl"),s(h,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[h])}}}}function bR(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function tm(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const u=e.RTCPeerConnection.prototype[s],d={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=d[s]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[s,u,d]=arguments;return i.apply(this,[s||null]).then(h=>{if(t.version<53&&!u)try{h.forEach(p=>{p.type=n[p.type]||p.type})}catch(p){if(p.name!=="TypeError")throw p;h.forEach((m,_)=>{h.set(_,Object.assign({},m,{type:n[m.type]||m.type}))})}return h}).then(u,d)}}function NR(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Ee.resolve(new Map)}}function PR(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n}),ca(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function DR(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){r_("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&t.getTracks().includes(n.track)&&this.removeTrack(n)})})}function kR(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function LR(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=t.apply(this,arguments);if(i){const{sender:u}=s,d=u.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=n,u.sendEncodings=n,this.setParametersPromises.push(u.setParameters(d).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return s})}function xR(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function MR(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ee.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function UR(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Ee.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var VR=Object.freeze({__proto__:null,shimOnTrack:bR,shimPeerConnection:tm,shimSenderGetStats:NR,shimReceiverGetStats:PR,shimRemoveStream:DR,shimRTCDataChannel:kR,shimAddTransceiver:LR,shimGetParameters:xR,shimCreateOffer:MR,shimCreateAnswer:UR,shimGetUserMedia:OR,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Ee.reject(i)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}});function BR(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>t.call(this,i,n)),n.getVideoTracks().forEach(i=>t.call(this,i,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,s=new Array(i>1?i-1:0),u=1;u<i;u++)s[u-1]=arguments[u];return s&&s.forEach(d=>{this._localStreams?this._localStreams.includes(d)||this._localStreams.push(d):this._localStreams=[d]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const i=t.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function jR(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const u=new Event("addstream");u.stream=s,this.dispatchEvent(u)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(s)>=0)return;n._remoteStreams.push(s);const u=new Event("addstream");u.stream=s,n.dispatchEvent(u)})}),t.apply(n,arguments)}}}function FR(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,s=t.setLocalDescription,u=t.setRemoteDescription,d=t.addIceCandidate;t.createOffer=function(p,m){const _=arguments.length>=2?arguments[2]:arguments[0],E=n.apply(this,[_]);return m?(E.then(p,m),Ee.resolve()):E},t.createAnswer=function(p,m){const _=arguments.length>=2?arguments[2]:arguments[0],E=i.apply(this,[_]);return m?(E.then(p,m),Ee.resolve()):E};let h=function(p,m,_){const E=s.apply(this,[p]);return _?(E.then(m,_),Ee.resolve()):E};t.setLocalDescription=h,h=function(p,m,_){const E=u.apply(this,[p]);return _?(E.then(m,_),Ee.resolve()):E},t.setRemoteDescription=h,h=function(p,m,_){const E=d.apply(this,[p]);return _?(E.then(m,_),Ee.resolve()):E},t.addIceCandidate=h}function GR(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=s=>i(WR(s))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(n,i,s){t.mediaDevices.getUserMedia(n).then(i,s)}.bind(t))}function WR(e){return e&&e.video!==void 0?Object.assign({},e,{video:wT(e.video)}):e}function HR(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const s=[];for(let u=0;u<n.iceServers.length;u++){let d=n.iceServers[u];!d.hasOwnProperty("urls")&&d.hasOwnProperty("url")?(r_("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,s.push(d)):s.push(n.iceServers[u])}n.iceServers=s}return new t(n,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function KR(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function zR(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const s=this.getTransceivers().find(u=>u.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):n.offerToReceiveVideo!==!0||s||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function YR(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var qR=Object.freeze({__proto__:null,shimLocalStreamsAPI:BR,shimRemoteStreamsAPI:jR,shimCallbacksAPI:FR,shimGetUserMedia:GR,shimConstraints:WR,shimRTCIceServerUrls:HR,shimTrackEventTransceiver:KR,shimCreateOfferLegacy:zR,shimAudioContext:YR}),P4=`	
\v\f\r                　\u2028\u2029\uFEFF`,D4=st,k4=ic,JR=N("".replace),vh=`[	
\v\f\r                　\u2028\u2029\uFEFF]`,L4=RegExp("^"+vh+vh+"*"),x4=RegExp(vh+vh+"*$"),nm=function(e){return function(t){var n=k4(D4(t));return 1&e&&(n=JR(n,L4,"")),2&e&&(n=JR(n,x4,"")),n}},M4={start:nm(1),end:nm(2),trim:nm(3)},U4=ry.PROPER,V4=l,XR=P4,B4=M4.trim;sr({target:"String",proto:!0,forced:function(e){return V4(function(){return!!XR[e]()||"​᠎"[e]()!=="​᠎"||U4&&XR[e].name!==e})}("trim")},{trim:function(){return B4(this)}});var j4=ls("String").trim,F4=w,G4=j4,rm=String.prototype,xo=function(e){var t=e.trim;return typeof e=="string"||e===rm||F4(rm,e)&&t===rm.trim?G4:t},im={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return xo(n).call(n).split(`
`).map(i=>xo(i).call(i))},t.splitSections=function(n){return n.split(`
m=`).map((i,s)=>{var u;return xo(u=s>0?"m="+i:i).call(u)+`\r
`})},t.getDescription=function(n){const i=t.splitSections(n);return i&&i[0]},t.getMediaSections=function(n){const i=t.splitSections(n);return i.shift(),i},t.matchPrefix=function(n,i){return t.splitLines(n).filter(s=>s.indexOf(i)===0)},t.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const s={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let u=8;u<i.length;u+=2)switch(i[u]){case"raddr":s.relatedAddress=i[u+1];break;case"rport":s.relatedPort=parseInt(i[u+1],10);break;case"tcptype":s.tcpType=i[u+1];break;case"ufrag":s.ufrag=i[u+1],s.usernameFragment=i[u+1];break;default:s[i[u]]===void 0&&(s[i[u]]=i[u+1])}return s},t.writeCandidate=function(n){const i=[];i.push(n.foundation);const s=n.component;s==="rtp"?i.push(1):s==="rtcp"?i.push(2):i.push(s),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const u=n.type;return i.push("typ"),i.push(u),u!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(n){return n.substr(14).split(" ")},t.parseRtpMap=function(n){let i=n.substr(9).split(" ");const s={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),s.name=i[0],s.clockRate=parseInt(i[1],10),s.channels=i.length===3?parseInt(i[2],10):1,s.numChannels=s.channels,s},t.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},t.parseExtmap=function(n){const i=n.substr(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1]}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+`\r
`},t.parseFmtp=function(n){const i={};let s;const u=n.substr(n.indexOf(" ")+1).split(";");for(let p=0;p<u.length;p++){var d,h;s=xo(d=u[p]).call(d).split("="),i[xo(h=s[0]).call(h)]=s[1]}return i},t.writeFmtp=function(n){let i="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const u=[];Object.keys(n.parameters).forEach(d=>{n.parameters[d]!==void 0?u.push(d+"="+n.parameters[d]):u.push(d)}),i+="a=fmtp:"+s+" "+u.join(";")+`\r
`}return i},t.parseRtcpFb=function(n){const i=n.substr(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(n){let i="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(u=>{i+="a=rtcp-fb:"+s+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(n){const i=n.indexOf(" "),s={ssrc:parseInt(n.substr(7,i-7),10)},u=n.indexOf(":",i);return u>-1?(s.attribute=n.substr(i+1,u-i-1),s.value=n.substr(u+1)):s.attribute=n.substr(i+1),s},t.parseSsrcGroup=function(n){const i=n.substr(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(s=>parseInt(s,10))}},t.getMid=function(n){const i=t.matchPrefix(n,"a=mid:")[0];if(i)return i.substr(6)},t.parseFingerprint=function(n){const i=n.substr(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:t.matchPrefix(n+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,i){let s="a=setup:"+i+`\r
`;return n.fingerprints.forEach(u=>{s+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),s},t.parseCryptoLine=function(n){const i=n.substr(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substr(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,i){return t.matchPrefix(n+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,i){const s=t.matchPrefix(n+i,"a=ice-ufrag:")[0],u=t.matchPrefix(n+i,"a=ice-pwd:")[0];return s&&u?{usernameFragment:s.substr(12),password:u.substr(10)}:null},t.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=t.splitLines(n)[0].split(" ");for(let u=3;u<s.length;u++){const d=s[u],h=t.matchPrefix(n,"a=rtpmap:"+d+" ")[0];if(h){const p=t.parseRtpMap(h),m=t.matchPrefix(n,"a=fmtp:"+d+" ");switch(p.parameters=m.length?t.parseFmtp(m[0]):{},p.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+d+" ").map(t.parseRtcpFb),i.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(p.name.toUpperCase())}}}return t.matchPrefix(n,"a=extmap:").forEach(u=>{i.headerExtensions.push(t.parseExtmap(u))}),i},t.writeRtpDescription=function(n,i){let s="";s+="m="+n+" ",s+=i.codecs.length>0?"9":"0",s+=" UDP/TLS/RTP/SAVPF ",s+=i.codecs.map(d=>d.preferredPayloadType!==void 0?d.preferredPayloadType:d.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(d=>{s+=t.writeRtpMap(d),s+=t.writeFmtp(d),s+=t.writeRtcpFb(d)});let u=0;return i.codecs.forEach(d=>{d.maxptime>u&&(u=d.maxptime)}),u>0&&(s+="a=maxptime:"+u+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(d=>{s+=t.writeExtmap(d)}),s},t.parseRtpEncodingParameters=function(n){const i=[],s=t.parseRtpParameters(n),u=s.fecMechanisms.indexOf("RED")!==-1,d=s.fecMechanisms.indexOf("ULPFEC")!==-1,h=t.matchPrefix(n,"a=ssrc:").map(y=>t.parseSsrcMedia(y)).filter(y=>y.attribute==="cname"),p=h.length>0&&h[0].ssrc;let m;const _=t.matchPrefix(n,"a=ssrc-group:FID").map(y=>y.substr(17).split(" ").map(A=>parseInt(A,10)));_.length>0&&_[0].length>1&&_[0][0]===p&&(m=_[0][1]),s.codecs.forEach(y=>{if(y.name.toUpperCase()==="RTX"&&y.parameters.apt){let A={ssrc:p,codecPayloadType:parseInt(y.parameters.apt,10)};p&&m&&(A.rtx={ssrc:m}),i.push(A),u&&(A=JSON.parse(JSON.stringify(A)),A.fec={ssrc:p,mechanism:d?"red+ulpfec":"red"},i.push(A))}}),i.length===0&&p&&i.push({ssrc:p});let E=t.matchPrefix(n,"b=");return E.length&&(E=E[0].indexOf("b=TIAS:")===0?parseInt(E[0].substr(7),10):E[0].indexOf("b=AS:")===0?1e3*parseInt(E[0].substr(5),10)*.95-16e3:void 0,i.forEach(y=>{y.maxBitrate=E})),i},t.parseRtcpParameters=function(n){const i={},s=t.matchPrefix(n,"a=ssrc:").map(h=>t.parseSsrcMedia(h)).filter(h=>h.attribute==="cname")[0];s&&(i.cname=s.value,i.ssrc=s.ssrc);const u=t.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=u.length>0,i.compound=u.length===0;const d=t.matchPrefix(n,"a=rtcp-mux");return i.mux=d.length>0,i},t.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},t.parseMsid=function(n){let i;const s=t.matchPrefix(n,"a=msid:");if(s.length===1)return i=s[0].substr(7).split(" "),{stream:i[0],track:i[1]};const u=t.matchPrefix(n,"a=ssrc:").map(d=>t.parseSsrcMedia(d)).filter(d=>d.attribute==="msid");return u.length>0?(i=u[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(n){const i=t.parseMLine(n),s=t.matchPrefix(n,"a=max-message-size:");let u;s.length>0&&(u=parseInt(s[0].substr(19),10)),isNaN(u)&&(u=65536);const d=t.matchPrefix(n,"a=sctp-port:");if(d.length>0)return{port:parseInt(d[0].substr(12),10),protocol:i.fmt,maxMessageSize:u};const h=t.matchPrefix(n,"a=sctpmap:");if(h.length>0){const p=h[0].substr(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:u}}},t.writeSctpDescription=function(n,i){let s=[];return s=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&s.push("a=max-message-size:"+i.maxMessageSize+`\r
`),s.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(n,i,s){let u;const d=i!==void 0?i:2;return u=n||t.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+u+" "+d+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,i){const s=t.splitLines(n);for(let u=0;u<s.length;u++)switch(s[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[u].substr(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substr(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const i=t.splitLines(n)[0].substr(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){const i=t.matchPrefix(n,"o=")[0].substr(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=t.splitLines(n);for(let s=0;s<i.length;s++)if(i[s].length<2||i[s].charAt(1)!=="=")return!1;return!0},e.exports=t})(im);var hc=im.exports,W4=Object.freeze(a({__proto__:null,default:hc},[im.exports]));function gh(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new t(n),s=hc.parseCandidate(n.candidate),u=Object.assign(i,s);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,ca(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function om(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||ca(e,"icecandidate",t=>{if(t.candidate){const n=hc.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function Sh(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(h){if(!h||!h.sdp)return!1;const p=hc.splitSections(h.sdp);return p.shift(),p.some(m=>{const _=hc.parseMLine(m);return _&&_.kind==="application"&&_.protocol.indexOf("SCTP")!==-1})},i=function(h){const p=h.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;const m=parseInt(p[1],10);return m!=m?-1:m},s=function(h){let p=65536;return t.browser==="firefox"&&(p=t.version<57?h===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),p},u=function(h,p){let m=65536;t.browser==="firefox"&&t.version===57&&(m=65535);const _=hc.matchPrefix(h.sdp,"a=max-message-size:");return _.length>0?m=parseInt(_[0].substr(19),10):t.browser==="firefox"&&p!==-1&&(m=2147483637),m},d=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:h}=this.getConfiguration();h==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const h=i(arguments[0]),p=s(h),m=u(arguments[0],h);let _;_=p===0&&m===0?Number.POSITIVE_INFINITY:p===0||m===0?Math.max(p,m):Math.min(p,m);const E={};Object.defineProperty(E,"maxMessageSize",{get:()=>_}),this._sctp=E}return d.apply(this,arguments)}}function Th(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,s){const u=i.send;i.send=function(){const d=arguments[0],h=d.length||d.size||d.byteLength;if(i.readyState==="open"&&s.sctp&&h>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return u.apply(i,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},ca(e,"datachannel",i=>(t(i.channel,i.target),i))}function sm(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const u=s.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const d=new Event("connectionstatechange",s);u.dispatchEvent(d)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function am(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(u=>xo(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return n.apply(this,arguments)}}function yh(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Ee.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Ee.resolve())})}function Rh(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(u=>n.apply(this,[u]))})}var H4=Object.freeze({__proto__:null,shimRTCIceCandidate:gh,shimRTCIceCandidateRelayProtocol:om,shimMaxMessageSize:Sh,shimSendThrowTypeError:Th,shimConnectionState:sm,removeExtmapAllowMixed:am,shimAddIceCandidateNullOrEmpty:yh,shimParameterlessSetLocalDescription:Rh});let Ln,ht;(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=IT,i=o2(e),s={browserDetails:i,commonShim:H4,extractVersion:zl,disableLog:r2,disableWarnings:i2,sdp:W4};switch(i.browser){case"chrome":if(!wR||!em||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=wR,yh(e,i),Rh(e),vR(e,i),gR(e),em(e,i),SR(e),IR(e,i),TR(e),yR(e),RR(e),AR(e,i),gh(e),om(e),sm(e),Sh(e,i),Th(e),am(e,i);break;case"firefox":if(!VR||!tm||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=VR,yh(e,i),Rh(e),OR(e,i),tm(e,i),bR(e),DR(e),NR(e),PR(e),kR(e),LR(e),xR(e),MR(e),UR(e),gh(e),sm(e),Sh(e,i),Th(e);break;case"safari":if(!qR||!t.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=qR,yh(e,i),Rh(e),HR(e),zR(e),FR(e),BR(e),jR(e),KR(e),GR(e),YR(e),gh(e),om(e),Sh(e,i),Th(e),am(e,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),function(e){e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot"}(Ln||(Ln={})),function(e){e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger"}(ht||(ht={}));var cm={exports:{}};(function(e,t){(function(n,i){var s="function",u="undefined",d="object",h="string",p="major",m="model",_="name",E="type",y="vendor",A="version",k="architecture",L="console",x="mobile",z="tablet",X="smarttv",ie="wearable",Ie="embedded",se="Amazon",de="Apple",oe="ASUS",ve="BlackBerry",pt="Firefox",Be="Google",At="Huawei",gt="LG",Xt="Microsoft",Nn="Motorola",Yt="Opera",Tr="Samsung",Z="Sharp",re="Sony",_e="Xiaomi",xe="Zebra",nt="Facebook",ce="Chromium OS",S="Mac OS",D=function(Ht){for(var nn={},St=0;St<Ht.length;St++)nn[Ht[St].toUpperCase()]=Ht[St];return nn},F=function(Ht,nn){return typeof Ht===h&&ee(nn).indexOf(ee(Ht))!==-1},ee=function(Ht){return Ht.toLowerCase()},Ue=function(Ht,nn){if(typeof Ht===h)return Ht=Ht.replace(/^\s\s*/,""),typeof nn===u?Ht:Ht.substring(0,350)},Rt=function(Ht,nn){for(var St,dr,So,Kt,et,yr,Ps=0;Ps<nn.length&&!et;){var Qi=nn[Ps],PN=nn[Ps+1];for(St=dr=0;St<Qi.length&&!et&&Qi[St];)if(et=Qi[St++].exec(Ht))for(So=0;So<PN.length;So++)yr=et[++dr],typeof(Kt=PN[So])===d&&Kt.length>0?Kt.length===2?typeof Kt[1]==s?this[Kt[0]]=Kt[1].call(this,yr):this[Kt[0]]=Kt[1]:Kt.length===3?typeof Kt[1]!==s||Kt[1].exec&&Kt[1].test?this[Kt[0]]=yr?yr.replace(Kt[1],Kt[2]):i:this[Kt[0]]=yr?Kt[1].call(this,yr,Kt[2]):i:Kt.length===4&&(this[Kt[0]]=yr?Kt[3].call(this,yr.replace(Kt[1],Kt[2])):i):this[Kt]=yr||i;Ps+=2}},Pn=function(Ht,nn){for(var St in nn)if(typeof nn[St]===d&&nn[St].length>0){for(var dr=0;dr<nn[St].length;dr++)if(F(nn[St][dr],Ht))return St==="?"?i:St}else if(F(nn[St],Ht))return St==="?"?i:St;return Ht},Ni={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},bs={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[A,[_,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[A,[_,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[_,A],[/opios[\/ ]+([\w\.]+)/i],[A,[_,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[A,[_,Yt]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[_,A],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[A,[_,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[A,[_,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[A,[_,"WeChat"]],[/konqueror\/([\w\.]+)/i],[A,[_,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[A,[_,"IE"]],[/yabrowser\/([\w\.]+)/i],[A,[_,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[_,/(.+)/,"$1 Secure Browser"],A],[/\bfocus\/([\w\.]+)/i],[A,[_,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[A,[_,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[A,[_,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[A,[_,"Dolphin"]],[/coast\/([\w\.]+)/i],[A,[_,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[A,[_,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[A,[_,pt]],[/\bqihu|(qi?ho?o?|360)browser/i],[[_,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[_,/(.+)/,"$1 Browser"],A],[/(comodo_dragon)\/([\w\.]+)/i],[[_,/_/g," "],A],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[_,A],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[_],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[_,nt],A],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[_,A],[/\bgsa\/([\w\.]+) .*safari\//i],[A,[_,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[A,[_,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[_,"Chrome WebView"],A],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[A,[_,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[_,A],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[A,[_,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[A,_],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[_,[A,Pn,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[_,A],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[_,"Netscape"],A],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[A,[_,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[_,A],[/(cobalt)\/([\w\.]+)/i],[_,[A,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[k,"amd64"]],[/(ia32(?=;))/i],[[k,ee]],[/((?:i[346]|x)86)[;\)]/i],[[k,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[k,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[k,"armhf"]],[/windows (ce|mobile); ppc;/i],[[k,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[k,/ower/,"",ee]],[/(sun4\w)[;\)]/i],[[k,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[k,ee]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[m,[y,Tr],[E,z]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[m,[y,Tr],[E,x]],[/\((ip(?:hone|od)[\w ]*);/i],[m,[y,de],[E,x]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[m,[y,de],[E,z]],[/(macintosh);/i],[m,[y,de]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[m,[y,Z],[E,x]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[m,[y,At],[E,z]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[m,[y,At],[E,x]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[m,/_/g," "],[y,_e],[E,x]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[m,/_/g," "],[y,_e],[E,z]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[m,[y,"OPPO"],[E,x]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[m,[y,"Vivo"],[E,x]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[m,[y,"Realme"],[E,x]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[m,[y,Nn],[E,x]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[m,[y,Nn],[E,z]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[m,[y,gt],[E,z]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[m,[y,gt],[E,x]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[m,[y,"Lenovo"],[E,z]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[m,/_/g," "],[y,"Nokia"],[E,x]],[/(pixel c)\b/i],[m,[y,Be],[E,z]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[m,[y,Be],[E,x]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[m,[y,re],[E,x]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[m,"Xperia Tablet"],[y,re],[E,z]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[m,[y,"OnePlus"],[E,x]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[m,[y,se],[E,z]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[m,/(.+)/g,"Fire Phone $1"],[y,se],[E,x]],[/(playbook);[-\w\),; ]+(rim)/i],[m,y,[E,z]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[m,[y,ve],[E,x]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[m,[y,oe],[E,z]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[m,[y,oe],[E,x]],[/(nexus 9)/i],[m,[y,"HTC"],[E,z]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[y,[m,/_/g," "],[E,x]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[m,[y,"Acer"],[E,z]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[m,[y,"Meizu"],[E,x]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[y,m,[E,x]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[y,m,[E,z]],[/(surface duo)/i],[m,[y,Xt],[E,z]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[m,[y,"Fairphone"],[E,x]],[/(u304aa)/i],[m,[y,"AT&T"],[E,x]],[/\bsie-(\w*)/i],[m,[y,"Siemens"],[E,x]],[/\b(rct\w+) b/i],[m,[y,"RCA"],[E,z]],[/\b(venue[\d ]{2,7}) b/i],[m,[y,"Dell"],[E,z]],[/\b(q(?:mv|ta)\w+) b/i],[m,[y,"Verizon"],[E,z]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[m,[y,"Barnes & Noble"],[E,z]],[/\b(tm\d{3}\w+) b/i],[m,[y,"NuVision"],[E,z]],[/\b(k88) b/i],[m,[y,"ZTE"],[E,z]],[/\b(nx\d{3}j) b/i],[m,[y,"ZTE"],[E,x]],[/\b(gen\d{3}) b.+49h/i],[m,[y,"Swiss"],[E,x]],[/\b(zur\d{3}) b/i],[m,[y,"Swiss"],[E,z]],[/\b((zeki)?tb.*\b) b/i],[m,[y,"Zeki"],[E,z]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[y,"Dragon Touch"],m,[E,z]],[/\b(ns-?\w{0,9}) b/i],[m,[y,"Insignia"],[E,z]],[/\b((nxa|next)-?\w{0,9}) b/i],[m,[y,"NextBook"],[E,z]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[y,"Voice"],m,[E,x]],[/\b(lvtel\-)?(v1[12]) b/i],[[y,"LvTel"],m,[E,x]],[/\b(ph-1) /i],[m,[y,"Essential"],[E,x]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[m,[y,"Envizen"],[E,z]],[/\b(trio[-\w\. ]+) b/i],[m,[y,"MachSpeed"],[E,z]],[/\btu_(1491) b/i],[m,[y,"Rotor"],[E,z]],[/(shield[\w ]+) b/i],[m,[y,"Nvidia"],[E,z]],[/(sprint) (\w+)/i],[y,m,[E,x]],[/(kin\.[onetw]{3})/i],[[m,/\./g," "],[y,Xt],[E,x]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[m,[y,xe],[E,z]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[m,[y,xe],[E,x]],[/smart-tv.+(samsung)/i],[y,[E,X]],[/hbbtv.+maple;(\d+)/i],[[m,/^/,"SmartTV"],[y,Tr],[E,X]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[y,gt],[E,X]],[/(apple) ?tv/i],[y,[m,"Apple TV"],[E,X]],[/crkey/i],[[m,"Chromecast"],[y,Be],[E,X]],[/droid.+aft(\w)( bui|\))/i],[m,[y,se],[E,X]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[m,[y,Z],[E,X]],[/(bravia[\w ]+)( bui|\))/i],[m,[y,re],[E,X]],[/(mitv-\w{5}) bui/i],[m,[y,_e],[E,X]],[/Hbbtv.*(technisat) (.*);/i],[y,m,[E,X]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[y,Ue],[m,Ue],[E,X]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[E,X]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[y,m,[E,L]],[/droid.+; (shield) bui/i],[m,[y,"Nvidia"],[E,L]],[/(playstation [345portablevi]+)/i],[m,[y,re],[E,L]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[m,[y,Xt],[E,L]],[/((pebble))app/i],[y,m,[E,ie]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[m,[y,de],[E,ie]],[/droid.+; (glass) \d/i],[m,[y,Be],[E,ie]],[/droid.+; (wt63?0{2,3})\)/i],[m,[y,xe],[E,ie]],[/(quest( 2| pro)?)/i],[m,[y,nt],[E,ie]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[y,[E,Ie]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[m,[E,x]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[m,[E,z]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[E,z]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[E,x]],[/(android[-\w\. ]{0,9});.+buil/i],[m,[y,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[A,[_,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[A,[_,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[_,A],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[A,_]],os:[[/microsoft (windows) (vista|xp)/i],[_,A],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[_,[A,Pn,Ni]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[_,"Windows"],[A,Pn,Ni]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[A,/_/g,"."],[_,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[_,S],[A,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[A,_],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[_,A],[/\(bb(10);/i],[A,[_,ve]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[A,[_,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[A,[_,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[A,[_,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[A,[_,"watchOS"]],[/crkey\/([\d\.]+)/i],[A,[_,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[_,ce],A],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[_,A],[/(sunos) ?([\w\.\d]*)/i],[[_,"Solaris"],A],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[_,A]]},fi=function(Ht,nn){if(typeof Ht===d&&(nn=Ht,Ht=i),!(this instanceof fi))return new fi(Ht,nn).getResult();var St=typeof n!==u&&n.navigator?n.navigator:i,dr=Ht||(St&&St.userAgent?St.userAgent:""),So=St&&St.userAgentData?St.userAgentData:i,Kt=nn?function(et,yr){var Ps={};for(var Qi in et)yr[Qi]&&yr[Qi].length%2==0?Ps[Qi]=yr[Qi].concat(et[Qi]):Ps[Qi]=et[Qi];return Ps}(bs,nn):bs;return this.getBrowser=function(){var et={};return et.name=i,et.version=i,Rt.call(et,dr,Kt.browser),et.major=function(yr){return typeof yr===h?yr.replace(/[^\d\.]/g,"").split(".")[0]:i}(et.version),St&&St.brave&&typeof St.brave.isBrave==s&&(et.name="Brave"),et},this.getCPU=function(){var et={};return et.architecture=i,Rt.call(et,dr,Kt.cpu),et},this.getDevice=function(){var et={};return et.vendor=i,et.model=i,et.type=i,Rt.call(et,dr,Kt.device),!et.type&&So&&So.mobile&&(et.type=x),et.model=="Macintosh"&&St&&typeof St.standalone!==u&&St.maxTouchPoints&&St.maxTouchPoints>2&&(et.model="iPad",et.type=z),et},this.getEngine=function(){var et={};return et.name=i,et.version=i,Rt.call(et,dr,Kt.engine),et},this.getOS=function(){var et={};return et.name=i,et.version=i,Rt.call(et,dr,Kt.os),!et.name&&So&&So.platform!="Unknown"&&(et.name=So.platform.replace(/chrome os/i,ce).replace(/macos/i,S)),et},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return dr},this.setUA=function(et){return dr=typeof et===h&&et.length>350?Ue(et,350):et,this},this.setUA(dr),this};fi.VERSION="0.7.34",fi.BROWSER=D([_,A,p]),fi.CPU=D([k]),fi.DEVICE=D([m,y,E,L,x,X,z,ie,Ie]),fi.ENGINE=fi.OS=D([_,A]),e.exports&&(t=e.exports=fi),t.UAParser=fi;var Ns=typeof n!==u&&(n.jQuery||n.Zepto);if(Ns&&!Ns.ua){var jc=new fi;Ns.ua=jc.getResult(),Ns.ua.get=function(){return jc.getUA()},Ns.ua.set=function(Ht){jc.setUA(Ht);var nn=jc.getResult();for(var St in nn)Ns.ua[St]=nn[St]}}})(typeof window=="object"?window:c)})(cm,cm.exports);const um=new cm.exports;let dm,Vr,Mo=um.getResult(),lm=null;function at(e){if(!lm){e&&um.setUA(e),Mo=um.getResult();const t=function(u){if(u.engine.name==="Blink"&&u.browser.name!=="WeChat")return ht.CHROME;switch(u.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return ht.CHROME;case"Safari":case"Mobile Safari":return ht.SAFARI;case"Edge":return ht.EDGE;case"Firefox":return ht.FIREFOX;case"QQBrowser":return ht.QQ;case"Opera":return ht.OPERA;case"WeChat":return ht.WECHAT;default:return u.browser.name||""}}(Mo),n=function(u){let d;return d=u.engine.name==="Blink"?u.engine.version||"":u.browser.version||"",d.split(".")[0]}(Mo),i=function(u){switch(u.os.name){case"Windows":return u.os.version?u.os.name+" "+u.os.version:u.os.name;default:return u.os.name||""}}(Mo),s=Mo.os.version;if(!(t&&n&&i&&s))return{name:t,version:n,os:i,osVersion:s};lm={name:t,version:n,os:i,osVersion:s}}return lm}function QR(){return at().os}function $R(){const e=at();return"".concat(e.os," ").concat(e.osVersion)}function Ch(){const e=at();return!!(Mo.engine.name==="WebKit"&&e.os===Ln.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==ht.SAFARI||Zn()&&e.name!==ht.SAFARI)}function K4(){const e=at();if(Ch()){if(e.os===Ln.MAC_OS)return!0;if(e.os===Ln.IOS){const t=Mo.os.version&&Mo.os.version.split(".");if(t&&Number(t[0])===14&&t[1]&&Number(t[1])>=3||t&&Number(t[0])>14)return!0}}return!1}function z4(){return Mo.engine.name==="WebKit"}function hm(){return at().name===ht.CHROME}function $n(){return at().name===ht.SAFARI}function Bt(){return at().name===ht.FIREFOX}function Zn(){return at().os===Ln.IOS}function pm(e){const t=at();return!(t.name!==ht.CHROME||!t.osVersion)&&Number(t.version)>=e}function ZR(e){const t=at();return!(t.name!==ht.EDGE||!t.osVersion)&&Number(t.version)>=e}function eC(e){const t=at();return!(t.name!==ht.OPERA||!t.osVersion)&&Number(t.version)>=e}function tC(){const e=at();return!(e.name!==ht.CHROME||!e.osVersion)&&Number(e.version)<=90}function nC(){const e=at();if(e.os!==Ln.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function pc(){const e=at();if(e.os!==Ln.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function fm(){const e=at();if(e.os!==Ln.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function rC(){const e=at();if(e.os!==Ln.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function ho(){return $n()&&navigator.maxTouchPoints>0}function iC(){return at().name===ht.WECHAT}function oC(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function pa(){const e=at();return e.name===ht.EDGE||e.name===ht.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Ih(){return QR()===Ln.ANDROID}function Xu(){const e=at();return Ih()&&(e.name===ht.CHROME||e.name===ht.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}(function(e){e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY"})(dm||(dm={})),function(e){e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver"}(Vr||(Vr={}));var sC={exports:{}},Y4=sr,q4=Y,aC=Fi.f;Y4({target:"Object",stat:!0,forced:Object.defineProperty!==aC,sham:!q4},{defineProperty:aC});var cC=Cn.Object,J4=sC.exports=function(e,t,n){return cC.defineProperty(e,t,n)};cC.defineProperty.sham&&(J4.sham=!0);var uC=sC.exports;function g(e,t,n){return t in e?uC(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _m,mm={exports:{}},dC=function(e,t){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return e.apply(t,n)}},X4=dC,Em=Object.prototype.toString,vm=(_m=Object.create(null),function(e){var t=Em.call(e);return _m[t]||(_m[t]=t.slice(8,-1).toLowerCase())});function fa(e){return e=e.toLowerCase(),function(t){return vm(t)===e}}function gm(e){return Array.isArray(e)}function Ah(e){return e===void 0}var lC=fa("ArrayBuffer");function hC(e){return e!==null&&typeof e=="object"}function wh(e){if(vm(e)!=="object")return!1;var t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}var Q4=fa("Date"),$4=fa("File"),Z4=fa("Blob"),ej=fa("FileList");function Sm(e){return Em.call(e)==="[object Function]"}var tj=fa("URLSearchParams");function Tm(e,t){if(e!=null)if(typeof e!="object"&&(e=[e]),gm(e))for(var n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.call(null,e[s],s,e)}var ym,nj=(ym=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(e){return ym&&e instanceof ym}),ar={isArray:gm,isArrayBuffer:lC,isBuffer:function(e){return e!==null&&!Ah(e)&&e.constructor!==null&&!Ah(e.constructor)&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)},isFormData:function(e){var t="[object FormData]";return e&&(typeof FormData=="function"&&e instanceof FormData||Em.call(e)===t||Sm(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&lC(e.buffer)},isString:function(e){return typeof e=="string"},isNumber:function(e){return typeof e=="number"},isObject:hC,isPlainObject:wh,isUndefined:Ah,isDate:Q4,isFile:$4,isBlob:Z4,isFunction:Sm,isStream:function(e){return hC(e)&&Sm(e.pipe)},isURLSearchParams:tj,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:Tm,merge:function e(){var t={};function n(u,d){wh(t[d])&&wh(u)?t[d]=e(t[d],u):wh(u)?t[d]=e({},u):gm(u)?t[d]=u.slice():t[d]=u}for(var i=0,s=arguments.length;i<s;i++)Tm(arguments[i],n);return t},extend:function(e,t,n){return Tm(t,function(i,s){e[s]=n&&typeof i=="function"?X4(i,n):i}),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return e.charCodeAt(0)===65279&&(e=e.slice(1)),e},inherits:function(e,t,n,i){e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,n&&Object.assign(e.prototype,n)},toFlatObject:function(e,t,n){var i,s,u,d={};t=t||{};do{for(s=(i=Object.getOwnPropertyNames(e)).length;s-- >0;)d[u=i[s]]||(t[u]=e[u],d[u]=!0);e=Object.getPrototypeOf(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:vm,kindOfTest:fa,endsWith:function(e,t,n){e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;var i=e.indexOf(t,n);return i!==-1&&i===n},toArray:function(e){if(!e)return null;var t=e.length;if(Ah(t))return null;for(var n=new Array(t);t-- >0;)n[t]=e[t];return n},isTypedArray:nj,isFileList:ej},fc=ar;function pC(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var fC=function(e,t,n){if(!t)return e;var i;if(n)i=n(t);else if(fc.isURLSearchParams(t))i=t.toString();else{var s=[];fc.forEach(t,function(d,h){d!=null&&(fc.isArray(d)?h+="[]":d=[d],fc.forEach(d,function(p){fc.isDate(p)?p=p.toISOString():fc.isObject(p)&&(p=JSON.stringify(p)),s.push(pC(h)+"="+pC(p))}))}),i=s.join("&")}if(i){var u=e.indexOf("#");u!==-1&&(e=e.slice(0,u)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e},rj=ar;function Oh(){this.handlers=[]}Oh.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},Oh.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},Oh.prototype.forEach=function(e){rj.forEach(this.handlers,function(t){t!==null&&e(t)})};var ij=Oh,oj=ar,_C=ar;function _c(e,t,n,i,s){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),s&&(this.response=s)}_C.inherits(_c,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var mC=_c.prototype,EC={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(e){EC[e]={value:e}}),Object.defineProperties(_c,EC),Object.defineProperty(mC,"isAxiosError",{value:!0}),_c.from=function(e,t,n,i,s,u){var d=Object.create(mC);return _C.toFlatObject(e,d,function(h){return h!==Error.prototype}),_c.call(d,e.message,t,n,i,s),d.name=e.name,u&&Object.assign(d,u),d};var mc=_c,vC={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Wi=ar,gC=function(e,t){t=t||new FormData;var n=[];function i(s){return s===null?"":Wi.isDate(s)?s.toISOString():Wi.isArrayBuffer(s)||Wi.isTypedArray(s)?typeof Blob=="function"?new Blob([s]):Buffer.from(s):s}return function s(u,d){if(Wi.isPlainObject(u)||Wi.isArray(u)){if(n.indexOf(u)!==-1)throw Error("Circular reference detected in "+d);n.push(u),Wi.forEach(u,function(h,p){if(!Wi.isUndefined(h)){var m,_=d?d+"."+p:p;if(h&&!d&&typeof h=="object"){if(Wi.endsWith(p,"{}"))h=JSON.stringify(h);else if(Wi.endsWith(p,"[]")&&(m=Wi.toArray(h)))return void m.forEach(function(E){!Wi.isUndefined(E)&&t.append(_,i(E))})}s(h,_)}}),n.pop()}else t.append(d,i(u))}(e),t},Rm=mc,bh=ar,sj=bh.isStandardBrowserEnv()?{write:function(e,t,n,i,s,u){var d=[];d.push(e+"="+encodeURIComponent(t)),bh.isNumber(n)&&d.push("expires="+new Date(n).toGMTString()),bh.isString(i)&&d.push("path="+i),bh.isString(s)&&d.push("domain="+s),u===!0&&d.push("secure"),document.cookie=d.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},aj=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},cj=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},SC=function(e,t){return e&&!aj(t)?cj(e,t):t},Cm=ar,uj=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],TC=ar,dj=TC.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(s){var u=s;return t&&(n.setAttribute("href",u),u=n.href),n.setAttribute("href",u),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return e=i(window.location.href),function(s){var u=TC.isString(s)?i(s):s;return u.protocol===e.protocol&&u.host===e.host}}():function(){return!0},Im=mc;function yC(e){Im.call(this,e??"canceled",Im.ERR_CANCELED),this.name="CanceledError"}ar.inherits(yC,Im,{__CANCEL__:!0});var Nh=yC,Qu=ar,lj=function(e,t,n){var i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new Rm("Request failed with status code "+n.status,[Rm.ERR_BAD_REQUEST,Rm.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)},hj=sj,pj=fC,fj=SC,_j=function(e){var t,n,i,s={};return e&&Cm.forEach(e.split(`
`),function(u){if(i=u.indexOf(":"),t=Cm.trim(u.substr(0,i)).toLowerCase(),n=Cm.trim(u.substr(i+1)),t){if(s[t]&&uj.indexOf(t)>=0)return;s[t]=t==="set-cookie"?(s[t]?s[t]:[]).concat([n]):s[t]?s[t]+", "+n:n}}),s},mj=dj,Ej=vC,Uo=mc,vj=Nh,gj=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""},Sj=function(e){return new Promise(function(t,n){var i,s=e.data,u=e.headers,d=e.responseType;function h(){e.cancelToken&&e.cancelToken.unsubscribe(i),e.signal&&e.signal.removeEventListener("abort",i)}Qu.isFormData(s)&&Qu.isStandardBrowserEnv()&&delete u["Content-Type"];var p=new XMLHttpRequest;if(e.auth){var m=e.auth.username||"",_=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";u.Authorization="Basic "+btoa(m+":"+_)}var E=fj(e.baseURL,e.url);function y(){if(p){var L="getAllResponseHeaders"in p?_j(p.getAllResponseHeaders()):null,x={data:d&&d!=="text"&&d!=="json"?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:L,config:e,request:p};lj(function(z){t(z),h()},function(z){n(z),h()},x),p=null}}if(p.open(e.method.toUpperCase(),pj(E,e.params,e.paramsSerializer),!0),p.timeout=e.timeout,"onloadend"in p?p.onloadend=y:p.onreadystatechange=function(){p&&p.readyState===4&&(p.status!==0||p.responseURL&&p.responseURL.indexOf("file:")===0)&&setTimeout(y)},p.onabort=function(){p&&(n(new Uo("Request aborted",Uo.ECONNABORTED,e,p)),p=null)},p.onerror=function(){n(new Uo("Network Error",Uo.ERR_NETWORK,e,p,p)),p=null},p.ontimeout=function(){var L=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",x=e.transitional||Ej;e.timeoutErrorMessage&&(L=e.timeoutErrorMessage),n(new Uo(L,x.clarifyTimeoutError?Uo.ETIMEDOUT:Uo.ECONNABORTED,e,p)),p=null},Qu.isStandardBrowserEnv()){var A=(e.withCredentials||mj(E))&&e.xsrfCookieName?hj.read(e.xsrfCookieName):void 0;A&&(u[e.xsrfHeaderName]=A)}"setRequestHeader"in p&&Qu.forEach(u,function(L,x){s===void 0&&x.toLowerCase()==="content-type"?delete u[x]:p.setRequestHeader(x,L)}),Qu.isUndefined(e.withCredentials)||(p.withCredentials=!!e.withCredentials),d&&d!=="json"&&(p.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&p.addEventListener("progress",e.onDownloadProgress),typeof e.onUploadProgress=="function"&&p.upload&&p.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(i=function(L){p&&(n(!L||L&&L.type?new vj:L),p.abort(),p=null)},e.cancelToken&&e.cancelToken.subscribe(i),e.signal&&(e.signal.aborted?i():e.signal.addEventListener("abort",i))),s||(s=null);var k=gj(E);k&&["http","https","file"].indexOf(k)===-1?n(new Uo("Unsupported protocol "+k+":",Uo.ERR_BAD_REQUEST,e)):p.send(s)})},er=ar,RC=function(e,t){oj.forEach(e,function(n,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[i])})},CC=mc,Tj=gC,yj={"Content-Type":"application/x-www-form-urlencoded"};function IC(e,t){!er.isUndefined(e)&&er.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var AC,Ph={transitional:vC,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(AC=Sj),AC),transformRequest:[function(e,t){if(RC(t,"Accept"),RC(t,"Content-Type"),er.isFormData(e)||er.isArrayBuffer(e)||er.isBuffer(e)||er.isStream(e)||er.isFile(e)||er.isBlob(e))return e;if(er.isArrayBufferView(e))return e.buffer;if(er.isURLSearchParams(e))return IC(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n,i=er.isObject(e),s=t&&t["Content-Type"];if((n=er.isFileList(e))||i&&s==="multipart/form-data"){var u=this.env&&this.env.FormData;return Tj(n?{"files[]":e}:e,u&&new u)}return i||s==="application/json"?(IC(t,"application/json"),function(d,h,p){if(er.isString(d))try{return(h||JSON.parse)(d),er.trim(d)}catch(m){if(m.name!=="SyntaxError")throw m}return(p||JSON.stringify)(d)}(e)):e}],transformResponse:[function(e){var t=this.transitional||Ph.transitional,n=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,s=!n&&this.responseType==="json";if(s||i&&er.isString(e)&&e.length)try{return JSON.parse(e)}catch(u){if(s)throw u.name==="SyntaxError"?CC.from(u,CC.ERR_BAD_RESPONSE,this,null,this.response):u}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:null},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};er.forEach(["delete","get","head"],function(e){Ph.headers[e]={}}),er.forEach(["post","put","patch"],function(e){Ph.headers[e]=er.merge(yj)});var Am=Ph,Rj=ar,Cj=Am,wC=function(e){return!(!e||!e.__CANCEL__)},OC=ar,wm=function(e,t,n){var i=this||Cj;return Rj.forEach(n,function(s){e=s.call(i,e,t)}),e},Ij=wC,Aj=Am,wj=Nh;function Om(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new wj}var ii=ar,bC=function(e,t){t=t||{};var n={};function i(m,_){return ii.isPlainObject(m)&&ii.isPlainObject(_)?ii.merge(m,_):ii.isPlainObject(_)?ii.merge({},_):ii.isArray(_)?_.slice():_}function s(m){return ii.isUndefined(t[m])?ii.isUndefined(e[m])?void 0:i(void 0,e[m]):i(e[m],t[m])}function u(m){if(!ii.isUndefined(t[m]))return i(void 0,t[m])}function d(m){return ii.isUndefined(t[m])?ii.isUndefined(e[m])?void 0:i(void 0,e[m]):i(void 0,t[m])}function h(m){return m in t?i(e[m],t[m]):m in e?i(void 0,e[m]):void 0}var p={url:u,method:u,data:u,baseURL:d,transformRequest:d,transformResponse:d,paramsSerializer:d,timeout:d,timeoutMessage:d,withCredentials:d,adapter:d,responseType:d,xsrfCookieName:d,xsrfHeaderName:d,onUploadProgress:d,onDownloadProgress:d,decompress:d,maxContentLength:d,maxBodyLength:d,beforeRedirect:d,transport:d,httpAgent:d,httpsAgent:d,cancelToken:d,socketPath:d,responseEncoding:d,validateStatus:h};return ii.forEach(Object.keys(e).concat(Object.keys(t)),function(m){var _=p[m]||s,E=_(m);ii.isUndefined(E)&&_!==h||(n[m]=E)}),n},NC="0.27.2",Oj=NC,_s=mc,bm={};["object","boolean","number","function","string","symbol"].forEach(function(e,t){bm[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});var PC={};bm.transitional=function(e,t,n){function i(s,u){return"[Axios v"+Oj+"] Transitional option '"+s+"'"+u+(n?". "+n:"")}return function(s,u,d){if(e===!1)throw new _s(i(u," has been removed"+(t?" in "+t:"")),_s.ERR_DEPRECATED);return t&&!PC[u]&&(PC[u]=!0,console.warn(i(u," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(s,u,d)}};var DC=ar,bj=fC,kC=ij,LC=function(e){return Om(e),e.headers=e.headers||{},e.data=wm.call(e,e.data,e.headers,e.transformRequest),e.headers=OC.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),OC.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||Aj.adapter)(e).then(function(t){return Om(e),t.data=wm.call(e,t.data,t.headers,e.transformResponse),t},function(t){return Ij(t)||(Om(e),t&&t.response&&(t.response.data=wm.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})},Dh=bC,Nj=SC,xC={assertOptions:function(e,t,n){if(typeof e!="object")throw new _s("options must be an object",_s.ERR_BAD_OPTION_VALUE);for(var i=Object.keys(e),s=i.length;s-- >0;){var u=i[s],d=t[u];if(d){var h=e[u],p=h===void 0||d(h,u,e);if(p!==!0)throw new _s("option "+u+" must be "+p,_s.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new _s("Unknown option "+u,_s.ERR_BAD_OPTION)}},validators:bm},Ec=xC.validators;function vc(e){this.defaults=e,this.interceptors={request:new kC,response:new kC}}vc.prototype.request=function(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},(t=Dh(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;n!==void 0&&xC.assertOptions(n,{silentJSONParsing:Ec.transitional(Ec.boolean),forcedJSONParsing:Ec.transitional(Ec.boolean),clarifyTimeoutError:Ec.transitional(Ec.boolean)},!1);var i=[],s=!0;this.interceptors.request.forEach(function(E){typeof E.runWhen=="function"&&E.runWhen(t)===!1||(s=s&&E.synchronous,i.unshift(E.fulfilled,E.rejected))});var u,d=[];if(this.interceptors.response.forEach(function(E){d.push(E.fulfilled,E.rejected)}),!s){var h=[LC,void 0];for(Array.prototype.unshift.apply(h,i),h=h.concat(d),u=Promise.resolve(t);h.length;)u=u.then(h.shift(),h.shift());return u}for(var p=t;i.length;){var m=i.shift(),_=i.shift();try{p=m(p)}catch(E){_(E);break}}try{u=LC(p)}catch(E){return Promise.reject(E)}for(;d.length;)u=u.then(d.shift(),d.shift());return u},vc.prototype.getUri=function(e){e=Dh(this.defaults,e);var t=Nj(e.baseURL,e.url);return bj(t,e.params,e.paramsSerializer)},DC.forEach(["delete","get","head","options"],function(e){vc.prototype[e]=function(t,n){return this.request(Dh(n||{},{method:e,url:t,data:(n||{}).data}))}}),DC.forEach(["post","put","patch"],function(e){function t(n){return function(i,s,u){return this.request(Dh(u||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:s}))}}vc.prototype[e]=t(),vc.prototype[e+"Form"]=t(!0)});var Pj=vc,Dj=Nh;function gc(e){if(typeof e!="function")throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(i){t=i});var n=this;this.promise.then(function(i){if(n._listeners){var s,u=n._listeners.length;for(s=0;s<u;s++)n._listeners[s](i);n._listeners=null}}),this.promise.then=function(i){var s,u=new Promise(function(d){n.subscribe(d),s=d}).then(i);return u.cancel=function(){n.unsubscribe(s)},u},e(function(i){n.reason||(n.reason=new Dj(i),t(n.reason))})}gc.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},gc.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},gc.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}},gc.source=function(){var e;return{token:new gc(function(t){e=t}),cancel:e}};var kj=gc,Lj=ar,MC=ar,xj=dC,kh=Pj,Mj=bC,Br=function e(t){var n=new kh(t),i=xj(kh.prototype.request,n);return MC.extend(i,kh.prototype,n),MC.extend(i,n),i.create=function(s){return e(Mj(t,s))},i}(Am);Br.Axios=kh,Br.CanceledError=Nh,Br.CancelToken=kj,Br.isCancel=wC,Br.VERSION=NC,Br.toFormData=gC,Br.AxiosError=mc,Br.Cancel=Br.CanceledError,Br.all=function(e){return Promise.all(e)},Br.spread=function(e){return function(t){return e.apply(null,t)}},Br.isAxiosError=function(e){return Lj.isObject(e)&&e.isAxiosError===!0},mm.exports=Br,mm.exports.default=Br;var Ri=mm.exports;class Uj{constructor(t){g(this,"logger",void 0),g(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}class jt{constructor(){g(this,"_events",{}),g(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(n=>n.listener):[]}on(t,n){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!1})}once(t,n){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!0})}off(t,n){if(!this._events[t])return;const i=this._events[t],s=this._indexOfListener(i,n);s!==-1&&i.splice(s,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const n=this._events[t].map(d=>d);for(var i=arguments.length,s=new Array(i>1?i-1:0),u=1;u<i;u++)s[u-1]=arguments[u];for(let d=0;d<n.length;d+=1){const h=n[d];h.once&&this.off(t,h.listener),h.listener.apply(this,s||[])}}_indexOfListener(t,n){let i=t.length;for(;i--;)if(t[i].listener===n)return i;return-1}}const Lh=new class extends jt{reportLogUploadError(e){this.emit("REPORT_LOG_UPLOAD",e)}};let P;(function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION"})(P||(P={}));class V extends Error{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(n),g(this,"code",void 0),g(this,"message",void 0),g(this,"data",void 0),g(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=i}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return t==="error"&&I.error(this.toString()),t==="warning"&&I.warning(this.toString()),this}throw(){throw this.print(),this}}const un={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Nm(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function po(e,t,n,i){const s=Object.assign({},un,i);let u=s.timeout;const d=async()=>{await function(m){return new Ee(_=>{window.setTimeout(_,m)})}(u),u*=s.timeoutFactor,u=Math.min(s.maxRetryTimeout,u)};let h=!1;const p=new Ee(async(m,_)=>{t=t||(()=>!1),n=n||(()=>!0);for(let E=0;E<s.maxRetryCount;E+=1){if(h)return _(new V(P.OPERATION_ABORTED));try{const y=await e();if(!t(y,E)||E+1===s.maxRetryCount)return m(y);await d()}catch(y){if(!n(y,E)||E+1===s.maxRetryCount)return _(y);await d()}}});return p.cancel=()=>h=!0,p}function Pm(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function UC(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const oi={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},xh=Date.now(),$u=e=>{for(const t in oi)if(Object.prototype.hasOwnProperty.call(oi,t)&&oi[t]===e)return t;return"DEFAULT"},I=new class{constructor(){g(this,"proxyServerURL",void 0),g(this,"logLevel",oi.DEBUG),g(this,"uploadState","collecting"),g(this,"uploadLogWaitingList",[]),g(this,"uploadLogUploadingList",[]),g(this,"uploadErrorCount",0),g(this,"currentLogID",0),g(this,"url",void 0),g(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[oi.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[oi.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[oi.WARNING].concat(t);this.log.apply(this,i)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[oi.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[oi.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Et("UPLOAD_LOG",!0)}disableLogUpload(){Et("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Uj(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-xh<100)return void setTimeout(()=>{this.log(...t)},Date.now()-xh);const i=Math.max(0,Math.min(4,t[0]));if(t[0]=Pm()+" Agora-SDK [".concat($u(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;const s=Pm()+" %cAgora-SDK [".concat($u(i),"]:");let u=[];if(!H("USE_NEW_LOG"))switch(i){case oi.DEBUG:u=[s,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,u);break;case oi.INFO:u=[s,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,u);break;case oi.WARNING:u=[s,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,u);break;case oi.ERROR:u=[s,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-xh<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-xh);const i=Math.max(0,Math.min(4,t[0]));t[0]=Pm()+" Agora-SDK [".concat($u(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!H("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=UC()+" Agora-SDK [".concat($u(e),"]:"):n[0]=UC()+" Agora-SDK [".concat($u(e),"]:");let s="";n.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),s+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:s,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:si,process_id:H("PROCESS_ID"),payload:JSON.stringify(e)};return po(async()=>{const n=await Ri.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(H("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(H("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>(n.response?Lh.reportLogUploadError({status:n.response.status,data:n.response.data,headers:n.response.headers,message:n.message}):n.request?Lh.reportLogUploadError({status:n.request.status,message:n.message}):Lh.reportLogUploadError({status:-1,message:n.message}),!0),{timeout:H("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:H("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,H("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),H("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),H("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),H("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}},Dm="v4.18.0-0-gcacc234f-dirty(6/21/2023, 3:22:58 PM)",si=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){const i=t[1],s=t[2];return"".concat(i,".").concat(s)}const n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(n&&n[1]&&n[2]){const i=n[1],s=n[2];return"".concat(i,".").concat(100*(Number(s)+1))}return"4.0.0.999"}("4.18.0"),km=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),VC=["CHINA","GLOBAL"],jr=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),s=[];for(let h=0;h<6;h++)s.push("1");const u=s.join(""),d={};return d[e]=i,d[t]=u,Object.assign(d,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=jr;const Vj={"90p":Qe(160,90),"90p_1":Qe(160,90),"120p":Qe(160,120,15,30,65),"120p_1":Qe(160,120,15,30,65),"120p_3":Qe(120,120,15,30,50),"120p_4":Qe(212,120),"180p":Qe(320,180,15,30,140),"180p_1":Qe(320,180,15,30,140),"180p_3":Qe(180,180,15,30,100),"180p_4":Qe(240,180,15,30,120),"240p":Qe(320,240,15,40,200),"240p_1":Qe(320,240,15,40,200),"240p_3":Qe(240,240,15,40,140),"240p_4":Qe(424,240,15,40,220),"360p":Qe(640,360,15,80,400),"360p_1":Qe(640,360,15,80,400),"360p_3":Qe(360,360,15,80,260),"360p_4":Qe(640,360,30,80,600),"360p_6":Qe(360,360,30,80,400),"360p_7":Qe(480,360,15,80,320),"360p_8":Qe(480,360,30,80,490),"360p_9":Qe(640,360,15,80,800),"360p_10":Qe(640,360,24,80,800),"360p_11":Qe(640,360,24,80,1e3),"480p":Qe(640,480,15,100,500),"480p_1":Qe(640,480,15,100,500),"480p_2":Qe(640,480,30,100,1e3),"480p_3":Qe(480,480,15,100,400),"480p_4":Qe(640,480,30,100,750),"480p_6":Qe(480,480,30,100,600),"480p_8":Qe(848,480,15,100,610),"480p_9":Qe(848,480,30,100,930),"480p_10":Qe(640,480,10,100,400),"720p":Qe(1280,720,15,120,1130),"720p_1":Qe(1280,720,15,120,1130),"720p_2":Qe(1280,720,30,120,2e3),"720p_3":Qe(1280,720,30,120,1710),"720p_5":Qe(960,720,15,120,910),"720p_6":Qe(960,720,30,120,1380),"1080p":Qe(1920,1080,15,120,2080),"1080p_1":Qe(1920,1080,15,120,2080),"1080p_2":Qe(1920,1080,30,120,3e3),"1080p_3":Qe(1920,1080,30,120,3150),"1080p_5":Qe(1920,1080,60,120,4780),"1440p":Qe(2560,1440,30,120,4850),"1440p_1":Qe(2560,1440,30,120,4850),"1440p_2":Qe(2560,1440,60,120,7350),"4k":Qe(3840,2160,30,120,8910),"4k_1":Qe(3840,2160,30,120,8910),"4k_3":Qe(3840,2160,60,120,13500)},Bj={"480p":Ci(640,480,5),"480p_1":Ci(640,480,5),"480p_2":Ci(640,480,30),"480p_3":Ci(640,480,15),"720p":Ci(1280,720,5),"720p_1":Ci(1280,720,5),"720p_2":Ci(1280,720,30),"720p_3":Ci(1280,720,15),"1080p":Ci(1920,1080,5),"1080p_1":Ci(1920,1080,5),"1080p_2":Ci(1920,1080,30),"1080p_3":Ci(1920,1080,15)},jj={"1SL1TL":xm(1,1),"3SL3TL":xm(3,3),"2SL3TL":xm(2,3)};function _a(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Vj[e]):e}function Lm(e){return typeof e=="string"?Object.assign({},Bj[e]):e}function Mh(e){return typeof e=="string"?Object.assign({},jj[e]):e}const Fj={speech_low_quality:Sc(16e3,!1),speech_standard:Sc(32e3,!1,18),music_standard:Sc(48e3,!1),standard_stereo:Sc(48e3,!0,56),high_quality:Sc(48e3,!1,128),high_quality_stereo:Sc(48e3,!0,192)};function Uh(e){return typeof e=="string"?Object.assign({},Fj[e]):e}function Et(e,t,n){Object.keys(mr).includes(e)&&(!n&&Object.keys(ma).includes(e)||(mr[e]=t))}function H(e){return mr[e]}const mr={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:VC,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION:2e3,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}},ma={};function Sc(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Qe(e,t,n,i,s){return{width:e,height:t,frameRate:n,bitrateMin:i,bitrateMax:s}}function Ci(e,t,n,i,s){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:i,bitrateMax:s}}function xm(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}km||(mr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],mr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],mr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],mr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],mr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],mr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],mr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",mr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",mr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",mr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",mr.AREAS=["NORTH_AMERICA","OVERSEA"]);const Gj=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Ea=[],Zu=[];function va(e,t){return!!t&&Ea.some(n=>n.uid===e&&n.channelName===t)}var Wj=Gl,Hj=Fi,Kj=He,Mm=function(e,t,n){var i=Wj(t);i in e?Hj.f(e,i,Kj(0,n)):e[i]=n},BC=s_,zj=ds,Yj=Mm,qj=U.Array,Jj=Math.max,jC=function(e,t,n){for(var i=zj(e),s=BC(t,i),u=BC(n===void 0?i:n,i),d=qj(Jj(u-s,0)),h=0;s<u;s++,h++)Yj(d,h,e[s]);return d.length=h,d},FC=jC,Xj=Math.floor,Um=function(e,t){var n=e.length,i=Xj(n/2);return n<8?Qj(e,t):$j(e,Um(FC(e,0,i),t),Um(FC(e,i),t),t)},Qj=function(e,t){for(var n,i,s=e.length,u=1;u<s;){for(i=u,n=e[u];i&&t(e[i-1],n)>0;)e[i]=e[--i];i!==u++&&(e[i]=n)}return e},$j=function(e,t,n,i){for(var s=t.length,u=n.length,d=0,h=0;d<s||h<u;)e[d+h]=d<s&&h<u?i(t[d],n[h])<=0?t[d++]:n[h++]:d<s?t[d++]:n[h++];return e},Zj=Um,GC=ni.match(/firefox\/(\d+)/i),eF=!!GC&&+GC[1],tF=/MSIE|Trident/.test(ni),WC=ni.match(/AppleWebKit\/(\d+)\./),nF=!!WC&&+WC[1],rF=sr,HC=N,iF=ji,oF=us,sF=ds,KC=ic,Vm=l,aF=Zj,cF=t_,zC=eF,uF=tF,YC=yi,qC=nF,ms=[],JC=HC(ms.sort),dF=HC(ms.push),lF=Vm(function(){ms.sort(void 0)}),hF=Vm(function(){ms.sort(null)}),pF=cF("sort"),XC=!Vm(function(){if(YC)return YC<70;if(!(zC&&zC>3)){if(uF)return!0;if(qC)return qC<603;var e,t,n,i,s="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)ms.push({k:t+i,v:n})}for(ms.sort(function(u,d){return d.v-u.v}),i=0;i<ms.length;i++)t=ms[i].k.charAt(0),s.charAt(s.length-1)!==t&&(s+=t);return s!=="DGBEFHACIJK"}});rF({target:"Array",proto:!0,forced:lF||!hF||!pF||!XC},{sort:function(e){e!==void 0&&iF(e);var t=oF(this);if(XC)return e===void 0?JC(t):JC(t,e);var n,i,s=[],u=sF(t);for(i=0;i<u;i++)i in t&&dF(s,t[i]);for(aF(s,function(d){return function(h,p){return p===void 0?-1:h===void 0?1:d!==void 0?+d(h,p)||0:KC(h)>KC(p)?1:-1}}(e)),n=s.length,i=0;i<n;)t[i]=s[i++];for(;i<u;)delete t[i++];return t}});var fF=ls("Array").sort,_F=w,mF=fF,Bm=Array.prototype,jm=function(e){var t=e.sort;return e===Bm||_F(Bm,e)&&t===Bm.sort?mF:t};function ed(e,t){if(typeof e!="boolean")throw new V(P.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function gn(e,t,n){if(!n.includes(e))throw new V(P.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function Ct(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4,s=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e<n||e>i||s&&!EF(e))throw new V(P.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function Fm(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new V(P.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Ct(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Ct(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Ct(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Ct(e.ideal,"".concat(t,".ideal"),1,1/0)}else Ct(e,t,1,1/0)}function xn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,s=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new V(P.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!QC(e,n,i,s))throw new V(P.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(s?" ASCII characters only.":""))}function Vo(e,t){if(!Array.isArray(e))throw new V(P.INVALID_PARAMS,"".concat(t," should be an array"))}function Gm(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw I.error("Invalid Channel Name ".concat(e)),new V(P.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Wm(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||QC(e,1,255)))throw I.error("Invalid UID ".concat(e," ").concat(typeof e)),new V(P.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&I.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function Ot(e){return e==null}function QC(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!i||vF(e))}function EF(e){return typeof e=="number"&&e%1==0}function vF(e){if(typeof e!="string")return!1;for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}let $C,ZC,Mn;(function(e){e.FREE="free",e.UPLOADING="uploading"})($C||($C={})),function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}(ZC||(ZC={})),function(e){e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata"}(Mn||(Mn={}));const Hm={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};function gF(e){return xn(e.reportId,"params.reportId",0,100,!1),xn(e.category,"params.category",0,100,!1),xn(e.event,"params.event",0,100,!1),xn(e.label,"params.label",0,100,!1),Ct(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}const SF={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let wn,Mt,eI,Km,rn,Ut,ga,Bo,Tc,td,Fr,Un,Oe,zm,ct,Xe,cr,ft,Ae,De,br,Ke,tI,Er;function nI(e){return Ct(e.timeout,"config.timeout",0,1e5),Ct(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Ct(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Ct(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function TF(e){return gn(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),gn(e.mode,"config.mode",["rtc","live"]),e.audioCodec!==void 0&&gn(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),e.proxyServer!==void 0&&xn(e.proxyServer,"config.proxyServer",1,1e4),e.turnServer!==void 0&&rI(e.turnServer),e.httpRetryConfig!==void 0&&nI(e.httpRetryConfig),e.websocketRetryConfig!==void 0&&nI(e.websocketRetryConfig),!0}function nd(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function rI(e){return xn(e.turnServerURL,"turnServerURL"),xn(e.username,"username"),xn(e.password,"password"),e.udpport&&Ct(e.udpport,"udpport",1,99999,!0),e.forceturn&&ed(e.forceturn,"forceturn"),e.security&&ed(e.security,"security"),e.tcpport&&Ct(e.tcpport,"tcpport",1,99999,!0),!0}function iI(e){return e.level!==void 0&&gn(e.level,"level",[1,2,3]),!0}(function(e){e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats"})(wn||(wn={})),function(e){e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats"}(Mt||(Mt={})),function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(eI||(eI={})),function(e){e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(Km||(Km={})),function(e){e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.DATACHANNEL_FAILBACK="Client._datachannelFailback",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",e.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage"}(rn||(rn={})),function(e){e.TRACER="tracer"}(Ut||(Ut={})),function(e){e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND"}(ga||(ga={})),function(e){e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(Bo||(Bo={})),function(e){e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(Tc||(Tc={})),function(e){e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(td||(td={})),function(e){e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(Fr||(Fr={})),function(e){e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(Un||(Un={})),function(e){e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Oe||(Oe={})),function(e){e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(zm||(zm={})),function(e){e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.FALLBACK="FALLBACK",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL"}(ct||(ct={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result"}(Xe||(Xe={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(cr||(cr={})),function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed"}(ft||(ft={})),function(e){e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback"}(Ae||(Ae={})),function(e){e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.SUBSCRIBE="subscribe",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter"}(De||(De={})),function(e){e.PUBLISH_STATS="publish_stats",e.PUBLISH_RELATED_STATS="publish_related_stats",e.SUBSCRIBE_STATS="subscribe_stats",e.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.TRANSPORT_STATS="transport_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats"}(br||(br={})),function(e){e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list"}(Ke||(Ke={})),function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.NEED_ANSWER="NEED_ANSWER",e.NEED_RENEGOTIATE="NEED_RENEGOTIATE",e.P2P_LOST="P2P_LOST",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NEED_UNPUB="NEED_UNPUB",e.NEED_UNSUB="NEED_UNSUB",e.NEED_UPLOAD="NEED_UPLOAD",e.NEED_CONTROL="NEED_CONTROL",e.START_RECONNECT="START_RECONNECT",e.END_RECONNECT="END_RECONNECT",e.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(tI||(tI={})),function(e){e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source"}(Er||(Er={}));const Ym={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},qm={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},oI={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},yF={uplinkNetworkQuality:0,downlinkNetworkQuality:0},sI={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Ge,on,Es;(function(e){e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"})(Ge||(Ge={})),function(e){e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming"}(on||(on={})),function(e){e[e.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",e[e.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",e[e.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",e[e.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",e[e.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",e[e.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",e[e.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",e[e.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",e[e.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(Es||(Es={}));const RF={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Jm={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Xm(e,t){xn(e.url,"".concat(t,".url"),1,1e3,!1),Ot(e.x)||Ct(e.x,"".concat(t,".x"),0,1e4),Ot(e.y)||Ct(e.y,"".concat(t,".y"),0,1e4),Ot(e.width)||Ct(e.width,"".concat(t,".width"),0,1e4),Ot(e.height)||Ct(e.height,"".concat(t,".height"),0,1e4),Ot(e.zOrder)||Ct(e.zOrder,"".concat(t,".zOrder"),0,255),Ot(e.alpha)||Ct(e.alpha,"".concat(t,".alpha"),0,1,!1)}const CF={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},IF={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};let Ii,yc,zt,aI,Vn,Hi,tr,vs,sn,Lt,Qt,Vh,Le,dn,Rc,Qm,$m,rd,gs,Cc,$e;function cI(e){if(!e.channelName)throw new V(P.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new V(P.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&xn(e.token,"info.token",1,2047),Wm(e.uid),Gm(e.channelName),!0}function uI(e){return gn(e,"mediaSource",["screen","window","application"]),!0}(function(e){e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(Ii||(Ii={})),function(e){e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(yc||(yc={})),function(e){e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(zt||(zt={})),function(e){e.CONNECT_FAILED="connect failed",e.CONNECT_TIMEOUT="connect timeout",e.WS_DISCONNECTED="websocket disconnected",e.REQUEST_TIMEOUT="request timeout",e.REQUEST_FAILED="request failed",e.WAIT_STATUS_TIMEOUT="wait status timeout",e.WAIT_STATUS_ERROR="wait status error",e.BAD_STATE="bad state",e.WS_ABORT="ws abort",e.AP_REQUEST_TIMEOUT="AP request timeout",e.AP_JSON_PARSE_ERROR="AP json parse error",e.AP_REQUEST_ERROR="AP request error",e.AP_REQUEST_ABORT="AP request abort"}(aI||(aI={})),function(e){e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile"}(Vn||(Vn={})),function(e){e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(Hi||(Hi={})),function(e){e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(tr||(tr={})),function(e){e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(vs||(vs={})),function(e){e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low"}(sn||(sn={})),function(e){e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_FAILBACK="datachannel_failback",e.RESET_SIGNAL="reset-signal"}(Lt||(Lt={})),function(e){e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data"}(Qt||(Qt={})),function(e){e[e.websocket=0]="websocket",e[e.datachannel=1]="datachannel"}(Vh||(Vh={})),function(e){e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track"}(Le||(Le={})),function(e){e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream"}(dn||(dn={})),function(e){e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM"}(Rc||(Rc={})),function(e){e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM"}(Qm||(Qm={})),function(e){e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY"}($m||($m={})),function(e){e.TRANSCEIVER_UPDATED="transceiver-updated"}(rd||(rd={})),function(e){e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed"}(gs||(gs={})),function(e){e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(Cc||(Cc={})),function(e){e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS"}($e||($e={}));const AF=[$e.AFRICA,$e.ASIA,$e.CHINA,$e.EUROPE,$e.GLOBAL,$e.INDIA,$e.JAPAN,$e.NORTH_AMERICA,$e.OCEANIA,$e.OVERSEA,$e.SOUTH_AMERICA];let Sn;(function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL"})(Sn||(Sn={}));const Bh={CHINA:{},ASIA:{CODE:Sn.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Sn.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Sn.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Sn.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Sn.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Sn.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Sn.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Sn.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Sn.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Sn.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Sn.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Sn.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Sn.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};let id,dI,je,On,Ki,Se,ln,Ze,Kn,Ss,Bn,vr,Gr,Wr,an,fo,Ft,zi;km&&(Bh.CHINA={CODE:Sn.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(e){e.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(id||(id={}));class jh extends jt{constructor(t,n){super(),g(this,"onICEConnectionStateChange",void 0),g(this,"onConnectionStateChange",void 0),g(this,"onDTLSTransportStateChange",void 0),g(this,"onDTLSTransportError",void 0),g(this,"onICETransportStateChange",void 0),g(this,"onFirstAudioReceived",void 0),g(this,"onFirstVideoReceived",void 0),g(this,"onFirstAudioDecoded",void 0),g(this,"onFirstVideoDecoded",void 0),g(this,"onFirstVideoDecodedTimeout",void 0),g(this,"onSelectedLocalCandidateChanged",void 0),g(this,"onSelectedRemoteCandidateChanged",void 0),g(this,"establishPromise",void 0)}}(function(e){e.SEND="sendonly",e.RECV="recvonly",e.SENDRECV="sendrecv",e.INACTIVE="inactive"})(dI||(dI={})),function(e){e.VIDEO="video",e.AUDIO="audio"}(je||(je={})),function(e){e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY"}(On||(On={})),function(e){e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(Ki||(Ki={})),function(e){e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack"}(Se||(Se={})),function(e){e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected"}(ln||(ln={})),function(e){e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState"}(Ze||(Ze={})),function(e){e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(Kn||(Kn={})),function(e){e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(Ss||(Ss={})),function(e){e.ON_TRACK="on_track",e.ON_NODE="on_node"}(Bn||(Bn={})),function(e){e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints"}(vr||(vr={})),function(e){e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED"}(Gr||(Gr={})),function(e){e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED"}(Wr||(Wr={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(an||(an={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(fo||(fo={})),function(e){e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback"}(Ft||(Ft={})),function(e){e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.SECURITY_POLICY_VIOLATION="security-policy-violation"}(zi||(zi={}));const zn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1};function Jt(){return zn}let mn;(function(e){e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(mn||(mn={}));var wF=ke,od=Array.isArray||function(e){return wF(e)=="Array"},OF=U,lI=od,bF=O_,NF=_n,PF=kn("species"),hI=OF.Array,DF=function(e){var t;return lI(e)&&(t=e.constructor,(bF(t)&&(t===hI||lI(t.prototype))||NF(t)&&(t=t[PF])===null)&&(t=void 0)),t===void 0?hI:t},pI=function(e,t){return new(DF(e))(t===0?0:t)},kF=Fu,LF=vt,xF=us,MF=ds,UF=pI,fI=N([].push),Ts=function(e){var t=e==1,n=e==2,i=e==3,s=e==4,u=e==6,d=e==7,h=e==5||u;return function(p,m,_,E){for(var y,A,k=xF(p),L=LF(k),x=kF(m,_),z=MF(L),X=0,ie=E||UF,Ie=t?ie(p,z):n||d?ie(p,0):void 0;z>X;X++)if((h||X in L)&&(A=x(y=L[X],X,k),e))if(t)Ie[X]=A;else if(A)switch(e){case 3:return!0;case 5:return y;case 6:return X;case 2:fI(Ie,y)}else switch(e){case 4:return!1;case 7:fI(Ie,y)}return u?-1:i||s?s:Ie}},_I={forEach:Ts(0),map:Ts(1),filter:Ts(2),some:Ts(3),every:Ts(4),find:Ts(5),findIndex:Ts(6),filterReject:Ts(7)},VF=_I.forEach,mI=t_("forEach")?[].forEach:function(e){return VF(this,e,arguments.length>1?arguments[1]:void 0)};sr({target:"Array",proto:!0,forced:[].forEach!=mI},{forEach:mI});var BF=ls("Array").forEach,jF=ps,FF=Or,GF=w,WF=BF,Zm=Array.prototype,HF={DOMTokenList:!0,NodeList:!0},KF=function(e){var t=e.forEach;return e===Zm||GF(Zm,e)&&t===Zm.forEach||FF(HF,jF(e))?WF:t},zF=us,EI=l_;sr({target:"Object",stat:!0,forced:l(function(){EI(1)})},{keys:function(e){return EI(zF(e))}});var YF=Cn.Object.keys,qF=yT,JF=sr,XF=od,QF=N([].reverse),vI=[1,2];JF({target:"Array",proto:!0,forced:String(vI)===String(vI.reverse())},{reverse:function(){return XF(this)&&(this.length=this.length),QF(this)}});var $F=ls("Array").reverse,ZF=w,e3=$F,eE=Array.prototype,t3=function(e){var t=e.reverse;return e===eE||ZF(eE,e)&&t===eE.reverse?e3:t},n3=l,r3=yi,i3=kn("species"),gI=function(e){return r3>=51||!n3(function(){var t=[];return(t.constructor={})[i3]=function(){return{foo:1}},t[e](Boolean).foo!==1})},o3=sr,s3=U,SI=od,a3=O_,c3=_n,TI=s_,u3=ds,d3=Ti,l3=Mm,h3=kn,p3=b_,f3=gI("slice"),_3=h3("species"),tE=s3.Array,m3=Math.max;o3({target:"Array",proto:!0,forced:!f3},{slice:function(e,t){var n,i,s,u=d3(this),d=u3(u),h=TI(e,d),p=TI(t===void 0?d:t,d);if(SI(u)&&(n=u.constructor,(a3(n)&&(n===tE||SI(n.prototype))||c3(n)&&(n=n[_3])===null)&&(n=void 0),n===tE||n===void 0))return p3(u,h,p);for(i=new(n===void 0?tE:n)(m3(p-h,0)),s=0;h<p;h++,s++)h in u&&l3(i,s,u[h]);return i.length=s,i}});var E3=ls("Array").slice,v3=w,g3=E3,nE=Array.prototype,S3=function(e){var t=e.slice;return e===nE||v3(nE,e)&&t===nE.slice?g3:t};function ne(e,t,n,i,s){var u,d,h,p={};return KF(u=YF(i)).call(u,function(m){p[m]=i[m]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=qF(d=t3(h=S3(n).call(n)).call(h)).call(d,function(m,_){return _(e,t,m)||m},p),s&&p.initializer!==void 0&&(p.value=p.initializer?p.initializer.call(s):void 0,p.initializer=void 0),p.initializer===void 0&&(uC(e,t,p),p=null),p}var T3=ls("Array").keys,y3=ps,R3=Or,C3=w,I3=T3,rE=Array.prototype,A3={DOMTokenList:!0,NodeList:!0},Sa=function(e){var t=e.keys;return e===rE||C3(rE,e)&&t===rE.keys||R3(A3,y3(e))?I3:t};function yI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function RI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yI(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yI(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Fh=0,iE=0;function Yi(e,t,n,i){return new Ee((s,u)=>{t.timeout=t.timeout||H("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Fh+=Nc(t.data)):n&&(t.data.size?Fh+=t.data.size:t.data instanceof FormData?Fh+=function(d){let h=0;return/DingTalk/i.test(navigator.userAgent)&&d.realFormData&&(d=d.realFormData),d.forEach(p=>{h+=typeof p=="string"?Nc(p):p.size}),h+138}(t.data):Fh+=Nc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Ri.request(t).then(d=>{typeof d.data=="string"?iE+=Nc(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?iE+=d.data.byteLength:iE+=Nc(JSON.stringify(d.data)),i&&s({data:d.data,headers:d.headers}),s(d.data)}).catch(d=>{Ri.isCancel(d)?u(new V(P.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?u(new V(P.NETWORK_TIMEOUT,d.message)):d.response?u(new V(P.NETWORK_RESPONSE_ERROR,d.response.status)):u(new V(P.NETWORK_ERROR,d.message))})})}async function w3(e,t){const n=new Blob([t.data],{type:"buffer"});return await Yi(e,RI(RI({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const $t=new class extends jt{set networkState(e){I.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+e),this.emit(Ss.NETWORK_STATE_CHANGE,e,this._networkState),e===Kn.ONLINE?this.emit(Ss.ONLINE):e===Kn.OFFLINE&&(this.onlineWaiter=new Ee(t=>{this.once(Ss.ONLINE,()=>{this.onlineWaiter=void 0,t(Kn.ONLINE)})}),this.emit(Ss.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}constructor(){super(),g(this,"_moduleName","network-indicator"),g(this,"_networkState",Kn.ONLINE),g(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Kn.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Kn.OFFLINE})}};let oE=!1;const Hr=new class extends jt{constructor(){super(...arguments),g(this,"onAutoplayFailed",void 0),g(this,"onAudioAutoplayFailed",void 0)}};function CI(){if(at(),!oE){const e=t=>{t.preventDefault(),oE=!1,Xu()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};oE=!0,Xu()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),I.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Hr.onAutoplayFailed?Hr.onAutoplayFailed():Hr.onAudioAutoplayFailed?I.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):I.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Hr.emit("autoplay-failed")}}function sE(e){return new TextEncoder().encode(e)}const II=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},O3=async e=>function(t,n){let i="";return new Uint8Array(t).forEach(s=>{i+=s.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",sE(e)),16);function AI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Fe(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?AI(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AI(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function be(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,i){const s=i.value;if(typeof s=="function"){const u=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);i.value=function(){for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];let m=h;if(e.argsMap)try{m=e.argsMap(this,...h)}catch(E){I.warning(E),m=[]}try{JSON.stringify(m)}catch{I.warning("arguments for method ".concat(u,".").concat(String(n)," not serializable for apiInvoke.")),m=[]}const _=(e.report||we).reportApiInvoke(this._sessionId||null,{name:"".concat(u,".").concat(String(n)),options:m,tag:Ut.TRACER,reportResult:e.reportResult},e.throttleTime);try{const E=s.apply(this,h);return E instanceof Ee?E.then(y=>(_.onSuccess(e.reportResult&&y),y)).catch(y=>{throw _.onError(y),y}):(_.onSuccess(e.reportResult&&E),E)}catch(E){throw _.onError(E),E}}}return i}}const we=new class{constructor(){g(this,"baseInfoMap",new Map),g(this,"proxyServer",void 0),g(this,"clientList",Ea),g(this,"eventUploadTimer",void 0),g(this,"setSessionIdTimer",void 0),g(this,"url",void 0),g(this,"backupUrl",void 0),g(this,"_appId",void 0),g(this,"keyEventUploadPendingItems",[]),g(this,"normalEventUploadPendingItems",[]),g(this,"apiInvokeUploadPendingItems",[]),g(this,"apiInvokeCount",0),g(this,"ltsList",[]),g(this,"lastSendNormalEventTime",Date.now()),g(this,"customReportCounterTimer",void 0),g(this,"customReportCount",0),g(this,"extApiInvoke",async e=>{for(const t of e){const n=Fe(Fe({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Ut.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),H("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),H("EVENT_REPORT_SEND_INTERVAL"))}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void I.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));const t=this.baseInfoMap.get(e),n=Date.now(),i=t.startTime;t.startTime=n,I.debug("rewrite session ".concat(e," startTime: ").concat(n," , ").concat(n-i,"ms")),this.baseInfoMap.set(e,t)}setAppId(e){this._appId=e}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const i=Date.now();this.apiInvokeCount+=1;const s=this.apiInvokeCount,u=()=>({tag:t.tag,invokeId:s,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null}),d=!!H("SHOW_REPORT_INVOKER_LOG");d&&I.info("".concat(t.name," start"),t.options);let h=!1;Fn(t.timeout).then(()=>{h||(this.sendApiInvoke(Fe(Fe({},u()),{},{error:P.API_INVOKE_TIMEOUT,success:!1})),I.debug("".concat(t.name," timeout")))});const p=new V(P.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:m=>{const _=()=>{if(h)throw p;return h=!0,this.sendApiInvoke(Fe(Fe({},u()),{},{success:!0},t.reportResult&&{result:m})),d&&I.info("".concat(t.name," onSuccess")),m};return n?GA(_,t.name+"Success",n,()=>h=!0):_()},onError:m=>{const _=()=>{if(h)throw m;h=!0,this.sendApiInvoke(Fe(Fe({},u()),{},{success:!1,error:m})),d&&I.info("".concat(t.name," onFailure"),m.toString())};return n?GA(_,t.name+"Error",n,()=>h=!0):_()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),i=this.createBaseInfo(e,n);i.cname=t.cname;const s=Object.assign({},{willUploadConsoleLog:H("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:km?"global":"oversea",areas:H("AREAS")&&H("AREAS").join(",")},t.extend),u=Date.now(),d=Fe(Fe({},i),{},{eventType:wn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:Dm,lts:u,elapse:u-n,extend:JSON.stringify(s),mode:t.mode,process:H("PROCESS_ID"),appType:H("APP_TYPE"),success:!0,version:si});this.send({type:Mt.SESSION,data:d},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),u=Fe(Fe({},i),{},{eventType:wn.JOIN_CHOOSE_SERVER,lts:s,eventElapse:s-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:s-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3});this.send({type:Mt.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),u=Fe(Fe({},i),{},{eventType:wn.REQ_USER_ACCOUNT,lts:s,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:s-n.startTime,eventElapse:s-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Mt.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;const s=Date.now(),{firstSuccess:u,avoidJoinStartTime:d,isProxy:h,addr:p}=t,m=s-(u&&d?d:n.startTime),_=Fe(Fe({},i),{},{eventType:wn.JOIN_GATEWAY,lts:s,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:m,eventElapse:s-t.lts,firstSuccess:u,signalChannel:t.signalChannel}),E=_.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=s),u)this.send({type:Mt.JOIN_GATEWAY,data:_},!0);else{let y;if(p)if(h){const k=p.match(/h=(\d{1,3}-){3}\d{1,3}/g),L=p.match(/p=[0-9]{1,6}/g);y={isSuccess:E,gatewayIp:k&&k.length?k[0].split("=")[1].replace(/-/g,"."):"",port:L&&L.length?L[0].split("=")[1]:"",isProxy:h?1:0}}else{const k=p.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),L=p.match(/:[0-9]{1,6}/g);y={isSuccess:E,gatewayIp:k&&k.length?k[0].split("//")[1].replace(/-/g,"."):"",port:L&&L.length?L[0].split(":")[1]:"",isProxy:h?1:0}}else y={isSuccess:E,gatewayIp:"",port:"",isProxy:h?1:0};delete _.success,delete _.eventType,delete _.firstSuccess,_.vid=Number(_.vid);const A=Object.assign({},_,y,{eventType:wn.REJOIN_GATEWAY});this.send({type:Mt.RE_JOIN_GATEWAY,data:A},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=Date.now(),s=Fe(Fe({},n.info),{},{lts:i,timeout:t,elapse:i-n.startTime});this.send({type:Mt.JOIN_CHANNEL_TIMEOUT,data:s},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),u=Fe(Fe({},i),{},{eventType:wn.PUBLISH,lts:s,eventElapse:t.eventElapse,elapse:s-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Mt.PUBLISH,data:u},!0)}subscribe(e,t,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,u=Date.now(),d=Fe(Fe({},s),{},{eventType:wn.SUBSCRIBE,lts:u,eventElapse:t.eventElapse,elapse:u-i.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?d.peerSuid=t.peerid:d.peer=t.peerid,this.send({type:Mt.SUBSCRIBE,data:d},!0)}wsCompressorInit(e){var t;const n=[...Sa(t=this.baseInfoMap).call(t)],i=n.length?n[0]:"UnableToGetSid",s=this.baseInfoMap.get(i);if(!s)return;const u=s.info,d=Date.now(),h=Fe(Fe({},u),{},{eventType:wn.WS_COMPRESSOR_INIT,lts:d,eventElapse:e.eventElapse,elapse:d-s.startTime,status:e.status?1:2});this.send({type:Mt.WS_COMPRESSOR_INIT,data:h},!0)}firstRemoteVideoDecode(e,t,n,i){const s=this.baseInfoMap.get(e);if(!s)return;const u=s.info,d=Date.now(),h=Fe(Fe(Fe({},u),i),{},{elapse:d-s.startTime,eventType:t,lts:d,firstDecodeFrame:Math.max(d-s.startTime,0),apEnd:Math.max(i.apEnd-s.startTime,0),apStart:Math.max(i.apStart-s.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-s.startTime,0),joinGwStart:Math.max(i.joinGwStart-s.startTime,0),pcEnd:Math.max(i.pcEnd-s.startTime,0),pcStart:Math.max(i.pcStart-s.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-s.startTime,0),subscriberStart:Math.max(i.subscriberStart-s.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-s.startTime,0)});this.send({type:n,data:h},!0)}firstRemoteFrame(e,t,n,i){const s=this.baseInfoMap.get(e);if(!s)return;const u=s.info,d=Date.now(),h=Fe(Fe(Fe({},u),i),{},{elapse:d-s.startTime,eventType:t,lts:d});this.send({type:n,data:h},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),u=Fe(Fe(Fe({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:s-n.startTime,eventType:wn.PC_STATS,lts:s});this.send({type:Mt.PC_STATS,data:u},!0)}onGatewayStream(e,t,n,i){const s=this.baseInfoMap.get(e);if(!s)return;const u=s.info,d=Date.now(),h=Fe(Fe(Fe({},u),i),{},{eventType:t,lts:d});this.send({type:n,data:h},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),u=Fe(Fe({},i),{},{eventType:wn.STREAM_SWITCH,lts:s,isDual:t.isdual,elapse:s-n.startTime,success:t.succ});this.send({type:Mt.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),u=Fe(Fe({},i),{},{eventType:wn.REQUEST_PROXY_APPCENTER,lts:s,eventElapse:s-t.lts,elapse:s-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Mt.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),u=Fe(Fe({},i),{},{eventType:wn.REQUEST_PROXY_WORKER_MANAGER,lts:s,eventElapse:s-t.lts,elapse:s-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Mt.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?I.debug("reportProxyServerurl: ".concat(e)):I.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),u=Fe(Fe({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:s,elapse:s-n.startTime,joinChannelSuccessElapse:s-(n.lastJoinSuccessTime||s),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Mt.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now();(function(u,d,h){const p=u[d];if(!p||typeof p!="string")return[u];u[d]="";const m=Nc(JSON.stringify(u));let _=0;const E=[];let y=0;for(let A=0;A<p.length;A++)y+=p.charCodeAt(A)<=127?1:3,y<=h-m||(E[E.length]=Ra(Ra({},u),{},{[d]:p.substring(_,A)}),_=A,y=p.charCodeAt(A)<=127?1:3);return _!==p.length-1&&(E[E.length]=Ra(Ra({},u),{},{[d]:p.substring(_)})),E})(Fe(Fe(Fe({},i),t),{},{elapse:s-n.startTime,lts:s,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:Mt.WORKER_EVENT,data:u},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),u=Fe(Fe(Fe({},i),t),{},{elapse:s-n.startTime,lts:s});this.send({type:Mt.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),u=Fe(Fe(Fe({},i),t),{},{elapse:s-n.startTime,lts:s,extend:t.extend||void 0});this.send({type:Mt.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),u=Fe(Fe(Fe({},i),t),{},{elapse:s-n.startTime,lts:s});this.send({type:Mt.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>H("CUSTOM_REPORT_LIMIT"))throw new V(P.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=t.map(s=>({type:Mt.USER_ANALYTICS,data:Fe(Fe({sid:e},s),{},{lts:n})}));try{H("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(s){throw I.error("send custom report message failed",s.toString()),new V(P.CUSTOM_REPORT_SEND_FAILED,s.message)}}autoplayFailed(e,t,n,i){if(!e)return;const s=this.baseInfoMap.get(e);if(!s)return;const u=s.info,d=Date.now(),h=Fe(Fe({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:d,elapse:d-s.startTime,cbRegistered:Hr.onAutoplayFailed||Hr.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:i,extend:void 0});this.send({type:Mt.AUTOPLAY_FAILED,data:h},!0)}sendApiInvoke(e){const t=H("NOT_REPORT_EVENT");if(e.tag&&t.includes&&t.includes(e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:i,uid:s,cid:u}=n.info;e.lts=e.lts||Date.now();let d;if(e.error)if(e.error instanceof V){const{code:p,message:m}=e.error;d=p||m||e.error.toString()}else d=e.error.toString();const h={invokeId:e.invokeId,sid:e.sid,cname:i,cid:u,uid:s,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?d:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Mt.API_INVOKE,data:h},!1),!0}appendSessionId(){this.clientList.forEach(e=>{if(e._sessionId){const t=this.apiInvokeUploadPendingItems.length;for(let n=0;n<t;n++){const i=this.apiInvokeUploadPendingItems.shift();i&&(i.sid=e._sessionId,this.sendApiInvoke(Object.assign({},i)))}}})}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>H("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],i=[];for(;e.length;){const u=e.shift();n.length<20?n.push(u):i.push(u)}e.push(...i);for(const u of[...n]){var s;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),jm(s=this.ltsList).call(s,(d,h)=>d-h))}return t||(this.lastSendNormalEventTime=Date.now()),H("ENABLE_EVENT_REPORT")&&n.length&&(H("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((u=>d=>{H("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>H("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-H("NORMAL_EVENT_QUEUE_CAPACITY")),I.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){$t.networkState===Kn.OFFLINE&&await Ee.race([$t.onlineWaiter,Fn(2*un.maxRetryTimeout)]);const t=s=>{let u=new Uint8Array;return s.forEach(d=>{const h=sE(JSON.stringify(d.data)),p=new ArrayBuffer(5),m=(E=>{let y=0;return Object.entries(Mt).forEach(A=>{let[k,L]=A;L===E.type&&(y=Km[k])}),y})(d),_=new DataView(p);_.setUint16(0,h.byteLength,!0),_.setUint8(2,255&m),_.setUint8(3,m>>>8&255),_.setUint8(4,m>>>16&255),u=II(u,new Uint8Array(p)),u=II(u,h)}),u},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(H("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(H("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let s=0;s<2;s+=1){s===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(H("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(H("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await Yi(i,{timeout:1e4,data:t(e),headers:Fe(Fe({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(s===1)throw u;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(u=>JSON.stringify(u)),vid:(u=>{const d=u&&u.data.sid&&this.baseInfoMap.get(u.data.sid);return d&&d.info.vid&&+d.info.vid||0})(e[0])};$t.networkState===Kn.OFFLINE&&await Ee.race([$t.onlineWaiter,Fn(2*un.maxRetryTimeout)]);const i=t?"/events/proto-raws":"/events/messages";let s=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(H("EVENT_REPORT_DOMAIN"),"&p=").concat(H("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(H("EVENT_REPORT_DOMAIN"),":").concat(H("STATS_COLLECTOR_PORT")).concat(i));for(let u=0;u<2;u+=1){u===1&&(s=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(H("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(H("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(H("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(H("STATS_COLLECTOR_PORT")).concat(i)));try{t?await w3(s,{timeout:1e4,data:n}):await Yi(s,{timeout:1e4,data:n})}catch(d){if(u===1)throw d;continue}return}}createBaseInfo(e,t){const n=Object.assign({},SF);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),i=n[n.length-1];i&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:i,tag:Ut.TRACER}).onSuccess()}};Lh.on("REPORT_LOG_UPLOAD",e=>{e.networkState=$t.networkState,we.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Ut.TRACER})});class wI extends jt{constructor(t,n){super(),g(this,"trackMediaType",void 0),g(this,"_ID",void 0),g(this,"_rtpTransceiver",void 0),g(this,"_lowRtpTransceiver",void 0),g(this,"_hints",[]),g(this,"_isClosed",!1),g(this,"_originMediaStreamTrack",void 0),g(this,"_mediaStreamTrack",void 0),g(this,"_external",{}),this._ID=n||bt(8,"track-"),this._originMediaStreamTrack=t,this._mediaStreamTrack=t,function(i){Zu.includes(i)||Zu.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){if(!t){const n=we.reportApiInvoke(null,{name:rn.GET_MEDIA_STREAM_TRACK,options:[],tag:Ut.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?n.onSuccess(this._mediaStreamTrack.label):n.onSuccess("")}return this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Rc.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=Zu.indexOf(t);n!==-1&&Zu.splice(n,1)}(this),this.emit(gs.CLOSED)}_updateRtpTransceiver(t,n){if(n===Rc.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(rd.TRANSCEIVER_UPDATED,t,n)}}let En,b3=1;class nr{constructor(t){g(this,"lockingPromise",Ee.resolve()),g(this,"locks",0),g(this,"name",""),g(this,"lockId",void 0),this.lockId=b3++,t&&(this.name=t),I.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(t){let n;this.locks+=1,I.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:""));const i=new Ee(u=>{n=()=>{this.locks-=1,I.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:"")),u()}}),s=this.lockingPromise.then(()=>n);return this.lockingPromise=this.lockingPromise.then(()=>i),s}}function Ic(e,t){return function(n,i,s){const u=s.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const d=this[t];if(!d)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const h=await d.lock("From ".concat(e,".").concat(i));try{for(var p=arguments.length,m=new Array(p),_=0;_<p;_++)m[_]=arguments[_];return await u.apply(this,m)}finally{h()}},s}}class aE extends wI{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}constructor(t,n){super(t,n),g(this,"_enabled",!0),g(this,"_muted",!1),g(this,"_isExternalTrack",!1),g(this,"_isClosed",!1),g(this,"_enabledMutex",void 0),g(this,"processor",void 0),g(this,"_processorContext",void 0),g(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new nr("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,I.debug("[".concat(this.getTrackId(),"] close")),this.emit(Le.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop(),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Wt(this,Le.NEED_REPLACE_TRACK,this),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){I.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(gs.TRACK_ENDED)}stateCheck(t,n){if(I.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),ed(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new V(P.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new V(P.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function OI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}(function(e){e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change"})(En||(En={}));const bI=window.AudioContext||window.webkitAudioContext;let Kr=null;const ut=new class extends jt{constructor(){super(...arguments),g(this,"prevState",void 0),g(this,"curState",void 0),g(this,"currentTime",void 0),g(this,"currentTimeStuckAt",void 0),g(this,"interruptDetectorTrack",void 0),g(this,"onLocalAudioTrackMute",()=>{I.info("ios15-interruption-start"),this.emit(En.IOS_15_16_INTERRUPTION_START)}),g(this,"onLocalAudioTrackUnmute",async()=>{I.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?I.info("ios15-interruption-end-canceled"):(Kr&&await Kr.suspend(),this.emit(En.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){I.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){I.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function N3(){if(!bI)return void I.error("your browser is not support web audio");I.info("create audio context");const e=function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?OI(Object(i),!0).forEach(function(s){g(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):OI(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}({},H("WEBAUDIO_INIT_OPTIONS"));I.debug("audio context init option:",JSON.stringify(e)),Kr=new bI(e),ut.curState=Kr.state,Kr.onstatechange=()=>{ut.prevState=ut.curState,ut.curState=Kr?Kr.state:void 0;const{prevState:t,curState:n}=ut,i=n==="running",s=n==="interrupted",u=t==="running",d=t==="suspended",h=t==="interrupted",p=at().osVersion;(Zn()||ho())&&u&&s&&(I.info("ios".concat(p,"-interruption-start")),ut.emit(En.IOS_INTERRUPTION_START)),(Zn()||ho())&&(d||h)&&i&&(I.info("ios".concat(p,"-interruption-end")),ut.emit(En.IOS_INTERRUPTION_END)),t!==n&&(I.debug("AudioContext State Change","".concat(t,"=>").concat(n)),ut.emit(En.STATE_CHANGE))},setInterval(()=>{var t;const n=(t=Kr)===null||t===void 0?void 0:t.currentTime;ut.currentTime!==n?(ut.currentTimeStuckAt&&(I.debug("AudioContext current time resume at ".concat(n)),ut.currentTimeStuckAt=void 0),ut.currentTime=n):(n!==ut.currentTimeStuckAt&&(we.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Ut.TRACER}).onSuccess(),I.warning("AudioContext current time stuck at ".concat(n))),ut.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,s=!1,u=!1,d=!1;function h(x){t.state==="running"?p(!1):Zn()||ho()?t.state==="suspended"&&(p(!0),x&&t.resume().then(_,_)):t.state!=="closed"&&(p(!0),x&&t.resume().then(_,_))}function p(x){if(s!==x){s=x;for(let z=0,X=n;z<X.length;z+=1){const ie=X[z];x?window.addEventListener(ie,E,{capture:!0,passive:!0}):window.removeEventListener(ie,E,{capture:!0,passive:!0})}}}function m(){h(!0)}function _(){h(!1)}function E(){h(!0)}function y(x){if(!d)if(i.paused)if(x){A(!1),d=!0;let z;try{z=i.play(),z?z.then(k,k):(i.addEventListener("playing",k),i.addEventListener("abort",k),i.addEventListener("error",k))}catch{k()}}else A(!0);else A(!1)}function A(x){if(u!==x){u=x;for(let z=0,X=n;z<X.length;z++){const ie=X[z];x?window.addEventListener(ie,L,{capture:!0,passive:!0}):window.removeEventListener(ie,L,{capture:!0,passive:!0})}}}function k(){i.removeEventListener("playing",k),i.removeEventListener("abort",k),i.removeEventListener("error",k),d=!1,y(!1)}function L(){y(!0)}if(Zn()){const x=t.createMediaStreamDestination(),z=document.createElement("div");z.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=z.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=x.stream,y(!0)}ut.on(En.STATE_CHANGE,m),h(!1)}(Kr)}function Ac(){if(!Kr){if(N3(),!Kr)throw new V(P.NOT_SUPPORTED,"can not create audio context");return Kr}return Kr}function NI(){return!!Kr}function Ta(e){if(function(){if(cE!==null)return cE;const i=Ac(),s=i.createBufferSource(),u=i.createGain(),d=i.createGain();s.connect(u),s.connect(d),s.disconnect(u);let h=!1;try{s.disconnect(u)}catch{h=!0}return s.disconnect(),cE=h,h}())return;const t=e.connect,n=e.disconnect;e.connect=(i,s,u)=>(e._inputNodes||(e._inputNodes=[]),e._inputNodes.includes(i)||(i instanceof AudioNode?(e._inputNodes.push(i),t.call(e,i,s,u)):t.call(e,i,s)),e),e.disconnect=(i,s,u)=>{n.call(e),i?EE(e._inputNodes,i):e._inputNodes=[];for(const d of e._inputNodes)t.call(e,d)}}let cE=null;function PI(e,t){let n=!1;const i=1/t;if(H("DISABLE_WEBAUDIO")){const s=window.setInterval(()=>{n?window.clearInterval(s):e(performance.now()/1e3)},1e3*i)}else{const s=Ac();let u=s.createGain();u.gain.value=0,u.connect(s.destination);const d=()=>{if(n)return void(u=null);const h=s.createOscillator();h.onended=d,h.connect(u),h.start(0),h.stop(s.currentTime+i),e(s.currentTime)};d()}return()=>{n=!0}}class DI{constructor(){g(this,"context",void 0),g(this,"analyserNode",void 0),g(this,"sourceNode",void 0),this.context=Ac(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Zn()||ho()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let s=0;s<t.length;++s)t[s]=i[s]/128-1}const n=hs(t).call(t,(i,s)=>i+s*s,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{I.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class kI extends jt{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),g(this,"outputNode",void 0),g(this,"outputTrack",void 0),g(this,"isPlayed",!1),g(this,"sourceNode",void 0),g(this,"context",void 0),g(this,"audioBufferNode",void 0),g(this,"destNode",void 0),g(this,"audioOutputLevel",0),g(this,"volumeLevelAnalyser",void 0),g(this,"_processedNode",void 0),g(this,"playNode",void 0),g(this,"isDestroyed",!1),g(this,"onNoAudioInput",void 0),g(this,"isNoAudioInput",!1),g(this,"_noAudioInputCount",0),this.context=Ac(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Ta(this.outputNode),this.volumeLevelAnalyser=new DI}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Er.ON_AUDIO_BUFFER,function(i){for(let s=0;s<i.outputBuffer.numberOfChannels;s+=1){const u=i.outputBuffer.getChannelData(s);for(let d=0;d<u.length;d+=1)u[d]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Jt().webAudioMediaStreamDest)throw new V(P.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&Ji(()=>{ut.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Zn()||ho()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let s=!1;for(let u=0;u<i.length;u++)i[u]!==0&&(s=!0);return s?(this.isNoAudioInput=!1,!0):(await Fn(200),await this.checkHasAudioInput(t?t+1:1)&&s)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class uE extends kI{get isFreeze(){return!1}constructor(t,n,i){var s;if(super(),g(this,"sourceNode",void 0),g(this,"track",void 0),g(this,"clonedTrack",void 0),g(this,"audioElement",void 0),g(this,"isCurrentTrackCloned",!1),g(this,"isRemoteTrack",!1),g(this,"originVolumeLevelAnalyser",void 0),g(this,"rebuildWebAudio",async()=>{if(I.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void I.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>I.info("resume success")),I.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const h=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?h.stop():this.isCurrentTrackCloned=!0;const p=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(p),Ta(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const m=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(m,this.context.currentTime),Ta(this.outputNode),this.emit(Er.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=p,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new V(P.UNEXPECTED_ERROR);this.track=t;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(u),Ta(this.sourceNode),i){const h=i.clone();h.enabled=!0,this.clonedTrack=h,I.debug("create an unmuted track ".concat(h.id," from the original track ").concat(i.id," to get the volume"));const p=this.context.createMediaStreamSource(new MediaStream([h]));Ta(p),this.originVolumeLevelAnalyser=new DI,this.originVolumeLevelAnalyser.updateSource(p)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const d=at();n&&d.os===Ln.IOS&&Number((s=d.osVersion)===null||s===void 0?void 0:s.split(".")[0])<15&&(ut.on(En.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(h=>{h||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Ta(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Er.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),ut.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),I.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));Ta(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function LI(e,t){const n=(s,u)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||u:s:u,i={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:n(t.height,1080),maxWidth:n(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function P3(e){const t=await xI(e.mediaSource),n=await function(i){return new Ee((s,u)=>{const d=document.createElement("div");d.innerText="share screen",d.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const h=document.createElement("div");h.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const p=document.createElement("div");p.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",p.setAttribute("style","height: 12%;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const _=document.createElement("div");_.setAttribute("style","text-align: right; padding: 16px 0;");const E=document.createElement("button");E.innerHTML="cancel",E.setAttribute("style","width: 85px;"),E.onclick=()=>{document.body.removeChild(y);const A=new Error("NotAllowedError");A.name="NotAllowedError",u(A)},_.appendChild(E),h.appendChild(p),h.appendChild(m),h.appendChild(_);const y=document.createElement("div");y.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),y.appendChild(d),y.appendChild(h),document.body.appendChild(y),i.map(A=>{if(A.id){const k=document.createElement("div");k.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let L=A.thumbnail;const{width:x}=L.getSize();x>1920&&(L=L.resize({width:1920})),k.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+L.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(A.name.replace(/[\u00A0-\u9999<>\&]/g,function(z){return"&#"+z.charCodeAt(0)+";"})+"</span>"),k.onclick=()=>{document.body.removeChild(y),s(A.id)},m.appendChild(k)}})})}(t);return await LI(n,e)}async function xI(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=MI();if(!n)throw new V(P.ELECTRON_IS_NULL);let i=null;try{var s;i=((s=n.desktopCapturer)===null||s===void 0?void 0:s.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new Ee((u,d)=>{n.desktopCapturer.getSources({types:t},(h,p)=>{h?d(h):u(p)})}));try{return await i}catch(u){throw new V(P.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}let Gh=null;function MI(){if(Gh)return Gh;try{return Gh=window.require("electron"),Gh}catch{return null}}function UI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}const dE=new nr("safari");let VI=!1,BI=!1;async function Ai(e,t){let n=0,i=null;for(;n<2;)try{i=await D3(e,t,n>0);break}catch(s){if(s instanceof V)throw I.error("[".concat(t,"] ").concat(s.toString())),s;const u=Wh(s.name||s.code||s,s.message);if(u.code===P.MEDIA_OPTION_INVALID){I.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await Fn(500);continue}throw I.error("[".concat(t,"] ").concat(u.toString())),u}if(!i)throw new V(P.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function D3(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new V(P.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const i=Jt(),s=new MediaStream;if(e.audioSource&&s.addTrack(e.audioSource),e.videoSource&&s.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return I.debug("Using Video Source/ Audio Source"),s;if(e.screen)if(MI())e.screen.sourceId?wc(s,await LI(e.screen.sourceId,e.screen)):wc(s,await P3(e.screen));else if(hm()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new V(P.NOT_SUPPORTED,"This browser does not support screen sharing");I.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const y=await(d=e.screen.extensionId,h=t,new Ee((A,k)=>{try{chrome.runtime.sendMessage(d,{getStream:!0},L=>{if(!L||!L.streamId)return I.error("[".concat(h,"] No response from Chrome Plugin. Plugin not installed properly"),L),void k(new V(P.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));A(L.streamId)})}catch(L){I.error("[".concat(h,"] AgoraRTC screensharing plugin is not accessible(").concat(d,")"),L.toString()),k(new V(P.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=y,wc(s,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia){var u;e.screen.mediaSource&&uI(e.screen.mediaSource);const y={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:A,surfaceSwitching:k,systemAudio:L}=e.screen,x={selfBrowserSurface:A,surfaceSwitching:k,systemAudio:L};!A&&delete x.selfBrowserSurface,!k&&delete x.surfaceSwitching,!L&&delete x.systemAudio,I.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:y,audio:!!e.screenAudio,controls:x})),wc(s,await navigator.mediaDevices.getDisplayMedia(function(z){for(var X=1;X<arguments.length;X++){var ie=arguments[X]!=null?arguments[X]:{};X%2?UI(Object(ie),!0).forEach(function(Ie){g(z,Ie,ie[Ie])}):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(ie)):UI(Object(ie)).forEach(function(Ie){Object.defineProperty(z,Ie,Object.getOwnPropertyDescriptor(ie,Ie))})}return z}({video:y,audio:!!e.screenAudio},x)))}else{if(!Bt())throw I.error("[".concat(t,"] This browser does not support screenSharing")),new V(P.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&uI(e.screen.mediaSource);const y={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};I.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(y))),wc(s,await navigator.mediaDevices.getUserMedia(y))}}var d,h;if(!e.video&&!e.audio)return s;let p={video:e.video,audio:e.audio},m=H("MEDIA_DEVICE_CONSTRAINTS");if(m)try{typeof m=="string"&&(m=JSON.parse(m)),p=function y(A,k){if(!WA(A)||!WA(k)||Array.isArray(A)&&!Array.isArray(k)||!Array.isArray(A)&&Array.isArray(k))return k;if(Array.isArray(k)&&Array.isArray(A)){const L=[...A];for(let x=0;x<k.length;x++)L[x]=y(A[x],k[x]);return L}{const L=Ra({},A);for(const x in k)Object.prototype.hasOwnProperty.call(k,x)&&(Object.prototype.hasOwnProperty.call(A,x)?L[x]=y(A[x],k[x]):L[x]=k[x]);return L}}(p,m)}catch{}I.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(p)),at();let _,E=null;($n()||Zn()||Ch())&&(E=await dE.lock());try{_=await navigator.mediaDevices.getUserMedia(p)}catch(y){throw E&&E(),y}return p.audio&&(VI=!0),p.video&&(BI=!0),wc(s,_),E&&E(),s}function Wh(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new V(P.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new V(P.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new V(P.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new V(P.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new V(P.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new V(P.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return I.error("getUserMedia unexpected error",e),new V(P.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function wc(e,t){const n=e.getVideoTracks()[0],i=e.getAudioTracks()[0],s=t.getVideoTracks()[0],u=t.getAudioTracks()[0];u&&(i&&e.removeTrack(i),e.addTrack(u)),s&&(n&&e.removeTrack(n),e.addTrack(s))}const zr=new class extends jt{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Bo.STATE_CHANGE,e),this._state=e)}constructor(){super(),g(this,"_state",ga.IDLE),g(this,"isAccessMicrophonePermission",!1),g(this,"isAccessCameraPermission",!1),g(this,"lastAccessMicrophonePermission",!1),g(this,"lastAccessCameraPermission",!1),g(this,"checkdeviceMatched",!1),g(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(H("ENUMERATE_DEVICES_INTERVAL")||(Ih()||QR()===Ln.HARMONY_OS)&&pa())&&this.updateDevicesInfo()},H("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>I.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new V(P.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),s=this.checkMediaDeviceInfoIsOk(i);let u=!this.isAccessMicrophonePermission&&e,d=!this.isAccessCameraPermission&&t;s.audio&&(u=!1),s.video&&(d=!1);let h=null,p=null,m=null;if(!n&&(u||d)){if(dE.isLocked&&(I.debug("[device manager] wait GUM lock"),(await dE.lock())(),I.debug("[device manager] GUM unlock")),VI&&(u=!1,this.isAccessMicrophonePermission=!0),BI&&(d=!1,this.isAccessCameraPermission=!0),I.debug("[device manager] check media device permissions",e,t,u,d),u&&d){try{m=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(_){const E=Wh(_.name||_.code||_,_.message);if(E.code===P.PERMISSION_DENIED)throw E;I.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{h=await navigator.mediaDevices.getUserMedia({audio:e})}catch(_){const E=Wh(_.name||_.code||_,_.message);if(E.code===P.PERMISSION_DENIED)throw E;I.warning("getUserMedia failed in getDevices",E)}this.isAccessMicrophonePermission=!0}else if(d){try{p=await navigator.mediaDevices.getUserMedia({video:t})}catch(_){const E=Wh(_.name||_.code||_,_.message);if(E.code===P.PERMISSION_DENIED)throw E;I.warning("getUserMedia failed in getDevices",E)}this.isAccessCameraPermission=!0}I.debug("[device manager] mic permission",e,"cam permission",t)}try{const _=await navigator.mediaDevices.enumerateDevices();return h&&h.getTracks().forEach(E=>E.stop()),p&&p.getTracks().forEach(E=>E.stop()),m&&m.getTracks().forEach(E=>E.stop()),h=null,p=null,m=null,_}catch(_){return h&&h.getTracks().forEach(E=>E.stop()),p&&p.getTracks().forEach(E=>E.stop()),m&&m.getTracks().forEach(E=>E.stop()),h=null,p=null,m=null,new V(P.ENUMERATE_DEVICES_FAILED,_.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new V(P.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=ga.INITING;try{await this.updateDevicesInfo(),this.state=ga.INITEND}catch(e){throw I.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=ga.IDLE,!function(){return typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1"}()&&new V(P.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const s=e.find(d=>d.kind==="audioinput"&&d.deviceId==="default"),u=e.find(d=>d.kind==="audiooutput"&&d.deviceId==="default");s&&u?u.groupId===s.groupId?I.debug("[device-check] default input ".concat(s.label," and output ").concat(u.label," is the same group")):I.warning("[device-check] default input ".concat(s.label," and output ").concat(u.label," is not the same group")):I.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(s=>{if(!s.deviceId)return;const u=this.deviceInfoMap.get("".concat(s.kind,"_").concat(s.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const d={initAt:t,updateAt:t,device:s,state:"ACTIVE"};this.deviceInfoMap.set("".concat(s.kind,"_").concat(s.deviceId),d),n.push(d)}u&&(u.updateAt=t)}),this.deviceInfoMap.forEach((s,u)=>{s.state==="ACTIVE"&&s.updateAt!==t&&(s.state="INACTIVE",n.push(s))}),this.state!==ga.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(s=>{switch(s.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Bo.RECORDING_DEVICE_CHANGED,s);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Bo.CAMERA_DEVICE_CHANGED,s);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Bo.PLAYOUT_DEVICE_CHANGED,s)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(s=>s.kind==="audioinput"),n=e.filter(s=>s.kind==="videoinput"),i={audio:!1,video:!1};for(const s of t)if(s.label&&s.deviceId){i.audio=!0;break}for(const s of n)if(s.label&&s.deviceId){i.video=!0;break}return i}},k3=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Nr=new class{constructor(){g(this,"onAutoplayFailed",void 0),g(this,"elementMap",new Map),g(this,"elementStateMap",new Map),g(this,"elementsNeedToResume",[]),g(this,"sinkIdMap",new Map),g(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const i=this.elementStateMap.get(t),s=n.srcObject.getAudioTracks()[0];pc()?s&&s.readyState==="live"&&ut.curState==="running"&&(I.debug("auto resume after interruption for iOS 15"),n.pause(),n.play()):i&&i==="paused"&&s&&s.readyState==="live"&&ut.curState==="running"&&(I.debug("auto resume after interruption for iOS"),n.play())})}),g(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(I.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),ut.on(En.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ut.on(En.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),ut.on(En.STATE_CHANGE,()=>{Zn()&&ut.prevState==="suspended"&&ut.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(i){throw new V(P.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(e,t,n,i){if(this.elementMap.has(t))return;const s=document.createElement("audio");s.autoplay=!0,s.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,s),this.elementMap.set(t,s),this.elementStateMap.set(t,Mn.INIT),this.setVolume(t,n);const u=this.sinkIdMap.get(t);if(u)try{s.setSinkId(u).catch(h=>{I.warning("[".concat(t,"] set sink id failed"),h.toString())})}catch(h){I.warning("[".concat(t,"] set sink id failed"),h.toString())}const d=s.play();d&&d.then&&d.catch(h=>{i&&we.autoplayFailed(i,"audio",h.message,t),I.warning("audio element play warning",h.toString()),this.elementMap.has(t)&&h.name==="NotAllowedError"&&(I.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(s),Ji(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),CI()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){k3.forEach(n=>{t.addEventListener(n,i=>{const s=this.elementStateMap.get(e),u=i.type==="pause"?"paused":i.type;if(I.debug("[".concat(e,"] audio-element-status change ").concat(s," => ").concat(u)),i.type==="error"){const d=t==null?void 0:t.error;d&&I.error("[".concat(e,"] media error, code: ").concat(d.code,", message: ").concat(d.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{I.debug("Auto resume audio element success")}).catch(n=>{I.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new Ee(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Xu()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Gt(){return function(e,t,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new V(P.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");for(var s=arguments.length,u=new Array(s),d=0;d<s;d++)u[d]=arguments[d];const h=i.apply(this,u);return h instanceof Ee?new Ee((p,m)=>{h.then(p).catch(m)}):h}),n}}var L3=ls("Array").values,x3=ps,M3=Or,U3=w,V3=L3,lE=Array.prototype,B3={DOMTokenList:!0,NodeList:!0},_o=function(e){var t=e.values;return e===lE||U3(lE,e)&&t===lE.values||M3(B3,x3(e))?V3:t};function jI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Hh(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?jI(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jI(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class FI extends jt{constructor(t){super(),g(this,"name","VideoProcessorDestination"),g(this,"ID","0"),g(this,"_source",void 0),g(this,"videoContext",void 0),g(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new V(P.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new V(P.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(Bn.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Bn.ON_TRACK,void 0)}}class GI extends jt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),g(this,"constraintsMap",new Map),g(this,"statsRegistry",[]),g(this,"usageRegistry",[]),g(this,"trackId",void 0),g(this,"direction",void 0),g(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await Gn(this,vr.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var i;return I.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Wt(this,vr.REQUEST_UPDATE_CONSTRAINTS,Array.from(_o(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return I.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),Wt(this,vr.REQUEST_UPDATE_CONSTRAINTS,Array.from(_o(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:s,cb:u}of this.statsRegistry)try{const d=u();t.push({processorID:n,processorName:i,type:s,stats:d})}catch(d){I.error(new V(P.UNEXPECTED_ERROR,d.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof Ee&&(i=await i),t.push(Hh(Hh({},i),{},{direction:this.direction}))}catch(i){I.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class WI extends jt{constructor(t){super(),g(this,"name","AudioProcessorDestination"),g(this,"ID","0"),g(this,"inputTrack",void 0),g(this,"inputNode",void 0),g(this,"audioProcessorContext",void 0),g(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new V(P.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new V(P.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Bn.ON_TRACK,void 0),this.emit(Bn.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(Bn.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(Bn.ON_NODE,this.inputNode))}}class HI extends jt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,i){super(),g(this,"constraintsMap",new Map),g(this,"statsRegistry",[]),g(this,"audioContext",void 0),g(this,"trackId",void 0),g(this,"direction",void 0),g(this,"usageRegistry",[]),g(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=i}async getConstraints(){return Gn(this,vr.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var i;return I.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Wt(this,vr.REQUEST_UPDATE_CONSTRAINTS,Array.from(_o(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),Wt(this,vr.REQUEST_UPDATE_CONSTRAINTS,Array.from(_o(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:s,cb:u}of this.statsRegistry)try{const d=u();t.push({processorID:n,processorName:i,type:s,stats:d})}catch(d){I.error(new V(P.UNEXPECTED_ERROR,d.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof Ee&&(i=await i),t.push(Hh(Hh({},i),{},{direction:this.direction}))}catch(i){I.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class hE extends jt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),g(this,"context",void 0),g(this,"processSourceNode",void 0),g(this,"outputTrack",void 0),g(this,"processedNode",void 0),g(this,"clonedTrack",void 0),g(this,"outputNode",void 0),this.outputNode=new j3}setVolume(){}createOutputTrack(){throw new V(P.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class j3{disconnect(){}connect(){}}let Kh,Oc=null;class F3{constructor(){g(this,"state","open"),g(this,"trigger",void 0),g(this,"tasks",[]),I.debug("[macro-task-queue] is created."),this.trigger=setTimeout(()=>{this.state="closed",I.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(t=>t.key),"]")),this.trigger=void 0,this.tasks.forEach(t=>{let{func:n}=t;return n()}),this.tasks.length=0,I.debug("[macro-task-queue] is closed.")})}enqueue(t,n){this.state!=="closed"&&(this.tasks.push({key:t,func:n}),I.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat(typeof t=="string"?t:"")))}runTask(t){if(this.state==="closed")return;const n=this.tasks.findIndex(i=>i.key===t);if(n!==-1){const i=this.tasks.splice(n,1);I.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat(typeof t=="string"?t:"")),i[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,I.debug("[macro-task-queue] is closed."))}}function pE(e){return function(t,n,i){var s;const u=(s=i.value)!==null&&s!==void 0?s:i.get,d=function(){Oc&&Oc.state==="open"&&Oc.runTask(e);for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return u==null?void 0:u.apply(this,...p)};return i.value?i.value=d:i.get=d,i}}var KI,zI,YI,qI,JI,XI,QI,$I,ZI,eA,tA,nA,rA,iA,oA,sA,aA,cA,uA,dA,lA,dt,hA,pA,fA,_A,mA,EA,mo,vA,gA,SA,TA,yA,RA,CA,IA,AA,wA,OA,bA,Yn;function NA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function fE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?NA(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})(Kh||(Kh={}));let jn=(KI=pE("INIT_WEBAUDIO"),zI=pE("INIT_WEBAUDIO"),YI=pE("INIT_WEBAUDIO"),qI=be({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),JI=be({argsMap:(e,t)=>[e.getTrackId(),t]}),XI=Gt(),QI=Ic("LocalAudioTrack","_enabledMutex"),$I=be({argsMap:(e,t)=>[e.getTrackId(),t]}),ZI=Gt(),eA=Ic("LocalAudioTrack","_enabledMutex"),tA=be({argsMap:(e,t)=>[e.getTrackId(),t]}),nA=Gt(),rA=Gt(),iA=Gt(),oA=be({argsMap:e=>[e.getTrackId()]}),sA=Gt(),aA=be({argsMap:e=>[e.getTrackId()]}),cA=Gt(),uA=be({argsMap:e=>[e.getTrackId()]}),dA=be({argsMap:(e,t)=>[e.getTrackId(),t.name]}),lA=be({argsMap:e=>[e.getTrackId()]}),ne((dt=class extends aE{get _source(){return this._trackSource}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get processorDestination(){return this._processorDestination}set processorDestination(e){this._processorDestination=e}get isPlaying(){return this._useAudioElement?Nr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,i,s){super(e,n),g(this,"trackMediaType","audio"),g(this,"_encoderConfig",void 0),g(this,"_trackSource",void 0),g(this,"_enabled",!0),g(this,"_volume",100),g(this,"_useAudioElement",!1),g(this,"_bypassWebAudio",!1),g(this,"processor",void 0),g(this,"_processorContext",void 0),g(this,"_processorDestination",void 0),g(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i;const u=()=>{this.processorContext=new HI(this._source.context,this.getTrackId(),"local"),this.processorDestination=new WI(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Er.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},d=s&&$n()&&!NI();H("DISABLE_WEBAUDIO")?(this._source=new hE,this._useAudioElement=!0,this._bypassWebAudio=!0):d?this._source=new hE:(this._source=new uE(e,!1,this._getOriginVolumeLevel?e:void 0),H("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),u(),!H("DISABLE_WEBAUDIO")&&d&&(Oc||(Oc=new F3),Oc).enqueue("INIT_WEBAUDIO",()=>{this._source=new uE(e,!1,this._getOriginVolumeLevel?e:void 0),H("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),u(),this.emit(Kh.UPDATE_TRACK_SOURCE)})}setVolume(e){Ct(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Nr.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void I.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,Wt(this,Le.NEED_REPLACE_TRACK,this).then(()=>{I.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{I.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement)throw new V(P.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Nr.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(I.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Wt(this,Le.NEED_ENABLE_TRACK,this),I.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(i){throw n||(this._enabled=!1),I.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Wt(this,Le.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),I.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,I.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Wt(this,Le.NEED_MUTE_TRACK,this):await Wt(this,Le.NEED_UNMUTE_TRACK,this))}getStats(){return sd(()=>{I.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),qi(this,Le.GET_STATS)||fE({},Ym)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Er.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Er.ON_AUDIO_BUFFER),this._source.on(Er.ON_AUDIO_BUFFER,n=>e(n))}play(){I.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(I.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Nr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){I.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Nr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];I.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Nr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e.addEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:e,context:this.processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Wt(this,Le.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Ee.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new V(P.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new V(P.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Bn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await Wt(this,Le.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Wt(this,Le.NEED_REPLACE_TRACK,this))}),this.processorDestination.on(Bn.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Bn.ON_TRACK),this.processorDestination.removeAllListeners(Bn.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(vr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(vr.REQUEST_CONSTRAINTS)}}).prototype,"_source",[KI],Object.getOwnPropertyDescriptor(dt.prototype,"_source"),dt.prototype),ne(dt.prototype,"processorContext",[zI],Object.getOwnPropertyDescriptor(dt.prototype,"processorContext"),dt.prototype),ne(dt.prototype,"processorDestination",[YI],Object.getOwnPropertyDescriptor(dt.prototype,"processorDestination"),dt.prototype),ne(dt.prototype,"setVolume",[qI],Object.getOwnPropertyDescriptor(dt.prototype,"setVolume"),dt.prototype),ne(dt.prototype,"setPlaybackDevice",[JI,XI],Object.getOwnPropertyDescriptor(dt.prototype,"setPlaybackDevice"),dt.prototype),ne(dt.prototype,"setEnabled",[QI,$I,ZI],Object.getOwnPropertyDescriptor(dt.prototype,"setEnabled"),dt.prototype),ne(dt.prototype,"setMuted",[eA,tA,nA],Object.getOwnPropertyDescriptor(dt.prototype,"setMuted"),dt.prototype),ne(dt.prototype,"getStats",[rA],Object.getOwnPropertyDescriptor(dt.prototype,"getStats"),dt.prototype),ne(dt.prototype,"setAudioFrameCallback",[iA],Object.getOwnPropertyDescriptor(dt.prototype,"setAudioFrameCallback"),dt.prototype),ne(dt.prototype,"play",[oA,sA],Object.getOwnPropertyDescriptor(dt.prototype,"play"),dt.prototype),ne(dt.prototype,"stop",[aA,cA],Object.getOwnPropertyDescriptor(dt.prototype,"stop"),dt.prototype),ne(dt.prototype,"close",[uA],Object.getOwnPropertyDescriptor(dt.prototype,"close"),dt.prototype),ne(dt.prototype,"pipe",[dA],Object.getOwnPropertyDescriptor(dt.prototype,"pipe"),dt.prototype),ne(dt.prototype,"unpipe",[lA],Object.getOwnPropertyDescriptor(dt.prototype,"unpipe"),dt.prototype),dt),zh=(hA=be({argsMap:(e,t)=>[e.getTrackId(),t]}),pA=Gt(),fA=Ic("MicrophoneAudioTrack","_enabledMutex"),_A=be({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),mA=Gt(),EA=be({argsMap:e=>[e.getTrackId()]}),ne((mo=class extends jn{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,i){super(e,t.encoderConfig?Uh(t.encoderConfig):{},i,H("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),g(this,"_config",void 0),g(this,"_deviceName","default"),g(this,"_constraints",void 0),g(this,"_originalConstraints",void 0),g(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(pc()||fm())&&ut.bindInterruptDetectorTrack(this),this.on(Kh.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),NI()&&this.bindProcessorContextEvents()}async setDevice(e){if(I.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await zr.getDeviceById(e),n={};n.audio=fE({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await Ai(n,this.getTrackId())}catch(s){throw I.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),i=await Ai({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw I.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await zr.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw I.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}I.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return I.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(I.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await Wt(this,Le.NEED_DISABLE_TRACK,this)}catch(d){throw I.error("[".concat(this.getTrackId(),"] setEnabled false failed"),d.toString()),d}return}const s=fE({},this._constraints),u=zr.searchDeviceIdByName(this._deviceName);u&&!s.deviceId&&(s.deviceId=u);try{n||(this._enabled=!0);const d=await Ai({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),await Wt(this,Le.NEED_ENABLE_TRACK,this)}catch(d){throw n||(this._enabled=!1),I.error("[".concat(this.getTrackId(),"] setEnabled true failed"),d.toString()),d}I.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(pc()||fm())&&ut.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Zn()||ho())&&this._enabled&&!this._isClosed&&ut.duringInterruption){const e=async()=>{ut.off(En.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(I.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ut.on(En.IOS_INTERRUPTION_END,e)}else I.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(gs.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=zr.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const i=await Ai({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(){this.processorContext.on(vr.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{const i=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(i),t()}catch(i){n(i)}}),this.processorContext.on(vr.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[hA,pA],Object.getOwnPropertyDescriptor(mo.prototype,"setDevice"),mo.prototype),ne(mo.prototype,"setEnabled",[fA,_A,mA],Object.getOwnPropertyDescriptor(mo.prototype,"setEnabled"),mo.prototype),ne(mo.prototype,"close",[EA],Object.getOwnPropertyDescriptor(mo.prototype,"close"),mo.prototype),mo),G3=(vA=be({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),gA=Gt(),SA=be({argsMap:e=>[e.getTrackId()]}),TA=Gt(),yA=be({argsMap:e=>[e.getTrackId()]}),RA=Gt(),CA=be({argsMap:e=>[e.getTrackId()]}),IA=Gt(),AA=be({argsMap:e=>[e.getTrackId()]}),wA=Gt(),OA=be({argsMap:e=>[e.getTrackId()]}),bA=Gt(),ne((Yn=class extends jn{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,i){super(t.createOutputTrack(),n,i),g(this,"source",void 0),g(this,"_bufferSource",void 0),this.source=e,this._bufferSource=t,this._bufferSource.on(Er.AUDIO_SOURCE_STATE_CHANGE,s=>{this.emit(gs.SOURCE_STATE_CHANGE,s)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}setAudioBufferPlaybackSpeed(e){Ct(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[vA,gA],Object.getOwnPropertyDescriptor(Yn.prototype,"startProcessAudioBuffer"),Yn.prototype),ne(Yn.prototype,"pauseProcessAudioBuffer",[SA,TA],Object.getOwnPropertyDescriptor(Yn.prototype,"pauseProcessAudioBuffer"),Yn.prototype),ne(Yn.prototype,"seekAudioBuffer",[yA,RA],Object.getOwnPropertyDescriptor(Yn.prototype,"seekAudioBuffer"),Yn.prototype),ne(Yn.prototype,"resumeProcessAudioBuffer",[CA,IA],Object.getOwnPropertyDescriptor(Yn.prototype,"resumeProcessAudioBuffer"),Yn.prototype),ne(Yn.prototype,"stopProcessAudioBuffer",[AA,wA],Object.getOwnPropertyDescriptor(Yn.prototype,"stopProcessAudioBuffer"),Yn.prototype),ne(Yn.prototype,"setAudioBufferPlaybackSpeed",[OA,bA],Object.getOwnPropertyDescriptor(Yn.prototype,"setAudioBufferPlaybackSpeed"),Yn.prototype),Yn);class gr extends jn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Ac().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,bt(8,"track-mix-")),g(this,"trackList",void 0),g(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(I.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):I.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){I.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}EE(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof gr?n.emit(rd.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class W3 extends jt{constructor(){super(...arguments),g(this,"resultStorage",new Map)}setLocalAudioStats(t,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(t,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i))}setRemoteAudioStats(t,n){const i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(t,n,i){this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const s=this.resultStorage.get(t);if(s&&(s.result.push(i),s.result.length>=5)){const u=s.result.includes(!0);s.isPrevNormal&&!u&&this.emit("exception",PA[t],t,n),!s.isPrevNormal&&u&&this.emit("exception",PA[t]+2e3,t+"_RECOVER",n),s.isPrevNormal=u,s.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof gr&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=Fo(n._encoderConfig.frameRate));const s=t.captureFrameRate;return!i||!s||!(i>10&&s<5||i<10&&i>=5&&s<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof gr&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const PA={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},ai=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function DA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function ya(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?DA(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class bc{constructor(t){g(this,"store",void 0),g(this,"onStatsException",void 0),g(this,"onUploadPublishDuration",void 0),g(this,"onStatsChanged",void 0),g(this,"localStats",new Map),g(this,"remoteStats",new Map),g(this,"updateStatsInterval",void 0),g(this,"trafficStats",void 0),g(this,"trafficStatsPeerList",[]),g(this,"uplinkStats",void 0),g(this,"exceptionMonitor",void 0),g(this,"p2pChannel",void 0),g(this,"scalabilityMode",dm.L1T1),g(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new W3,this.exceptionMonitor.on("exception",(n,i,s)=>{this.onStatsException&&this.onStatsException(n,i,s)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Se.LocalAudioTrack)||ya({},Ym)}getLocalVideoTrackStats(){return this.localStats.get(Se.LocalVideoTrack)||ya({},qm)}getRemoteAudioTrackStats(t){const n=(u,d)=>{if(!this.trafficStats)return d;const h=this.trafficStats.peer_delay.find(p=>p.peer_uid===u);return h&&(d.publishDuration=h.B_ppad+(Date.now()-this.trafficStats.timestamp)),d},i={};if(t){var s;const u=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.audioStats;u&&(i[t]=n(t,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[d,{audioStats:h}]=u;h&&(i[d]=n(d,h))});return i}getRemoteNetworkQualityStats(t){const n={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;s&&(n[t]=s)}else Array.from(this.remoteStats.entries()).forEach(s=>{let[u,{networkStats:d}]=s;d&&(n[u]=d)});return n}getRemoteVideoTrackStats(t){const n=(u,d)=>{if(!this.trafficStats)return d;const h=this.trafficStats.peer_delay.find(p=>p.peer_uid===u);return h&&(d.publishDuration=h.B_ppvd+(Date.now()-this.trafficStats.timestamp)),d},i={};if(t){var s;const u=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.videoStats;u&&(i[t]=n(t,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[d,{videoStats:h}]=u;h&&(i[d]=n(d,h))});return i}getRTCStats(){let t=0,n=0,i=0,s=0;const u=this.localStats.get(Se.LocalAudioTrack);u&&(t+=u.sendBytes,n+=u.sendBitrate);const d=this.localStats.get(Se.LocalVideoTrack);d&&(t+=d.sendBytes,n+=d.sendBitrate);const h=this.localStats.get(Se.LocalVideoLowTrack);h&&(t+=h.sendBytes,n+=h.sendBitrate),this.remoteStats.forEach(m=>{let{audioStats:_,videoStats:E}=m;_&&(i+=_.receiveBytes,s+=_.receiveBitrate),E&&(i+=E.receiveBytes,s+=E.receiveBitrate)});let p=1;return this.trafficStats&&(p+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:p,SendBitrate:n,SendBytes:t,RecvBytes:i,RecvBitrate:s,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const s=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),u=s!=null&&s.videoSSRC?ai.measureFromSubscribeStart(this.store.clientId,s.videoSSRC):0,d=s!=null&&s.audioSSRC?ai.measureFromSubscribeStart(this.store.clientId,s.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,u>d?u:d),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&I.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,i){if(!t)return!1;const s=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,u=!i||n.framesDecodeCount>i.framesDecodeCount;return s||!u}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[i,s]=n;switch(i){case Se.LocalVideoTrack:case Se.LocalVideoLowTrack:{const d=s,h=ya({},qm),p=t.getStats(),m=t.getLocalMedia(i);if(p){const _=p.videoSend.find(E=>E.ssrc===(m==null?void 0:m.ssrcs[0].ssrcId));if(_){const E=t.getLocalVideoSize(),y=t.getEncoderConfig(Se.LocalVideoTrack);_.codec!=="H264"&&_.codec!=="H265"&&_.codec!=="VP8"&&_.codec!=="VP9"&&_.codec!=="AV1X"&&_.codec!=="AV1"||(h.codecType=_.codec),h.sendBytes=_.bytes,h.sendBitrate=d?8*Math.max(0,h.sendBytes-d.sendBytes):0,_.inputFrame?(h.captureFrameRate=_.inputFrame.frameRate,h.captureResolutionHeight=_.inputFrame.height,h.captureResolutionWidth=_.inputFrame.width):E&&(h.captureResolutionWidth=E.width,h.captureResolutionHeight=E.height),_.sentFrame?(h.sendFrameRate=_.sentFrame.frameRate,h.sendResolutionHeight=_.sentFrame.height,h.sendResolutionWidth=_.sentFrame.width):E&&(h.sendResolutionWidth=E.width,h.sendResolutionHeight=E.height),_.avgEncodeMs&&(h.encodeDelay=_.avgEncodeMs),y&&y.bitrateMax&&(h.targetSendBitrate=1e3*y.bitrateMax),h.sendPackets=_.packets,h.sendPacketsLost=_.packetsLost,h.totalDuration=d?d.totalDuration+1:1,h.totalFreezeTime=d?d.totalFreezeTime:0,this.isLocalVideoFreeze(_)&&(h.totalFreezeTime+=1),_.scalabilityMode&&this.scalabilityMode!==_.scalabilityMode&&(I.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(_.scalabilityMode)),this.scalabilityMode=_.scalabilityMode)}this.trafficStats&&(h.sendPacketsLost=this.trafficStats.B_pvlr4/100)}var u;this.localStats.set(i,h),((d==null?void 0:d.sendResolutionWidth)!==h.sendResolutionWidth||(d==null?void 0:d.sendResolutionHeight)!==h.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:h.sendResolutionWidth,height:h.sendResolutionHeight})),h&&m&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,m.track,h);break}case Se.LocalAudioTrack:{const d=s,h=ya({},Ym),p=t.getStats(),m=t.getLocalMedia(i);if(p){const _=p.audioSend.find(E=>E.ssrc===(m==null?void 0:m.ssrcs[0].ssrcId));if(_){if(_.codec!=="opus"&&_.codec!=="aac"&&_.codec!=="PCMU"&&_.codec!=="PCMA"&&_.codec!=="G722"||(h.codecType=_.codec),_.inputLevel)h.sendVolumeLevel=Math.round(32767*_.inputLevel);else{const E=t.getLocalAudioVolume();E&&(h.sendVolumeLevel=Math.round(32767*E))}h.sendBytes=_.bytes,h.sendPackets=_.packets,h.sendPacketsLost=_.packetsLost,h.sendBitrate=d?8*Math.max(0,h.sendBytes-d.sendBytes):0}}this.trafficStats&&(h.sendPacketsLost=this.trafficStats.B_pvlr4/100),this.localStats.set(Se.LocalAudioTrack,h),h&&m&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,m.track,h);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{let[i,{videoStats:s,audioStats:u,videoPcStats:d}]=n;const h=u,p=s,m=d,_=ya({},oI),E=ya({},sI),y=ya({},yF),{audioTrack:A,videoTrack:k,audioSSRC:L,videoSSRC:x}=t.getRemoteMedia(i),z=t.getStats(),X=z==null?void 0:z.audioRecv.find(se=>se.ssrc===L),ie=z==null?void 0:z.videoRecv.find(se=>se.ssrc===x),Ie=this.trafficStats&&this.trafficStats.peer_delay.find(se=>se.peer_uid===i);if(X&&(X.codec!=="opus"&&X.codec!=="aac"&&X.codec!=="PCMU"&&X.codec!=="PCMA"&&X.codec!=="G722"||(_.codecType=X.codec),X.outputLevel?_.receiveLevel=Math.round(32767*X.outputLevel):A&&(_.receiveLevel=Math.round(32767*A.getVolumeLevel())),_.receiveBytes=X.bytes,_.receivePackets=X.packets,_.receivePacketsLost=X.packetsLost,_.packetLossRate=_.receivePacketsLost/(_.receivePackets+_.receivePacketsLost),_.receiveBitrate=h?8*Math.max(0,_.receiveBytes-h.receiveBytes):0,_.totalDuration=h?h.totalDuration+1:1,_.totalFreezeTime=h?h.totalFreezeTime:0,_.freezeRate=_.totalFreezeTime/_.totalDuration,_.receiveDelay=X.jitterBufferMs,_.totalDuration>10&&bc.isRemoteAudioFreeze(A)&&(_.totalFreezeTime+=1)),ie){ie.codec!=="H264"&&ie.codec!=="H265"&&ie.codec!=="VP8"&&ie.codec!=="VP9"&&ie.codec!=="AV1X"&&ie.codec!=="AV1"||(E.codecType=ie.codec),E.receiveBytes=ie.bytes,E.receiveBitrate=p?8*Math.max(0,E.receiveBytes-p.receiveBytes):0,E.decodeFrameRate=ie.decodeFrameRate<0?0:ie.decodeFrameRate,E.renderFrameRate=ie.decodeFrameRate<0?0:ie.decodeFrameRate,ie.outputFrame&&(E.renderFrameRate=ie.outputFrame.frameRate),ie.receivedFrame?(E.receiveFrameRate=ie.receivedFrame.frameRate,E.receiveResolutionHeight=ie.receivedFrame.height,E.receiveResolutionWidth=ie.receivedFrame.width):k&&(E.receiveResolutionHeight=k._videoHeight||0,E.receiveResolutionWidth=k._videoWidth||0),ie.framesRateFirefox!==void 0&&(E.receiveFrameRate=Math.round(ie.framesRateFirefox)),E.receivePackets=ie.packets,E.receivePacketsLost=ie.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.totalDuration=p?p.totalDuration+1:1,E.totalFreezeTime=p?p.totalFreezeTime:0,E.receiveDelay=ie.jitterBufferMs||0;const se=!!x&&t.getRemoteVideoIsReady(x);k&&se&&bc.isRemoteVideoFreeze(k,ie,m)&&(E.totalFreezeTime+=1),E.freezeRate=E.totalFreezeTime/E.totalDuration}Ie&&(_.end2EndDelay=Ie.B_ad,E.end2EndDelay=Ie.B_vd,_.transportDelay=Ie.B_ed,E.transportDelay=Ie.B_ed,_.currentPacketLossRate=Ie.B_ealr4/100,E.currentPacketLossRate=Ie.B_evlr4/100,y.uplinkNetworkQuality=Ie.B_punq?Ie.B_punq:0,y.downlinkNetworkQuality=Ie.B_pdnq?Ie.B_pdnq:0),this.remoteStats.set(i,{audioStats:_,videoStats:E,videoPcStats:ie,networkStats:y}),A&&this.exceptionMonitor.setRemoteAudioStats(A,_),k&&this.exceptionMonitor.setRemoteVideoStats(k,E)})}}const jo=new class extends jt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),g(this,"_lastHiddenTime",0),g(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),I.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function kA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Yh(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?kA(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function qh(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(H("TURN_DOMAIN")):(I.info("Cannot recognized as IP address ".concat(e,". Used As Host instead")),e)}function LA(e,t){var n,i;const s=H("GATEWAY_DOMAINS");let u=s[1]&&t.indexOf(s[1])!==-1?1:0;e.addresses=e.addresses||[];const d=e.addresses.map(p=>p.domain_prefix?{address:"".concat(p.domain_prefix,".").concat(s[u++%s.length],":").concat(p.port)}:p.ip.match(/^[\.\:\d]+$/)?{ip:p.ip,port:p.port,address:"".concat(p.ip.replace(/[^\d]/g,"-"),".").concat(s[u++%s.length],":").concat(p.port)}:(I.info("Cannot recognized as IP address ".concat(p.ip,". Used As Host instead")),{ip:p.ip,port:p.port,address:"".concat(p.ip,":").concat(p.port)}));if((n=e.detail)!==null&&n!==void 0&&n[18]&&typeof((i=e.detail)===null||i===void 0?void 0:i[18])=="string"){const p=e.detail[18],m=p==null?void 0:p.split(";");for(let _=0;_<m.length;_++){var h;const E=xo(h=m[_]).call(h);d[_]&&E&&(d[_].ip6=E)}}return{gatewayAddrs:d,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Fo(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function xA(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(Fo(t.width),"x").concat(Fo(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function MA(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function _E(e,t){let n,i,s;switch(t){case mn.CHOOSE_SERVER:n=4096,i="choose server";break;case mn.CLOUD_PROXY:n=1048576,i="proxy";break;case mn.CLOUD_PROXY_5:n=4194304,i="proxy5";break;case mn.CLOUD_PROXY_FALLBACK:n=4194310,i="proxy fallback";break;default:throw new V(P.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===n&&(s={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(d=>Yh(Yh({},d),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:Yh(Yh({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!s)throw new V(P.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return s}async function H3(e,t){return await Ee.all(e.addresses.map(async n=>({address:qh(n.ip),tcpport:n.port,udpport:n.port,username:t&&H("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():jr.username,password:t&&H("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await O3(t.toString()):jr.password})))}function K3(e,t){const n=t._videoWidth||t.getMediaStreamTrack(!0).getSettings().width;return n||I.warning("cannot get original video track's width, default scale down 4 times for low stream"),n?n/Fo(e.width):4}function Jh(e){let{candidateType:t,relayProtocol:n,type:i,address:s,port:u,protocol:d}=e;return i==="local-candidate"?{candidateType:t,relayProtocol:n,protocol:d}:{candidateType:t,relayProtocol:n,address:s,port:u,protocol:d}}function UA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Ra(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?UA(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Nc(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function Fn(e){return new Ee(t=>{window.setTimeout(t,e)})}function z3(e){const t=new V(P.TIMEOUT,"timeout");return new Ee((n,i)=>{window.setTimeout(()=>i(t),e)})}function bt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+bt(e-n.length,"")}function mE(){return bt(32,"").toUpperCase()}const Xh=()=>{};function VA(e){return new Ee((t,n)=>{let i=!1;const s=document.createElement("video");s.setAttribute("autoplay",""),s.setAttribute("muted",""),s.muted=!0,s.autoplay=!0,s.setAttribute("playsinline",""),s.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(s);const u=Zn()?"canplay":"playing";s.addEventListener(u,()=>{const d=s.videoWidth,h=s.videoHeight;!d&&Bt()||(i=!0,s.srcObject=null,s.remove(),t([d,h]))}),s.srcObject=new MediaStream([e]),s.play().catch(Xh),setTimeout(()=>{i||(s.srcObject=null,s.remove(),t([s.videoWidth,s.videoHeight]))},4e3)})}function Pc(e){return Ee.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}function Gn(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return e.getListeners(t).length===0?Ee.reject(new V(P.UNEXPECTED_ERROR,"can not emit promise")):new Ee((u,d)=>{e.emit(t,...i,u,d)})}function Wt(e,t){if(e.getListeners(t).length===0)return Ee.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return Gn(e,t,...i)}function qi(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return Ca(e,t,...i)}function Ca(e,t){let n=null,i=null;for(var s=arguments.length,u=new Array(s>2?s-2:0),d=2;d<s;d++)u[d-2]=arguments[d];if(e.emit(t,...u,h=>{n=h},h=>{i=h}),i!==null)throw i;if(n===null)throw new V(P.UNEXPECTED_ERROR,"handler is not sync");return n}function EE(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function BA(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function Ji(e){Ee.resolve().then(e)}function Zt(e){return JSON.parse(JSON.stringify(e))}const jA={};function sd(e,t){jA[t]||(jA[t]=!0,e())}function vE(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)n[i]=t.charCodeAt(i);return n}function Qh(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}const FA=new class{constructor(){g(this,"fnMap",new Map)}throttleByKey(e,t,n,i){for(var s=arguments.length,u=new Array(s>4?s-4:0),d=4;d<s;d++)u[d-4]=arguments[d];if(this.fnMap.has(t)){const h=this.fnMap.get(t);if(h.threshold!==n){h.fn(...h.args),clearTimeout(h.timer);const p=window.setTimeout(()=>{const m=this.fnMap.get(t);m&&m.fn(...m.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:p,args:u,skipFn:i})}else h.skipFn&&h.skipFn(...h.args),this.fnMap.set(t,Ra(Ra({},h),{},{fn:e,args:u,skipFn:i}))}else{const h=window.setTimeout(()=>{const p=this.fnMap.get(t);p&&p.fn(...p.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:h,args:u,skipFn:i})}}},GA=FA.throttleByKey.bind(FA),ad=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:i,allFailedhandler:s,promisesCollector:u}=e,d=0;const h=t;let p,m=0;const _=async()=>{const E=(()=>{const y=d*h,A=y+h;return n.slice(y,A).map(i)})();u&&u.push(...E);try{p=await Pc(E)}catch(y){if(m+=h,d++,!(m>=n.length))return void await _();s(y)}E.forEach(y=>y.cancel())};return await _(),p};function WA(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}const Y3={[Tc.ACCESS_POINT]:{[Un.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Un.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Un.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Un.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Un.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Un.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Un.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Un.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[Un.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Un.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Un.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Un.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Un.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Un.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Un.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Un.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Un.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Un.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Tc.UNILBS]:{[Fr.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Fr.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Fr.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Fr.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Fr.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Fr.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Fr.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Fr.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Fr.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Fr.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Fr.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Fr.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Tc.STRING_UID_ALLOCATOR]:{[td.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[td.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[td.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function $h(e){const t=Y3[Math.floor(e/1e4)];if(!t)return{desc:"unkonw error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===Tc.ACCESS_POINT){const i=e%1e4;if(i.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return n}const q3={[Oe.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Oe.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Oe.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Oe.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Oe.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Oe.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Oe.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Oe.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Oe.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Oe.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Oe.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Oe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Oe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Oe.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Oe.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Oe.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Oe.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Oe.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Oe.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Oe.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Oe.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Oe.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Oe.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Oe.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Oe.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Oe.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Oe.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Oe.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Oe.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Oe.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Oe.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Oe.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Oe.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Oe.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Oe.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Oe.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Oe.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Oe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Oe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Oe.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Oe.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Oe.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Oe.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Oe.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Oe.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Oe.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Oe.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Oe.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Oe.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Oe.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Oe.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Oe.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Oe.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Oe.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Oe.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Oe.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Oe.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Oe.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Oe.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Oe.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Oe.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Oe.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Oe.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Oe.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function cd(e){return q3[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function HA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}class Dc extends jt{get url(){return this.websocket?this.websocket.url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){["tryNext","recover"].includes(t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Ge.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Ge.CONNECTED):this._state==="closed"?this.emit(Ge.CLOSED):this._state==="failed"&&this.emit(Ge.FAILED))}resetReconnectCount(t){I.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4?arguments[4]:void 0;super(),g(this,"connectionID",0),g(this,"currentURLIndex",0),g(this,"urls",void 0),g(this,"_reconnectMode","tryNext"),g(this,"reconnectReason",void 0),g(this,"_initMutex",new nr("websocket")),g(this,"name",void 0),g(this,"_state","closed"),g(this,"reconnectInterrupter",void 0),g(this,"websocket",void 0),g(this,"retryConfig",void 0),g(this,"reconnectCount",0),g(this,"forceCloseTimeout",5e3),g(this,"onlineReconnectListener",void 0),g(this,"useCompress",void 0),g(this,"tryDoubleDomain",!1),g(this,"wsInflateLength",0),g(this,"wsDeflateLength",0),g(this,"closeEstablishingWs",()=>{}),g(this,"store",void 0),g(this,"joinChannelServiceRecordIndex",void 0),this.store=u,this.name=t,this.retryConfig=function(_){for(var E=1;E<arguments.length;E++){var y=arguments[E]!=null?arguments[E]:{};E%2?HA(Object(y),!0).forEach(function(A){g(_,A,y[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(y)):HA(Object(y)).forEach(function(A){Object.defineProperty(_,A,Object.getOwnPropertyDescriptor(y,A))})}return _}({},n),this.useCompress=i,this.tryDoubleDomain=s;const{timeout:d,timeoutFactor:h}=n,p=Math.max(300,Math.floor(3*d/5)),m=Math.max(1.2,Math.floor(8*h)/10);Kn.ONLINE&&(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m),$t.on(Ss.NETWORK_STATE_CHANGE,(_,E)=>{_!==E&&(this.resetReconnectCount("network state change: ".concat(E," -> ").concat(_)),_===Kn.ONLINE?(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m):(this.retryConfig.timeout=d,this.retryConfig.timeoutFactor=h))})}getConnection(){return this.websocket||void 0}init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this.forceCloseTimeout=n;const i=(s,u)=>{this.urls=t;const d=this.urls[this.currentURLIndex];this.state="connecting",this.createWebSocketConnection(d).then(s).catch(u),this.once(Ge.CLOSED,()=>u(new V(P.WS_DISCONNECT))),this.once(Ge.CONNECTED,()=>s())};return this._initMutex.lock().then(s=>new Ee((u,d)=>{i(u,d)}).then(()=>{s()}).catch(()=>{s()}))}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void I.warning("[".concat(this.name,"] can not reconnect, no websocket"));var i;t!==void 0&&(this.reconnectMode=t),I.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinChannelServiceRecordIndex=="number"&&((i=this.store)===null||i===void 0||i.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinChannelServiceRecordIndex));const s=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),s&&s.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new V(P.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(i){throw new V(P.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t,n){return this.connectionID+=1,this.connectionID,this.joinChannelServiceRecordIndex=void 0,new Ee((i,s)=>{var u;const d=_=>{var E;(E=this.store)===null||E===void 0||E.signalChannelOpen(),I.debug("[".concat(this.name,"] websocket opened:"),_),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i()},h=async _=>{if(I.debug("[".concat(this.name,"] websocket close ").concat(this.websocket&&this.websocket.url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const E=qi(this,Ge.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,y=await this.reconnectWithAction(E);if(this.state==="closed")return void I.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!y)return s(new V(P.WS_DISCONNECT,"websocket reconnect failed: ".concat(_.code))),void this.close(!0);i()}else s(new V(P.WS_DISCONNECT,"websocket close: ".concat(_.code))),this.close()},p=_=>{this.emit(Ge.ON_MESSAGE,_)};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),H("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=H("GATEWAY_WSS_ADDRESS")),I.debug("[".concat(this.name,"] start connect, url: ").concat(t));const m=(u=this.store)===null||u===void 0?void 0:u.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});this.chooseBestWebsocketConnection(t,!!n,m).then(_=>{var E;this.websocket=_,d&&d(_.url),_.onclose=h,_.onmessage=p,(E=this.store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this.joinChannelServiceRecordIndex=m}).catch(_=>{var E;if((E=this.store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:_ instanceof V&&_.code===P.WS_ABORT?"aborted":"error",errors:[_]},m),this.state!=="closed"){if(_ instanceof V&&_.code===P.WS_ERR){const y=new V(P.WS_ERR,"init websocket failed! Error: ".concat(_.toString()));return I.error("[".concat(this.name,"]").concat(y)),void s(y)}h&&h(_)}else s(new V(P.WS_DISCONNECT,"websocket is closed: ".concat(_.toString())))})})}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||!this.urls||this.state==="closed")return!1;this.onlineReconnectListener||$t.networkState!==Kn.OFFLINE||(this.onlineReconnectListener=$t.onlineWaiter&&$t.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>{i=!1},n){const d=Nm(this.reconnectCount,this.retryConfig);I.debug("[".concat(this.name,"] wait ").concat(d,"ms to reconnect websocket, mode: ").concat(t)),await Ee.race([Fn(d),this.onlineReconnectListener||new Ee(()=>{})])}if(this.state==="closed"||!i)return!1;this.reconnectCount+=1;const s=async(d,h)=>{this.emit(Ge.RECONNECT_CREATE_CONNECTION,h),await this.createWebSocketConnection(d)};try{if(t==="retry"){const d=this.urls[this.currentURLIndex];this.emit(Ge.RECONNECT_WAITTING_FINISH,t),await s(d,t)}else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover",!1);I.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex));const d=this.urls[this.currentURLIndex];this.emit(Ge.RECONNECT_WAITTING_FINISH,t),await s(d,t)}else if(t==="recover"){I.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Ge.RECONNECT_WAITTING_FINISH,t),this.urls=await Gn(this,Ge.REQUEST_NEW_URLS),this.currentURLIndex=0;const d=this.urls[this.currentURLIndex];await s(d,t)}return!0}catch(d){var u;return I.error("[".concat(this.name,"] reconnect failed"),d.toString()),d!=null&&(u=d.data)!==null&&u!==void 0&&u.desc&&Array.isArray(d.data.desc)&&d.data.desc.length&&d.data.desc.includes("dynamic key expired")?(this.emit(Ge.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,n)}}async chooseBestWebsocketConnection(t,n,i){return new Ee((s,u)=>{let d=!1;const h=[];this.closeEstablishingWs=()=>{I.debug("[choose-best-ws] close establishing websockets"),h.forEach(L=>{L.onclose=null,L.onopen=null,L.onmessage=null,L.close()}),u(new V(P.WS_ABORT,"choose best websocket aborted"))};const p=H("GATEWAY_DOMAINS");let m;const _=t.indexOf("?h="),E=p.find(L=>_!==-1?t.includes(L,_):t.includes(L));I.debug("[choose-best-ws] currentDomain: ",E,", domains: ",p);let y=!this.tryDoubleDomain||n||!E;if(!y&&E){var A;const L=Date.now();try{p.forEach(x=>{const z=_===-1?t.replace(E,x):t.substr(0,_)+t.substr(_).replace(E,x),X=new WebSocket(z);X.binaryType="arraybuffer",h.push(X),I.debug("[choose-best-ws] ws is connecting:",X.url)})}catch{for(I.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(z=>z.close());h.length;)h.pop();y=!0}(A=this.store)===null||A===void 0||A.recordJoinChannelService({urls:h.map(x=>x.url),service:"gateway"},i),h.forEach(x=>{x.onopen=()=>{if(d)return;const z=Date.now()-L;I.debug("[choose-best-ws] ws open cost ".concat(z,"ms")),h.filter(X=>X!==x).forEach(X=>{I.debug("[choose-best-ws]close backup websocket: ".concat(X.url)),X.close()}),d=!0,s(x)},x.onclose=z=>{m=z,!d&&(h.find(X=>!(X.readyState===WebSocket.CLOSED||X.readyState===WebSocket.CLOSING))||(I.debug("[choose-best-ws] all websocket is closed"),d=!0,u(m)))},x.onmessage=z=>{I.debug("[choose-best-ws]".concat(x.url," onmessage: ").concat(z.data))}}),Fn(this.forceCloseTimeout).then(()=>{h.forEach(x=>{x.readyState!==WebSocket.OPEN&&x.close()})})}if(y){var k;let L;I.debug("[choose-best-ws] use single url: ",t),(k=this.store)===null||k===void 0||k.recordJoinChannelService({urls:[t],service:"gateway"},i);try{L=new WebSocket(t),h.push(L),L.binaryType="arraybuffer"}catch(x){const z=new V(P.WS_ERR,"init websocket failed! Error: ".concat(x.toString()));return I.error("[".concat(this.name,"]").concat(z)),void u(z)}L.onopen=()=>{s(L)},L.onclose=x=>{u(x)},L.onmessage=x=>{I.debug("[choose-best-ws]".concat(L.url," onmessage: ").concat(x.data))},Fn(this.forceCloseTimeout).then(()=>{L&&L.readyState!==WebSocket.OPEN&&L.close()})}}).then(s=>(this.closeEstablishingWs=void 0,s)).catch(s=>{throw this.closeEstablishingWs=void 0,s})}}class KA{constructor(t){g(this,"input",[]),g(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:hs(t=this.input).call(t,(n,i)=>n+i)/this.input.length}}class zA extends jt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===ft.CONNECTED?this.emit(Ae.WS_CONNECTED):t===ft.RECONNECTING?this.emit(Ae.WS_RECONNECTING,this._websocketReconnectReason):t===ft.CLOSED&&this.emit(Ae.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),g(this,"_disconnectedReason",void 0),g(this,"_websocketReconnectReason",void 0),g(this,"_connectionState",ft.CLOSED),g(this,"reconnectToken",void 0),g(this,"websocket",void 0),g(this,"openConnectionTime",void 0),g(this,"clientId",void 0),g(this,"lastMsgTime",Date.now()),g(this,"uploadCache",[]),g(this,"uploadCacheInterval",void 0),g(this,"rttRolling",new KA(5)),g(this,"pingpongTimer",void 0),g(this,"wsInflateDataTimer",void 0),g(this,"pingpongTimeoutCount",0),g(this,"joinResponse",void 0),g(this,"multiIpOption",void 0),g(this,"initError",void 0),g(this,"spec",void 0),g(this,"store",void 0),g(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Ae.ON_BINARY_DATA,i.data);const s=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const u="res-@".concat(s._id);this.emit(u,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){if(this.emit(s._type,s._message),s._type===Ke.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===Ke.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(ct.UID_BANNED);break;case 15:this.close(ct.IP_BANNED);break;case 16:this.close(ct.CHANNEL_BANNED)}if(s._type===Ke.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case Oe.ERR_LICENSE_MISSING:this.close(ct.LICENSE_MISSING);break;case Oe.ERR_LICENSE_EXPIRED:this.close(ct.LICENSE_EXPIRED);break;case Oe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(ct.LICENSE_MINUTES_EXCEEDED);break;case Oe.ERR_LICENSE_PERIOD_INVALID:this.close(ct.LICENSE_PERIOD_INVALID);break;case Oe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(ct.LICENSE_MULTIPLE_SDK_SERVICE);break;case Oe.ERR_LICENSE_ILLEGAL:this.close(ct.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new Dc("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ft.CONNECTED&&this.reconnect("retry",cr.OFFLINE)})}async request(t,n,i,s){const u=bt(6,""),d={_id:u,_type:t,_message:n},h=this.websocket.connectionID,p=()=>new Ee((k,L)=>{if(this.connectionState===ft.CONNECTED)return k();const x=()=>{this.off(Ae.WS_CLOSED,z),k()},z=()=>{this.off(Ae.WS_CONNECTED,x),L(new V(P.WS_ABORT))};this.once(Ae.WS_CONNECTED,x),this.once(Ae.WS_CLOSED,z),t!==De.PUBLISH&&t!==De.SUBSCRIBE&&t!==De.UNSUBSCRIBE&&t!==De.UNPUBLISH&&t!==De.CONTROL&&t!==De.RESTART_ICE||this.once(Ae.DISCONNECT_P2P,()=>{L(new V(P.DISCONNECT_P2P))}),t!==De.PUBLISH&&t!==De.RESTART_ICE||this.once(Ae.ABORT_P2P_EXECUTION,()=>{L(new V(P.DISCONNECT_P2P))})});if(this.connectionState!==ft.CONNECTING&&this.connectionState!==ft.RECONNECTING||t===De.JOIN||t===De.REJOIN||await p(),this.websocket.sendMessage(d,!0),s)return;const m=new Ee((k,L)=>{let x=!1;const z=(ie,Ie)=>{x=!0,k({isSuccess:ie==="success",message:Ie||{}}),this.off(Ae.WS_CLOSED,X),this.off(Ae.WS_RECONNECTING,X),this.emit(Ae.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(u),z);const X=()=>{L(new V(P.WS_ABORT,"type: ".concat(t))),this.off(Ae.WS_CLOSED,X),this.off(Ae.WS_RECONNECTING,X),this.off("res-@".concat(u),z)};this.once(Ae.WS_CLOSED,X),this.once(Ae.WS_RECONNECTING,X),Fn(H("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==h||x||(I.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Ae.REQUEST_TIMEOUT,t,n))})});let _=null;try{_=await m}catch(k){if(this.connectionState===ft.CLOSED||t===De.LEAVE)throw new V(P.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?k.throw():t===De.JOIN||t===De.REJOIN?null:(await p(),await this.request(t,n))}if(_.isSuccess)return _.message;const E=Number(_.message.error_code||_.message.code),y=cd(E),A=new V(P.UNEXPECTED_RESPONSE,"".concat(y.desc,": ").concat(_.message.error_str),{code:E,data:_.message});return y.action==="success"?_.message:(I.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(y.desc,", action: ").concat(y.action)),E===Oe.ERR_TOO_MANY_BROADCASTERS?((t===De.JOIN||t===De.REJOIN)&&(this.initError=A,this.close()),A.throw()):y.action==="failed"?A.throw():y.action==="quit"?(this.initError=A,this.close(),A.throw()):(E===Oe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,I.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",cr.MULTI_IP)):this.reconnect(y.action,cr.SERVER_ERROR),t===De.JOIN||t===De.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new Ee(i=>{const s=u=>{(!n||n(u))&&(this.off(t,s),i(u))};this.on(t,s)})}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const u=H("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ft.CONNECTED)return;const d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},H("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}init(t,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ee((i,s)=>{this.once(Ae.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Ae.WS_CLOSED,()=>s(this.initError||new V(P.WS_ABORT))),this.connectionState=ft.CONNECTING,this.websocket.init(t).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4),setTimeout(()=>{n&&this.openConnectionTime===void 0&&(I.debug("[".concat(this.clientId,"] init websocket timeout while join with fallback to proxy")),s(new V(P.INIT_WEBSOCKET_TIMEOUT)))},H("JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||ct.LEAVE,this.connectionState=ft.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===ct.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Dc("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(Ae.ABORT_P2P_EXECUTION);const t=await Gn(this,Ae.REQUEST_JOIN_INFO),n=await this.request(De.JOIN,t);if(!n)return this.emit(Ae.REPORT_JOIN_GATEWAY,P.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Ae.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ft.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new V(P.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Ca(this,Ae.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(De.REJOIN,t);return!!n&&(this.connectionState=ft.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(Ke.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(Ke.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(Ke.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(Ke.MUTE_AUDIO,{uid:i.uid}):this.emit(Ke.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(Ke.MUTE_VIDEO,{uid:i.uid}):this.emit(Ke.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(Ke.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(Ke.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(Ke.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(Ke.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(Ke.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){I.debug("[".concat(this.clientId,"] receive notification: "),t);const n=cd(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(ct.UID_BANNED),void this.close()):void this.reconnect(n.action,cr.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=H("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(I.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>H("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",cr.TIMEOUT):this.request(De.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),H("REPORT_STATS")&&this.send(De.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(br.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Ge.RECONNECT_WAITTING_FINISH,t=>{this.emit(Ae.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(Ge.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Ae.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Ge.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ge.CLOSED,()=>{this.connectionState=ft.CLOSED}),this.websocket.on(Ge.FAILED,()=>{this._disconnectedReason=ct.NETWORK_ERROR,this.connectionState=ft.CLOSED}),this.websocket.on(Ge.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===ft.CONNECTED?this.connectionState=ft.RECONNECTING:this.connectionState=ft.CONNECTING}),this.websocket.on(Ge.WILL_RECONNECT,(t,n)=>{if(Ca(this,Ae.IS_P2P_DISCONNECTED)&&t==="retry")return I.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Ae.NEED_RENEW_SESSION),this.emit(Ae.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(I.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(Ae.NEED_RENEW_SESSION),this.emit(Ae.DISCONNECT_P2P)),n(t)}),this.websocket.on(Ge.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{I.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",cr.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Ae.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof V&&t.code===P.UNEXPECTED_RESPONSE&&t.data.code===Oe.ERR_NO_AUTHORIZED)return I.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",cr.SERVER_ERROR);I.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",cr.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Ge.REQUEST_NEW_URLS,(t,n)=>{Gn(this,Ae.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Ge.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ke.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function YA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}class J3 extends jt{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){["tryNext","recover"].includes(t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Ft.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Ft.CONNECTED):this._state==="closed"?this.emit(Ft.CLOSED):this._state==="failed"&&this.emit(Ft.FAILED))}constructor(t,n,i,s){super(),g(this,"connectionID",0),g(this,"currentURLIndex",0),g(this,"reconnectReason",void 0),g(this,"_reconnectMode","tryNext"),g(this,"_initMutex",void 0),g(this,"_name",void 0),g(this,"_state","closed"),g(this,"_reconnectInterrupter",void 0),g(this,"_url",void 0),g(this,"_retryConfig",void 0),g(this,"_reconnectCount",0),g(this,"_forceCloseTimeout",5e3),g(this,"_onlineReconnectListener",void 0),g(this,"_closeEstablishingTransmitter",()=>{}),g(this,"_store",void 0),g(this,"_joinChannelServiceRecordIndex",void 0),g(this,"_transmitter",void 0),g(this,"_useCompress",void 0),g(this,"_inflateLength",0),g(this,"_deflateLength",0),this._store=s,this._name=t,this._retryConfig=function(u){for(var d=1;d<arguments.length;d++){var h=arguments[d]!=null?arguments[d]:{};d%2?YA(Object(h),!0).forEach(function(p){g(u,p,h[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(h)):YA(Object(h)).forEach(function(p){Object.defineProperty(u,p,Object.getOwnPropertyDescriptor(h,p))})}return u}({},n),this._useCompress=i}resetReconnectCount(t){I.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const i=this._transmitter;n?setTimeout(()=>i.close(),500):i.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,n){if(!this._transmitter)return void I.warning("[".concat(this._name,"] can not reconnect, no websocket"));var i;t!==void 0&&(this.reconnectMode=t),I.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((i=this._store)===null||i===void 0||i.recordJoinChannelService({status:"error",errors:[new Error(n)]},this._joinChannelServiceRecordIndex));const s=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),s&&s.bind(this._transmitter)({code:9999,reason:n})}getInflateData(){const t=this._inflateLength,n=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:n}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}function qA(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);const i=e.getUint32(t,n),s=e.getUint32(t+4,n),u=Number(!!n),d=Number(!n);return BigInt(i*d+s*u)<<BigInt(32)|BigInt(i*u+s*d)}function JA(e,t,n,i){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,i);const s=Number(n>>BigInt(32)),u=Number(n&BigInt(4294967295));i?(e.setUint32(t+4,s,i),e.setUint32(t,u,i)):(e.setUint32(t,s,i),e.setUint32(t+4,u,i))}let ci;(function(e){e[e.Default=0]="Default",e[e.Ack=1]="Ack"})(ci||(ci={}));class X3{constructor(t,n,i){g(this,"version",1),g(this,"initialRTO",void 0),g(this,"maxBatchAckCount",void 0),g(this,"maxRTO",void 0),g(this,"initialRTT",void 0),g(this,"ID",void 0),g(this,"rtt",void 0),g(this,"packetNumber",1),g(this,"rtoRatioMap",new Map),g(this,"timeoutMap",new Map),g(this,"unorderedPacketQueue",[]),g(this,"batchAckPacketQueue",[]),g(this,"lastOrderedPacketNumber",0),g(this,"batchAckTimer",void 0),g(this,"sendImpl",void 0),g(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=n,this.ID=bt(7,"transmitter-"),this.initialRTO=(i==null?void 0:i.initialRTO)!==void 0?i.initialRTO:H("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:H("TRANSMITTER_INITIAL_RTT"),this.rtt=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:H("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(i==null?void 0:i.maxBatchAckCount)!==void 0?i.maxBatchAckCount:H("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(i==null?void 0:i.maxRTO)!==void 0?i.maxRTO:H("TRANSMITTER_MAX_RTO")}packetize(t,n){return{type:ci.Default,version:this.version,packetNumber:n,payload:t}}serialize(t){switch(t.type){case ci.Default:{let n;typeof t.payload=="string"?n=new TextEncoder().encode(t.payload):n=t.payload;const i=new ArrayBuffer(n.length+15),s=new DataView(i);return s.setUint16(0,t.version),s.setUint8(2,t.type),s.setUint32(3,t.packetNumber),JA(s,7,BigInt(t.sendTs)),new Uint8Array(s.buffer).set(n,15),i}case ci.Ack:{const n=new ArrayBuffer(16),i=new DataView(n);return i.setUint16(0,t.version),i.setUint8(2,t.type),i.setUint32(3,t.maxAckPacketNumber),i.setUint8(7,t.shift),JA(i,8,BigInt(t.ackSendTs)),n}}}deserialize(t){const n=new DataView(t),i=n.getUint16(0),s=n.getUint8(2);switch(s){case ci.Default:{const u=n.getUint32(3),d=qA(n,7),h=t.slice(15),p=new TextDecoder().decode(h);return{version:i,type:s,packetNumber:u,sendTs:Number(d),payload:p}}case ci.Ack:{const u=n.getUint32(3),d=n.getUint8(7),h=qA(n,8);return{version:i,type:s,maxAckPacketNumber:u,shift:d,ackSendTs:Number(h)}}default:throw I.error("[".concat(this.ID,"] Unrecognized packet type ").concat(s)),new Error("Unrecognized packet type ".concat(s))}}sendMessage(t){const n=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const i=this.calculateRTO(n),s=window.setTimeout(()=>{this.resendMessage(n)},i);this.timeoutMap.set(n.packetNumber,s),this.sendPacket(n)}onData(t){const n=this.deserialize(t);n.type===ci.Default?this.ack(n):n.type===ci.Ack&&(this.updateRTT(n,Math.round(performance.now())),this.clearRTO(n))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[n,i]=t;window.clearTimeout(i)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const n=this.calculateRTO(t),i=window.setTimeout(()=>{this.resendMessage(t)},n);this.timeoutMap.set(t.packetNumber,i),this.sendPacket(t)}calculateRTO(t){const n=this.rtoRatioMap.get(t.packetNumber);if(n===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const i=9*this.rtt/8*n;return this.rtoRatioMap.set(t.packetNumber,n+1),i>this.maxRTO?this.maxRTO:i}}updateRTT(t,n){const i=t.ackSendTs;this.rtt=this.rtt*(7/8)+(n-i-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const n=this.unorderedPacketQueue[0];if(!n){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(n.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:ci.Ack,version:this.version};this.sendPacket(n)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:ci.Ack,version:this.version};this.sendPacket(n)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:ci.Ack,version:this.version};this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===ci.Default&&(t.sendTs=Math.round(performance.now()));const n=this.serialize(t);this.sendImpl(n)}clearRTO(t){for(let n=t.maxAckPacketNumber-t.shift;n<=t.maxAckPacketNumber;n++){const i=this.timeoutMap.get(n);i!==void 0&&window.clearTimeout(i),this.timeoutMap.delete(n),this.rtoRatioMap.delete(n)}}}class XA extends J3{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),g(this,"_initMutex",void 0),g(this,"_reconnectInterrupter",void 0),g(this,"_url",void 0),g(this,"_transmitter",void 0),g(this,"_addresses",void 0),g(this,"_reliableTransmission",void 0),this._initMutex=new nr("datachannel");const{timeout:i,timeoutFactor:s}=n,u=Math.max(300,Math.floor(3*i/5)),d=Math.max(1.2,Math.floor(8*s)/10);Kn.ONLINE&&(this._retryConfig.timeout=u,this._retryConfig.timeoutFactor=d),$t.on(Ss.NETWORK_STATE_CHANGE,(h,p)=>{h!==p&&(this.resetReconnectCount("network state change: ".concat(p," -> ").concat(h)),h===Kn.ONLINE?(this._retryConfig.timeout=u,this._retryConfig.timeoutFactor=d):(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=s))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=n;const i=(s,u)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(h=>h.fingerprint||H("FINGERPRINT"));const d=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(d).then(s).catch(u),this.once(Ft.CLOSED,()=>u(new V(P.WS_DISCONNECT))),this.once(Ft.CONNECTED,()=>s())};return this._initMutex.lock().then(s=>new Ee((u,d)=>{i(u,d)}).then(()=>{s()}).catch(()=>{s()}))}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new V(P.WS_ABORT,"datachannel is not ready");try{n||(t=JSON.stringify(t)),this._reliableTransmission.sendMessage(t)}catch(i){throw new V(P.WS_ERR,"send datachannel signal message error"+i.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const n=JSON.stringify(t);return{compressed:n,compressedLength:n.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new Ee((n,i)=>{var s;const u=()=>{I.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n()},d=async _=>{var E;if((E=this._closeEstablishingTransmitter)===null||E===void 0||E.call(this),I.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");const y=qi(this,Ft.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,A=await this.reconnectWithAction(y);if(this.state==="closed")return void I.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!A)return i(new V(P.WS_DISCONNECT,"datachannel reconnect failed: ".concat(_.code))),void this.close(!0);n()}else i(new V(P.WS_DISCONNECT,"datachannel close: ".concat(_.code))),this.close()},h=_=>{var E;(E=this._reliableTransmission)===null||E===void 0||E.onData(_.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),I.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const p=(s=this._store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),m=Date.now();Gn(this,Ft.TO_CONNECT_DATACHANNEL,t).then(_=>{var E,y;if(!_)throw new Error("transmissonInfo not exist yet");const{transmitter:A,close:k}=_;this._transmitter=A,(E=this._store)===null||E===void 0||E.signalChannelOpen();const L=Date.now()-m;I.debug("[choose dc] dc open cost ".concat(L,"ms")),this._reliableTransmission=new X3(x=>{var z;this._transmitter&&this._transmitter.readyState==="open"&&((z=this._transmitter)===null||z===void 0||z.send(x))},x=>{typeof x=="string"&&this.emit(Ft.ON_MESSAGE,x)}),this._closeEstablishingTransmitter=()=>{var x;(x=this._reliableTransmission)===null||x===void 0||x.close(),this._reliableTransmission=void 0,k()},u&&u(),A.onclose=d,A.onmessage=h,(y=this._store)===null||y===void 0||y.recordJoinChannelService({endTs:Date.now(),status:"success"},p),this._joinChannelServiceRecordIndex=p}).catch(_=>{var E;if((E=this._store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:_ instanceof V&&_.code===P.WS_ABORT?"aborted":"error",errors:[_]},p),this.state!=="closed"){if(_ instanceof V&&_.code===P.WS_ERR){const y=new V(P.WS_ERR,"init datachannel failed! Error: ".concat(_.toString()));return I.error("[".concat(this._name,"]").concat(y)),void i(y)}d&&d(_)}else i(new V(P.WS_DISCONNECT,"datachannel is closed: ".concat(_.toString())))})})}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||$t.networkState!==Kn.OFFLINE||(this._onlineReconnectListener=$t.onlineWaiter&&$t.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let i=!0;if(this._reconnectInterrupter=()=>{i=!1},n){const d=Nm(this._reconnectCount,this._retryConfig);I.debug("[".concat(this._name,"] wait ").concat(d,"ms to reconnect datachannel, mode: ").concat(t)),await Ee.race([Fn(d),this._onlineReconnectListener||new Ee(()=>{})])}if(this.state==="closed"||!i)return!1;this._reconnectCount+=1;const s=async(d,h)=>{this.emit(Ft.RECONNECT_CREATE_CONNECTION,h),await this.createTransmitterConnection(d)};try{if(t==="retry"){const d=this._addresses[this.currentURLIndex];this.emit(Ft.RECONNECT_WAITTING_FINISH,t),await s(d,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let h=this.currentURLIndex;h<this._addresses.length;h++){if(this._addresses[h].fingerprint||H("FINGERPRINT")){this.currentURLIndex=h;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return I.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);I.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const d=this._addresses[this.currentURLIndex];this.emit(Ft.RECONNECT_WAITTING_FINISH,t),await s(d,t)}else t==="recover"&&(I.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(Ft.RECONNECT_WAITTING_FINISH,t),this.emit(Ft.FAILBACK));return!0}catch(d){var u;return I.error("[".concat(this._name,"] reconnect failed"),d.toString()),d!=null&&(u=d.data)!==null&&u!==void 0&&u.desc&&Array.isArray(d.data.desc)&&d.data.desc.length&&d.data.desc.includes("dynamic key expired")?(this.emit(Ft.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,n)}}}class Go extends jt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===ft.CONNECTED?this.emit(Ae.WS_CONNECTED):t===ft.RECONNECTING?this.emit(Ae.WS_RECONNECTING,this._websocketReconnectReason):t===ft.CLOSED&&this.emit(Ae.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),g(this,"_disconnectedReason",void 0),g(this,"_websocketReconnectReason",void 0),g(this,"_connectionState",ft.CLOSED),g(this,"reconnectToken",void 0),g(this,"websocket",void 0),g(this,"openConnectionTime",void 0),g(this,"clientId",void 0),g(this,"lastMsgTime",Date.now()),g(this,"uploadCache",[]),g(this,"uploadCacheInterval",void 0),g(this,"rttRolling",new KA(5)),g(this,"pingpongTimer",void 0),g(this,"inflateDataTimer",void 0),g(this,"pingpongTimeoutCount",0),g(this,"joinResponse",void 0),g(this,"multiIpOption",void 0),g(this,"initError",void 0),g(this,"spec",void 0),g(this,"store",void 0),g(this,"onWebsocketMessage",i=>{if(i instanceof ArrayBuffer)return void this.emit(Ae.ON_BINARY_DATA,i);const s=JSON.parse(i);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const u="res-@".concat(s._id);this.emit(u,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")&&(this.emit(s._type,s._message),s._type===Ke.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===Ke.ON_USER_BANNED))switch(s._message.error_code){case 14:this.close(ct.UID_BANNED);break;case 15:this.close(ct.IP_BANNED);break;case 16:this.close(ct.CHANNEL_BANNED)}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new XA("gateway-".concat(this.clientId),this.spec.retryConfig,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===ft.CONNECTED&&this.reconnect("retry",fo.OFFLINE)})}async request(t,n,i,s){const u=bt(6,""),d={_id:u,_type:t,_message:n},h=this.websocket.connectionID,p=()=>new Ee((k,L)=>{if(this.connectionState===ft.CONNECTED)return k();const x=()=>{this.off(Ae.WS_CLOSED,z),k()},z=()=>{this.off(Ae.WS_CONNECTED,x),L(new V(P.WS_ABORT))};this.once(Ae.WS_CONNECTED,x),this.once(Ae.WS_CLOSED,z),t!==De.PUBLISH&&t!==De.SUBSCRIBE&&t!==De.UNSUBSCRIBE&&t!==De.UNPUBLISH&&t!==De.CONTROL&&t!==De.RESTART_ICE||this.once(Ae.DISCONNECT_P2P,()=>{L(new V(P.DISCONNECT_P2P))}),t!==De.PUBLISH&&t!==De.RESTART_ICE||this.once(Ae.ABORT_P2P_EXECUTION,()=>{L(new V(P.DISCONNECT_P2P))})});if(this.connectionState!==ft.CONNECTING&&this.connectionState!==ft.RECONNECTING||t===De.JOIN||t===De.REJOIN||await p(),t===De.LEAVE&&(this.websocket.unbindDcCloseEventListener(),s=!0),this.websocket.sendMessage(d,!0,!1),s)return;const m=new Ee((k,L)=>{let x=!1;const z=(ie,Ie)=>{x=!0,k({isSuccess:ie==="success",message:Ie||{}}),this.off(Ae.WS_CLOSED,X),this.off(Ae.WS_RECONNECTING,X),this.emit(Ae.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(u),z);const X=()=>{L(new V(P.WS_ABORT,"type: ".concat(t))),this.off(Ae.WS_CLOSED,X),this.off(Ae.WS_RECONNECTING,X),this.off("res-@".concat(u),z)};this.once(Ae.WS_CLOSED,X),this.once(Ae.WS_RECONNECTING,X),Fn(H("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==h||x||(I.warning("dc request timeout, type: ".concat(t)),this.emit(Ae.REQUEST_TIMEOUT,t,n))})});let _=null;try{_=await m}catch(k){if(this.connectionState===ft.CLOSED||t===De.LEAVE)throw new V(P.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?k.throw():t===De.JOIN||t===De.REJOIN?null:(await p(),await this.request(t,n))}if(_.isSuccess)return _.message;const E=Number(_.message.error_code||_.message.code),y=cd(E),A=new V(P.UNEXPECTED_RESPONSE,"".concat(y.desc,": ").concat(_.message.error_str),{code:E,data:_.message});return y.action==="success"?_.message:(I.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(y.desc,", action: ").concat(y.action)),E===Oe.ERR_TOO_MANY_BROADCASTERS?((t===De.JOIN||t===De.REJOIN)&&(this.initError=A,this.close()),A.throw()):y.action==="failed"?A.throw():y.action==="quit"?(this.initError=A,this.close(),A.throw()):(E===Oe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,I.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",fo.MULTI_IP)):this.reconnect(y.action,fo.SERVER_ERROR),t===De.JOIN||t===De.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new Ee(i=>{const s=u=>{(!n||n(u))&&(this.off(t,s),i(u))};this.on(t,s)})}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const u=H("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==ft.CONNECTED)return;const d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},H("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}init(t,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Ee((i,s)=>{this.once(Ae.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Ae.WS_CLOSED,()=>s(this.initError||new V(P.WS_ABORT))),this.connectionState=ft.CONNECTING,this.websocket.init(t).catch(s),this.websocket.once(Ft.FAILBACK,()=>{this.openConnectionTime===void 0&&s(new V(P.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{n&&this.openConnectionTime===void 0&&(I.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),s(new V(P.INIT_DATACHANNEL_TIMEOUT)))},H("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||ct.LEAVE,this.connectionState=ft.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===ct.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new XA("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(Ae.ABORT_P2P_EXECUTION);const t=await Gn(this,Ae.DATACHANNEL_CONNECTING),n=await this.request(De.JOIN,t);if(!n)return this.emit(Ae.REPORT_JOIN_GATEWAY,P.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Ae.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=ft.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new V(P.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Ca(this,Ae.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(De.REJOIN,t);return!!n&&(this.connectionState=ft.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(Ke.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(Ke.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(Ke.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(Ke.MUTE_AUDIO,{uid:i.uid}):this.emit(Ke.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(Ke.MUTE_VIDEO,{uid:i.uid}):this.emit(Ke.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(Ke.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(Ke.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(Ke.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(Ke.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(Ke.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){I.debug("[".concat(this.clientId,"] receive notification: "),t);const n=cd(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(ct.UID_BANNED),void this.close()):void this.reconnect(n.action,fo.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=H("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(I.warning("PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>H("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",fo.TIMEOUT):this.request(De.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),H("REPORT_STATS")&&this.send(De.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleInflateData(){const{inflateLength:t,deflateLength:n}=this.websocket.getInflateData();t!==0&&n!==0&&this.upload(br.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Ft.RECONNECT_WAITTING_FINISH,t=>{this.emit(Ae.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(Ft.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Ae.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Ft.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ft.CLOSED,()=>{this.connectionState=ft.CLOSED}),this.websocket.on(Ft.FAILED,()=>{this._disconnectedReason=ct.NETWORK_ERROR,this.connectionState=ft.CLOSED}),this.websocket.on(Ft.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===ft.CONNECTED?this.connectionState=ft.RECONNECTING:this.connectionState=ft.CONNECTING}),this.websocket.on(Ft.WILL_RECONNECT,(t,n)=>{if(Ca(this,Ae.IS_P2P_DISCONNECTED)&&t==="retry")return I.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Ae.NEED_RENEW_SESSION),this.emit(Ae.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(I.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(Ae.NEED_RENEW_SESSION),this.emit(Ae.DISCONNECT_P2P)),n(t)}),this.websocket.on(Ft.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{I.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",fo.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Ae.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof V&&t.code===P.UNEXPECTED_RESPONSE&&t.data.code===Oe.ERR_NO_AUTHORIZED)return I.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",fo.SERVER_ERROR);I.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",fo.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Ft.REQUEST_NEW_URLS,(t,n)=>{Gn(this,Ae.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Ft.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ke.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Ft.TO_CONNECT_DATACHANNEL,async(t,n,i)=>Gn(this,Ae.DATACHANNEL_PRECONNECT,t).then(n).catch(i)),this.websocket.on(Ft.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(Ae.DATACHANNEL_FAILBACK)})}}function QA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Eo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?QA(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const gE=new Map;class Q3 extends jt{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Lt.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(Lt.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){I.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){super(),g(this,"store",void 0),g(this,"joinInfo",void 0),g(this,"key",void 0),g(this,"signal",void 0),g(this,"role",void 0),g(this,"inChannelInfo",{joinAt:null,duration:0}),g(this,"spec",void 0),g(this,"_state","DISCONNECTED"),g(this,"_statsCollector",void 0),g(this,"_disconnectedReason",void 0),g(this,"isSignalRecover",!1),g(this,"hasChangeBGPAddress",!1),g(this,"trafficStatsInterval",void 0),g(this,"networkQualityInterval",void 0),g(this,"_joinGatewayStartTime",0),g(this,"_signalTimeout",!1),g(this,"_clientRoleOptions",void 0),g(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useDataChannel?new Go(Eo(Eo({},n),{},{retryConfig:n.websocketRetryConfig}),t):new zA(Eo(Eo({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,i){if(this.signal instanceof Go){let p=!1;t.cloudProxyServer!=="disabled"?(I.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),p=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(I.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),p=!0):t.apResponse.addresses.some(m=>m.fingerprint)||H("FINGERPRINT")||(I.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),p=!0),p&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const s=Date.now();let u=gE.get(t.cname);if(u||(u=new Map,gE.set(t.cname,u)),this._isProactiveJoin=!0,u.has(t.uid)){const p=new V(P.UID_CONFLICT);throw we.joinGateway(t.sid,{lts:s,succ:!1,ec:p.message,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:this.signal instanceof Go?"1":"0"}),this._isProactiveJoin=!1,p}u.set(t.uid,!0),this.joinInfo=t,this.key=n;let d=0;this.joinGatewayStartTime=s;const h=t.proxyServer;try{let p;if(I.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof Go?"datachannel":"websocket"," join uid ").concat(d)),this.signal instanceof Go)p=await this.signal.init(t.apResponse.addresses,i);else{const m=t.proxyServer,_=m?t.gatewayAddrs.map(E=>{const y=E.address.split(":");return"wss://".concat(m,"/ws/?h=").concat(y[0],"&p=").concat(y[1])}):t.gatewayAddrs.map(E=>"wss://".concat(E.address));p=await this.signal.init(_,i)}d=p.uid,I.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof Go?"datachannel":"websocket"," join uid ").concat(d," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(p){throw p&&p.code===P.INIT_WEBSOCKET_TIMEOUT?(I.warning("[".concat(this.store.clientId,"] User join failed"),p.toString()),p):p&&p.code===P.INIT_DATACHANNEL_TIMEOUT?(I.warning("[".concat(this.store.clientId,"] User join datachannel failed"),p.toString()),this.resetSignal(),p):(I.error("[".concat(this.store.clientId,"] User join failed"),p.toString()),we.joinGateway(t.sid,{lts:s,succ:!1,ec:p.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!h,signalChannel:this.signal instanceof Go?"1":"0"}),this._isProactiveJoin=!1,u.delete(t.uid),this.signal.close(),p)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),I.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(p=>{I.warning("[".concat(this.store.clientId,"] get traffic stats error"),p.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Lt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Lt.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Lt.NETWORK_QUALITY,{uplinkNetworkQuality:MA(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:MA(this._statsCollector.trafficStats.B_dnq)}):this.emit(Lt.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),d}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==ct.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==ft.CONNECTED||await function(i,s){return s===1/0?i:Ee.race([i,z3(s)])}(this.signal.request(De.LEAVE,void 0,!0),3e3)}catch(i){I.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==ct.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new V(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:H("PUB_EXTEND"),twcc:!!H("PUBLISH_TWCC"),rtx:!!H("USE_PUB_RTX")};try{return(await this.signal.request(De.PUBLISH,s,!0))._message}catch(u){if(i&&u.data&&u.data.code===Oe.ERR_PUBLISH_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw u}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new V(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(De.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(i){I.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async subscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new V(P.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const s={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!H("SUBSCRIBE_TWCC"),rtx:!!H("USE_SUB_RTX"),extend:H("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(H("SVC"))&&H("SVC").length!==0?H("SVC"):void 0};try{return(await this.signal.request(De.SUBSCRIBE,s,!0))._message}catch(u){if(i&&u.data&&u.data.code===Oe.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw u}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new V(P.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!H("USE_SUB_RTX")};try{return await this.signal.request(De.SUBSCRIBE_STREAMS,i,!0)}catch(s){if(n&&s.data&&s.data.code===Oe.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),s.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw s}}async setVideoProfile(t){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let s=i.frameRate,u=i.width,d=i.height,h=!0;return typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(h=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(h=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,s||(h=!1)),h?{stream_type:0,width:u,height:d,fps:s,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(t);if(n)return this.signal.request(De.SET_VIDEO_PROFILE,n);I.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(De.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(i){I.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async massUnsubscribe(t){try{await this.signal.request(De.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){I.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:s}=t;return{gatewayEstablishParams:await this.signal.request(De.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:s}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(De.GATEWAY_INFO)}async renewToken(t){await this.signal.request(De.RENEW_TOKEN,t),this.key=t.token}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),this.state!=="CONNECTED")return void(this.role=t);let i;i=t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0,await this.signal.request(De.SET_CLIENT_ROLE,{role:t,level:i,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(De.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(De.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(De.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(De.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Eo({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(De.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=gE.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:jr.username,password:jr.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Eo(Eo({},jr),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(De.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(s=>s.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&Ji(()=>{this.emit(Lt.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new V(P.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let i=H("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}i&&i.length>128&&(i=void 0);const s=Eo({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:si,browser:navigator.userAgent,process_id:H("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:H("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:{enablePublishedUserList:H("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:H("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof H("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?H("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof H("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?H("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof H("ENABLE_USER_LICENSE_CHECK")=="boolean"?H("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:H("USE_PUB_RTX")===!0||H("USE_SUB_RTX")===!0||void 0}},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(s.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(s.aes_mode=this.joinInfo.aesmode,H("ENCRYPT_AES")?(s.aes_secret=this.joinInfo.aespassword,s.aes_encrypt=!0):s.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(s.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(s.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(s.default_video_stream=this.joinInfo.defaultVideoStream),s}getRejoinMessage(){if(!this.joinInfo)throw new V(P.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Ae.WS_RECONNECT_WAITTING_FINISH,t=>{["tryNext","recover"].includes(t)&&this.joinInfo&&we.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(Ae.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Ae.WS_RECONNECTING,t=>{this.joinInfo&&we.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||cr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",we.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Ae.WS_CLOSED,t=>{let n;switch(t){case ct.LEAVE:n=cr.LEAVE;break;case ct.UID_BANNED:case ct.IP_BANNED:case ct.CHANNEL_BANNED:case ct.SERVER_ERROR:n=cr.SERVER_ERROR;break;case ct.FALLBACK:n=cr.FALLBACK;break;case ct.LICENSE_MISSING:case ct.LICENSE_EXPIRED:case ct.LICENSE_MINUTES_EXCEEDED:case ct.LICENSE_PERIOD_INVALID:case ct.LICENSE_MULTIPLE_SDK_SERVICE:case ct.LICENSE_ILLEGAL:n=t;break;default:n=cr.NETWORK_ERROR}I.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+cr.NETWORK_ERROR)),this.joinInfo&&we.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===ct.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==ct.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Ae.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&this._clientRoleOptions.level&&(I.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),we.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Go?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void I.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));Et("EVENT_REPORT_DOMAIN",t[1]),Et("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Et("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}),this.signal.on(Ke.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Ae.REQUEST_RECOVER,(t,n,i)=>{if(!this.joinInfo)return i(new V(P.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Gn(this,Lt.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(Ae.REQUEST_JOIN_INFO,async t=>{var n;this.updateTurnConfigFromSignal();const{iceParameters:i,dtlsParameters:s,rtpCapabilities:u}=await Gn(this,Lt.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(n=this.joinInfo)===null||n===void 0?void 0:n.turnServer});t(this.getJoinMessage({ortc:{iceParameters:i,dtlsParameters:s,rtpCapabilities:u,version:"2"}}))}),this.signal.on(Ae.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Ae.REPORT_JOIN_GATEWAY,(t,n)=>{this.joinInfo&&(we.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Go?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(Ae.IS_P2P_DISCONNECTED,t=>{t(Ca(this,Lt.IS_P2P_DISCONNECTED))}),this.signal.on(Ae.DISCONNECT_P2P,()=>{this.emit(Lt.DISCONNECT_P2P)}),this.signal.on(Ae.NEED_RENEW_SESSION,()=>{this.emit(Lt.NEED_RENEW_SESSION)}),this.signal.on(Ae.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Ae.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Ae.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(Lt.JOIN_RESPONSE,t,n)}),this.signal.on(Ae.DATACHANNEL_PRECONNECT,async(t,n,i)=>{this.updateTurnConfigFromSignal();const s=this.getCurrentGatewayAddress();return Gn(this,Lt.DATACHANNEL_PRECONNECT,t,s).then(n).catch(i)}),this.signal.on(Ae.DATACHANNEL_CONNECTING,async t=>{const{iceParameters:n,dtlsParameters:i,rtpCapabilities:s}=await Gn(this,Lt.REQUEST_DC_CONNECTION_PARAMS);t(this.getJoinMessage({ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:s,version:"2"}}))}),this.signal.on(Ae.DATACHANNEL_FAILBACK,()=>{I.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Lt.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(De.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(i){throw I.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(De.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(i){throw I.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryMassUnsubBeforeResub(t){const n={users:t.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(De.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw I.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(t,n){const i={action:t.find(s=>s.stream_type===sn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(De.CONTROL,i,!0,!0)}catch(s){throw I.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),s),s}}async unmuteLocal(t,n){const i={action:t.find(s=>s.stream_type===sn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(De.CONTROL,i,!0,!0)}catch(s){throw I.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),s),s}}uploadStats(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(De.RESTART_ICE,n,!0)}catch(i){throw I.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,cr.P2P_FAILED)}getCurrentGatewayAddress(){var t;if(!H("GATEWAY_WSS_ADDRESS"))return(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(De.SET_PARAMETER,{enablePublishAudioFilter:t})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(ct.FALLBACK)),this.store.useDataChannel=!1,this.signal=new zA(Eo(Eo({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Lt.RESET_SIGNAL,Vh.websocket)}}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(Z){var re=0;return function(){return re<Z.length?{done:!1,value:Z[re++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(Z,re,_e){return Z==Array.prototype||Z==Object.prototype||(Z[re]=_e.value),Z},i,s=function(Z){Z=[typeof globalThis=="object"&&globalThis,Z,typeof window=="object"&&window,typeof self=="object"&&self,typeof c=="object"&&c];for(var re=0;re<Z.length;++re){var _e=Z[re];if(_e&&_e.Math==Math)return _e}throw Error("Cannot find global object")}(this);function u(Z,re){if(re)e:{var _e=s;Z=Z.split(".");for(var xe=0;xe<Z.length-1;xe++){var nt=Z[xe];if(!(nt in _e))break e;_e=_e[nt]}(re=re(xe=_e[Z=Z[Z.length-1]]))!=xe&&re!=null&&n(_e,Z,{configurable:!0,writable:!0,value:re})}}function d(Z){return(Z={next:Z})[Symbol.iterator]=function(){return this},Z}function h(Z){var re=typeof Symbol<"u"&&Symbol.iterator&&Z[Symbol.iterator];return re?re.call(Z):{next:t(Z)}}if(u("Symbol",function(Z){function re(nt,ce){this.A=nt,n(this,"description",{configurable:!0,writable:!0,value:ce})}if(Z)return Z;re.prototype.toString=function(){return this.A};var _e="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",xe=0;return function nt(ce){if(this instanceof nt)throw new TypeError("Symbol is not a constructor");return new re(_e+(ce||"")+"_"+xe++,ce)}}),u("Symbol.iterator",function(Z){if(Z)return Z;Z=Symbol("Symbol.iterator");for(var re="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),_e=0;_e<re.length;_e++){var xe=s[re[_e]];typeof xe=="function"&&typeof xe.prototype[Z]!="function"&&n(xe.prototype,Z,{configurable:!0,writable:!0,value:function(){return d(t(this))}})}return Z}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var p;e:{var m={};try{m.__proto__={a:!0},p=m.a;break e}catch{}p=!1}i=p?function(Z,re){if(Z.__proto__=re,Z.__proto__!==re)throw new TypeError(Z+" is not extensible");return Z}:null}var _=i;function E(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function y(Z){if(Z.m)throw new TypeError("Generator is already running");Z.m=!0}function A(Z,re){return Z.h=3,{value:re}}function k(Z){this.g=new E,this.G=Z}function L(Z,re,_e,xe){try{var nt=re.call(Z.g.j,_e);if(!(nt instanceof Object))throw new TypeError("Iterator result "+nt+" is not an object");if(!nt.done)return Z.g.m=!1,nt;var ce=nt.value}catch(S){return Z.g.j=null,Z.g.s(S),x(Z)}return Z.g.j=null,xe.call(Z.g,ce),x(Z)}function x(Z){for(;Z.g.h;)try{var re=Z.G(Z.g);if(re)return Z.g.m=!1,{value:re.value,done:!1}}catch(_e){Z.g.v=void 0,Z.g.s(_e)}if(Z.g.m=!1,Z.g.l){if(re=Z.g.l,Z.g.l=null,re.F)throw re.D;return{value:re.return,done:!0}}return{value:void 0,done:!0}}function z(Z){this.next=function(re){return Z.o(re)},this.throw=function(re){return Z.s(re)},this.return=function(re){return function(_e,xe){y(_e.g);var nt=_e.g.j;return nt?L(_e,"return"in nt?nt.return:function(ce){return{value:ce,done:!0}},xe,_e.g.return):(_e.g.return(xe),x(_e))}(Z,re)},this[Symbol.iterator]=function(){return this}}function X(Z,re){return re=new z(new k(re)),_&&Z.prototype&&_(re,Z.prototype),re}if(E.prototype.o=function(Z){this.v=Z},E.prototype.s=function(Z){this.l={D:Z,F:!0},this.h=this.C||this.u},E.prototype.return=function(Z){this.l={return:Z},this.h=this.u},k.prototype.o=function(Z){return y(this.g),this.g.j?L(this,this.g.j.next,Z,this.g.o):(this.g.o(Z),x(this))},k.prototype.s=function(Z){return y(this.g),this.g.j?L(this,this.g.j.throw,Z,this.g.o):(this.g.s(Z),x(this))},u("Array.prototype.entries",function(Z){return Z||function(){return function(re,_e){re instanceof String&&(re+="");var xe=0,nt=!1,ce={next:function(){if(!nt&&xe<re.length){var S=xe++;return{value:_e(S,re[S]),done:!1}}return nt=!0,{done:!0,value:void 0}}};return ce[Symbol.iterator]=function(){return ce},ce}(this,function(re,_e){return[re,_e]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ie=function(Z,re){for(var _e=0;_e<Z.length;_e++)re(Z[_e])},Ie=function(Z){return Z.replace(/\r?\n|\r/g,`\r
`)},se=function(Z,re,_e){return re instanceof Blob?(_e=_e!==void 0?String(_e+""):typeof re.name=="string"?re.name:"blob",re.name===_e&&Object.prototype.toString.call(re)!=="[object Blob]"||(re=new File([re],_e)),[String(Z),re]):[String(Z),String(re)]},de=function(Z,re){if(Z.length<re)throw new TypeError(re+" argument required, but only "+Z.length+" present.")},oe=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,ve=oe.FormData,pt=oe.XMLHttpRequest&&oe.XMLHttpRequest.prototype.send,Be=oe.Request&&oe.fetch,At=oe.navigator&&oe.navigator.sendBeacon,gt=oe.Element&&oe.Element.prototype,Xt=oe.Symbol&&Symbol.toStringTag;Xt&&(Blob.prototype[Xt]||(Blob.prototype[Xt]="Blob"),"File"in oe&&!File.prototype[Xt]&&(File.prototype[Xt]="File"));try{new File([],"")}catch{oe.File=function(re,_e,xe){return re=new Blob(re,xe||{}),Object.defineProperties(re,{name:{value:_e},lastModified:{value:+(xe&&xe.lastModified!==void 0?new Date(xe.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Xt&&Object.defineProperty(re,Xt,{value:"File"}),re}}var Nn=function(Z){return Z.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Yt=function(Z){this.i=[];var re=this;Z&&ie(Z.elements,function(_e){if(_e.name&&!_e.disabled&&_e.type!=="submit"&&_e.type!=="button"&&!_e.matches("form fieldset[disabled] *"))if(_e.type==="file"){var xe=_e.files&&_e.files.length?_e.files:[new File([],"",{type:"application/octet-stream"})];ie(xe,function(nt){re.append(_e.name,nt)})}else _e.type==="select-multiple"||_e.type==="select-one"?ie(_e.options,function(nt){!nt.disabled&&nt.selected&&re.append(_e.name,nt.value)}):_e.type==="checkbox"||_e.type==="radio"?_e.checked&&re.append(_e.name,_e.value):(xe=_e.type==="textarea"?Ie(_e.value):_e.value,re.append(_e.name,xe))})};if((e=Yt.prototype).append=function(Z,re,_e){de(arguments,2),this.i.push(se(Z,re,_e))},e.delete=function(Z){de(arguments,1);var re=[];Z=String(Z),ie(this.i,function(_e){_e[0]!==Z&&re.push(_e)}),this.i=re},e.entries=function Z(){var re,_e=this;return X(Z,function(xe){if(xe.h==1&&(re=0),xe.h!=3)return re<_e.i.length?xe=A(xe,_e.i[re]):(xe.h=0,xe=void 0),xe;re++,xe.h=2})},e.forEach=function(Z,re){de(arguments,1);for(var _e=h(this),xe=_e.next();!xe.done;xe=_e.next()){var nt=h(xe.value);xe=nt.next().value,nt=nt.next().value,Z.call(re,nt,xe,this)}},e.get=function(Z){de(arguments,1);var re=this.i;Z=String(Z);for(var _e=0;_e<re.length;_e++)if(re[_e][0]===Z)return re[_e][1];return null},e.getAll=function(Z){de(arguments,1);var re=[];return Z=String(Z),ie(this.i,function(_e){_e[0]===Z&&re.push(_e[1])}),re},e.has=function(Z){de(arguments,1),Z=String(Z);for(var re=0;re<this.i.length;re++)if(this.i[re][0]===Z)return!0;return!1},e.keys=function Z(){var re,_e,xe,nt,ce=this;return X(Z,function(S){if(S.h==1&&(re=h(ce),_e=re.next()),S.h!=3)return _e.done?void(S.h=0):(xe=_e.value,nt=h(xe),A(S,nt.next().value));_e=re.next(),S.h=2})},e.set=function(Z,re,_e){de(arguments,2),Z=String(Z);var xe=[],nt=se(Z,re,_e),ce=!0;ie(this.i,function(S){S[0]===Z?ce&&(ce=!xe.push(nt)):xe.push(S)}),ce&&xe.push(nt),this.i=xe},e.values=function Z(){var re,_e,xe,nt,ce=this;return X(Z,function(S){if(S.h==1&&(re=h(ce),_e=re.next()),S.h!=3)return _e.done?void(S.h=0):(xe=_e.value,(nt=h(xe)).next(),A(S,nt.next().value));_e=re.next(),S.h=2})},Yt.prototype._asNative=function(){for(var Z=new ve,re=h(this),_e=re.next();!_e.done;_e=re.next()){var xe=h(_e.value);_e=xe.next().value,xe=xe.next().value,Z.append(_e,xe)}return Z},Yt.prototype._blob=function(){var Z="----formdata-polyfill-"+Math.random(),re=[],_e="--"+Z+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(xe,nt){return typeof xe=="string"?re.push(_e+Nn(Ie(nt))+`"\r
\r
`+Ie(xe)+`\r
`):re.push(_e+Nn(Ie(nt))+'"; filename="'+Nn(xe.name)+`"\r
Content-Type: `+(xe.type||"application/octet-stream")+`\r
\r
`,xe,`\r
`)}),re.push("--"+Z+"--"),new Blob(re,{type:"multipart/form-data; boundary="+Z})},Yt.prototype[Symbol.iterator]=function(){return this.entries()},Yt.prototype.toString=function(){return"[object FormData]"},gt&&!gt.matches&&(gt.matches=gt.matchesSelector||gt.mozMatchesSelector||gt.msMatchesSelector||gt.oMatchesSelector||gt.webkitMatchesSelector||function(Z){for(var re=(Z=(this.document||this.ownerDocument).querySelectorAll(Z)).length;0<=--re&&Z.item(re)!==this;);return-1<re}),Xt&&(Yt.prototype[Xt]="FormData"),pt){var Tr=oe.XMLHttpRequest.prototype.setRequestHeader;oe.XMLHttpRequest.prototype.setRequestHeader=function(Z,re){Tr.call(this,Z,re),Z.toLowerCase()==="content-type"&&(this.B=!0)},oe.XMLHttpRequest.prototype.send=function(Z){Z instanceof Yt?(Z=Z._blob(),this.B||this.setRequestHeader("Content-Type",Z.type),pt.call(this,Z)):pt.call(this,Z)}}Be&&(oe.fetch=function(Z,re){return re&&re.body&&re.body instanceof Yt&&(re.body=re.body._blob()),Be.call(this,Z,re)}),At&&(oe.navigator.sendBeacon=function(Z,re){return re instanceof Yt&&(re=re._asNative()),At.call(this,Z,re)}),oe.FormData=Yt}})();const Zh=()=>{const e=H("AREAS");return e.length===0&&e.push($e.GLOBAL),hs(e).call(e,(t,n,i)=>{const s=$A(n);return s?i===0?s:"".concat(t,",").concat(s):t},"")},$A=e=>e===$e.OVERSEA?"".concat(Sn.ASIA,",").concat(Sn.EUROPE,",").concat(Sn.AFRICA,",").concat(Sn.NORTH_AMERICA,",").concat(Sn.SOUTH_AMERICA,",").concat(Sn.OCEANIA):Sn[e],$3=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const i=Bh[n],s=Object.keys(i);s&&s.map(u=>{u!=="CODE"&&(t[u]=t[u].concat(i[u]))})}),t},ep={GLOBAL:{ASIA:[$e.CHINA,$e.JAPAN,$e.INDIA,$e.KOREA,$e.HKMC],EUROPE:[],NORTH_AMERICA:[$e.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},SE=Object.keys(ep[$e.GLOBAL]),ZA=[$e.CHINA,$e.NORTH_AMERICA,$e.EUROPE,$e.ASIA,$e.JAPAN,$e.INDIA,$e.OCEANIA,$e.SOUTH_AMERICA,$e.AFRICA,$e.KOREA,$e.HKMC,$e.US],Z3=function(e,t){let n=[];if(e.includes($e.GLOBAL)){const u=[$e.GLOBAL,$e.OVERSEA],d=Object.keys(Bh);if(t===$e.GLOBAL)throw new V(P.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===$e.CHINA)n=[$e.OVERSEA];else if(s=t,SE.includes(s)){const h=(i=t,ep[$e.GLOBAL][i]||[]),p=[...u,t,...h];n=d.filter(m=>!p.includes(m))}else if(function(h){let p=!1;return SE.forEach(m=>{ep[$e.GLOBAL][m].includes(h)&&(p=!0)}),p}(t)){const h=function(m){let _;return SE.forEach(E=>{ep[$e.GLOBAL][E].includes(m)&&(_=E)}),_}(t),p=[...u,h,t];n=d.filter(m=>!p.includes(m))}else n=e;n=function(h){const p=[];return ZA.forEach(m=>{h.includes(m)&&p.push(m)}),p.concat(h.filter(m=>!ZA.includes(m)))}(n)}else n=e;var i,s;return n};function ew(e){if(!e&&H("AREAS").includes($e.EXTENSIONS))return I.debug("update area from ap : reset"),void TE(VC,!0);if(!H("AREAS").includes($e.GLOBAL)||!e)return;let t=Bh.EXTENSIONS;t&&(t={CODE:$A($e.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},I.debug("update area from ap success: ".concat(e,",config is "),t),Et("AREAS",[$e.EXTENSIONS],!0),Object.keys(t).map(n=>{n==="LOG_UPLOAD_SERVER"||n==="EVENT_REPORT_DOMAIN"||n==="EVENT_REPORT_BACKUP_DOMAIN"||n==="PROXY_SERVER_TYPE3"?Et(n,t[n][0]):Et(n,t[n])}))}function TE(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=we.reportApiInvoke(null,{name:rn.SET_AREA,options:e,tag:Ut.TRACER});try{let i=[];if(typeof e=="string"&&(i=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!AF.includes(u))throw new V(P.INVALID_PARAMS,"invalid area code")}),i=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:u,excludedArea:d}=e;if(!u)throw new V(P.INVALID_PARAMS,"area code is needed");let h=u;typeof u=="string"&&(h=[u]),i=d?Z3(h,d):h}if(!t){if(ma.AREAS){const u=new V(P.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(u),void I.warning("setArea is prohibited because of config-distribute")}if(i.includes($e.GLOBAL)&&H("AREAS")===$e.EXTENSIONS){const u=new V(P.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(u),void I.warning("setArea is prohibited because of ap extensions")}}Et("AREAS",i,t);const s=$3(i);Object.keys(s).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?Et(u,s[u][0]):Et(u,s[u])}),I.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function tw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function nw(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?tw(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tw(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let yE=1;function e8(e,t,n,i,s){yE+=1;const u={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:yE,requestId:yE,version:si,cname:n.cname},d={service_name:t,json_body:JSON.stringify(u)};let h,p,m=e[0];return po(async()=>{h=Date.now();const _=await Yi(m,{data:d,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(p=Date.now()-h,_.code!==0){const A=new V(P.UNEXPECTED_RESPONSE,"live streaming ap error, code"+_.code,{retry:!0,responseTime:p});throw I.error(A.toString()),A}const E=JSON.parse(_.json_body);if(E.code!==200){const A=new V(P.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(E.code,", reason: ").concat(E.reason),{code:E.code,responseTime:p});throw I.error(A.toString()),A}if(!E.servers||E.servers.length===0){const A=new V(P.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:E.code,responseTime:p});throw I.error(A.toString()),A}const y=function(A,k){return{addressList:A.servers.map(L=>"wss://".concat(L.address.replace(/\./g,"-"),".").concat(H("WORKER_DOMAIN"),":").concat(L.wss,"?serviceName=").concat(encodeURIComponent(k))),workerToken:A.workerToken,vid:A.vid}}(E,t);return H("LIVE_STREAMING_ADDRESS")&&(y.addressList=H("LIVE_STREAMING_ADDRESS")instanceof Array?H("LIVE_STREAMING_ADDRESS"):[H("LIVE_STREAMING_ADDRESS")]),nw(nw({},y),{},{responseTime:p})},(_,E)=>(we.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(_.addressList),firstSuccess:E===0,responseTime:p,serverIp:e[E%e.length]}),!1),(_,E)=>(we.apworkerEvent(n.sid,{success:!1,sc:_.data&&_.data.code||200,serviceName:t,responseTime:p,serverIp:e[E%e.length]}),!!(_.code!==P.OPERATION_ABORTED&&_.code!==P.UNEXPECTED_RESPONSE||_.data&&_.data.retry)&&(m=e[(E+1)%e.length],!0)),s)}let RE=1;function rw(e,t,n,i){let{url:s,areaCode:u}=e;const d=Date.now();let h;const[p,m]=aw(t,u,[mn.CHOOSE_SERVER]);let _=$t.networkState;return po(async()=>{_&&$t.networkState===Kn.OFFLINE&&$t.onlineWaiter&&await Ee.race([$t.onlineWaiter,Fn(i&&i.maxRetryTimeout||un.maxRetryTimeout)]),_=$t.networkState;const{data:E,headers:y}=await Yi(s,{data:p,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=y.http3==="1"?1:-1,we.reportResourceTiming(s,t.sid),ow(E,s,t,d,[mn.CHOOSE_SERVER],h);const A=_E(E,mn.CHOOSE_SERVER);return sw(A),LA(A,s)},E=>(E&&we.joinChooseServer(t.sid,{lts:d,succ:!0,csAddr:s,opid:m,serverList:E.gatewayAddrs.map(y=>y.address),ec:null,cid:E.cid.toString(),uid:E.uid.toString(),csIp:E.csIp,unilbsServerIds:[mn.CHOOSE_SERVER].toString(),isHttp3:h}),!1),E=>E.code!==P.OPERATION_ABORTED&&(E.code===P.CAN_NOT_GET_GATEWAY_SERVER?E.data.retry:(we.joinChooseServer(t.sid,{lts:d,succ:!1,csAddr:s,serverList:null,opid:m,ec:E.code,csIp:E.data&&E.data.csIp,unilbsServerIds:[mn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:_}),isHttp3:h}),I.warning("[".concat(t.clientId,"] Choose server network error, retry"),E),!0)),i)}function iw(e,t,n,i){let s,{url:u,areaCode:d,serviceIds:h}=e;const p=Date.now(),[m,_]=aw(t,d,h);let E;return po(async()=>{E&&$t.networkState===Kn.OFFLINE&&$t.onlineWaiter&&await Ee.race([$t.onlineWaiter,Fn(i&&i.maxRetryTimeout||un.maxRetryTimeout)]),E=$t.networkState;const{data:y,headers:A}=await Yi(u,{data:m,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);s=A.http3==="1"?1:-1,we.reportResourceTiming(u,t.sid),ow(y,u,t,p,h,s);const k=_E(y,mn.CHOOSE_SERVER),L=_E(y,t.cloudProxyServer==="proxy5"?mn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?mn.CLOUD_PROXY:mn.CLOUD_PROXY_FALLBACK);return sw(k),{gatewayInfo:LA(k,u),proxyInfo:L,url:u}},y=>(y.gatewayInfo&&we.joinChooseServer(t.sid,{lts:p,succ:!0,csAddr:u,serverList:y.gatewayInfo.gatewayAddrs.map(A=>A.address),ec:null,opid:_,cid:y.gatewayInfo.cid.toString(),uid:y.gatewayInfo.uid.toString(),csIp:y.gatewayInfo.csIp,unilbsServerIds:h.toString(),isHttp3:s}),y.proxyInfo&&we.joinWebProxyAP(t.sid,{lts:p,sucess:1,apServerAddr:u,turnServerAddrList:y.proxyInfo.addresses.map(A=>A.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:h.toString()}),!1),y=>y.code!==P.OPERATION_ABORTED&&(y.code===P.CAN_NOT_GET_GATEWAY_SERVER?y.data.retry:(we.joinWebProxyAP(t.sid,{lts:p,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:y.code,eventType:t.cloudProxyServer,unilbsServerIds:h.toString(),extend:JSON.stringify({networkState:E})}),I.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),y),!0)),i)}const ow=(e,t,n,i,s,u)=>{const d=[],h=p=>{p.flag===4096?we.joinChooseServer(n.sid,{lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:p.error.message,csIp:p.error.data&&p.error.data.csIp,unilbsServerIds:s.toString(),isHttp3:u}):p.flag!==1048576&&p.flag!==4194304&&p.flag!==4194310||we.joinWebProxyAP(n.sid,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:p.error.code,eventType:n.cloudProxyServer,unilbsServerIds:s.toString()})};if(e.response_body.forEach(p=>{const m=p.buffer.code;if(p.uri===23&&m===0&&!p.buffer.edges_services)if(p.buffer.flag===4194310)I.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),p.buffer.edges_services=[];else{const _={error:new V(P.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:p.buffer.flag};d.push(_),h(_)}if(m!==0){const _=$h(m),E={error:new V(P.CAN_NOT_GET_GATEWAY_SERVER,_.desc,{desc:_.desc,retry:_.retry,csIp:e.detail[502]}),flag:p.buffer.flag};p.buffer.flag===4194310?I.warning(E.error.toString()):d.push(E),h(E)}}),d.length)throw I.warning("[".concat(n.clientId,"] multi unilbs ").concat(t," failed, ").concat(d.map(p=>"flag: ".concat(p.flag,", message: ").concat(p.error.message,", retry: ").concat(p.error.data.retry)).join(" | "))),new V(P.CAN_NOT_GET_GATEWAY_SERVER,d.map(p=>"flag: ".concat(p.flag,", message: ").concat(p.error.message)).join(" | "),{retry:!!d.find(p=>p.error.data.retry),csIp:e.detail[502],desc:[...new Set(d.map(p=>{var m,_;return p==null||(m=p.error)===null||m===void 0||(_=m.data)===null||_===void 0?void 0:_.desc}).filter(p=>!!p))]})},sw=e=>{var t,n,i,s;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new V(P.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(H("AP_AREA")&&((i=e.detail)!==null&&i!==void 0&&i[23]&&typeof((s=e.detail)===null||s===void 0?void 0:s[23])=="string"?ew(e.detail[23].toLowerCase()):ew()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const d=e.detail[19],h=d==null?void 0:d.split(";");for(let p=0;p<h.length;p++){var u;const m=xo(u=h[p]).call(u);e.addresses[p]&&h&&(e.addresses[p].fingerprint=m)}}if(H("GATEWAY_ADDRESS")&&H("GATEWAY_ADDRESS").length>0){I.debug("assign gateway address to",H("GATEWAY_ADDRESS"));const d=H("GATEWAY_ADDRESS").map(h=>{var p,m;const _=(p=(m=e.addresses.find(E=>E.ip===h.ip&&E.port===h.port))===null||m===void 0?void 0:m.fingerprint)!==null&&p!==void 0?p:"";return{ip:h.ip,port:h.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:_}});e.addresses=d}},t8=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const i=$h(n.buffer.code);throw new V(P.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw I.debug("update ticket request received ap response without response body:",t),new V(P.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},aw=(e,t,n)=>{const i=Math.floor(Math.random()*1e12),s={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:{6:e.stringUid,11:t,12:H("USE_NEW_TOKEN")?"1":void 0,22:t},key:e.token,service_ids:n,uid:e.uid||0}}]};s.request_bodies.forEach(d=>{e.multiIP&&e.multiIP.gateway_ip&&(d.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const u=new FormData;return u.append("request",JSON.stringify(s)),[u,i]},n8=(e,t)=>{const n=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},s=new FormData;return s.append("request",JSON.stringify(i)),[s,n]};let CE=0;async function IE(e,t,n,i){return{gatewayInfo:await async function(u,d,h,p){let m=null;const _=[],E=async()=>{const A=H("WEBCS_DOMAIN").slice(0,H("AJAX_REQUEST_CONCURRENT")).map(x=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(x+"/api/v2/transpond/webrtc?v=2"):"https://".concat(x,"/api/v2/transpond/webrtc?v=2"),areaCode:Zh()})),k=p.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:A.map(x=>x.url)}),L=await ad({fragementLength:H("FRAGEMENT_LENGTH"),referenceList:A,asyncMapHandler:x=>(I.debug("[".concat(u.clientId,"] Connect to choose_server:"),x.url),rw(x,u,d,h)),allFailedhandler:x=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:x},k),x[0]},promisesCollector:_});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},k),L},y=async()=>{if(await Fn(1e3),m!==null)return m;const A=H("WEBCS_DOMAIN_BACKUP_LIST").map(x=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(x+"/api/v2/transpond/webrtc?v=2"):"https://".concat(x,"/api/v2/transpond/webrtc?v=2"),areaCode:Zh()})),k=p.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:A.map(x=>x.url)}),L=await ad({fragementLength:H("FRAGEMENT_LENGTH"),referenceList:A,asyncMapHandler:x=>(I.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),x.url),rw(x,u,d,h)),allFailedhandler:x=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:x},k),x[0]},promisesCollector:_});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},k),L};try{return m=await Pc([E(),y()]),_.length&&_.forEach(A=>A.cancel&&typeof A.cancel=="function"&&A.cancel()),m}catch(A){throw A[0]}}(e,t,n,i)}}async function cw(e,t,n,i,s){const u=e.cloudProxyServer;if(u==="disabled"){if(!i)return;if(e.useLocalAccessPoint)return await IE(e,t,n,s);if(H("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:m,proxyInfo:_}=await dw(e,t,n,s);return e.turnServer&&e.turnServer.mode!=="auto"||(e.turnServer={mode:"manual",servers:_.map(E=>({turnServerURL:E.address,tcpport:E.tcpport||jr.tcpport,udpport:E.udpport||jr.udpport,username:E.username||jr.username,password:E.password||jr.password,forceturn:!1,security:!0}))}),{gatewayInfo:m}}return await IE(e,t,n,s)}const{proxyInfo:d,gatewayInfo:h}=await dw(e,t,n,s),p={gatewayInfo:h};return e.turnServer={mode:"manual",servers:d.map(m=>({turnServerURL:m.address,tcpport:u==="proxy3"?void 0:m.tcpport?m.tcpport:jr.tcpport,udpport:u==="proxy4"?void 0:m.udpport?m.udpport:jr.udpport,username:m.username||jr.username,password:m.password||jr.password,forceturn:u!=="proxy4",security:u==="proxy5"}))},I.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),p}async function uw(e,t,n,i,s){const u=H("ACCOUNT_REGISTER").slice(0,H("AJAX_REQUEST_CONCURRENT"));let d=[];d=t.proxyServer?u.map(p=>"https://".concat(t.proxyServer,"/ap/?url=").concat(p+"/api/v1")):u.map(p=>"https://".concat(p,"/api/v1"));const h=s==null?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:d});try{const p=await async function(m,_,E,y,A){const k=Date.now(),L={sid:E.sid,opid:10,appid:E.appId,string_uid:_};let x=m[0];const z=await po(()=>Yi(x+"".concat(x.indexOf("?")===-1?"?":"&","action=stringuid"),{data:L,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(X,ie)=>{if(X.code===0){if(X.uid<=0||X.uid>=Math.pow(2,32))throw I.error("Invalid Uint Uid ".concat(_," => ").concat(X.uid),X),we.reqUserAccount(L.sid,{lts:k,success:!1,serverAddr:x,stringUid:L.string_uid,uid:X.uid,errorCode:P.INVALID_UINT_UID_FROM_STRING_UID,extend:L}),new V(P.INVALID_UINT_UID_FROM_STRING_UID);return we.reqUserAccount(L.sid,{lts:k,success:!0,serverAddr:x,stringUid:L.string_uid,uid:X.uid,errorCode:null,extend:L}),!1}const Ie=$h(X.code);return Ie.retry&&(x=m[(ie+1)%m.length]),we.reqUserAccount(L.sid,{lts:k,success:!1,serverAddr:x,stringUid:L.string_uid,uid:X.uid,errorCode:Ie.desc,extend:L}),Ie.retry},(X,ie)=>X.code!==P.OPERATION_ABORTED&&(we.reqUserAccount(L.sid,{lts:k,success:!1,serverAddr:x,stringUid:L.string_uid,uid:null,errorCode:X.code,extend:L}),x=m[(ie+1)%m.length],!0),A);if(z.code!==0){const X=$h(z.code);throw new V(P.UNEXPECTED_RESPONSE,X.desc)}return z}(d,e,t,n,i);return s==null||s.recordJoinChannelService({status:"success",endTs:Date.now()},h),p.uid}catch(p){throw s==null||s.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[p]},h),p}}async function r8(e,t,n){const i=H("CDS_AP").slice(0,H("AJAX_REQUEST_CONCURRENT")).map(h=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(h+"/api/v1"):"https://".concat(h,"/api/v1?action=config")).map(h=>function(p,m,_,E){const y=at(),A={flag:64,cipher_method:0,features:{device:y.name,system:y.os,system_general:navigator.userAgent,vendor:m.appId,version:si,cname:m.cname,sid:m.sid,session_id:m.sid,detail:"",proxyServer:m.proxyServer}};return po(()=>Yi(p,{data:A,timeout:1e3,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,k=>k.code!==P.OPERATION_ABORTED,E)}(h,e,t,n));let s=null,u=null,d={};try{s=await Pc(i)}catch(h){if(h.code===P.OPERATION_ABORTED)throw h;u=h}if(i.forEach(h=>h.cancel()),we.reportApiInvoke(e.sid,{name:rn.REQUEST_CONFIG_DISTRIBUTE,options:{error:u,res:s}}).onSuccess(),s&&s.test_tags)try{d=function(h){if(!h.test_tags)return{};const p=h.test_tags,m=Object.keys(p),_={};return m.forEach(E=>{var y;const A=xo(y=E.slice(4)).call(y),k=JSON.parse(p[E])[1];_[A]=k}),_}(s)}catch{}return d}async function dw(e,t,n,i){const s=H("PROXY_SERVER_TYPE3"),u=(A,k,L)=>{let x=L||s;return Array.isArray(x)&&(x=k%2==0?s[1]:s[0]),"https://".concat(x,"/ap/?url=").concat(A)};let d=null;const h=[],p=async()=>{const A=H("WEBCS_DOMAIN").slice(0,H("AJAX_REQUEST_CONCURRENT")).map((x,z)=>{let X;return X=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(x,"/api/v2/transpond/webrtc?v=2"),z,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(x,"/api/v2/transpond/webrtc?v=2"):u("".concat(x,"/api/v2/transpond/webrtc?v=2"),z),{url:X,areaCode:Zh(),serviceIds:[mn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?mn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?mn.CLOUD_PROXY:mn.CLOUD_PROXY_FALLBACK]}}),k=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:A.map(x=>x.url)}),L=await ad({fragementLength:H("FRAGEMENT_LENGTH"),referenceList:A,asyncMapHandler:x=>(I.debug("[".concat(e.clientId,"] Connect to choose_server:"),x.url),iw(x,e,t,n)),allFailedhandler:x=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:x},k),x[0]},promisesCollector:h});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},k),L},m=async()=>{if(await Fn(1e3),d!==null)return d;const A=H("WEBCS_DOMAIN_BACKUP_LIST").map((x,z)=>{let X;return X=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(x,"/api/v2/transpond/webrtc?v=2"),z,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(x,"/api/v2/transpond/webrtc?v=2"):u("".concat(x,"/api/v2/transpond/webrtc?v=2"),z),{url:X,areaCode:Zh(),serviceIds:[mn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?mn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?mn.CLOUD_PROXY:mn.CLOUD_PROXY_FALLBACK]}}),k=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:A.map(x=>x.url)}),L=await ad({fragementLength:H("FRAGEMENT_LENGTH"),referenceList:A,asyncMapHandler:x=>(I.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),x.url),iw(x,e,t,n)),allFailedhandler:x=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:x},k),x[0]},promisesCollector:h});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},k),L};let _,E,y;try{({gatewayInfo:_,proxyInfo:E,url:y}=await Pc([p(),m()]))}catch(A){throw A[0]}if(h.length&&h.forEach(A=>A.cancel&&typeof A.cancel=="function"&&A.cancel()),!_||!E)throw new V(P.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=y,e.cloudProxyServer!=="disabled"&&Array.isArray(s)&&y){const A=/^https?:\/\/(.+?)(\/.*)?$/.exec(y)[1];s.includes(A)&&(e.proxyServer=A,I.setProxyServer(A),we.setProxyServer(A))}return d={gatewayInfo:_,proxyInfo:await H3(E,_.uid)},d}async function lw(e,t,n,i){const s=H("UAP_AP").slice(0,H("AJAX_REQUEST_CONCURRENT")).map(u=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap"));return await e8(s,e,t,n,i)}async function i8(e,t,n){const i=H("UAP_AP").slice(0,H("AJAX_REQUEST_CONCURRENT")).map(s=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")).map(s=>function(u,d,h,p){const m={command:"convergeAllocateEdge",sid:d.sid,appId:d.appId,token:d.token,ts:Date.now(),version:si,cname:d.cname,uid:d.uid.toString(),requestId:RE,seq:RE};RE+=1;const _={service_name:"tele_channel",json_body:JSON.stringify(m)};return po(async()=>{const E=await Yi(u,{data:_,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(E.code!==0){const A=new V(P.UNEXPECTED_RESPONSE,"cross channel ap error, code"+E.code,{retry:!0});throw I.error(A.toString()),A}const y=JSON.parse(E.json_body);if(y.code!==200){const A=new V(P.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(y.code,", reason: ").concat(y.reason));throw I.error(A.toString()),A}if(!y.servers||y.servers.length===0){const A=new V(P.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw I.error(A.toString()),A}return{vid:y.vid,workerToken:y.workerToken,addressList:(H("CHANNEL_MEDIA_RELAY_SERVERS")||y.servers).map(A=>"wss://".concat(A.address.replace(/\./g,"-"),".").concat(H("WORKER_DOMAIN"),":").concat(A.wss))}},void 0,E=>!!(E.code!==P.OPERATION_ABORTED&&E.code!==P.UNEXPECTED_RESPONSE||E.data&&E.data.retry),p)}(s,e,t,n));try{const s=await Pc(i);return i.forEach(u=>u.cancel()),s}catch(s){throw s[0]}}async function o8(e,t,n){let i=null;const s=[],u=async d=>{const h=H(d?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(p=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(p+"/api/v2/transpond/webrtc?v=2"):"https://".concat(p,"/api/v2/transpond/webrtc?v=2"));return d&&(await Fn(1e3),i!==null)?i:await ad({fragementLength:H("FRAGEMENT_LENGTH"),referenceList:h,asyncMapHandler:p=>(I.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(d?"backup":""," choose_server:"),p),function(m,_,E,y){const[A]=n8(_,[mn.CHOOSE_SERVER]);let k=$t.networkState;return po(async()=>{k&&$t.networkState===Kn.OFFLINE&&$t.onlineWaiter&&await Ee.race([$t.onlineWaiter,Fn(y&&y.maxRetryTimeout||un.maxRetryTimeout)]),k=$t.networkState;const L=await Yi(m,{data:A,cancelToken:E,headers:{"Content-Type":"multipart/form-data;"}},!0);return t8(L,m)},()=>!1,L=>L.code!==P.OPERATION_ABORTED&&(L.code===P.UPDATE_TICKET_FAILED?L.data.retry:(I.warning("[".concat(_.clientId,"] update ticket network error, retry"),L),!0)),y)}(p,e,t,n)),allFailedhandler:p=>{throw p[0]},promisesCollector:s})};try{return i=await Pc([u(!1),u(!0)]),s.length&&s.forEach(d=>d.cancel&&typeof d.cancel=="function"&&d.cancel()),i}catch(d){throw d[0]}}function hw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function pw(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hw(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hw(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class s8 extends jt{constructor(){super(),g(this,"configs",void 0),g(this,"joinInfo",void 0),g(this,"cancelToken",void 0),g(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),g(this,"interval",void 0),g(this,"mutex",new nr("config-distribute")),g(this,"mutableParamsRead",!1)}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),H("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},H("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,we.reportApiInvoke(null,{options:void 0,name:rn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Ut.TRACER}).onSuccess(JSON.stringify(ma))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void I.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await r8(this.joinInfo,this.cancelToken,this.retryConfig),I.debug("[config-distribute] get config distribute",JSON.stringify(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(i){const s=new V(P.NETWORK_RESPONSE_ERROR,i);I.warning("[config-distribute] ".concat(s.toString()))}finally{n()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var n;(n=t)&&n.uplink&&n.id&&n.uplink.max_bitrate!==void 0&&n.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(id.UPDATE_BITRATE_LIMIT,t):this.emit(id.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&pw({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var n;const i=jm(n=Object.keys(t).filter(u=>/^webrtc_ng_global_parameter/.test(u))).call(n);for(let u=0;u<i.length;u++)for(let d=i.length-1;d>u;d--){const h=i[d];if(typeof t[h].__priority=="number"){const p=t[h].__priority,m=i[d-1];if(typeof t[m].__priority=="number"){if(!(p>t[m].__priority))continue;{const _=h;i[d]=i[d-1],i[d-1]=_}}else{const _=h;i[d]=i[d-1],i[d-1]=_}}}const s={};i.forEach(u=>{const d=t[u],h=d.__expires;Object.keys(d).forEach(p=>{p==="__priority"||p==="__expires"||Object.prototype.hasOwnProperty.call(s,p)||(s[p]=pw({value:d[p]},h&&{expires:h}))})});try{const u=JSON.stringify(s),d=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",d),I.debug("Caching global parameters ".concat(u))}catch(u){I.error("Error caching global parameters:",u.message)}}}function fw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function ud(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?fw(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fw(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class a8 extends jt{constructor(t,n,i,s){super(),g(this,"spec",void 0),g(this,"token",void 0),g(this,"websocket",void 0),g(this,"pingpongTimer",void 0),g(this,"reconnectMode","retry"),g(this,"serviceMode",void 0),g(this,"reqId",0),g(this,"commandReqId",0),g(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),g(this,"handleWebSocketMessage",u=>{if(!u.data)return;const d=JSON.parse(u.data);d.requestId?this.emit("@".concat(d.requestId,"-").concat(d.sid),d):this.serviceMode===on.INJECT?this.emit(Ii.INJECT_STREAM_STATUS,d):(we.workerEvent(this.spec.sid,{actionType:"status",serverCode:d.code,workerType:this.serviceMode===on.TRANSCODE?1:2}),this.emit(Ii.PUBLISH_STREAM_STATUS,d))}),this.spec=n,this.token=t,this.serviceMode=s,this.websocket=new Dc("live-streaming",i),this.websocket.on(Ge.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Ge.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Ge.REQUEST_NEW_URLS,(u,d)=>{Gn(this,Ii.REQUEST_NEW_ADDRESS).then(u).catch(d)}),this.websocket.on(Ge.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,i,s){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const u=this.commandReqId,d=this.reqId;if(!d||!this.websocket)throw new V(P.UNEXPECTED_ERROR);const h=ud({command:t,sdkVersion:si==="4.18.0"?"0.0.1":si,seq:d,requestId:d,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new V(P.WS_DISCONNECT);const p=()=>new Ee((y,A)=>{this.websocket.once(Ge.CLOSED,()=>A(new V(P.WS_ABORT))),this.websocket.once(Ge.CONNECTED,y)});this.websocket.state!=="connected"&&await p(),h.clientRequest&&(h.clientRequest.workerToken=this.token);const m=new Ee((y,A)=>{const k=()=>{A(new V(P.WS_ABORT))};this.websocket.once(Ge.RECONNECTING,k),this.websocket.once(Ge.CLOSED,k),this.once("@".concat(d,"-").concat(this.spec.sid),L=>{y(L)})});s&&we.workerEvent(this.spec.sid,ud(ud({},s),{},{requestId:u,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const _=Date.now();this.websocket.sendMessage(h);let E=null;try{E=await m}catch(y){if(this.websocket.state==="closed")throw y;return await p(),await this.request(t,n,i)}return s&&we.workerEvent(this.spec.sid,ud(ud({},s),{},{requestId:u,actionType:"response",payload:JSON.stringify(E.serverResponse),serverCode:E.code,success:E.code===200,responseTime:Date.now()-_})),E.code!==200&&this.handleResponseError(E),E}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=si==="4.18.0"?"0.0.1":si;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case zt.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void I.warning("live stream response already exists stream");case zt.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case zt.LIVE_STREAM_RESPONSE_BAD_STREAM:case zt.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new V(P.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case zt.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new V(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case zt.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new V(P.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case zt.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new V(P.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Ii.WARNING,n,t.serverResponse.url)}case zt.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new V(P.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Ii.WARNING,n,t.serverResponse.url)}case zt.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new V(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case zt.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new V(P.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case zt.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new V(P.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Ii.WARNING,n,t.serverResponse.url)}case zt.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new V(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case zt.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new V(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case zt.LIVE_STREAM_RESPONSE_WORKER_LOST:case zt.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new V(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case zt.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new V(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new V(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case zt.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case zt.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case zt.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case zt.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new V(P.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Xh)},6e3)}}function _w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function ur(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?_w(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_w(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class c8 extends jt{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:un,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:un;super(),g(this,"onLiveStreamWarning",void 0),g(this,"onLiveStreamError",void 0),g(this,"onInjectStatusChange",void 0),g(this,"spec",void 0),g(this,"retryTimeout",1e4),g(this,"connection",void 0),g(this,"httpRetryConfig",void 0),g(this,"wsRetryConfig",void 0),g(this,"streamingTasks",new Map),g(this,"isStartingStreamingTask",!1),g(this,"taskMutex",new nr("live-streaming")),g(this,"cancelToken",Ri.CancelToken.source()),g(this,"transcodingConfig",void 0),g(this,"injectConfig",ur({},IF)),g(this,"injectLoopTimes",0),g(this,"uapResponse",void 0),g(this,"lastTaskId",1),g(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=ur(ur({},CF),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(I.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(d=>ur(ur(ur({},RF),d),{},{zOrder:d.zOrder?d.zOrder+1:1}))),function(d){Ot(d.width)||Ct(d.width,"config.width",0,1e4),Ot(d.height)||Ct(d.height,"config.height",0,1e4),Ot(d.videoBitrate)||Ct(d.videoBitrate,"config.videoBitrate",1,1e6),Ot(d.videoFrameRate)||Ct(d.videoFrameRate,"config.videoFrameRate"),Ot(d.lowLatency)||ed(d.lowLatency,"config.lowLatency"),Ot(d.audioSampleRate)||gn(d.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Ot(d.audioBitrate)||Ct(d.audioBitrate,"config.audioBitrate",1,128),Ot(d.audioChannels)||gn(d.audioChannels,"config.audioChannels",[1,2,3,4,5]),Ot(d.videoGop)||Ct(d.videoGop,"config.videoGop"),Ot(d.videoCodecProfile)||gn(d.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Ot(d.userCount)||Ct(d.userCount,"config.userCount",0,17),Ot(d.backgroundColor)||Ct(d.backgroundColor,"config.backgroundColor",0,16777215),Ot(d.userConfigExtraInfo)||xn(d.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),d.transcodingUsers&&!Ot(d.transcodingUsers)&&(Vo(d.transcodingUsers,"config.transcodingUsers"),d.transcodingUsers.forEach((h,p)=>{Wm(h.uid),Ot(h.x)||Ct(h.x,"transcodingUser[".concat(p,"].x"),0,1e4),Ot(h.y)||Ct(h.y,"transcodingUser[".concat(p,"].y"),0,1e4),Ot(h.width)||Ct(h.width,"transcodingUser[".concat(p,"].width"),0,1e4),Ot(h.height)||Ct(h.height,"transcodingUser[".concat(p,"].height"),0,1e4),Ot(h.zOrder)||Ct(h.zOrder-1,"transcodingUser[".concat(p,"].zOrder"),0,100),Ot(h.alpha)||Ct(h.alpha,"transcodingUser[".concat(p,"].alpha"),0,1,!1)})),Ot(d.watermark)||Xm(d.watermark,"watermark"),Ot(d.backgroundImage)||Xm(d.backgroundImage,"backgroundImage"),d.images&&!Ot(d.images)&&(Vo(d.images,"config.images"),d.images.forEach((h,p)=>{Xm(h,"images[".concat(p,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(d=>ur(ur(ur({},Jm),d),{},{zOrder:255}))),n.backgroundImage&&(i.push(ur(ur(ur({},Jm),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(ur(ur(ur({},Jm),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(d=>ur({},d)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const s=(n.userConfigs||[]).map(d=>typeof d.uid=="number"?Ee.resolve(d.uid):uw(d.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Ee.all(s)).forEach((d,h)=>{n.userConfigs&&n.userConfigs[h]&&(n.userConfigs[h].uid=d)}),this.transcodingConfig=n,this.connection)try{var u;const d=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(_o(u=this.streamingTasks).call(u)).map(h=>h.taskId).join("#")});I.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(d.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(d){if(!d.data||!d.data.retry)throw d;d.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(h=>{I.warning("[".concat(this.spec.clientId,"] live streaming receive error"),d.toString(),"try to republish",h.url),this.startLiveStreamingTask(h.url,h.mode,d).then(()=>{I.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(h.url," success"))}).catch(p=>{I.error("[".concat(this.spec.clientId,"] live streaming republish failed"),h.url,p.toString()),this.onLiveStreamError&&this.onLiveStreamError(h.url,p)})})}}setInjectStreamConfig(t,n){this.injectConfig=Object.assign({},this.injectConfig,t),this.injectLoopTimes=n}async startLiveStreamingTask(t,n,i){var s;if(Array.from(_o(s=this.streamingTasks).call(s)).find(p=>p.mode===on.INJECT)&&n===on.INJECT)return new V(P.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&n===on.TRANSCODE)throw new V(P.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let u={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};I.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const d=await this.taskMutex.lock();if(!this.connection&&i)return void d();if(this.streamingTasks.get(t)&&!i)return d(),new V(P.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(p){throw d(),p}switch(n){case on.TRANSCODE:u.transcodingConfig=ur({},this.transcodingConfig);break;case on.RAW:break;case on.INJECT:u={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(u.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const p=new Ee((_,E)=>{Fn(this.retryTimeout).then(()=>{if(i)return E(i);const y=this.statusError.get(t);return y?(this.statusError.delete(t),E(y)):void 0})}),m=await Ee.race([this.connection.request("request",{clientRequest:u},!0,{url:t,command:"PublishStream",workerType:n===on.TRANSCODE?1:2,requestByUser:!i,tid:h.toString()}),p]);this.isStartingStreamingTask=!1,I.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(m.code)),this.streamingTasks.set(t,{clientRequest:u,mode:n,url:t,taskId:h}),d()}catch(p){if(d(),this.isStartingStreamingTask=!1,!p.data||!p.data.retry||i)throw p;return p.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,p)):await this.startLiveStreamingTask(t,n,p)}}stopLiveStreamingTask(t){return new Ee((n,i)=>{const s=this.streamingTasks.get(t);if(!s||!this.connection)return new V(P.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=s.mode;s.abortTask=()=>{I.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:u===on.INJECT?"UninjectStream":"UnpublishStream",url:s.url}},!1,{url:t,command:"UnPublishStream",workerType:u===on.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(d=>{I.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(d.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&u!==on.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),n(),u===on.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(Es.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,t)}).catch(i)})}async controlInjectStream(t,n,i,s){const u=this.streamingTasks.get(t);if(!u||!this.connection||u.mode!==on.INJECT)throw new V(P.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:n,audioVolume:i,position:s}})).serverResponse}resetAllTask(){var t;const n=Array.from(_o(t=this.streamingTasks).call(t));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(s=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,s)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ri.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new V(P.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await Gn(this,yc.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new a8(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Ii.WARNING,(i,s)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(s,i)),this.connection.on(Ii.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(Ii.INJECT_STREAM_STATUS,i=>this.handleInjectStreamServerStatus(i)),this.connection.on(Ii.REQUEST_NEW_ADDRESS,(i,s)=>{if(!this.connection)return s(new V(P.UNEXPECTED_ERROR,"can not get new live streaming address list"));Gn(this,yc.REQUEST_WORKER_MANAGER_LIST,t).then(u=>{this.uapResponse=u,i(u.addressList)}).catch(s)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),s=t.reason;switch(t.code){case zt.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case zt.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case zt.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case zt.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const d=new V(P.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return I.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,d);if(!this.isStartingStreamingTask)return;this.statusError.set(n,d)}case zt.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const d=new V(P.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,s);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,d)}case zt.LIVE_STREAM_RESPONSE_WORKER_LOST:case zt.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const d=Array.from(_o(u=this.streamingTasks).call(u));for(const h of d)h.abortTask?h.abortTask():(I.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",h.url),this.startLiveStreamingTask(h.url,h.mode,new V(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{I.debug("[".concat(this.spec.clientId,"] republish live stream success"),h.url)}).catch(p=>{I.error(p.toString()),this.onLiveStreamError&&this.onLiveStreamError(h.url,p)}));return}}}handleInjectStreamServerStatus(t){const n=Number(t.uid),i=t.serverStatus&&t.serverStatus.url;switch(t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(Es.INJECT_STREAM_STATUS_START_SUCCESS,n,i));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(Es.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,n,i),void this.streamingTasks.delete(i);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(Es.INJECT_STREAM_STATUS_START_UNAUTHORIZED,n,i),void this.streamingTasks.delete(i);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(Es.INJECT_STREAM_STATUS_BROKEN,n,i),void this.streamingTasks.delete(i);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(Es.INJECT_STREAM_STATUS_START_TIMEOUT,n,i),void this.streamingTasks.delete(i);default:return void I.debug("inject stream server status",t)}}hasUrl(t){return this.streamingTasks.has(t)}}class mw{constructor(){g(this,"destChannelMediaInfos",new Map),g(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){cI(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){cI(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){Gm(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function Ew(e){if(!(e instanceof mw))return new V(P.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new V(P.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new V(P.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class u8 extends jt{constructor(t,n,i){super(),g(this,"ws",void 0),g(this,"requestId",1),g(this,"heartBeatTimer",void 0),g(this,"joinInfo",void 0),g(this,"clientId",void 0),g(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),g(this,"onClose",s=>{this.emit("close"),this.dispose()}),g(this,"onMessage",s=>{const u=JSON.parse(s.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=t,this.clientId=n,this.ws=new Dc("cross-channel-".concat(this.clientId),i),this.ws.on(Ge.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Ge.CONNECTED,this.onOpen),this.ws.on(Ge.ON_MESSAGE,this.onMessage),this.ws.on(Ge.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new Ee((n,i)=>{const s=window.setTimeout(()=>{i(new V(P.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,u=>{window.clearTimeout(s),u.state&&u.state!==0?i(new V(P.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(s),i(new V(P.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new V(P.WS_DISCONNECT);const n=()=>new Ee((d,h)=>{this.ws.once(Ge.CLOSED,()=>h(new V(P.WS_ABORT))),this.ws.once(Ge.CONNECTED,d)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(t),s=new Ee((d,h)=>{const p=()=>{h(new V(P.WS_ABORT))};this.ws.once(Ge.RECONNECTING,p),this.ws.once(Ge.CLOSED,p),this.once("req_".concat(i),d),Fn(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(Ge.RECONNECTING,p),this.ws.off(Ge.CLOSED,p),h(new V(P.TIMEOUT,"cross channel ws request timeout"))})}),u=await s;if(!u||u.code!==200)throw new V(P.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(t){this.ws.removeAllListeners(Ge.REQUEST_NEW_URLS),this.ws.on(Ge.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class d8 extends jt{set state(t){t!==this._state&&(t!==tr.RELAY_STATE_FAILURE&&(this.errorCode=vs.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,i,s,u){super(),g(this,"joinInfo",void 0),g(this,"sid",void 0),g(this,"clientId",void 0),g(this,"cancelToken",Ri.CancelToken.source()),g(this,"workerToken",void 0),g(this,"requestId",0),g(this,"signal",void 0),g(this,"prevChannelMediaConfig",void 0),g(this,"httpRetryConfig",void 0),g(this,"_resolution",void 0),g(this,"_state",tr.RELAY_STATE_IDLE),g(this,"errorCode",vs.RELAY_OK),g(this,"onStatus",d=>{I.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(d))),d&&d.command&&(d.command==="onAudioPacketReceived"&&this.emit("event",Hi.PACKET_RECEIVED_AUDIO_FROM_SRC),d.command==="onVideoPacketReceived"&&this.emit("event",Hi.PACKET_RECEIVED_VIDEO_FROM_SRC),d.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=vs.SRC_TOKEN_EXPIRED,this.state=tr.RELAY_STATE_FAILURE),d.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=vs.DEST_TOKEN_EXPIRED,this.state=tr.RELAY_STATE_FAILURE))}),g(this,"onReconnect",async()=>{I.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Hi.NETWORK_DISCONNECTED),this.state=tr.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(d=>{this.state!==tr.RELAY_STATE_IDLE&&(I.error("auto restart channel media relay failed",d.toString()),this.errorCode=vs.SERVER_CONNECTION_LOST,this.state=tr.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=mE(),this.signal=new u8(this.joinInfo,this.clientId,i),this.httpRetryConfig=s,this._resolution=u}async startChannelMediaRelay(t){if(this.state!==tr.RELAY_STATE_IDLE)throw new V(P.INVALID_OPERATION);this.state=tr.RELAY_STATE_CONNECTING,await this.connect(),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new V(P.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new V(P.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new V(P.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==tr.RELAY_STATE_RUNNING)throw new V(P.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==tr.RELAY_STATE_RUNNING)throw new V(P.INVALID_OPERATION);const n=this.genMessage(Vn.SetVideoProfile);await this.signal.request(n),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),I.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=tr.RELAY_STATE_IDLE,this.dispose()}dispose(){I.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ri.CancelToken.source(),this.state=tr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await i8(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Hi.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(Vn.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(Vn.SetSdkProfile,t);await this.signal.request(i),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const s=this.genMessage(Vn.SetSourceChannel,t);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Hi.PACKET_JOINED_SRC_CHANNEL),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(Vn.SetSourceUserId,t);await this.signal.request(u),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const d=this.genMessage(Vn.SetDestChannel,t);await this.signal.request(d),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Hi.PACKET_JOINED_DEST_CHANNEL),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const h=this.genMessage(Vn.StartPacketTransfer,t);await this.signal.request(h),this.emit("event",Hi.PACKET_SENT_TO_DEST_CHANNEL),this.state=tr.RELAY_STATE_RUNNING,I.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(Vn.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",Hi.PACKET_UPDATE_DEST_CHANNEL),I.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Vn.StopPacketTransfer);await this.signal.request(t),I.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const i=[],s=[],u=[];this.requestId+=1;const d={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:si,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};d.sdkVersion==="4.18.0"&&(d.sdkVersion="0.0.1");let h=null,p=null;switch(t){case Vn.SetSdkProfile:return d.clientRequest={command:"SetSdkProfile",type:"multi_channel"},d;case Vn.SetSourceChannel:if(p=n&&n.getSrcChannelMediaInfo(),!p)throw new V(P.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceChannel",uid:"0",channelName:p.channelName,token:p.token||this.joinInfo.appId},d;case Vn.SetSourceUserId:if(p=n&&n.getSrcChannelMediaInfo(),!p)throw new V(P.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceUserId",uid:p.uid+""},d;case Vn.SetDestChannel:if(h=n&&n.getDestChannelMediaInfo(),!h)throw new V(P.UNEXPECTED_ERROR,"can not find dest config");return h.forEach(m=>{i.push(m.channelName),s.push(m.uid+""),u.push(m.token||this.joinInfo.appId)}),d.clientRequest={command:"SetDestChannel",channelName:i,uid:s,token:u},d;case Vn.StartPacketTransfer:return d.clientRequest={command:"StartPacketTransfer"},d;case Vn.Reconnect:return d.clientRequest={command:"Reconnect"},d;case Vn.StopPacketTransfer:return d.clientRequest={command:"StopPacketTransfer"},d;case Vn.UpdateDestChannel:if(h=n&&n.getDestChannelMediaInfo(),!h)throw new V(P.UNEXPECTED_ERROR,"can not find dest config");return h.forEach(m=>{i.push(m.channelName),s.push(m.uid+""),u.push(m.token||this.joinInfo.appId)}),d.clientRequest={command:"UpdateDestChannel",channelName:i,uid:s,token:u},d;case Vn.SetVideoProfile:d.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return d}}const AE=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new Ee((n,i)=>{t.toBlob(async s=>{if(t.remove(),s){const u=await vw(s);n({buffer:u,width:t.width,height:t.height})}else i(new V(P.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},vw=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};function gw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Sw(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?gw(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gw(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class wE{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(I.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}constructor(t){g(this,"trackId",void 0),g(this,"config",void 0),g(this,"onFirstVideoFrameDecoded",void 0),g(this,"freezeTimeCounterList",[]),g(this,"renderFreezeAccTime",0),g(this,"isKeepLastFrame",!1),g(this,"timeUpdatedCount",0),g(this,"freezeTime",0),g(this,"playbackTime",0),g(this,"lastTimeUpdatedTime",0),g(this,"autoplayFailed",!1),g(this,"videoTrack",void 0),g(this,"videoElement",void 0),g(this,"cacheVideoElement",void 0),g(this,"videoElementCheckInterval",void 0),g(this,"_videoElementStatus",Mn.NONE),g(this,"isGettingVideoDimensions",!1),g(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return I.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),g(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&ut.curState==="running"&&(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat($R())),rC()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),g(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Mn.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Mn.CANPLAY;break;case"stalled":this.videoElementStatus=Mn.STALLED;break;case"suspend":this.videoElementStatus=Mn.SUSPEND;break;case"pause":this.videoElementStatus=Mn.PAUSED,Zn()||ho()||$n()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Mn.WAITING;break;case"abort":this.videoElementStatus=Mn.ABORT;break;case"ended":this.videoElementStatus=Mn.ENDED;break;case"emptied":this.videoElementStatus=Mn.EMPTIED;break;case"error":{this.videoElementStatus=Mn.ERROR;const i=this.videoElement.error;i&&I.error("[".concat(this.trackId,"] media error, code: ").concat(i.code,", message: ").concat(i.message));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const s=i-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,jo.lastVisibleTime<jo.lastHiddenTime||u<jo.lastHiddenTime||u<jo.lastVisibleTime)return;for(s>H("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=s),this.playbackTime+=s;this.playbackTime>=6e3;){this.playbackTime-=6e3;const d=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(d),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),g(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat($R())),rC()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),ut.on(En.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ut.on(En.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(s=>{t&&we.autoplayFailed(t,"video",s.message,this.trackId),s.name==="NotAllowedError"?(I.warning("detected video element autoplay failed",s),this.autoplayFailed=!0,this.handleAutoPlayFailed()):I.warning("[".concat(this.trackId,"] play warning: "),s)});const i=at();if((i.name==="Safari"&&Number(i.version)===15||pc())&&n&&n.then&&n.catch){const s=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(s).catch(s)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return I.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height);return t.remove(),i}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const s=i.getContext("2d");return s?(s.drawImage(this.videoElement,0,0,i.width,i.height),new Ee((u,d)=>{i.toBlob(async h=>{if(i.remove(),h){const p=await vw(h);u({buffer:p,width:i.width,height:i.height})}else d(new V(P.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await AE(t)}destroy(){ut.off(En.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ut.off(En.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=Mn.INIT,!this.videoElementCheckInterval&&(Tw.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=Mn.DESTROYED)},1e3),H("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let u;const d=(h,p)=>{if(this.videoElementStatus===Mn.PLAYING){if(u){const E=p.presentationTime-u.presentationTime;E>H("VIDEO_FREEZE_DURATION")&&jo.lastVisibleTime>=jo.lastHiddenTime&&u.timestamp>jo.lastVisibleTime&&u.timestamp>jo.lastHiddenTime&&(this.renderFreezeAccTime+=E)}u=Sw(Sw({},p),{},{timestamp:h})}var m,_;H("ENABLE_VIDEO_FRAME_CALLBACK")&&((m=(_=this.videoElement).requestVideoFrameCallback)===null||m===void 0||m.call(_,d))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,d)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Ih()&&(this.videoElement.poster="noposter");const i=at();i.name==="Safari"&&Number(i.version)===15||pc()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Bt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Bt()&&this.videoElement.load());const s=this.videoElement.play();s!==void 0&&s.catch(u=>{I.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){Tw.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Mn.NONE}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{I.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{I.error(i)}),this.autoplayFailed=!1,Xu()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Xu()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),CI()}}const Tw=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class yw extends wE{constructor(t){super(t),g(this,"container",void 0),g(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,i):await AE(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",H("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function tp(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=_a(e.encoderConfig);return t.width=n.width,t.height=n.height,!oC()&&n.frameRate&&(t.frameRate=n.frameRate),at().name===ht.EDGE&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Bt()&&(t.frameRate={ideal:30,max:30}),t}function l8(e){const t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&hm()&&(t.extensionId=e.extensionId);const{displaySurface:n,selfBrowserSurface:i,surfaceSwitching:s,systemAudio:u}=e;(pm(107)||ZR(107)||eC(93))&&(n&&(gn(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),i?(gn(i,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=i):t.selfBrowserSurface="include",s&&(gn(s,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=s)),(pm(105)||ZR(105)||eC(91))&&u&&(gn(u,"systemAudio",["exclude","include"]),t.systemAudio=u),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);const d=e.encoderConfig?Lm(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:d?d.width:void 0,maxHeight:d?d.height:void 0},d&&(d.frameRate&&(typeof d.frameRate=="number"?(t.mandatory.maxFrameRate=d.frameRate,t.mandatory.minFrameRate=d.frameRate):(t.mandatory.maxFrameRate=d.frameRate.max||d.frameRate.ideal||d.frameRate.exact||void 0,t.mandatory.minFrameRate=d.frameRate.min||d.frameRate.ideal||d.frameRate.exact||void 0),t.frameRate=d.frameRate),d.width&&(t.width=d.width),d.height&&(t.height=d.height)),t}function Rw(e){const t={};if(oC()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,hm()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){const n=Uh(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),Ih()&&(t.sampleRate=void 0),t}var kc,np;(function(e){e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE"})(kc||(kc={})),function(e){e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(np||(np={}));var Cw,Iw,Aw,ww,Ow,bw,Nw,Pw,Dw,kw,Lw,xw,Mw,Uw,Vw,Bw,jw,Fw,Gw,Ww,Hw,Kw,zw,Yw,qe,qw,Jw,Xw,Qw,$w,Zw,eO,tO,ui,nO=new class{constructor(){g(this,"_clientSize",null),g(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),g(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),g(this,"getStyle",e=>window.getComputedStyle(e,null)),g(this,"checkCssVisibleProperty",e=>{let t=!0;const n=this.getStyle(e),{display:i,visibility:s,opacity:u,filter:d}=n;return(i==="none"||["hidden","collapse"].includes(s)||Number(u)<.1)&&(t=!1),t?(d&&d.split(" ").filter(h=>{const p=h.split("(")[0];return["brightness","blur","opacity"].includes(p)}).map(h=>{const[p,m]=h.split(/\(|\)/);return[p,Number(m.match(/^[0-9\.]+/))]}).forEach(h=>{const[p,m]=h;switch(p){case"brightness":(m<.1||m>3)&&(t=!1);break;case"blur":m>3&&(t=!1);break;case"opacity":m<.1&&(t=!1)}}),t):!1}),g(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,i=!0;const s=d=>t(d);let u=e;for(;u&&i;)s(u)||(n=!1,i=!1),u=u.parentElement,u||(i=!1);return n}),g(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),g(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:i,right:s,top:u,bottom:d}=e.getBoundingClientRect(),h=this.getClientWidth(),p=this.getClientHeight();return{width:t,height:n,left:i,right:s,top:u,bottom:d,clientWidth:h,clientHeight:p,clientMin:Math.min(h,p)}}),g(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),g(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),g(this,"checkCoverForAPoint",(e,t,n)=>{const i=this.elementFromPoint(e,t);return i!==null&&i!==n}),g(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:i}=this._clientSize,s=e/6,u=t/6,d=[],h=10**6;for(let p=0;p<5;p++)for(let m=0;m<5;m++){const _=(n*h+(p===0?.1:p===4?(s*p*h-1e5)/h:s*p)*h)/h,E=(i*h+(m===0?.1:m===4?(u*m*h-1e5)/h:u*m)*h)/h;d.push({x:_,y:E})}return[...d]}),g(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),g(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),g(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:i,clientHeight:s,clientWidth:u,clientMin:d}=this._clientSize;let h,p,m,_;if(e<0)h=0;else{if(!(e<u))return!1;h=e}if(t<0)return!1;if(p=t<u?t:u,n<0)m=0;else{if(!(n<s))return!1;m=n}if(i<0)return!1;_=i<s?i:s;const E=p-h,y=_-m;return this.checkSizeIsVisible(E,y,d)}),g(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),g(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(kc.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(kc.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(kc.SIZE)}}return this.returnHiddenResult(kc.STYLE)}return this.returnHiddenResult(np.UNMOUNTED)}return this.returnHiddenResult(np.INVALID_HTML_ELEMENT)}),g(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function rO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function dd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?rO(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rO(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let en=(Cw=be({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Iw=Gt(),Aw=be({argsMap:e=>[e.getTrackId()]}),ww=Ic("LocalVideoTrack","_enabledMutex"),Ow=be({argsMap:(e,t)=>[e.getTrackId(),t]}),bw=Gt(),Nw=Ic("LocalVideoTrack","_enabledMutex"),Pw=be({argsMap:(e,t)=>[e.getTrackId(),t]}),Dw=Gt(),kw=be({argsMap:(e,t)=>[e.getTrackId(),t]}),Lw=Gt(),xw=Gt(),Mw=be({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),Uw=Gt(),Vw=Gt(),Bw=Gt(),jw=Gt(),Fw=Gt(),Gw=Gt(),Ww=Gt(),Hw=be({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Kw=be({argsMap:e=>[e.getTrackId()]}),zw=be({argsMap:e=>[e.getTrackId()]}),Yw=be({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),ne((qe=class aL extends aE{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Mn.PLAYING)}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,i,s,u,d){if(super(t,u),g(this,"trackMediaType","video"),g(this,"_player",void 0),g(this,"_videoVisibleTimer",null),g(this,"_previousVideoVisibleStatus",void 0),g(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),g(this,"_encoderConfig",void 0),g(this,"_scalabiltyMode",{numSpatialLayers:1,numTemporalLayers:1}),g(this,"_optimizationMode",void 0),g(this,"_videoHeight",void 0),g(this,"_videoWidth",void 0),g(this,"_forceBitrateLimit",void 0),g(this,"_enabled",!0),g(this,"processorDestination",void 0),g(this,"_processorContext",void 0),$n()){const{width:h,height:p}=t.getSettings();this._videoWidth=h,this._videoHeight=p}else this.updateMediaStreamTrackResolution();this._encoderConfig=n,this._scalabiltyMode=i,this._optimizationMode=s,this._hints=d||[],this._hints.indexOf(dn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile(),n&&this._hints.indexOf(dn.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this.processorContext=new GI(this.getTrackId(),"local"),this.processorDestination=new FI(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const s=document.getElementById(t);s?t=s:(I.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}I.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=dd(dd(dd({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new wE(i):this._player=new yw(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const s=this.getVideoElementVisibleStatus();this.emit(gs.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},H("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,I.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(I.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await Wt(this,Le.NEED_DISABLE_TRACK,this)}catch(i){throw I.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void I.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Wt(this,Le.NEED_ENABLE_TRACK,this)}catch(i){throw I.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}I.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,I.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Wt(this,Le.NEED_MUTE_TRACK,this):await Wt(this,Le.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,n){if(!this._enabled)throw new V(P.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=_a(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const i=tp({encoderConfig:t});($n()||Zn()||ho())&&(i.deviceId=void 0),I.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){const u=new V(P.UNEXPECTED_ERROR,s.toString());throw I.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=t,this._hints.indexOf(dn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Wt(this,Le.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw()}}getStats(){return sd(()=>{I.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),qi(this,Le.GET_STATS)||dd({},qm)}async setBeautyEffect(t){I.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await AE(t)}clone(t,n,i,s){const u=this._mediaStreamTrack.clone();return new aL(u,t,n,i,s)}async setBitrateLimit(t){if(I.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await Wt(this,Le.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw()}}}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void I.error(P.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await Wt(this,Le.SET_OPTIMIZATION_MODE,this)}catch(i){throw this._optimizationMode=n,I.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}I.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return I.error(P.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=t,I.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){VA(this._originMediaStreamTrack).then(t=>{let[n,i]=t;this._videoHeight=i,this._videoWidth=n}).catch(Xh)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!n||!i)return;const[s,u]=function(d,h,p){const m=H("BITRATE_ADAPTER_TYPE");let _;const E=200*Math.pow(p/15,.6)*Math.pow(d*h/640/360,.75),y=E;if(m==="STANDARD_BITRATE")_=4*E;else{if(m!=="COMPATIABLE_BITRATE")return;_=2*E}return[Math.floor(_),Math.floor(y)]}(t,n,i)||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=u,this._encoderConfig.bitrateMax=s,I.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(s,", brMin: ").concat(u,"]")))}getVideoElementVisibleStatus(){try{var t,n;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:u,slot:d}=s;if(this.isPlaying&&u instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=nO.checkOneElementVisible(u),p=Object.assign({},h);if(p.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=p.visible;const m=we.reportApiInvoke(null,{tag:Ut.TRACER,name:rn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});p.visible?m.onSuccess("Video is visible"):m.onSuccess("Invisible because of ".concat(p.reason))}return p}return}catch(i){throw new V(P.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new V(P.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new V(P.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new V(P.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}bindProcessorDestinationEvents(){this.processorDestination.on(Bn.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await Wt(this,Le.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Wt(this,Le.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Bn.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(vr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(vr.REQUEST_CONSTRAINTS)}}).prototype,"play",[Cw,Iw],Object.getOwnPropertyDescriptor(qe.prototype,"play"),qe.prototype),ne(qe.prototype,"stop",[Aw],Object.getOwnPropertyDescriptor(qe.prototype,"stop"),qe.prototype),ne(qe.prototype,"setEnabled",[ww,Ow,bw],Object.getOwnPropertyDescriptor(qe.prototype,"setEnabled"),qe.prototype),ne(qe.prototype,"setMuted",[Nw,Pw,Dw],Object.getOwnPropertyDescriptor(qe.prototype,"setMuted"),qe.prototype),ne(qe.prototype,"setEncoderConfiguration",[kw,Lw],Object.getOwnPropertyDescriptor(qe.prototype,"setEncoderConfiguration"),qe.prototype),ne(qe.prototype,"getStats",[xw],Object.getOwnPropertyDescriptor(qe.prototype,"getStats"),qe.prototype),ne(qe.prototype,"setBeautyEffect",[Mw,Uw],Object.getOwnPropertyDescriptor(qe.prototype,"setBeautyEffect"),qe.prototype),ne(qe.prototype,"getCurrentFrameData",[Vw],Object.getOwnPropertyDescriptor(qe.prototype,"getCurrentFrameData"),qe.prototype),ne(qe.prototype,"getCurrentFrameImage",[Bw],Object.getOwnPropertyDescriptor(qe.prototype,"getCurrentFrameImage"),qe.prototype),ne(qe.prototype,"setBitrateLimit",[jw],Object.getOwnPropertyDescriptor(qe.prototype,"setBitrateLimit"),qe.prototype),ne(qe.prototype,"setOptimizationMode",[Fw],Object.getOwnPropertyDescriptor(qe.prototype,"setOptimizationMode"),qe.prototype),ne(qe.prototype,"setScalabiltyMode",[Gw],Object.getOwnPropertyDescriptor(qe.prototype,"setScalabiltyMode"),qe.prototype),ne(qe.prototype,"updateMediaStreamTrackResolution",[Ww],Object.getOwnPropertyDescriptor(qe.prototype,"updateMediaStreamTrackResolution"),qe.prototype),ne(qe.prototype,"pipe",[Hw],Object.getOwnPropertyDescriptor(qe.prototype,"pipe"),qe.prototype),ne(qe.prototype,"unpipe",[Kw],Object.getOwnPropertyDescriptor(qe.prototype,"unpipe"),qe.prototype),ne(qe.prototype,"close",[zw],Object.getOwnPropertyDescriptor(qe.prototype,"close"),qe.prototype),ne(qe.prototype,"replaceTrack",[Yw],Object.getOwnPropertyDescriptor(qe.prototype,"replaceTrack"),qe.prototype),qe),iO=(qw=be({argsMap:(e,t)=>[e.getTrackId(),t]}),Jw=Gt(),Xw=Ic("CameraVideoTrack","_enabledMutex"),Qw=be({argsMap:(e,t)=>[e.getTrackId(),t]}),$w=Gt(),Zw=be({argsMap:(e,t)=>[e.getTrackId(),t]}),eO=Gt(),tO=be({argsMap:e=>[e.getTrackId()]}),ne((ui=class extends en{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,i,s,u){super(e,_a(t.encoderConfig),i,s,u),g(this,"_config",void 0),g(this,"_originalConstraints",void 0),g(this,"_constraints",void 0),g(this,"_enabled",!0),g(this,"_deviceName","default"),g(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(pc()||fm())&&!function(){const d=at();if(d.os!==Ln.IOS||!d.osVersion)return!1;const h=d.osVersion.split(".");return Number(h[0])===15&&Number(h[1])>=2}()&&iC()&&this._enabled&&!this._isClosed&&(I.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=_a(this._config.encoderConfig),ut.on(En.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ut.on(En.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){if(I.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await zr.getDeviceById(e),n={};n.video=dd({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await Ai(n,this.getTrackId())}catch(s){throw I.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),i=await Ai({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(t){throw I.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await zr.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(t){throw I.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}I.info("[".concat(this.getTrackId(),"] setDevice success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(I.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const n=await Ai({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1)}await Wt(this,Le.NEED_ENABLE_TRACK,this)}catch(n){throw I.error("[".concat(this.getTrackId(),"] setEnabled true error"),n.toString()),n}this.updateMediaStreamTrackResolution(),I.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await Wt(this,Le.NEED_DISABLE_TRACK,this)}catch(n){throw I.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}I.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new V(P.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=_a(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin);const n=Zt(this._config);n.encoderConfig=e;const i=tp(n);($n()||Zn()||ho())&&(i.deviceId=void 0),I.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){const u=new V(P.UNEXPECTED_ERROR,s.toString());throw I.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}this._config=n,this._constraints=i,this._originalConstraints=i,this._encoderConfig=e,this._hints.indexOf(dn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Wt(this,Le.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw()}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Zn()||ho())&&this._enabled&&!this._isClosed&&ut.duringInterruption){const e=async()=>{ut.off(En.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(I.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ut.on(En.IOS_INTERRUPTION_END,e)}else I.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(gs.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=zr.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){const i=await Ai({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),ut.off(En.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ut.off(En.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}bindProcessorContextEvents(){this.processorContext.on(vr.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{const i=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(i),t()}catch(i){n(i)}}),this.processorContext.on(vr.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[qw,Jw],Object.getOwnPropertyDescriptor(ui.prototype,"setDevice"),ui.prototype),ne(ui.prototype,"setEnabled",[Xw,Qw,$w],Object.getOwnPropertyDescriptor(ui.prototype,"setEnabled"),ui.prototype),ne(ui.prototype,"setEncoderConfiguration",[Zw,eO],Object.getOwnPropertyDescriptor(ui.prototype,"setEncoderConfiguration"),ui.prototype),ne(ui.prototype,"close",[tO],Object.getOwnPropertyDescriptor(ui.prototype,"close"),ui.prototype),ui);class OE{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}constructor(t,n){g(this,"uid",void 0),g(this,"_uintid",void 0),g(this,"_trust_in_room_",!0),g(this,"_trust_audio_enabled_state_",!0),g(this,"_trust_video_enabled_state_",!0),g(this,"_trust_audio_mute_state_",!0),g(this,"_trust_video_mute_state_",!0),g(this,"_audio_muted_",!1),g(this,"_video_muted_",!1),g(this,"_audio_enabled_",!0),g(this,"_video_enabled_",!0),g(this,"_audio_added_",!1),g(this,"_video_added_",!1),g(this,"_trust_video_stream_added_state_",!0),g(this,"_trust_audio_stream_added_state_",!0),g(this,"_audioTrack",void 0),g(this,"_videoTrack",void 0),g(this,"_audioSSRC",void 0),g(this,"_videoSSRC",void 0),g(this,"_audioOrtc",void 0),g(this,"_videoOrtc",void 0),g(this,"_cname",void 0),g(this,"_rtxSsrcId",void 0),this.uid=t,this._uintid=n}}var h8=mR,p8=cc,f8=hh;sr({target:"Promise",stat:!0},{try:function(e){var t=p8.f(this),n=f8(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var bE=h8,_8=sr,m8=U,E8=l,v8=od,g8=_n,S8=us,T8=ds,oO=Mm,y8=pI,R8=gI,C8=yi,sO=kn("isConcatSpreadable"),aO=9007199254740991,cO="Maximum allowed index exceeded",uO=m8.TypeError,I8=C8>=51||!E8(function(){var e=[];return e[sO]=!1,e.concat()[0]!==e}),A8=R8("concat"),w8=function(e){if(!g8(e))return!1;var t=e[sO];return t!==void 0?!!t:v8(e)};_8({target:"Array",proto:!0,forced:!I8||!A8},{concat:function(e){var t,n,i,s,u,d=S8(this),h=y8(d,0),p=0;for(t=-1,i=arguments.length;t<i;t++)if(w8(u=t===-1?d:arguments[t])){if(p+(s=T8(u))>aO)throw uO(cO);for(n=0;n<s;n++,p++)n in u&&oO(h,p,u[n])}else{if(p>=aO)throw uO(cO);oO(h,p++,u)}return h.length=p,h}});var dO={},O8=ke,b8=Ti,lO=ql.f,N8=jC,hO=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];dO.f=function(e){return hO&&O8(e)=="Window"?function(t){try{return lO(t)}catch{return N8(hO)}}(e):lO(b8(e))};var ld={},P8=kn;ld.f=P8;var pO=Cn,D8=Or,k8=ld,L8=Fi.f,bn=function(e){var t=pO.Symbol||(pO.Symbol={});D8(t,e)||L8(t,e,{value:k8.f(e)})},Lc=sr,NE=U,x8=Mr,M8=M,hd=ue,U8=N,xc=Y,Ia=Qa,PE=l,Wn=Or,V8=od,B8=j,j8=_n,F8=w,DE=Du,kE=Gi,G8=us,rp=Ti,LE=Gl,fO=ic,xE=He,pd=$l,_O=l_,W8=ql,mO=dO,ME=u_,EO=K,vO=Fi,H8=d_,gO=J,K8=b_,UE=ch,fd=ec.exports,SO=Jl,TO=X0,yO=kn,z8=ld,Y8=bn,q8=Hu,RO=ah,ip=_I.forEach,Yr=Yl("hidden"),op="Symbol",CO=yO("toPrimitive"),J8=RO.set,IO=RO.getterFor(op),Xi=Object.prototype,ys=NE.Symbol,Aa=ys&&ys.prototype,AO=NE.TypeError,VE=NE.QObject,_d=x8("JSON","stringify"),wO=EO.f,Rs=vO.f,OO=mO.f,X8=gO.f,bO=U8([].push),Wo=fd("symbols"),md=fd("op-symbols"),BE=fd("string-to-symbol-registry"),jE=fd("symbol-to-string-registry"),Q8=fd("wks"),FE=!VE||!VE.prototype||!VE.prototype.findChild,GE=xc&&PE(function(){return pd(Rs({},"a",{get:function(){return Rs(this,"a",{value:7}).a}})).a!=7})?function(e,t,n){var i=wO(Xi,t);i&&delete Xi[t],Rs(e,t,n),i&&e!==Xi&&Rs(Xi,t,i)}:Rs,WE=function(e,t){var n=Wo[e]=pd(Aa);return J8(n,{type:op,tag:e,description:t}),xc||(n.description=t),n},sp=function(e,t,n){e===Xi&&sp(md,t,n),kE(e);var i=LE(t);return kE(n),Wn(Wo,i)?(n.enumerable?(Wn(e,Yr)&&e[Yr][i]&&(e[Yr][i]=!1),n=pd(n,{enumerable:xE(0,!1)})):(Wn(e,Yr)||Rs(e,Yr,xE(1,{})),e[Yr][i]=!0),GE(e,i,n)):Rs(e,i,n)},HE=function(e,t){kE(e);var n=rp(t),i=_O(n).concat(KE(n));return ip(i,function(s){xc&&!hd(NO,n,s)||sp(e,s,n[s])}),e},NO=function(e){var t=LE(e),n=hd(X8,this,t);return!(this===Xi&&Wn(Wo,t)&&!Wn(md,t))&&(!(n||!Wn(this,t)||!Wn(Wo,t)||Wn(this,Yr)&&this[Yr][t])||n)},PO=function(e,t){var n=rp(e),i=LE(t);if(n!==Xi||!Wn(Wo,i)||Wn(md,i)){var s=wO(n,i);return!s||!Wn(Wo,i)||Wn(n,Yr)&&n[Yr][i]||(s.enumerable=!0),s}},DO=function(e){var t=OO(rp(e)),n=[];return ip(t,function(i){Wn(Wo,i)||Wn(SO,i)||bO(n,i)}),n},KE=function(e){var t=e===Xi,n=OO(t?md:rp(e)),i=[];return ip(n,function(s){!Wn(Wo,s)||t&&!Wn(Xi,s)||bO(i,Wo[s])}),i};if(Ia||(UE(Aa=(ys=function(){if(F8(Aa,this))throw AO("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?fO(arguments[0]):void 0,t=TO(e),n=function(i){this===Xi&&hd(n,md,i),Wn(this,Yr)&&Wn(this[Yr],t)&&(this[Yr][t]=!1),GE(this,t,xE(1,i))};return xc&&FE&&GE(Xi,t,{configurable:!0,set:n}),WE(t,e)}).prototype,"toString",function(){return IO(this).tag}),UE(ys,"withoutSetter",function(e){return WE(TO(e),e)}),gO.f=NO,vO.f=sp,H8.f=HE,EO.f=PO,W8.f=mO.f=DO,ME.f=KE,z8.f=function(e){return WE(yO(e),e)},xc&&Rs(Aa,"description",{configurable:!0,get:function(){return IO(this).description}})),Lc({global:!0,wrap:!0,forced:!Ia,sham:!Ia},{Symbol:ys}),ip(_O(Q8),function(e){Y8(e)}),Lc({target:op,stat:!0,forced:!Ia},{for:function(e){var t=fO(e);if(Wn(BE,t))return BE[t];var n=ys(t);return BE[t]=n,jE[n]=t,n},keyFor:function(e){if(!DE(e))throw AO(e+" is not a symbol");if(Wn(jE,e))return jE[e]},useSetter:function(){FE=!0},useSimple:function(){FE=!1}}),Lc({target:"Object",stat:!0,forced:!Ia,sham:!xc},{create:function(e,t){return t===void 0?pd(e):HE(pd(e),t)},defineProperty:sp,defineProperties:HE,getOwnPropertyDescriptor:PO}),Lc({target:"Object",stat:!0,forced:!Ia},{getOwnPropertyNames:DO,getOwnPropertySymbols:KE}),Lc({target:"Object",stat:!0,forced:PE(function(){ME.f(1)})},{getOwnPropertySymbols:function(e){return ME.f(G8(e))}}),_d&&Lc({target:"JSON",stat:!0,forced:!Ia||PE(function(){var e=ys();return _d([e])!="[null]"||_d({a:e})!="{}"||_d(Object(e))!="{}"})},{stringify:function(e,t,n){var i=K8(arguments),s=t;if((j8(t)||e!==void 0)&&!DE(e))return V8(t)||(t=function(u,d){if(B8(s)&&(d=hd(s,this,u,d)),!DE(d))return d}),i[1]=t,M8(_d,null,i)}}),!Aa[CO]){var $8=Aa.valueOf;UE(Aa,CO,function(e){return hd($8,this)})}q8(ys,op),SO[Yr]=!0,bn("asyncIterator"),bn("hasInstance"),bn("isConcatSpreadable"),bn("iterator"),bn("match"),bn("matchAll"),bn("replace"),bn("search"),bn("species"),bn("split"),bn("toPrimitive"),bn("toStringTag"),bn("unscopables"),Hu(U.JSON,"JSON",!0);var Z8=Cn.Symbol;bn("asyncDispose"),bn("dispose"),bn("matcher"),bn("metadata"),bn("observable"),bn("patternMatch"),bn("replaceAll");var kO=Z8,LO=ld.f("asyncIterator"),e6=LO;function xO(e){this.wrapped=e}function Ed(e){var t,n;function i(u,d){try{var h=e[u](d),p=h.value,m=p instanceof xO;bE.resolve(m?p.wrapped:p).then(function(_){m?i(u==="return"?"return":"next",_):s(h.done?"return":"normal",_)},function(_){i("throw",_)})}catch(_){s("throw",_)}}function s(u,d){switch(u){case"return":t.resolve({value:d,done:!0});break;case"throw":t.reject(d);break;default:t.resolve({value:d,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(u,d){return new bE(function(h,p){var m={key:u,arg:d,resolve:h,reject:p,next:null};n?n=n.next=m:(t=n=m,i(u,d))})},typeof e.return!="function"&&(this.return=void 0)}function wi(e){return function(){return new Ed(e.apply(this,arguments))}}function Je(e){return new xO(e)}Ed.prototype[typeof kO=="function"&&e6||"@@asyncIterator"]=function(){return this},Ed.prototype.next=function(e){return this._invoke("next",e)},Ed.prototype.throw=function(e){return this._invoke("throw",e)},Ed.prototype.return=function(e){return this._invoke("return",e)};var t6=ld.f("iterator");function ap(e,t){var n={},i=!1;function s(u,d){return i=!0,d=new bE(function(h){h(e[u](d))}),{done:!1,value:t(d)}}return n[kO!==void 0&&t6||"@@iterator"]=function(){return this},n.next=function(u){return i?(i=!1,u):s("next",u)},typeof e.throw=="function"&&(n.throw=function(u){if(i)throw i=!1,u;return s("throw",u)}),typeof e.return=="function"&&(n.return=function(u){return i?(i=!1,u):s("return",u)}),n}var MO=LO,tn={exports:{}};function UO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function VO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?UO(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UO(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function zE(e,t,n,i,s,u,d){let h=[],p=[],m=[],_=[],E=!1,y=!1;if(tn.exports.parse(e).mediaDescriptions.forEach(A=>{d&&d!==A.attributes.direction||(A.media.mediaType!=="video"||E||(p=A.attributes.payloads,_=A.attributes.extmaps,E=!0),A.media.mediaType!=="audio"||y||(h=A.attributes.payloads,m=A.attributes.extmaps,y=!0))}),!_||p.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!m||h.length===0)throw new Error("Cannot get audio capabilities from SDP.");return p.forEach(A=>{var k;(k=A.rtpMap)!==null&&k!==void 0&&k.clockRate&&(A.rtpMap.clockRate=parseInt(A.rtpMap.clockRate))}),h.forEach(A=>{var k;(k=A.rtpMap)!==null&&k!==void 0&&k.clockRate&&(A.rtpMap.clockRate=parseInt(A.rtpMap.clockRate))}),t&&(h=h.filter(A=>{var k;return((k=A.rtpMap)===null||k===void 0?void 0:k.encodingName.toLowerCase())!=="rtx"}),p=p.filter(A=>{var k;return((k=A.rtpMap)===null||k===void 0?void 0:k.encodingName.toLowerCase())!=="rtx"})),n&&(p=p.filter(A=>{var k;return!/(red)|(ulpfec)|(flexfec)/i.test(((k=A.rtpMap)===null||k===void 0?void 0:k.encodingName)||"")})),i&&(h=h.filter(A=>{var k;return!/(red)|(ulpfec)|(flexfec)/i.test(((k=A.rtpMap)===null||k===void 0?void 0:k.encodingName)||"")})),s&&(s==null?void 0:s.length)>0&&(h=h.filter(A=>{var k;return s.includes(((k=A.rtpMap)===null||k===void 0?void 0:k.encodingName.toLowerCase())||"")})),u&&(u==null?void 0:u.length)>0&&(p=p.filter(A=>{var k;return u.includes(((k=A.rtpMap)===null||k===void 0?void 0:k.encodingName.toLowerCase())||"")})),{audioCodecs:h,videoCodecs:p,audioExtensions:m,videoExtensions:_}}function wa(e){const t=tn.exports.parse(e);let n,i;for(const s of t.mediaDescriptions){if(!n){const u=s.attributes.iceUfrag,d=s.attributes.icePwd;if(!u||!d)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:u,icePwd:d}}if(!i){const u=s.attributes.fingerprints;u.length>0&&(i={fingerprints:u})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function BO(e,t){const n=[],i=e.attributes.ssrcGroups.filter(d=>d.semantic==="FID"),s=e.attributes.ssrcGroups.find(d=>d.semantic==="SIM"),u=e.attributes.ssrcs;if(s)s.ssrcIds.forEach(d=>{var h;const p=(h=i.find(m=>m.ssrcIds[0]===d))===null||h===void 0?void 0:h.ssrcIds[1];n.push({ssrcId:d,rtx:t?p:void 0})});else if(i.length>0){const d=i[0].ssrcIds[0],h=i[0].ssrcIds[1];n.push({ssrcId:d,rtx:t?h:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:u[0].ssrcId})}return n}function jO(e,t){const{cname:n}=e;let i;t&&t.ip&&typeof t.port=="number"?(i=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],I.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(i.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),I.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):i=e.iceParameters.candidates.map(h=>({foundation:h.foundation,componentId:"1",transport:h.protocol,priority:h.priority.toString(),connectionAddress:h.ip,port:h.port.toString(),type:h.type,extension:{}}));const s={fingerprints:e.dtlsParameters.fingerprints.map(h=>({hashFunction:h.algorithm,fingerprint:h.fingerprint}))},u={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let d;switch(e.dtlsParameters.role){case"server":d="passive";break;case"client":d="active";break;case"auto":d="actpass"}return{dtlsParameters:s,iceParameters:u,candidates:i,rtpCapabilities:JE(e.rtpCapabilities),setup:d,cname:n}}function di(e,t,n){const i=[],s=[];return e.forEach(u=>{let{ssrcId:d,rtx:h}=u;const p=bt(8,"track-"),m={ssrcId:d,attributes:VO({label:p,mslabel:n=n||bt(10,""),msid:"".concat(n," ").concat(p)},t&&{cname:t})};if(i.push(m),h!==void 0){const _={ssrcId:h,attributes:VO({label:p,mslabel:n,msid:"".concat(n," ").concat(p)},t&&{cname:t})};i.push(_),s.push({semantic:"FID",ssrcIds:[d,h]})}}),e.length>1&&s.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:d}=u;return d})}),{ssrcs:i,ssrcGroups:s}}function Mc(e,t){t instanceof jn&&e.attributes.payloads.forEach(n=>{var i;const s=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!s||["opus","pcmu","pcma","g722"].indexOf(s)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const u=t._encoderConfig;u&&s!=="pcmu"&&s!=="pcma"&&s!=="g722"&&(u.bitrate&&!Bt()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function YE(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function qE(e,t){if(!(t instanceof en&&t._encoderConfig&&t._hints.indexOf(dn.SCREEN_TRACK)===-1))return;const n=t._encoderConfig;Jt().supportMinBitrate&&n.bitrateMin&&e.attributes.payloads.forEach(i=>{var s;["h264","h265","vp8","vp9","av1"].includes(((s=i.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(n.bitrateMin))}),Jt().supportMinBitrate&&!t._hints.includes(dn.LOW_STREAM)&&n.bitrateMax&&e.attributes.payloads.forEach(i=>{var s;["h264","h265","vp8","vp9","av1"].includes(((s=i.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(H("X_GOOGLE_START_BITRATE")||Math.floor(n.bitrateMax)))})}function FO(e){if(e.media.mediaType!=="video")return;const t=at();if(t.name!==ht.SAFARI&&t.os!==Ln.IOS)return;const n=e.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function cp(e,t,n){if(!t)return;let i,s;if(e.media.mediaType==="video"?(i=n.videoExtensions,s=n.videoCodecs):(i=n.audioExtensions,s=n.audioCodecs),t.twcc===!0){const u=i.find(d=>d.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");u&&(e.attributes.extmaps.find(d=>d.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e.attributes.extmaps.push({entry:u.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(d,h){return h.filter(p=>!!d.find(m=>m.payloadType===p.payloadType&&!!m.rtcpFeedbacks.find(_=>_.type==="transport-cc")))}(s,e.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(h=>h.type==="transport-cc")||d.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t.twcc===!1){const u=e.attributes.extmaps.findIndex(d=>d.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(d=>{const h=d.rtcpFeedbacks.findIndex(p=>p.type==="transport-cc");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}if(t.remb===!0){const u=i.find(d=>d.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");u&&(e.attributes.extmaps.find(d=>d.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e.attributes.extmaps.push({entry:u.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(d,h){return h.filter(p=>!!d.find(m=>m.payloadType===p.payloadType&&!!m.rtcpFeedbacks.find(_=>_.type==="goog-remb")))}(s,e.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(h=>h.type==="goog-remb")||d.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t.remb===!1){const u=e.attributes.extmaps.findIndex(d=>d.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(d=>{const h=d.rtcpFeedbacks.findIndex(p=>p.type==="goog-remb");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}}function GO(e,t,n){if(Bt()||e.media.mediaType!=="video"||!(t instanceof en)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!H("SIMULCAST")||t._scalabiltyMode===void 0||t._scalabiltyMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:t._scalabiltyMode.numSpatialLayers,s=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(h=>h.semantic==="FID"&&h.ssrcIds[0]===s.ssrcId),d={semantic:"SIM",ssrcIds:[s.ssrcId]};for(let h=1;h<i;h++)e.attributes.ssrcs.push({ssrcId:s.ssrcId+h,attributes:Zt(s.attributes)}),d.ssrcIds.push(s.ssrcId+h),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+h,attributes:Zt(s.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[s.ssrcId+h,u.ssrcIds[1]+h]}));e.attributes.ssrcGroups.unshift(d)}async function WO(e,t,n,i,s){const u=new RTCPeerConnection;u.addTransceiver("video",{direction:"sendonly"}),u.addTransceiver("audio",{direction:"sendonly"}),u.addTransceiver("video",{direction:"recvonly"}),u.addTransceiver("audio",{direction:"recvonly"});const d=(await u.createOffer()).sdp,h=zE(d,e,t,n,i,s,"sendonly"),p=zE(d,e,t,n,i,s,"recvonly"),m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(up(h,p,"videoExtensions",m,_,E),up(h,p,"videoCodecs",m,_,E),up(h,p,"audioExtensions",m,_,E),up(h,p,"audioCodecs",m,_,E),H("RAISE_H264_BASELINE_PRIORITY")){const y=E.videoCodecs.findIndex(A=>{var k,L;return((k=A.rtpMap)===null||k===void 0?void 0:k.encodingName.toLocaleLowerCase())==="h264"&&((L=A.fmtp)===null||L===void 0?void 0:L.parameters["profile-level-id"])==="42001f"});if(y!==-1){const A=E.videoCodecs.findIndex(k=>{var L;return((L=k.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"});if(A<y){I.debug("raising H264 baseline profile priority");const k=E.videoCodecs[y];E.videoCodecs.splice(y,1),E.videoCodecs.splice(A,0,k)}A!==-1&&(_.videoCodecs=_.videoCodecs.filter(k=>{var L,x;return!(((L=k.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"&&((x=k.fmtp)===null||x===void 0?void 0:x.parameters["profile-level-id"])!=="42001f")})),A!==-1&&H("FILTER_SEND_H264_BASELINE")&&(m.videoCodecs=m.videoCodecs.filter(k=>{var L,x;return!(((L=k.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"&&((x=k.fmtp)===null||x===void 0?void 0:x.parameters["profile-level-id"])!=="42001f")}))}}try{u.close()}catch{}return{send:m,recv:_,sendrecv:E}}function up(e,t,n,i,s,u){if(n==="videoExtensions"||n==="audioExtensions"){const d=[];return e[n].forEach(h=>{t[n].some((p,m)=>{if(h.entry===p.entry&&h.extensionName===p.extensionName)return d.push(m),!0})?u[n].push(h):i[n].push(h)}),void t[n].forEach((h,p)=>{d.indexOf(p)===-1&&s[n].push(h)})}if(n==="videoCodecs"||n==="audioCodecs"){const d=[];return e[n].forEach(h=>{t[n].some((p,m)=>{if(h.payloadType===p.payloadType&&JSON.stringify(h)===JSON.stringify(p))return d.push(m),!0})?u[n].push(h):i[n].push(h)}),void t[n].forEach((h,p)=>{d.indexOf(p)===-1&&s[n].push(h)})}}function JE(e){const{send:t,recv:n,sendrecv:i}=e;if(!i){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let s,u;return t?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...t.audioCodecs,...i.audioCodecs],s.videoCodecs=[...t.videoCodecs,...i.videoCodecs],s.audioExtensions=[...t.audioExtensions,...i.audioExtensions],s.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):s=i,n?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...n.audioCodecs,...i.audioCodecs],u.videoCodecs=[...n.videoCodecs,...i.videoCodecs],u.audioExtensions=[...n.audioExtensions,...i.audioExtensions],u.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):u=i,{send:s,recv:u}}function Cs(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function HO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function KO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?HO(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HO(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}(function(e,t){e.exports=(()=>{var n={8:(u,d,h)=>{h.r(d),h.d(d,{Parser:()=>At,Printer:()=>Tr,parse:()=>xe,print:()=>nt});const p=`
`,m="".concat("\r").concat(p),_=" ";let E;function y(ce){return ce>="0"&&ce<="9"}function A(ce){return ce>="!"&&ce<="~"}function k(ce){return A(ce)||ce>=""&&ce<="ÿ"}function L(ce){return ce==="!"||ce>="#"&&ce<="'"||ce>="*"&&ce<="+"||ce>="-"&&ce<="."||ce>="0"&&ce<="9"||ce>="A"&&ce<="Z"||ce>="^"&&ce<="~"}function x(ce){return ce>="1"&&ce<="9"}function z(ce){return ce>="A"&&ce<="Z"||ce>="a"&&ce<="z"}function X(ce){return ce==="d"||ce==="h"||ce==="m"||ce==="s"}function ie(ce){return ce>""&&ce<"	"||ce>"\v"&&ce<"\f"||ce>""&&ce<"ÿ"}function Ie(ce){return z(ce)||y(ce)||ce==="+"||ce==="/"}function se(ce){return y(ce)||z(ce)||ce==="+"||ce==="/"||ce==="-"||ce==="_"}function de(ce){return z(ce)||y(ce)||ce==="+"||ce==="/"}function oe(ce,S){var D=Object.keys(ce);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(ce);S&&(F=F.filter(function(ee){return Object.getOwnPropertyDescriptor(ce,ee).enumerable})),D.push.apply(D,F)}return D}function ve(ce){for(var S=1;S<arguments.length;S++){var D=arguments[S]!=null?arguments[S]:{};S%2?oe(Object(D),!0).forEach(function(F){pt(ce,F,D[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ce,Object.getOwnPropertyDescriptors(D)):oe(Object(D)).forEach(function(F){Object.defineProperty(ce,F,Object.getOwnPropertyDescriptor(D,F))})}return ce}function pt(ce,S,D){return S in ce?Object.defineProperty(ce,S,{value:D,enumerable:!0,configurable:!0,writable:!0}):ce[S]=D,ce}(function(ce){ce.VERSION="v",ce.ORIGIN="o",ce.SESSION_NAME="s",ce.INFORMATION="i",ce.URI="u",ce.EMAIL="e",ce.PHONE="p",ce.CONNECTION="c",ce.BANDWIDTH="b",ce.TIME="t",ce.REPEAT="r",ce.ZONE_ADJUSTMENTS="z",ce.KEY="k",ce.ATTRIBUTE="a",ce.MEDIA="m"})(E||(E={}));class Be{consumeText(S,D){let F=D;for(;F<S.length;){const ee=S[F];if(ee==="\0"||ee==="\r"||ee===p)break;F+=1}if(F-D==0)throw new Error("Invalid text, at ".concat(S));return F}consumeUnicastAddress(S,D,F){return this.consumeTill(S,D,_)}consumeOneOrMore(S,D,F){let ee=D;for(;F(S[ee]);)ee++;if(ee-D==0)throw new Error("Invalid rule at ".concat(D,"."));return ee}consumeSpace(S,D){if(S[D]===_)return D+1;throw new Error("Invalid space at ".concat(D,"."))}consumeIP4Address(S,D){let F=D;for(let ee=0;ee<4;ee++)if(F=this.consumeDecimalUChar(S,F),ee!==3){if(S[F]!==".")throw new Error("Invalid IP4 address.");F++}return F}consumeDecimalUChar(S,D){let F=D;for(let Ue=0;Ue<3&&y(S[F]);Ue++,F++);if(F-D==0)throw new Error("Invalid decimal uchar.");const ee=parseInt(S.slice(D,F));if(ee>=0&&ee<=255)return F;throw new Error("Invalid decimal uchar")}consumeIP6Address(S,D){let F=this.consumeHexpart(S,D);return S[F]===":"&&(F+=1,F=this.consumeIP4Address(S,F)),F}consumeHexpart(S,D){let F=D;if(S[F]===":"&&S[F+1]===":"){F+=2;try{F=this.consumeHexseq(S,F)}catch{}return F}if(F=this.consumeHexseq(S,F),S[F]===":"&&S[F+1]===":"){F+=2;try{F=this.consumeHexseq(S,F)}catch{}return F}return F}consumeHexseq(S,D){let F=D;for(;F=this.consumeHex4(S,F),S[F]===":"&&S[F+1]!==":";)F+=1;return F}consumeHex4(S,D){let F=0;for(;F<4;F++)if(!((ee=S[D+F])>="0"&&ee<="9"||ee>="a"&&ee<="f"||ee>="A"&&ee<="F")){if(F===0)throw new Error("Invalid hex 4");break}var ee;return D+F}consumeFQDN(S,D){let F=D;for(;y(S[F])||z(S[F])||S[F]==="-"||S[F]===".";)F+=1;if(F-D<4)throw new Error("Invalid FQDN");return F}consumeExtnAddr(S,D){return this.consumeOneOrMore(S,D,k)}consumeMulticastAddress(S,D,F){switch(F){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(S,D);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(S,D);default:try{return this.consumeFQDN(S,D)}catch{return this.consumeExtnAddr(S,D)}}}consumeIP6MulticastAddress(S,D){const F=this.consumeHexpart(S,D);return S[F]==="/"?this.consumeInteger(S,F+1):F}consumeIP4MulticastAddress(S,D){let F=D+3;const ee=S.slice(D,F),Ue=parseInt(ee);if(Ue<224||Ue>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Rt=0;Rt<3;Rt++){if(S[F]!==".")throw new Error("Invalid IP4 multicast address.");F+=1,F=this.consumeDecimalUChar(S,F)}return S[F]==="/"&&(F+=1),F=this.consumeTTL(S,F),S[F]==="/"&&(F=this.consumeInteger(S,F)),F}consumeInteger(S,D){if(!x(S[D]))throw new Error("Invalid integer.");for(D+=1;y(S[D]);)D+=1;return D}consumeTTL(S,D){if(S[D]==="0")return D+1;if(!x(S[D]))throw new Error("Invalid TTL.");D+=1;for(let F=0;F<2&&y(S[D]);F++)D+=1;return D}consumeToken(S,D){return this.consumeOneOrMore(S,D,L)}consumeTime(S,D){let F=D;if(S[F]==="0")return F+1;for(x(S[F])&&(F+=1);y(S[F]);)F++;if(F-D<10)throw new Error("Invalid time");return F}consumeAddress(S,D){return this.consumeTill(S,D,_)}consumeTypedTime(S,D){let F=D;return F=this.consumeOneOrMore(S,F,y),X(S[F])?F+1:F}consumeRepeatInterval(S,D){if(!x(S[D]))throw new Error("Invalid repeat interval");for(D+=1;y(S[D]);)D+=1;return X(S[D])&&(D+=1),D}consumePort(S,D){return this.consumeOneOrMore(S,D,y)}consume(S,D,F){for(let ee=0;ee<F.length;ee++){if(D+ee>=S.length)throw new Error("consume exceeding value length");if(S[D+ee]!==F[ee])throw new Error("consume ".concat(F," failed at ").concat(ee))}return D+F.length}consumeTill(S,D,F){let ee=D;for(;ee<S.length&&(typeof F!="string"||S[ee]!==F)&&(typeof F!="function"||!F(S[ee]));)ee++;return ee}}class At extends Be{constructor(){super(),pt(this,"records",[]),pt(this,"currentLine",0)}parse(S){const D=this.probeEOL(S);this.records=S.split(D).filter(dr=>!!dr.trim()).map(this.parseLine),this.currentLine=0;const F=this.parseVersion(),ee=this.parseOrigin(),Ue=this.parseSessionName(),Rt=this.parseInformation(),Pn=this.parseUri(),Ni=this.parseEmail(),bs=this.parsePhone(),fi=this.parseConnection(),Ns=this.parseBandWidth(),jc=this.parseTimeFields(),Ht=this.parseKey(),nn=this.parseSessionAttribute(),St=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:F,origin:ee,sessionName:Ue,information:Rt,uri:Pn,emails:Ni,phones:bs,connection:fi,bandwidths:Ns,timeFields:jc,key:Ht,attributes:nn,mediaDescriptions:St}}getCurrentRecord(){const S=this.records[this.currentLine];if(!S)throw new Error("Record doesn't exit.");return S}probeEOL(S){for(let D=0;D<S.length;D++)if(S[D]===p)return S[D-1]==="\r"?m:p;throw new Error("Invalid newline character.")}parseLine(S,D){if(S.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const F=S[0];if(S[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:F,value:S.slice(2),line:D,cur:0}}parseSessionAttribute(){const S=new Xt;for(;this.currentLine<this.records.length;){const D=this.getCurrentRecord();if(D.type!==E.ATTRIBUTE)break;const F={attField:this.extractOneOrMore(D,ee=>L(ee)&&ee!==":"),_cur:0};D.value[D.cur]===":"&&(D.cur+=1,F.attValue=this.extractOneOrMore(D,ie)),S.parse(F),this.currentLine++}return S.digest()}parseMediaAttributes(S){const D=new Nn(S);for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==E.ATTRIBUTE)break;const ee={attField:this.extractOneOrMore(F,Ue=>L(Ue)&&Ue!==":"),_cur:0};F.value[F.cur]===":"&&(F.cur+=1,ee.attValue=this.extractOneOrMore(F,ie)),D.parse(ee),this.currentLine++}return D.digest()}parseKey(){const S=this.getCurrentRecord();if(S.type===E.KEY){if(S.value==="prompt"||S.value==="clear:"||S.value==="base64:"||S.value==="uri:")return S.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const S=this.getCurrentRecord();if(S.type===E.ZONE_ADJUSTMENTS){const D=[];for(;;)try{const F=this.extract(S,this.consumeTime);this.consumeSpaceForRecord(S);let ee=!1;S.value[S.cur]==="-"&&(ee=!0,S.cur+=1);const Ue=this.extract(S,this.consumeTypedTime);D.push({time:F,typedTime:Ue,back:ee})}catch{break}if(D.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,D}return[]}parseRepeat(){const S=[];for(;;){const D=this.getCurrentRecord();if(D.type!==E.REPEAT)break;{const F=this.extract(D,this.consumeRepeatInterval),ee=this.parseTypedTime(D);S.push({repeatInterval:F,typedTimes:ee}),this.currentLine++}}return S}parseTypedTime(S){const D=[];for(;;)try{this.consumeSpaceForRecord(S),D.push(this.extract(S,this.consumeTypedTime))}catch{break}if(D.length===0)throw new Error("Invalid typed time.");return D}parseTime(){const S=this.getCurrentRecord(),D=this.extract(S,this.consumeTime);this.consumeSpaceForRecord(S);const F=this.extract(S,this.consumeTime);return this.currentLine++,{startTime:D,stopTime:F}}parseBandWidth(){const S=[];for(;this.currentLine<this.records.length;){const D=this.getCurrentRecord();if(D.type!==E.BANDWIDTH)break;{const F=this.extractOneOrMore(D,L);if(D.value[D.cur]!==":")throw new Error("Invalid bandwidth field.");D.cur++;const ee=this.extractOneOrMore(D,y);S.push({bwtype:F,bandwidth:ee}),this.currentLine++}}return S}parseVersion(){const S=this.getCurrentRecord();if(S.type!==E.VERSION)throw new Error("first sdp record must be version");const D=S.value.slice(0,this.consumeOneOrMore(S.value,0,y));if(D.length!==S.value.length)throw new Error('invalid proto version, "v='.concat(S.value,'"'));return this.currentLine++,D}parseOrigin(){const S=this.getCurrentRecord();if(S.type!==E.ORIGIN)throw new Error("second line of sdp must be origin");const D=this.extractOneOrMore(S,k);this.consumeSpaceForRecord(S);const F=this.extractOneOrMore(S,y);this.consumeSpaceForRecord(S);const ee=this.extractOneOrMore(S,y);this.consumeSpaceForRecord(S);const Ue=this.extractOneOrMore(S,L);this.consumeSpaceForRecord(S);const Rt=this.extractOneOrMore(S,L);this.consumeSpaceForRecord(S);const Pn=this.extract(S,this.consumeUnicastAddress);return this.currentLine++,{username:D,sessId:F,sessVersion:ee,nettype:Ue,addrtype:Rt,unicastAddress:Pn}}parseSessionName(){const S=this.getCurrentRecord();if(S.type===E.SESSION_NAME){const D=this.extract(S,this.consumeText);return this.currentLine++,D}}parseInformation(){const S=this.getCurrentRecord();if(S.type!==E.INFORMATION)return;const D=this.extract(S,this.consumeText);return this.currentLine++,D}parseUri(){const S=this.getCurrentRecord();if(S.type===E.URI)return this.currentLine++,S.value}parseEmail(){const S=[];for(;;){const D=this.getCurrentRecord();if(D.type!==E.EMAIL)break;S.push(D.value),this.currentLine++}return S}parsePhone(){const S=[];for(;;){const D=this.getCurrentRecord();if(D.type!==E.PHONE)break;S.push(D.value),this.currentLine++}return S}parseConnection(){const S=this.getCurrentRecord();if(S.type===E.CONNECTION){const D=this.extractOneOrMore(S,L);this.consumeSpaceForRecord(S);const F=this.extractOneOrMore(S,L);this.consumeSpaceForRecord(S);const ee=this.extract(S,this.consumeAddress);return this.currentLine++,{nettype:D,addrtype:F,address:ee}}}parseMedia(){const S=this.getCurrentRecord(),D=this.extract(S,this.consumeToken);this.consumeSpaceForRecord(S);let F=this.extract(S,this.consumePort);S.value[S.cur]==="/"&&(S.cur+=1,F+=this.extract(S,this.consumeInteger)),this.consumeSpaceForRecord(S);const ee=[];for(ee.push(this.extract(S,this.consumeToken));S.value[S.cur]==="/";)S.cur+=1,ee.push(this.extract(S,this.consumeToken));if(ee.length===0)throw new Error("Invalid proto");const Ue=this.parseFmt(S);return this.currentLine++,{mediaType:D,port:F,protos:ee,fmts:Ue}}parseTimeFields(){const S=[];for(;this.getCurrentRecord().type===E.TIME;){const D=this.parseTime(),F=this.parseRepeat(),ee=this.parseZone();S.push({time:D,repeats:F,zones:ee})}return S}parseMediaDescription(){const S=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.MEDIA;){const D=this.parseMedia(),F=this.parseInformation(),ee=this.parseConnections(),Ue=this.parseBandWidth(),Rt=this.parseKey(),Pn=this.parseMediaAttributes(D);S.push({media:D,information:F,connections:ee,bandwidths:Ue,key:Rt,attributes:Pn})}return S}parseConnections(){const S=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.CONNECTION;)S.push(this.parseConnection());return S}parseFmt(S){const D=[];for(;;)try{this.consumeSpaceForRecord(S),D.push(this.extract(S,this.consumeToken))}catch{break}if(D.length===0)throw new Error("Invalid fmts");return D}extract(S,D,...F){const ee=D.call(this,S.value,S.cur,...F),Ue=S.value.slice(S.cur,ee);return S.cur=ee,Ue}extractOneOrMore(S,D){const F=this.consumeOneOrMore(S.value,S.cur,D),ee=S.value.slice(S.cur,F);return S.cur=F,ee}consumeSpaceForRecord(S){if(S.value[S.cur]!==_)throw new Error("Invalid space at ".concat(S.cur,"."));S.cur+=1}}class gt extends Be{constructor(...S){super(...S),pt(this,"attributes",void 0),pt(this,"digested",!1)}extractOneOrMore(S,D,F){const ee=this.consumeOneOrMore(S.attValue,S._cur,D),Ue=S.attValue.slice(S._cur,ee),[Rt,Pn]=F||[];if(typeof Rt=="number"&&Ue.length<Rt)throw new Error("error in length, should be more or equal than ".concat(Rt," characters."));if(typeof Pn=="number"&&Ue.length>Pn)throw new Error("error in length, should be less or equal than ".concat(Pn," characters."));return S._cur=ee,Ue}consumeAttributeSpace(S){if(S.attValue[S._cur]!==_)throw new Error("Invalid space at ".concat(S._cur,"."));S._cur+=1}extract(S,D,...F){if(!S.attValue)throw new Error("Nothing to extract from attValue.");const ee=D.call(this,S.attValue,S._cur,...F),Ue=S.attValue.slice(S._cur,ee);return S._cur=ee,Ue}atEnd(S){if(!S.attValue)throw new Error;return S._cur>=S.attValue.length}peekChar(S){if(!S.attValue)throw new Error;return S.attValue[S._cur]}peek(S,D){if(!S.attValue)throw new Error;for(let F=0;F<D.length;F++)if(D[F]!==S.attValue[S._cur+F])return!1;return!0}parseIceUfrag(S){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(S,Ie,[4,256])}parseIcePwd(S){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(S,Ie,[22,256])}parseIceOptions(S){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const D=[];for(;!this.atEnd(S);){D.push(this.extractOneOrMore(S,Ie));try{this.consumeAttributeSpace(S)}catch(F){if(this.atEnd(S))break;throw F}}this.attributes.iceOptions=D}parseFingerprint(S){const D=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S);const F=this.extract(S,this.consumeTill);this.attributes.fingerprints.push({hashFunction:D,fingerprint:F})}parseExtmap(S){const D=this.extractOneOrMore(S,y);let F;this.peekChar(S)==="/"&&(this.extract(S,this.consume,"/"),F=this.extract(S,this.consumeToken)),this.consumeAttributeSpace(S);const ee=this.extract(S,this.consumeTill,_),Ue=ve(ve({entry:parseInt(D,10)},F&&{direction:F}),{},{extensionName:ee});this.peekChar(S)===_&&(this.consumeAttributeSpace(S),Ue.extensionAttributes=this.extract(S,this.consumeTill)),this.attributes.extmaps.push(Ue)}parseSetup(S){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const D=this.extract(S,this.consumeTill);if(D!=="active"&&D!=="passive"&&D!=="actpass"&&D!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=D}}class Xt extends gt{constructor(...S){super(...S),pt(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(S){if(this.digested)throw new Error("already digested");try{switch(S.attField){case"group":this.parseGroup(S);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(S);break;case"ice-pwd":this.parseIcePwd(S);break;case"ice-options":this.parseIceOptions(S);break;case"fingerprint":this.parseFingerprint(S);break;case"setup":this.parseSetup(S);break;case"tls-id":this.parseTlsId(S);break;case"identity":this.parseIdentity(S);break;case"extmap":this.parseExtmap(S);break;case"msid-semantic":this.parseMsidSemantic(S);break;default:S.ignored=!0,this.attributes.unrecognized.push(S)}}catch(D){throw console.error("parsing session attribute ".concat(S.attField,' error, "a=').concat(S.attField,":").concat(S.attValue,'"')),D}if(!S.ignored&&S.attValue&&!this.atEnd(S))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(S){const D=this.extract(S,this.consumeToken),F=[];for(;!this.atEnd(S)&&this.peekChar(S)===_;)this.consumeAttributeSpace(S),F.push(this.extract(S,this.consumeToken));this.attributes.groups.push({semantic:D,identificationTag:F})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(S){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(S,se)}parseIdentity(S){const D=this.extractOneOrMore(S,de),F=[];for(;!this.atEnd(S)&&this.peekChar(S)===_;){this.consumeAttributeSpace(S);const ee=this.extract(S,this.consumeToken);this.extract(S,this.consume,"=");const Ue=this.extractOneOrMore(S,Rt=>Rt!==_&&ie(Rt));F.push({name:ee,value:Ue})}this.attributes.identities.push({assertionValue:D,extensions:F})}parseMsidSemantic(S){this.peekChar(S)===_&&this.consumeAttributeSpace(S);const D={semantic:this.extract(S,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(S)}catch{break}if(this.peekChar(S)==="*"){this.extract(S,this.consume,"*"),D.applyForAll=!0;break}{const F=this.extract(S,this.consumeTill,_);D.identifierList.push(F)}}this.attributes.msidSemantic=D}}class Nn extends gt{constructor(S){super(),pt(this,"attributes",void 0),S.protos.indexOf("RTP")!==-1||S.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(S){if(this.digested)throw new Error("already digested");try{switch(S.attField){case"extmap":this.parseExtmap(S);break;case"setup":this.parseSetup(S);break;case"ice-ufrag":this.parseIceUfrag(S);break;case"ice-pwd":this.parseIcePwd(S);break;case"ice-options":this.parseIceOptions(S);break;case"candidate":this.parseCandidate(S);break;case"remote-candidate":this.parseRemoteCandidate(S);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(S);break;case"rtpmap":this.parseRtpmap(S);break;case"ptime":this.parsePtime(S);break;case"maxptime":this.parseMaxPtime(S);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(S);break;case"ssrc":this.parseSSRC(S);break;case"fmtp":this.parseFmtp(S);break;case"rtcp-fb":this.parseRtcpFb(S);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(S);break;case"mid":this.parseMid(S);break;case"msid":this.parseMsid(S);break;case"imageattr":this.parseImageAttr(S);break;case"rid":this.parseRid(S);break;case"simulcast":this.parseSimulcast(S);break;case"sctp-port":this.parseSctpPort(S);break;case"max-message-size":this.parseMaxMessageSize(S);break;case"ssrc-group":this.parseSSRCGroup(S);break;default:S.ignored=!0,this.attributes.unrecognized.push(S)}}catch(D){throw console.error("parsing media attribute ".concat(S.attField,' error, "a=').concat(S.attField,":").concat(S.attValue,'"')),D}if(!S.ignored&&S.attValue&&!this.atEnd(S))throw new Error("attribute parsing error")}parseCandidate(S){const D=this.extractOneOrMore(S,Ie,[1,32]);this.consumeAttributeSpace(S);const F=this.extractOneOrMore(S,y,[1,5]);this.consumeAttributeSpace(S);const ee=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S);const Ue=this.extractOneOrMore(S,y,[1,10]);this.consumeAttributeSpace(S);const Rt=this.extract(S,this.consumeAddress);this.consumeAttributeSpace(S);const Pn=this.extract(S,this.consumePort);this.consumeAttributeSpace(S),this.extract(S,this.consume,"typ"),this.consumeAttributeSpace(S);const Ni={foundation:D,componentId:F,transport:ee,priority:Ue,connectionAddress:Rt,port:Pn,type:this.extract(S,this.consumeToken),extension:{}};for(this.peek(S," raddr")&&(this.extract(S,this.consume," raddr"),this.consumeAttributeSpace(S),Ni.relAddr=this.extract(S,this.consumeAddress)),this.peek(S," rport")&&(this.extract(S,this.consume," rport"),this.consumeAttributeSpace(S),Ni.relPort=this.extract(S,this.consumePort));this.peekChar(S)===_;){this.consumeAttributeSpace(S);const bs=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S),Ni.extension[bs]=this.extractOneOrMore(S,A)}this.attributes.candidates.push(Ni)}parseRemoteCandidate(S){const D=[];for(;;){const F=this.extractOneOrMore(S,y,[1,5]);this.consumeAttributeSpace(S);const ee=this.extract(S,this.consumeAddress);this.consumeAttributeSpace(S);const Ue=this.extract(S,this.consumePort);D.push({componentId:F,connectionAddress:ee,port:Ue});try{this.consumeAttributeSpace(S)}catch{break}}this.attributes.remoteCandidatesList.push(D)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(S){const D=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S);const F=this.extract(S,this.consumeTill,"/");this.extract(S,this.consume,"/");const ee={encodingName:F,clockRate:this.extractOneOrMore(S,y)};this.atEnd(S)||this.peekChar(S)!=="/"||(this.extract(S,this.consume,"/"),ee.encodingParameters=parseInt(this.extract(S,this.consumeTill),10));const Ue=this.attributes.payloads.find(Rt=>Rt.payloadType===parseInt(D,10));Ue?Ue.rtpMap=ee:this.attributes.payloads.push({payloadType:parseInt(D,10),rtpMap:ee,rtcpFeedbacks:[]})}parsePtime(S){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(S,this.consumeTill)}parseMaxPtime(S){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(S,this.consumeTill)}parseDirection(S){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=S.attField}parseSSRC(S){const D=this.extractOneOrMore(S,y);this.consumeAttributeSpace(S);const F=this.extract(S,this.consumeTill,":");let ee;this.peekChar(S)===":"&&(this.extract(S,this.consume,":"),ee=this.extract(S,this.consumeTill));const Ue=this.attributes.ssrcs.find(Rt=>Rt.ssrcId===parseInt(D,10));Ue?Ue.attributes[F]=ee:this.attributes.ssrcs.push({ssrcId:parseInt(D,10),attributes:{[F]:ee}})}parseFmtp(S){const D=this.extract(S,this.consumeTill,_);this.consumeAttributeSpace(S);const F=this.extract(S,this.consumeTill),ee={};F.split(";").forEach(Rt=>{let[Pn,Ni]=Rt.split("=");Pn=Pn.trim();const bs=typeof Ni=="string"?Ni.trim():null;typeof Pn=="string"&&Pn.length>0&&(ee[Pn]=bs)});const Ue=this.attributes.payloads.find(Rt=>Rt.payloadType===parseInt(D,10));Ue?Ue.fmtp={parameters:ee}:this.attributes.payloads.push({payloadType:parseInt(D,10),rtcpFeedbacks:[],fmtp:{parameters:ee}})}parseFmtParameters(S){const D={},F=this.extract(S,this.consumeTill,"=");S._cur++;const ee=this.extract(S,this.consumeTill,";");for(D[F]=ee;S.attValue[S._cur]===";";){const Ue=this.extract(S,this.consumeTill,"=");S._cur++;const Rt=this.extract(S,this.consumeTill,";");D[Ue]=Rt}return D}parseRtcpFb(S){let D="";D=this.peekChar(S)==="*"?this.extract(S,this.consume,"*"):this.extract(S,this.consumeTill,_),this.consumeAttributeSpace(S);const F=this.extract(S,this.consumeTill,_);let ee;switch(F){case"trr-int":ee={type:F,interval:this.extract(S,this.consumeTill)};break;case"ack":case"nack":default:{const Ue={type:F};this.peekChar(S)===_&&(this.consumeAttributeSpace(S),Ue.parameter=this.extract(S,this.consumeToken),this.peekChar(S)===_&&(Ue.additional=this.extract(S,this.consumeTill))),ee=Ue}}if(D==="*")this.attributes.rtcpFeedbackWildcards.push(ee);else{const Ue=this.attributes.payloads.find(Rt=>Rt.payloadType===parseInt(D,10));Ue?Ue.rtcpFeedbacks.push(ee):this.attributes.payloads.push({payloadType:parseInt(D,10),rtcpFeedbacks:[ee]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(S){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const D={port:this.extract(S,this.consumePort)};this.peekChar(S)===_&&(this.consumeAttributeSpace(S),D.netType=this.extractOneOrMore(S,L),this.consumeAttributeSpace(S),D.addressType=this.extractOneOrMore(S,L),this.consumeAttributeSpace(S),D.address=this.extract(S,this.consumeAddress)),this.attributes.rtcp=D}parseMsid(S){const D={id:this.extractOneOrMore(S,L,[1,64])};this.peekChar(S)===_&&(this.consumeAttributeSpace(S),D.appdata=this.extractOneOrMore(S,L,[1,64])),this.attributes.msids.push(D)}parseImageAttr(S){this.attributes.imageattr.push(S.attValue)}parseRid(S){const D=this.extractOneOrMore(S,ee=>z(ee)||y(ee)||ee==="_"||ee==="-");this.consumeAttributeSpace(S);const F={id:D,direction:this.extract(S,this.consumeToken),params:[]};if(this.peekChar(S)===_){if(this.consumeAttributeSpace(S),this.peek(S,"pt=")){this.extract(S,this.consume,"pt=");const ee=[];for(;;){const Ue=this.extract(S,this.consumeToken);ee.push(Ue);try{this.extract(S,this.consume,",")}catch{break}}F.payloads=ee,this.peekChar(S)===_&&this.extract(S,this.consume,_)}for(;;){const ee=this.extract(S,this.consumeToken);switch(ee){case"depend":{const Ue={type:ee,rids:this.extract(S,this.consume,"=").split(",")};F.params.push(Ue);break}case"max-width":case"height-width":case"max-fps":case"max-fs":case"max-br":case"max-pps":case"max-bpp":default:{const Ue={type:ee};this.peekChar(S)==="="&&(this.extract(S,this.consume,"="),Ue.val=this.extract(S,this.consumeTill,";")),F.params.push(Ue)}}try{this.extract(S,this.consume,";")}catch{break}}}this.attributes.rids.push(F)}parseSimulcast(S){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=S.attValue,this.extract(S,this.consumeTill)}parseSctpPort(S){this.attributes.sctpPort=this.extractOneOrMore(S,y,[1,5])}parseMaxMessageSize(S){this.attributes.maxMessageSize=this.extractOneOrMore(S,y,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(S){this.attributes.mid=this.extract(S,this.consumeToken)}parseSSRCGroup(S){const D=this.extract(S,this.consumeToken),F=[];for(;;)try{this.consumeAttributeSpace(S);const ee=this.extract(S,this.consumeInteger);F.push(parseInt(ee,10))}catch{break}this.attributes.ssrcGroups.push({semantic:D,ssrcIds:F})}}function Yt(ce,S,D){return S in ce?Object.defineProperty(ce,S,{value:D,enumerable:!0,configurable:!0,writable:!0}):ce[S]=D,ce}class Tr{constructor(){Yt(this,"eol",m)}print(S,D){let F="";return D&&(this.eol=D),F+=this.printVersion(S.version),F+=this.printOrigin(S.origin),F+=this.printSessionName(S.sessionName),F+=this.printInformation(S.information),F+=this.printUri(S.uri),F+=this.printEmail(S.emails),F+=this.printPhone(S.phones),F+=this.printConnection(S.connection),F+=this.printBandwidth(S.bandwidths),F+=this.printTimeFields(S.timeFields),F+=this.printKey(S.key),F+=this.printSessionAttributes(S.attributes),F+=this.printMediaDescription(S.mediaDescriptions),F}printVersion(S){return"v=".concat(S).concat(this.eol)}printOrigin(S){return"o=".concat(S.username," ").concat(S.sessId," ").concat(S.sessVersion," ").concat(S.nettype," ").concat(S.addrtype," ").concat(S.unicastAddress).concat(this.eol)}printSessionName(S){return S?"s=".concat(S).concat(this.eol):""}printInformation(S){return S?"i=".concat(S).concat(this.eol):""}printUri(S){return S?"u=".concat(S).concat(this.eol):""}printEmail(S){let D="";for(const F of S)D+="e=".concat(F).concat(this.eol);return D}printPhone(S){let D="";for(const F of S)D+="e=".concat(F).concat(this.eol);return D}printConnection(S){return S?"c=".concat(S.nettype," ").concat(S.addrtype," ").concat(S.address).concat(this.eol):""}printBandwidth(S){let D="";for(const F of S)D+="b=".concat(F.bwtype,":").concat(F.bandwidth).concat(this.eol);return D}printTimeFields(S){let D="";for(const F of S){D+="t=".concat(F.time.startTime," ").concat(F.time.startTime).concat(this.eol);for(const ee of F.repeats)D+="r=".concat(ee.repeatInterval," ").concat(ee.typedTimes.join(" ")).concat(this.eol);F.zoneAdjustments&&(D+="z=",D+="z=".concat(F.zoneAdjustments.map(ee=>"".concat(ee.time," ").concat(ee.back?"-":""," ").concat(ee.typedTime)).join(" ")).concat(this.eol),D+=this.eol)}return D}printKey(S){return S?"k=".concat(S).concat(this.eol):""}printAttributes(S){let D="";for(const F of S)D+="a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol);return D}printMediaDescription(S){let D="";for(const F of S)D+=this.printMedia(F.media),D+=this.printInformation(F.information),D+=this.printConnections(F.connections),D+=this.printBandwidth(F.bandwidths),D+=this.printKey(F.key),D+=this.printMediaAttributes(F);return D}printConnections(S){let D="";for(const F of S)D+=this.printConnection(F);return D}printMedia(S){return"m=".concat(S.mediaType," ").concat(S.port," ").concat(S.protos.join("/")," ").concat(S.fmts.join(" ")).concat(this.eol)}printSessionAttributes(S){return new re(this.eol).print(S)}printMediaAttributes(S){return new _e(this.eol).print(S)}}class Z{constructor(S){Yt(this,"eol",void 0),this.eol=S}printIceUfrag(S){return S===void 0?"":"a=ice-ufrag:".concat(S).concat(this.eol)}printIcePwd(S){return S===void 0?"":"a=ice-pwd:".concat(S).concat(this.eol)}printIceOptions(S){return S===void 0?"":"a=ice-options:".concat(S.join(_)).concat(this.eol)}printFingerprints(S){return S.length>0?S.map(D=>"a=fingerprint:".concat(D.hashFunction).concat(_).concat(D.fingerprint)).join(this.eol)+this.eol:""}printExtmap(S){return S.map(D=>"a=extmap:".concat(D.entry).concat(D.direction?"/".concat(D.direction):"").concat(_).concat(D.extensionName).concat(D.extensionAttributes?"".concat(_).concat(D.extensionAttributes):"").concat(this.eol)).join("")}printSetup(S){return S===void 0?"":"a=setup:".concat(S).concat(this.eol)}printUnrecognized(S){return S.map(D=>"a=".concat(D.attField).concat(D.attValue?":".concat(D.attValue):"").concat(this.eol)).join("")}}class re extends Z{print(S){let D="";return D+=this.printGroups(S.groups),D+=this.printMsidSemantic(S.msidSemantic),D+=this.printIceLite(S.iceLite),D+=this.printIceUfrag(S.iceUfrag),D+=this.printIcePwd(S.icePwd),D+=this.printIceOptions(S.iceOptions),D+=this.printFingerprints(S.fingerprints),D+=this.printSetup(S.setup),D+=this.printTlsId(S.tlsId),D+=this.printIdentity(S.identities),D+=this.printExtmap(S.extmaps),D+=this.printUnrecognized(S.unrecognized),D}printGroups(S){let D="";return S.length>0&&(D+=S.map(F=>"a=group:".concat(F.semantic).concat(F.identificationTag.map(ee=>"".concat(_).concat(ee)).join("")).concat(this.eol)).join("")),D}printIceLite(S){return S===void 0?"":"a=ice-lite"+this.eol}printTlsId(S){return S?"a=tls-id:".concat(S).concat(this.eol):""}printIdentity(S){return S.length===0?"":S.map(D=>"a=identity:".concat(D.assertionValue).concat(D.extensions.map(F=>"".concat(_).concat(F.name).concat(F.value?"=".concat(F.value):"")))).join(this.eol)+this.eol}printMsidSemantic(S){if(!S)return"";let D="a=msid-semantic:".concat(S.semantic);return S.applyForAll?D+="".concat(_,"*"):S.identifierList.length>0&&(D+=S.identifierList.map(F=>"".concat(_).concat(F))),D+this.eol}}class _e extends Z{print(S){const D=S.attributes;let F="";return F+=this.printRTCP(D.rtcp),F+=this.printIceUfrag(D.iceUfrag),F+=this.printIcePwd(D.icePwd),F+=this.printIceOptions(D.iceOptions),F+=this.printCandidates(D.candidates),F+=this.printRemoteCandidatesList(D.remoteCandidatesList),F+=this.printEndOfCandidates(D.endOfCandidates),F+=this.printFingerprints(D.fingerprints),F+=this.printSetup(D.setup),F+=this.printMid(D.mid),F+=this.printExtmap(D.extmaps),F+=this.printRTPRelated(D),F+=this.printPtime(D.ptime),F+=this.printMaxPtime(D.maxPtime),F+=this.printDirection(D.direction),F+=this.printSSRCGroups(D.ssrcGroups),F+=this.printSSRC(D.ssrcs),F+=this.printRTCPMux(D.rtcpMux),F+=this.printRTCPMuxOnly(D.rtcpMuxOnly),F+=this.printRTCPRsize(D.rtcpRsize),F+=this.printMSId(D.msids),F+=this.printImageattr(D.imageattr),F+=this.printRid(D.rids),F+=this.printSimulcast(D.simulcast),F+=this.printSCTPPort(D.sctpPort),F+=this.printMaxMessageSize(D.maxMessageSize),F+=this.printUnrecognized(D.unrecognized),F}printCandidates(S){return S.map(D=>"a=candidate:".concat(D.foundation).concat(_).concat(D.componentId).concat(_).concat(D.transport).concat(_).concat(D.priority).concat(_).concat(D.connectionAddress).concat(_).concat(D.port).concat(_,"typ").concat(_).concat(D.type).concat(D.relAddr?"".concat(_,"raddr").concat(_).concat(D.relAddr):"").concat(D.relPort?"".concat(_,"rport").concat(_).concat(D.relPort):"").concat(Object.keys(D.extension).map(F=>"".concat(_).concat(F).concat(_).concat(D.extension[F])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(S){return S.map(D=>"a=remote-candidates:".concat(D.join(_)).concat(this.eol)).join("")}printEndOfCandidates(S){return S===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(S){if(!S.payloads)return"";const D=S.payloads;let F="";F+=S.rtcpFeedbackWildcards.map(ee=>this.printRTCPFeedback("*",ee)).join("");for(const ee of D)F+=this.printRtpMap(ee.payloadType,ee.rtpMap),F+=this.printFmtp(ee.payloadType,ee.fmtp),F+=ee.rtcpFeedbacks.map(Ue=>this.printRTCPFeedback(ee.payloadType,Ue)).join("");return F}printFmtp(S,D){if(!D)return"";const F=Object.keys(D.parameters);return F.length===1&&D.parameters[F[0]]===null?"a=fmtp:".concat(S).concat(_).concat(F[0]).concat(this.eol):"a=fmtp:".concat(S).concat(_).concat(Object.keys(D.parameters).map(ee=>"".concat(ee,"=").concat(D.parameters[ee])).join(";")).concat(this.eol)}printRtpMap(S,D){return D?"a=rtpmap:".concat(S).concat(_).concat(D.encodingName,"/").concat(D.clockRate).concat(D.encodingParameters?"/".concat(D.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(S,D){let F="a=rtcp-fb:".concat(S).concat(_),ee=D;switch(ee.type){case"trr-int":F+="ttr-int".concat(_).concat(ee.interval);break;case"ack":case"nack":default:ee=ee,F+="".concat(ee.type),ee.parameter&&(F+="".concat(_).concat(ee.parameter),ee.additional&&(F+="".concat(_).concat(ee.additional)))}return F+this.eol}printPtime(S){return S===void 0?"":"a=ptime:".concat(S).concat(this.eol)}printMaxPtime(S){return S===void 0?"":"a=maxptime:".concat(S).concat(this.eol)}printDirection(S){return S===void 0?"":"a=".concat(S).concat(this.eol)}printSSRC(S){return S.map(D=>Object.keys(D.attributes).map(F=>"a=ssrc:".concat(D.ssrcId.toString(10)).concat(_).concat(F).concat(D.attributes[F]?":".concat(D.attributes[F]):"").concat(this.eol)).join("")).join("")}printRTCPMux(S){return S===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(S){return S===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(S){return S===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(S){if(S===void 0)return"";let D="a=rtcp:".concat(S.port);return S.netType&&(D+="".concat(_).concat(S.netType)),S.addressType&&(D+="".concat(_).concat(S.addressType)),S.address&&(D+="".concat(_).concat(S.address)),D+this.eol}printMSId(S){return S.map(D=>"a=msid:".concat(D.id).concat(D.appdata?"".concat(_).concat(D.appdata):"").concat(this.eol)).join("")}printImageattr(S){return S.map(D=>"a=imageattr:".concat(D).concat(this.eol)).join("")}printRid(S){return S.map(D=>{let F="a=rid:".concat(D.id).concat(_).concat(D.direction);return D.payloads&&(F+="".concat(_,"pt=").concat(D.payloads.join(","))),D.params.length>0&&(F+="".concat(_).concat(D.params.map(ee=>ee.type==="depend"?"depend=".concat(ee.rids.join(",")):"".concat(ee.type,"=").concat(ee.val)).join(";"))),F+this.eol}).join("")}printSimulcast(S){return S===void 0?"":"a=simulcast:".concat(S).concat(this.eol)}printSCTPPort(S){return S===void 0?"":"a=sctp-port:".concat(S).concat(this.eol)}printMaxMessageSize(S){return S===void 0?"":"a=max-message-size:".concat(S).concat(this.eol)}printMid(S){return S===void 0?"":"a=mid:".concat(S).concat(this.eol)}printSSRCGroups(S){return S.map(D=>"a=ssrc-group:".concat(D.semantic).concat(D.ssrcIds.map(F=>"".concat(_).concat(F.toString(10))).join("")).concat(this.eol)).join("")}}function xe(ce){return new At().parse(ce)}function nt(ce,S){return new Tr().print(ce,S)}}},i={};function s(u){if(i[u])return i[u].exports;var d=i[u]={exports:{}};return n[u](d,d.exports,s),d.exports}return s.d=(u,d)=>{for(var h in d)s.o(d,h)&&!s.o(u,h)&&Object.defineProperty(u,h,{enumerable:!0,get:d[h]})},s.o=(u,d)=>Object.prototype.hasOwnProperty.call(u,d),s.r=u=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},s(8)})()})(tn);class n6{constructor(t){g(this,"sessionDesc",void 0),g(this,"localCapabilities",void 0),g(this,"rtpCapabilities",void 0),g(this,"candidates",void 0),g(this,"iceParameters",void 0),g(this,"dtlsParameters",void 0),g(this,"setup",void 0),g(this,"currentMidIndex",void 0),g(this,"cname",void 0),t=Zt(t);const{remoteIceParameters:n,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:u,remoteSetup:d,localCapabilities:h,sdkCodec:p,cname:m}=t,_=tn.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=s,this.iceParameters=n,this.dtlsParameters=i,this.setup=d,this.localCapabilities=h,this.cname=m;for(let E=0;E<_.mediaDescriptions.length;E++){const y=_.mediaDescriptions[E];y.attributes.iceUfrag=n.iceUfrag,y.attributes.icePwd=n.icePwd,y.attributes.fingerprints=i.fingerprints,y.attributes.candidates=s,y.attributes.setup=d,y.media.mediaType==="video"&&(y.media.fmts=u.videoCodecs.map(A=>A.payloadType.toString(10)),y.attributes.payloads=u.videoCodecs,y.attributes.extmaps=u.videoExtensions),y.media.mediaType==="audio"&&(y.media.fmts=u.audioCodecs.map(A=>A.payloadType.toString(10)),y.attributes.payloads=u.audioCodecs,y.attributes.extmaps=u.audioExtensions),_.mediaDescriptions[E]=this.mungMediaDesc(y)}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return tn.exports.print(this.sessionDesc)}send(t,n,i){const{ssrcs:s,ssrcGroups:u}=di(n,this.cname),d=this.sessionDesc.mediaDescriptions.find(m=>t===je.VIDEO?m.media.mediaType==="video":m.media.mediaType==="audio"),h=s[0].attributes.label,p=s[0].attributes.mslabel;return d.attributes.ssrcs=d.attributes.ssrcs.concat(s),d.attributes.ssrcGroups=d.attributes.ssrcGroups.concat(u),{id:h,mslabel:p}}batchSend(t){return t.map(n=>{let{kind:i,ssrcMsg:s}=n;return this.send(i,s,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],s=[],u=[];n.attributes.ssrcs.forEach(d=>{t.includes(d.attributes.label||"")?u.push(d):i.push(d)}),n.attributes.ssrcGroups.forEach(d=>{u.map(h=>h.ssrcId).includes(d.ssrcIds[0])||s.push(d)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=s})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,i){t.forEach((s,u)=>{const d=s._mediaStreamTrack,h=this.sessionDesc.mediaDescriptions.findIndex(m=>m.attributes.mid===d.kind),p=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[h],s);this.sessionDesc.mediaDescriptions[h]=p})}stopReceiving(t){}updateCandidates(t){t===On.TCP?this.candidates.forEach(n=>{this.candidates.findIndex(i=>i.transport==="tcp"&&i.connectionAddress===n.connectionAddress&&i.port===n.port)===-1&&this.candidates.push(KO(KO({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}):this.candidates=this.candidates.filter(n=>n.transport!=="tcp");for(const n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(t){t=Zt(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(t,n){const i=Zt(t);return Mc(i,n),qE(i,n),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===t);if(i!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=s}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,i){const s=this.sessionDesc.mediaDescriptions.find(d=>t===je.VIDEO?d.attributes.mid==="video":d.attributes.mid==="audio");if(s){const d=s.attributes.ssrcs.find(h=>h.attributes.label===n);var u;d&&(d.attributes.label=i,(u=d.attributes.msid)===null||u===void 0||u.replace(n,i))}}mungMediaDesc(t){const n=Zt(t);return YE(n),function(i){const s=i.attributes.extmaps.find(u=>u.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");s&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(s),1),i.attributes.payloads.forEach(u=>{const d=u.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");d!==-1&&u.rtcpFeedbacks.splice(d,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===t)return[i]}}function Oi(e){if(Array.isArray(e))return e.map(n=>n);if(!zO(e))return e;const t={};for(const n in e)zO(e[n])||Array.isArray(e[n])?t[n]=Oi(e[n]):t[n]=e[n];return t}function zO(e){return!(typeof e!="object"||Array.isArray(e)||!e)}function r6(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}function i6(e){return window.RTCStatsReport?e.getStats()instanceof Ee:!1}class XE{constructor(t){g(this,"input",[]),g(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const Is={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},vd={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Is,remoteCandidate:Is}},YO={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},qO={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,qpSumPerFrame:0},JO={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},XO={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function QO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function $O(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?QO(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QO(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class QE{constructor(t,n){g(this,"onFirstVideoReceived",void 0),g(this,"onFirstVideoDecoded",void 0),g(this,"onFirstAudioReceived",void 0),g(this,"onFirstVideoDecodedTimeout",void 0),g(this,"onFirstAudioDecoded",void 0),g(this,"onSelectedLocalCandidateChanged",void 0),g(this,"onSelectedRemoteCandidateChanged",void 0),g(this,"videoIsReady",!1),g(this,"videoIsReady2",{}),g(this,"pc",void 0),g(this,"options",void 0),g(this,"intervalTimer",void 0),g(this,"stats",Oi(vd)),g(this,"isFirstVideoReceived",{}),g(this,"isFirstVideoDecoded",{}),g(this,"isFirstAudioReceived",{}),g(this,"isFirstAudioDecoded",{}),g(this,"isFirstVideoDecodedTimeout",{}),g(this,"lossRateWindowStats",[]),this.pc=t,this.options=n,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Ee(t=>{t({local:$O({},Is),remote:$O({},Is)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,n){this.videoIsReady2[t]=n}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let s=0,u=0,d=0,h=0;for(const p of i)t[p].forEach((m,_)=>{if(!this.lossRateWindowStats[n-1][p][_]||!this.lossRateWindowStats[0][p][_])return;const E=this.lossRateWindowStats[n-1][p][_].packets-this.lossRateWindowStats[0][p][_].packets,y=this.lossRateWindowStats[n-1][p][_].packetsLost-this.lossRateWindowStats[0][p][_].packetsLost;p==="videoSend"||p==="audioSend"?(s+=E,d+=y):(u+=E,h+=y),Number.isNaN(E)||Number.isNaN(E)?m.packetLostRate=0:m.packetLostRate=E<=0||y<=0?0:y/(E+y)});t.sendPacketLossRate=s<=0||d<=0?0:d/(s+d),t.recvPacketLossRate=u<=0||h<=0?0:h/(u+h)}}function ZO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function o6(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ZO(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZO(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class s6 extends QE{constructor(){super(...arguments),g(this,"_stats",vd),g(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),n=this.statsResponsesToObjects(t);this._stats=Oi(vd);const i=n.filter(u=>u.type==="ssrc");this.processSSRCStats(i);const s=n.find(u=>u.type==="VideoBwe");s&&this.processBandwidthStats(s),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(n=>{const i=n.id.includes("send");switch("".concat(n.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const s=Oi(qO);s.codec=n.googCodecName,s.adaptionChangeReason="none",n.googCpuLimitedResolution&&(s.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(s.adaptionChangeReason="bandwidth"),s.avgEncodeMs=Number(n.googAvgEncodeMs),s.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},s.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},s.firsCount=Number(n.googFirReceived),s.nacksCount=Number(n.googNacksReceived),s.plisCount=Number(n.googPlisReceived),s.frameCount=Number(n.framesEncoded),s.bytes=Number(n.bytesSent),s.packets=Number(n.packetsSent),s.packetsLost=Number(n.packetsLost),s.ssrc=Number(n.ssrc),s.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(s),this._stats.rtt=s.rttMs;break}case"video_recv":{const s=Oi(YO),u=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(s.codec=n.googCodecName,s.targetDelayMs=Number(n.googTargetDelayMs),s.renderDelayMs=Number(n.googRenderDelayMs),s.currentDelayMs=Number(n.googCurrentDelayMs),s.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),s.decodeMs=Number(n.googDecodeMs),s.maxDecodeMs=Number(n.googMaxDecodeMs),s.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},s.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},s.decodeFrameRate=Number(n.googFrameRateDecoded),s.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},s.jitterBufferMs=Number(n.googJitterBufferMs),s.firsCount=Number(n.googFirsSent),s.nacksCount=Number(n.googNacksSent),s.plisCount=Number(n.googPlisSent),s.framesDecodeCount=Number(n.framesDecoded),s.bytes=Number(n.bytesReceived),s.packets=Number(n.packetsReceived),s.packetsLost=Number(n.packetsLost),s.ssrc=Number(n.ssrc),s.packets>0&&!this.isFirstVideoReceived[s.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(s.ssrc),this.isFirstVideoReceived[s.ssrc]=!0),s.framesDecodeCount>0&&!this.isFirstVideoDecoded[s.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(s.ssrc,s.decodedFrame.width,s.decodedFrame.height),this.isFirstVideoDecoded[s.ssrc]=!0),u){const d=u.stats,h=Date.now()-u.lts;s.framesDecodeFreezeTime=d.framesDecodeFreezeTime,s.framesDecodeInterval=d.framesDecodeInterval,s.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[s.ssrc]?(u.lts=Date.now(),s.framesDecodeInterval=h,s.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?s.framesDecodeFreezeTime+=s.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):s.framesDecodeCount<u.stats.framesDecodeCount&&(s.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(s.ssrc,{stats:o6({},s),lts:Date.now()}),this._stats.videoRecv.push(s);break}case"audio_recv":{const s=Oi(XO);s.codec=n.googCodecName,s.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,s.decodingCNG=Number(n.googDecodingCNG),s.decodingCTN=Number(n.googDecodingCTN),s.decodingCTSG=Number(n.googDecodingCTSG),s.decodingNormal=Number(n.googDecodingNormal),s.decodingPLC=Number(n.googDecodingPLC),s.decodingPLCCNG=Number(n.googDecodingPLCCNG),s.expandRate=Number(n.googExpandRate),s.accelerateRate=Number(n.googAccelerateRate),s.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),s.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),s.speechExpandRate=Number(n.googSpeechExpandRate),s.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),s.jitterBufferMs=Number(n.googJitterBufferMs),s.jitterMs=Number(n.googJitterReceived),s.bytes=Number(n.bytesReceived),s.packets=Number(n.packetsReceived),s.packetsLost=Number(n.packetsLost),s.ssrc=Number(n.ssrc),s.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),s.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),s.receivedFrames>0&&!this.isFirstAudioReceived[s.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(s.ssrc),this.isFirstAudioReceived[s.ssrc]=!0),s.decodingNormal>0&&!this.isFirstAudioDecoded[s.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(s.ssrc),this.isFirstAudioDecoded[s.ssrc]=!0),this._stats.audioRecv.push(s);break}case"audio_send":{const s=Oi(JO);s.codec=n.googCodecName,s.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,s.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),s.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),s.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),s.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),s.bytes=Number(n.bytesSent),s.packets=Number(n.packetsSent),s.packetsLost=Number(n.packetsLost),s.ssrc=Number(n.ssrc),s.rttMs=Number(n.googRtt||0),this._stats.rtt=s.rttMs,this._stats.audioSend.push(s);break}}})}_getStats(){return new Ee((t,n)=>{this.pc.getStats(t,n)})}statsResponsesToObjects(t){const n=[];return t.result().forEach(i=>{const s={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(u=>{s[u]=i.stat(u)}),n.push(s)}),n}}function eb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Oa(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?eb(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eb(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class tb extends QE{constructor(){super(...arguments),g(this,"_stats",vd),g(this,"report",void 0),g(this,"lastDecodeVideoReceiverStats",new Map),g(this,"lastVideoFramesRecv",new Map),g(this,"lastVideoFramesSent",new Map),g(this,"lastVideoFramesDecode",new Map),g(this,"lastVideoJBDelay",new Map),g(this,"lastAudioJBDelay",new Map),g(this,"mediaBytesSent",new Map),g(this,"mediaBytesRetransmit",new Map),g(this,"mediaBytesTargetEncode",new Map),g(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Oi(vd),this.report.forEach(t=>{switch(t.type){case Vr.OUTBOUND:t.mediaType==="audio"?this.processAudioOutboundStats(t):t.mediaType==="video"&&this.processVideoOutboundStats(t);break;case Vr.INBOUND:t.mediaType==="audio"?this.processAudioInboundStats(t):t.mediaType==="video"&&this.processVideoInboundStats(t);break;case Vr.TRANSPORT:{const n=this.report.get(t.selectedCandidatePairId);n&&this.processCandidatePairStats(n);break}case Vr.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),n={local:Oa({},Is),remote:Oa({},Is)};return t.forEach(i=>{let s;if(i.type===Vr.TRANSPORT&&(s=t.get(i.selectedCandidatePairId)),i.type===Vr.CANDIDATE_PAIR&&i.selected&&(s=i),s){const u=(d,h)=>{d.type=h.type,d.id=h.id,h.address&&(d.address=h.address),h.candidateType&&(d.candidateType=h.candidateType),h.port&&(d.port=h.port),h.priority&&(d.priority=h.priority),h.protocol&&(d.protocol=h.protocol),h.relayProtocol&&(d.relayProtocol=h.relayProtocol)};if(s.localCandidateId){const d=t.get(s.localCandidateId);d&&u(n.local,d)}if(s.remoteCandidateId){const d=t.get(s.remoteCandidateId);d&&u(n.remote,d)}}}),n}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(n=>{t.currentRoundTripTime&&(n.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{t.currentRoundTripTime&&(n.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const n=this.report.get(t.localCandidateId);n&&this.processCandidateStats(n)}if(t.remoteCandidateId){const n=this.report.get(t.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(t){let n;t.type===Vr.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),t.type===Vr.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=t.type,n.id=t.id,t.address&&(n.address=t.address),t.candidateType&&(n.candidateType=t.candidateType),t.port&&(n.port=t.port),t.priority&&(n.priority=t.priority),t.protocol&&(n.protocol=t.protocol),t.relayProtocol&&(n.relayProtocol=t.relayProtocol),t.type===Vr.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Oa({},n),Oa({},this.stats.selectedCandidatePair.localCandidate)),t.type===Vr.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Oa({},n),Oa({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let n=this._stats.audioRecv.find(i=>i.ssrc===t.ssrc);n||(n=Oi(XO),this._stats.audioRecv.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsReceived,n.packetsLost=t.packetsLost,n.bytes=t.bytesReceived,n.jitterMs=1e3*t.jitter,this.processAudioTrackReceiverStats(t,t.trackId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),n.receivedFrames||(n.receivedFrames=t.packetsReceived),n.droppedFrames||(n.droppedFrames=t.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),typeof t.concealedSamples=="number"&&(n.concealedSamples=t.concealedSamples)}processVideoInboundStats(t){let n=this._stats.videoRecv.find(d=>d.ssrc===t.ssrc);n||(n=Oi(YO),this._stats.videoRecv.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsReceived,n.packetsLost=t.packetsLost,n.bytes=t.bytesReceived,n.firsCount=t.firCount,n.nacksCount=t.nackCount,n.plisCount=t.pliCount,n.framesDecodeCount=t.framesDecoded,n.totalInterFrameDelay=t.totalInterFrameDelay,n.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay;const i=this.lastDecodeVideoReceiverStats.get(n.ssrc),s=this.lastVideoFramesDecode.get(n.ssrc),u=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]){const d=n.decodedFrame?n.decodedFrame.width:0,h=n.decodedFrame?n.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,d,h),this.isFirstVideoDecoded[n.ssrc]=!0}if(i){const d=i.stats,h=u-i.lts;n.framesDecodeFreezeTime=d.framesDecodeFreezeTime,n.framesDecodeInterval=d.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&h>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(i.lts=Date.now(),n.framesDecodeInterval=h,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):n.framesDecodeCount<d.framesDecodeCount&&(n.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(i.stats.framesDecodeCount>t.framesDecoded?n.qpSumPerFrame=t.qpSum/t.framesDecoded:n.qpSumPerFrame=(t.qpSum-i.qpSum)/(t.framesDecoded-i.stats.framesDecodeCount))}s&&u-s.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-s.count)/((u-s.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:u,rate:n.decodeFrameRate})):s?n.decodeFrameRate=s.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:u,rate:0}),t.totalDecodeTime&&(n.decodeMs=1e3*t.totalDecodeTime),this.processVideoTrackReceiverStats(t,t.trackId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(n.framesRateFirefox=t.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:Oa({},n),lts:i?i.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let n=this._stats.videoSend.find(s=>s.ssrc===t.ssrc);n||(n=Oi(qO),this._stats.videoSend.push(n));const i=this.mediaBytesSent.get(t.ssrc);if(i)i.add(t.bytesSent);else{const s=new XE(10);s.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,s)}if(t.retransmittedBytesSent!==void 0){const s=this.mediaBytesRetransmit.get(t.ssrc);if(s)s.add(t.retransmittedBytesSent);else{const u=new XE(10);u.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,u)}}if(t.totalEncodedBytesTarget){const s=this.mediaBytesTargetEncode.get(t.ssrc);if(s)s.add(t.totalEncodedBytesTarget);else{const u=new XE(10);u.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,u)}}if(n.ssrc=t.ssrc,n.bytes=t.bytesSent,n.packets=t.packetsSent,n.firsCount=t.firCount,n.nacksCount=t.nackCount,n.plisCount=t.pliCount,n.frameCount=t.framesEncoded,n.adaptionChangeReason=t.qualityLimitationReason,n.scalabilityMode=t.scalabilityMode,t.totalEncodeTime&&t.framesEncoded){const s=this.lastEncoderMs.get(t.ssrc);if(!s||s.lastFrameCount>t.framesEncoded)n.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const u=t.framesEncoded-s.lastFrameCount,d=t.totalEncodeTime-s.lastEncoderTime;n.avgEncodeMs=1e3*d/u}}if(t.framesEncoded&&t.qpSum){const s=this.lastEncoderMs.get(t.ssrc);!s||s.lastFrameCount>t.framesEncoded?n.qpSumPerFrame=t.qpSum/t.framesEncoded:n.qpSumPerFrame=(t.qpSum-s.lastQpSum)/(t.framesEncoded-s.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,n),this.processVideoTrackSenderStats(t,t.trackId,n),t.remoteId)this.processRemoteInboundStats(t.remoteId,n);else{const s=this.findRemoteStatsId(t.ssrc,Vr.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,n)}}processAudioOutboundStats(t){let n=this._stats.audioSend.find(i=>i.ssrc===t.ssrc);if(n||(n=Oi(JO),this._stats.audioSend.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsSent,n.bytes=t.bytesSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,n),t.remoteId)this.processRemoteInboundStats(t.remoteId,n);else{const i=this.findRemoteStatsId(t.ssrc,Vr.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,n)}}findRemoteStatsId(t,n){var i;const s=Array.from(_o(i=this.report).call(i)).find(u=>u.type===n&&u.ssrc===t);return s?s.id:null}processVideoMediaSource(t,n){const i=this.report.get(t);i&&i.width&&i.height&&i.framesPerSecond&&(n.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(t,n){const i=this.report.get(t);i&&(n.inputLevel=i.audioLevel)}processVideoTrackSenderStats(t,n,i){var s,u,d;const h=n?this.report.get(n):void 0,p=(s=h==null?void 0:h.framesSent)!==null&&s!==void 0?s:t.framesSent;let m=(u=h==null?void 0:h.frameWidth)!==null&&u!==void 0?u:t.frameWidth,_=(d=h==null?void 0:h.frameHeight)!==null&&d!==void 0?d:t.frameHeight;if(typeof p!="number")return;typeof m=="number"&&typeof _=="number"||(m=0,_=0);let E=0;const y=Date.now(),A=this.lastVideoFramesSent.get(i.ssrc);A&&y-A.lts>=800?(E=Math.round((p-A.count)/((y-A.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:p,lts:y,rate:E})):A?E=A.rate:this.lastVideoFramesSent.set(i.ssrc,{count:p,lts:y,rate:0}),i.sentFrame={width:m,height:_,frameRate:Math.max(0,E)}}processVideoTrackReceiverStats(t,n,i){var s,u,d,h,p;const m=n?this.report.get(n):void 0,_=(s=m==null?void 0:m.framesReceived)!==null&&s!==void 0?s:t.framesReceived,E=(u=m==null?void 0:m.frameWidth)!==null&&u!==void 0?u:t.frameWidth,y=(d=m==null?void 0:m.frameHeight)!==null&&d!==void 0?d:t.frameHeight,A=(h=m==null?void 0:m.jitterBufferDelay)!==null&&h!==void 0?h:t.jitterBufferDelay,k=(p=m==null?void 0:m.jitterBufferEmittedCount)!==null&&p!==void 0?p:t.jitterBufferEmittedCount;if(typeof _=="number"){const L=this.lastVideoFramesRecv.get(i.ssrc),x=Date.now();i.framesReceivedCount=_;let z=0;L&&x-L.lts>=800?(z=Math.round((_-L.count)/((x-L.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:_,lts:x,rate:z})):L?z=L.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:_,lts:x,rate:0}),i.receivedFrame={width:E||0,height:y||0,frameRate:z||0},i.decodedFrame={width:E||0,height:y||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:E||0,height:y||0,frameRate:i.decodeFrameRate||0}}if(A&&k){let L=this.lastVideoJBDelay.get(i.ssrc);this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:A,jitterBufferEmittedCount:k}),L||(L={jitterBufferDelay:0,jitterBufferEmittedCount:0});const x=1e3*(A-L.jitterBufferDelay)/(k-L.jitterBufferEmittedCount);i.jitterBufferMs=x,i.currentDelayMs=Math.round(x)}}processAudioTrackSenderStats(t,n,i){var s,u,d,h;const p=n?this.report.get(n):void 0,m=(s=(u=p==null?void 0:p.echoReturnLoss)!==null&&u!==void 0?u:t.echoReturnLoss)!==null&&s!==void 0?s:0,_=(d=(h=p==null?void 0:p.echoReturnLossEnhancement)!==null&&h!==void 0?h:t.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;i.aecReturnLoss=m,i.aecReturnLossEnhancement=_}processAudioTrackReceiverStats(t,n,i){var s,u,d,h,p,m,_;const E=n?this.report.get(n):void 0,y=(s=E==null?void 0:E.removedSamplesForAcceleration)!==null&&s!==void 0?s:t.removedSamplesForAcceleration,A=(u=E==null?void 0:E.totalSamplesReceived)!==null&&u!==void 0?u:t.totalSamplesReceived,k=(d=E==null?void 0:E.jitterBufferDelay)!==null&&d!==void 0?d:t.jitterBufferDelay,L=(h=E==null?void 0:E.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount,x=(p=E==null?void 0:E.audioLevel)!==null&&p!==void 0?p:t==null?void 0:t.audioLevel,z=(m=E==null?void 0:E.totalSamplesDuration)!==null&&m!==void 0?m:t==null?void 0:t.totalSamplesDuration,X=(_=E==null?void 0:E.concealedSamples)!==null&&_!==void 0?_:t.concealedSamples;if(y&&A&&(i.accelerateRate=y/A),k&&L){let Ie=this.lastAudioJBDelay.get(i.ssrc);this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:k,jitterBufferEmittedCount:L}),Ie||(Ie={jitterBufferDelay:0,jitterBufferEmittedCount:0});const se=1e3*(k-Ie.jitterBufferDelay)/(L-Ie.jitterBufferEmittedCount);i.jitterBufferMs=Math.round(se)}i.outputLevel=x;let ie=1920;z&&A&&(ie=A/z/50,i.receivedFrames=Math.round(A/ie)),X&&(i.droppedFrames=Math.round(X/ie))}processRemoteInboundStats(t,n){const i=this.report.get(t);i&&(n.packetsLost=i.packetsLost,i.roundTripTime&&(n.rttMs=1e3*i.roundTripTime))}getCodecFromCodecStats(t){const n=this.report.get(t);if(!n)return"";const i=n.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let t=0,n=null,i=null;this.mediaBytesSent.forEach(u=>{t+=u.diffMean()}),this.mediaBytesRetransmit.forEach(u=>{n=n===null?u.diffMean():n+u.diffMean()}),this.mediaBytesTargetEncode.forEach(u=>{i=i===null?u.diffMean():i+u.diffMean()});const s=n!==null?t-n:t;this._stats.bitrate={actualEncoded:8*s/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},n!==null&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}}class a6 extends QE{updateStats(){return Ee.resolve()}}function $E(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=r6();return u?u<76?new s6(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:s}):new tb(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:s}):i6(e)?new tb(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:s}):new a6(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:s})}var _t;function nb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function rb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nb(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nb(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let gd=(ne((_t=class xd extends jh{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(t,n){super(t,n),g(this,"store",void 0),g(this,"peerConnection",void 0),g(this,"remoteSDP",void 0),g(this,"initialOffer",void 0),g(this,"statsFilter",void 0),g(this,"useRTX",!1),g(this,"localCapabilities",void 0),g(this,"localCandidateCount",0),g(this,"allCandidatesReceived",!1),g(this,"establishPromise",void 0),g(this,"mutex",new nr("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(xd.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=$E(this.peerConnection,void 0,void 0,Bt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=wa(t.sdp),i=zE(t.sdp,!this.useRTX,H("FILTER_VIDEO_FEC"),H("FILTER_AUDIO_FEC"),["opus"]);return this.localCapabilities=i,this.initialOffer=t,rb(rb({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:t.sdp})}catch(t){throw new V(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,n,i,s,u,d){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new n6({remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:s.send,remoteSetup:u,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:d});const h=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(h){throw new V(P.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(h.toString()))}}send(t,n){var i=this;return wi(function*(){const s=yield Je(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=t.map(y=>i.peerConnection.addTrack(y._mediaStreamTrack)),d=yield Je(i.peerConnection.createOffer()),h=tn.exports.parse(d.sdp),p=t.map(y=>{const A=y._mediaStreamTrack,k=h.mediaDescriptions.find(L=>L.attributes.mid===A.kind);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return function(L,x,z){const X=L.attributes.ssrcs.filter(Ie=>Ie.attributes.label===x),ie=L.attributes.ssrcGroups;if(X.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ie&&X.length>1){const Ie=ie.find(se=>se.ssrcIds.indexOf(X[0].ssrcId)!==-1);return Ie?[{ssrcId:Ie.ssrcIds[0],rtx:z?Ie.ssrcIds[1]:void 0}]:[{ssrcId:X[0].ssrcId}]}return[{ssrcId:X[0].ssrcId}]}(k,A.id,i.useRTX)});let m;try{m=yield p}catch(y){throw u.forEach(A=>{$n()&&A.replaceTrack(null),i.peerConnection.removeTrack(A)}),y}const _=i.mungSendOfferSDP(d.sdp,t);i.remoteSDP.receive(t,n,m);const E=i.remoteSDP.toString();return yield Je(i.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Je(i.applySendEncodings(u,t)),yield Je(i.peerConnection.setRemoteDescription({type:"answer",sdp:E})),t.map((y,A)=>{const k=y._mediaStreamTrack.id;return{localSSRC:p[A],id:k}})}catch(u){throw new V(P.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{s()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(u=>{var d;return t.indexOf(((d=u.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(u=>{$n()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new V(P.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:u,mslabel:d}=this.remoteSDP.send(t,n,s),h=new Ee((_,E)=>{const y=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(u)))},1e4),A=k=>{const L=at();if((L.name==="Safari"&&Number(L.version)===11||Zn())&&k.track.id!==u&&k.streams[0].id===d){var x;const z=k.streams[0].getTracks()[0];return(x=this.remoteSDP)===null||x===void 0||x.updateTrackLabel(t,u,k.track.id),this.peerConnection.removeEventListener("track",A),clearTimeout(y),void _(z)}if(k.track.id===u)return this.peerConnection.removeEventListener("track",A),clearTimeout(y),void _(k.track)};this.peerConnection.addEventListener("track",A)}),p=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:p});const m=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(m),{track:await h,id:u}}catch(u){throw new V(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new V(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var s;return t.indexOf(((s=i.track)===null||s===void 0?void 0:s.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if($n()&&i.track)i.track.enabled=!1;else{const s=i.getParameters();s.encodings.forEach(u=>u.active=!1),i.setParameters(s)}})}catch(n){throw new V(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(u=>{var d;return t.indexOf(((d=u.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async u=>{if($n()&&u.track)u.track.enabled=!0;else{const d=u.getParameters();d.encodings.forEach(h=>h.active=!0),await u.setParameters(d)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new V(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return wi(function*(){const i=yield Je(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Jt().supportPCSetConfiguration){const p=n.peerConnection.getConfiguration(),m=t===On.RELAY?"relay":"all";p.iceTransportPolicy!==m&&(I.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(p.iceTransportPolicy,"] to [").concat(m,"]")),p.iceTransportPolicy=m,n.peerConnection.setConfiguration(p))}else if(t===On.RELAY)return;t!==On.RELAY&&n.remoteSDP.updateCandidates(t);const s=yield Je(n.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const u=wa(s.sdp),{remoteIceParameters:d}=yield u.iceParameters;n.remoteSDP.restartICE(d);const h=n.remoteSDP.toString();yield Je(n.peerConnection.setLocalDescription(s)),yield Je(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(s){I.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),s)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new V(P.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getSenders().filter(s=>{var u;return((u=s.track)===null||u===void 0?void 0:u.id)===t});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getSenders().find(s=>{var u;return((u=s.track)===null||u===void 0?void 0:u.id)===n});i&&await i.replaceTrack(t._mediaStreamTrack)}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},H("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(nd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...xd.turnServerConfigToIceServers(t.turnServer.servers)),H("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...xd.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async applySendEncodings(t,n){try{if(!Jt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let s=0;s<t.length;s++){var i;const u=t[s],d=n[s];if(!d)continue;const h={},p={};if(d instanceof en)switch(d._optimizationMode){case"motion":h.degradationPreference="maintain-framerate";break;case"detail":h.degradationPreference="maintain-resolution";break;default:h.degradationPreference="balanced"}if(H("DSCP_TYPE")&&pa()){const E=H("DSCP_TYPE");["very-low","low","medium","high"].includes(E)&&(p.networkPriority=E)}const m=u.getParameters(),_=(i=m.encodings)===null||i===void 0?void 0:i[0];_&&Object.assign(_,p),Object.assign(m,h),await u.setParameters(m)}}catch{I.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const i=tn.exports.parse(t);return n.forEach((s,u)=>{const d=s._mediaStreamTrack,h=i.mediaDescriptions.find(p=>p.attributes.mid===d.kind);h&&Mc(h,s)}),tn.exports.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((u,d)=>{let{id:h,mslabel:p}=u;const{kind:m}=t[d];return new Ee((_,E)=>{const y=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(h)))},1e4),A=k=>{const L=at();if(L.name==="Safari"&&Number(L.version)===11&&k.track.id!==h&&k.streams[0].id===p){var x;const z=k.streams[0].getTracks()[0];return(x=this.remoteSDP)===null||x===void 0||x.updateTrackLabel(m,h,k.track.id),this.peerConnection.removeEventListener("track",A),clearTimeout(y),void _({track:z,id:h})}if(k.track.id===h)return this.peerConnection.removeEventListener("track",A),clearTimeout(y),void _({track:k.track,id:h})};this.peerConnection.addEventListener("track",A)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),await Ee.all(n)}catch(n){throw new V(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Jt().supportPCSetConfiguration){const n=xd.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[li],Object.getOwnPropertyDescriptor(_t.prototype,"connect"),_t.prototype),ne(_t.prototype,"stopSending",[li],Object.getOwnPropertyDescriptor(_t.prototype,"stopSending"),_t.prototype),ne(_t.prototype,"receive",[li],Object.getOwnPropertyDescriptor(_t.prototype,"receive"),_t.prototype),ne(_t.prototype,"stopReceiving",[li],Object.getOwnPropertyDescriptor(_t.prototype,"stopReceiving"),_t.prototype),ne(_t.prototype,"muteRemote",[li],Object.getOwnPropertyDescriptor(_t.prototype,"muteRemote"),_t.prototype),ne(_t.prototype,"unmuteRemote",[li],Object.getOwnPropertyDescriptor(_t.prototype,"unmuteRemote"),_t.prototype),ne(_t.prototype,"muteLocal",[li],Object.getOwnPropertyDescriptor(_t.prototype,"muteLocal"),_t.prototype),ne(_t.prototype,"unmuteLocal",[li],Object.getOwnPropertyDescriptor(_t.prototype,"unmuteLocal"),_t.prototype),ne(_t.prototype,"close",[li],Object.getOwnPropertyDescriptor(_t.prototype,"close"),_t.prototype),ne(_t.prototype,"updateEncoderConfig",[li],Object.getOwnPropertyDescriptor(_t.prototype,"updateEncoderConfig"),_t.prototype),ne(_t.prototype,"updateSendParameters",[li],Object.getOwnPropertyDescriptor(_t.prototype,"updateSendParameters"),_t.prototype),ne(_t.prototype,"replaceTrack",[li],Object.getOwnPropertyDescriptor(_t.prototype,"replaceTrack"),_t.prototype),ne(_t.prototype,"getRemoteSSRC",[li],Object.getOwnPropertyDescriptor(_t.prototype,"getRemoteSSRC"),_t.prototype),_t);function li(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,u=await s.lock("Locking from P2PConnection.".concat(t));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await i.apply(this,h)}finally{u()}},n}function ib(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function ob(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ib(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ib(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const dp="9",sb=4e4;class c6{get localCapabilities(){return Zt(this._localCapabilities)}get rtpCapabilities(){return Zt(this._rtpCapabilities)}get candidates(){return Zt(this._candidates)}get iceParameters(){return Zt(this._iceParameters)}get dtlsParameters(){return Zt(this._dtlsParameters)}constructor(t){g(this,"sessionDesc",void 0),g(this,"_localCapabilities",void 0),g(this,"_rtpCapabilities",void 0),g(this,"_candidates",void 0),g(this,"_iceParameters",void 0),g(this,"_dtlsParameters",void 0),g(this,"setup",void 0),g(this,"currentMidIndex",void 0),g(this,"cname",void 0),g(this,"firefoxSsrcMidMap",new Map),t=Zt(t);const{remoteIceParameters:n,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:u,remoteSetup:d,localCapabilities:h,cname:p}=t,m=tn.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=u,this._candidates=s,this._iceParameters=n,this._dtlsParameters=i,this._localCapabilities=h,this.setup=d,this.cname=p;const _=this.rtpCapabilities.send;for(const E of m.mediaDescriptions){if(E.attributes.iceUfrag=n.iceUfrag,E.attributes.icePwd=n.icePwd,E.attributes.fingerprints=i.fingerprints,E.attributes.candidates=s,E.attributes.setup=d,E.media.mediaType==="video"&&(E.media.fmts=_.videoCodecs.map(y=>y.payloadType.toString(10)),E.attributes.payloads=_.videoCodecs,E.attributes.extmaps=_.videoExtensions,H("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:y,ssrcGroups:A}=di([{ssrcId:sb,rtx:H("USE_SUB_RTX")?40001:void 0}],this.cname);E.attributes.ssrcs=y,E.attributes.ssrcGroups=A}if(E.media.mediaType==="audio"&&(E.media.fmts=_.audioCodecs.map(y=>y.payloadType.toString(10)),E.attributes.payloads=_.audioCodecs,E.attributes.extmaps=_.audioExtensions,Cs(E),H("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:y,ssrcGroups:A}=di([{ssrcId:2e4}],this.cname);E.attributes.ssrcs=y,E.attributes.ssrcGroups=A}}this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}preloadRemoteMedia(){const t=H("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const n=this.candidates,i=this.dtlsParameters,s=this.iceParameters,u=this.rtpCapabilities.send;for(let d=1;d<t;d++){const h=2*d+2e4,p=2*d+sb,{ssrcs:m,ssrcGroups:_}=di([{ssrcId:h}],this.cname),{ssrcs:E,ssrcGroups:y}=di([{ssrcId:p,rtx:H("USE_SUB_RTX")?p+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:dp,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.videoCodecs.map(A=>A.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:s.iceUfrag,icePwd:s.icePwd,unrecognized:[],candidates:n,extmaps:u.videoExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:y,rtcpFeedbackWildcards:[],payloads:u.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*d)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:dp,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.audioCodecs.map(A=>A.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:s.iceUfrag,icePwd:s.icePwd,unrecognized:[],candidates:n,extmaps:u.audioExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:m,ssrcGroups:_,rtcpFeedbackWildcards:[],payloads:u.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*d+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return tn.exports.print(this.sessionDesc)}send(t,n,i,s){const{ssrcs:u,ssrcGroups:d}=di(n,this.cname,H("SYNC_GROUP")?i:void 0),h=this.findPreloadMediaDesc(u);if(h){if(Bt()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,h.attributes.mid),s&&(s.twcc||s.remb)){const p=this.sessionDesc.mediaDescriptions.indexOf(h);return this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(h,s),{mid:h.attributes.mid,needExchangeSDP:!0}}return{mid:h.attributes.mid,needExchangeSDP:!1}}{const p=this.findAvailableMediaIndex(t,u);let m;return p===-1||p===1&&($n()||tC())||p===0&&H("USE_SUB_RTX")||nC()?(m=this.createOrRecycleSendMedia(t,u,d,"sendonly",s),this.updateBundleMids()):(m=Zt(this.sessionDesc.mediaDescriptions[p]),m.attributes.direction="sendonly",m.attributes.ssrcs=u,m.attributes.ssrcGroups=d,this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(m,s)),Bt()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),{mid:m.attributes.mid,needExchangeSDP:!0}}}batchSend(t){const n=t.map(u=>{let{kind:d,ssrcMsg:h,mslabel:p}=u;return this.send(d,h,p)}),i=[];let s=!1;return n.forEach(u=>{let{mid:d,needExchangeSDP:h}=u;h&&(s=!0),i.push(d)}),{mids:i,needExchangeSDP:s}}stopSending(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(i=>{i.attributes.mid==="0"||Bt()||nC()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.includes(i.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.includes(i.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="recvonly"})}receive(t,n,i,s){t.forEach((u,d)=>{this.createOrRecycleRecvMedia(u,[],"recvonly",n,i,s[d])}),this.updateBundleMids()}stopReceiving(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(t){t===On.TCP?this._candidates.forEach(n=>{this._candidates.findIndex(i=>i.transport==="tcp"&&i.connectionAddress===n.connectionAddress&&i.port===n.port)===-1&&this._candidates.push(ob(ob({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}):this._candidates=this._candidates.filter(n=>n.transport!=="tcp");for(const n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(t){t=Zt(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}findAvailableMediaIndex(t,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const s=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(Bt()){if(s){const u=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(u||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!u||u!==i.attributes.mid)}return!1}return s})}createOrRecycleRecvMedia(t,n,i,s,u,d){const h=t._mediaStreamTrack.kind,p=this.rtpCapabilities.recv,m=this.localCapabilities.send;let _=[];if(h===je.VIDEO){var E,y;if(H("H264_PROFILE_LEVEL_ID")&&s==="h264"&&(_=p.videoCodecs.filter(z=>{var X,ie;return(((X=z.rtpMap)===null||X===void 0?void 0:X.encodingName.toLowerCase())||"").includes(s)&&(z==null||(ie=z.fmtp)===null||ie===void 0?void 0:ie.parameters["profile-level-id"])===H("H264_PROFILE_LEVEL_ID")})),!_||((E=_)===null||E===void 0?void 0:E.length)===0){const z=m.videoCodecs.filter(X=>{var ie;return(((ie=X.rtpMap)===null||ie===void 0?void 0:ie.encodingName.toLowerCase())||"").includes(s)});z.length!==0&&(_=p.videoCodecs.filter(X=>z.some(ie=>ie.payloadType===X.payloadType)))}if(H("USE_PUB_RTX")){const z=_.map(ie=>ie.payloadType.toString()),X=p.videoCodecs.filter(ie=>{var Ie,se;return((Ie=ie.rtpMap)===null||Ie===void 0?void 0:Ie.encodingName)==="rtx"&&z.includes(((se=ie.fmtp)===null||se===void 0?void 0:se.parameters.apt)||"")});_=[..._,...X]}_.length===0&&(I.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat((y=p.videoCodecs[0].rtpMap)===null||y===void 0?void 0:y.encodingName)),_=p.videoCodecs)}else _=p.audioCodecs.filter(z=>{var X;return(((X=z.rtpMap)===null||X===void 0?void 0:X.encodingName.toLowerCase())||"").includes(u)}),_.length===0&&(I.warning("codec ".concat(u," not included in rtpCapabilities, fallback to opus")),_=p.audioCodecs.filter(z=>{var X;return(((X=z.rtpMap)===null||X===void 0?void 0:X.encodingName.toLowerCase())||"").includes("opus")}));const A=h===je.VIDEO?p.videoExtensions:p.audioExtensions;this.currentMidIndex+=1;const k="".concat(this.currentMidIndex);let L={media:{mediaType:h,port:dp,protos:["UDP","TLS","RTP","SAVPF"],fmts:_.map(z=>z.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:_,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(k)}};L=this.mungRecvMediaDsec(L,t,d);const x=this.findFirstClosedMedia(h);if(x){const z=this.sessionDesc.mediaDescriptions.indexOf(x);this.sessionDesc.mediaDescriptions[z]=L}else this.sessionDesc.mediaDescriptions.push(L);return L}createOrRecycleSendMedia(t,n,i,s,u){const d=this.rtpCapabilities.send,h=t===je.VIDEO?d.videoCodecs:d.audioCodecs,p=t===je.VIDEO?d.videoExtensions:d.audioExtensions;this.currentMidIndex+=1;const m="".concat(this.currentMidIndex);let _={media:{mediaType:t,port:dp,protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};_=this.mungSendMediaDesc(_,u);const E=this.findFirstClosedMedia(t);if(E){const y=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[y]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,n,i){const s=Zt(t);return YE(s),Mc(s,n),qE(s,n),FO(s),cp(s,i,this.localCapabilities.send),s}mungSendMediaDesc(t,n){const i=Zt(t);return cp(i,n,this.localCapabilities.recv),Cs(i),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===t);if(i!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=s}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(n=>Bt()?n.media.port==="0"&&n.media.mediaType===t:n.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(n=>{var i,s;return((i=n.attributes)===null||i===void 0||(s=i.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===t[0].ssrcId})}getSSRC(t){var n;return(n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t))===null||n===void 0?void 0:n.attributes.ssrcs}}var mt;function ab(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Uc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ab(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ab(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Ho=(ne((mt=class Md extends jh{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n,i;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(i=n.transport)===null||i===void 0?void 0:i.state)!==null&&t!==void 0?t:null}constructor(t,n){super(t,n),g(this,"store",void 0),g(this,"peerConnection",void 0),g(this,"remoteSDP",void 0),g(this,"initialOffer",void 0),g(this,"transportEventReceiver",void 0),g(this,"statsFilter",void 0),g(this,"localCapabilities",void 0),g(this,"localCandidateCount",0),g(this,"allCandidatesReceived",!1),g(this,"selectedCandidatePairTimer",void 0),g(this,"establishPromise",void 0),g(this,"mutex",new nr("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(Md.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=$E(this.peerConnection,void 0,void 0,Bt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=wa(t.sdp),i=await WO(!H("USE_PUB_RTX")&&!H("USE_SUB_RTX"),H("FILTER_VIDEO_FEC"),H("FILTER_AUDIO_FEC"));return this.localCapabilities=JE(i),this.initialOffer=t,Uc(Uc({},n),{},{rtpCapabilities:i,offerSDP:t.sdp})}catch(t){throw new V(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,n,i,s,u,d){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new c6({remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:s,remoteSetup:u,localCapabilities:this.localCapabilities,cname:d});const h=this.remoteSDP.toString(),p=tn.exports.parse(this.initialOffer.sdp),m=p.mediaDescriptions.find(A=>A.media.mediaType==="audio");m&&Cs(m);const _=tn.exports.print(p),E=this.logSDPExchange(_||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:_}),E==null||E(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h});const y=this.peerConnection.getTransceivers()[0];if(y!=null&&y.receiver&&this.tryBindTransportEvents(y.receiver),H("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const A=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:A});const k=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(k)}}catch(h){throw new V(P.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(h.toString()))}}send(t,n,i){var s=this;return wi(function*(){const u=yield Je(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=[];t.forEach(L=>{const x=s.peerConnection.addTransceiver(L._mediaStreamTrack,{direction:"sendonly"});d.push(x),L._updateRtpTransceiver(x)}),Bt()&&H("SIMULCAST")===!0&&(yield Je(s.applySimulcastForFirefox(d,t)));const h=yield Je(s.peerConnection.createOffer()),p=s.remoteSDP.predictReceivingMids(t.length),m=s.mungSendOfferSDP(h.sdp,t,p),_=tn.exports.parse(m),E=p.map(L=>{const x=_.mediaDescriptions.find(z=>z.attributes.mid===L);if(!x)throw new Error("Cannot extract ssrc from mediaDescription.");return BO(x,H("USE_PUB_RTX"))});let y;try{y=yield E}catch(L){y=[],s.remoteSDP.receive(t,n,i,y);const x=s.remoteSDP.toString();throw yield Je(s.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Je(s.peerConnection.setRemoteDescription({type:"answer",sdp:x})),yield Je(s.stopSending(p,!0)),L}s.remoteSDP.receive(t,n,i,y);const A=s.remoteSDP.toString(),k=s.logSDPExchange(m,"offer","local","send");return yield Je(s.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Je(s.applySimulcastEncodings(d,t)),yield Je(s.applySendEncodings(d,t)),k==null||k(A),yield Je(s.peerConnection.setRemoteDescription({type:"answer",sdp:A})),d.map((L,x)=>{const z=p[x];return{localSSRC:E[x],id:z,transceiver:L}})}catch(d){throw d instanceof V?d:new V(P.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{u()}})()}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(p=>t.indexOf(p.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(p=>{var m;p.direction="inactive",(m=p.stop)===null||m===void 0||m.call(p)});const u=await this.peerConnection.createOffer(),d=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(t);const h=this.remoteSDP.toString();d==null||d(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new V(P.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async receive(t,n,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:u,needExchangeSDP:d}=this.remoteSDP.send(t,n,i,s);if(d){const p=this.remoteSDP.toString(),m=this.logSDPExchange(p,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:p});const _=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(_.sdp,u,t);m==null||m(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),I.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else I.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const h=this.peerConnection.getTransceivers().find(p=>p.mid===u);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:u,transceiver:h}}catch(u){throw new V(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);if(i){const s=this.remoteSDP.toString(),u=this.logSDPExchange(s,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=await this.peerConnection.createAnswer();u==null||u(d.sdp||""),await this.peerConnection.setLocalDescription(d),I.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else I.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return n.map(s=>{const u=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:s,transceiver:u}})}catch(n){throw new V(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new V(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new V(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new V(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(d=>{d.direction="inactive"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const u=this.remoteSDP.toString();s==null||s(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(n){throw new V(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(d,h)=>{d.direction="sendonly"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const u=this.remoteSDP.toString();s==null||s(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(n){throw new V(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return wi(function*(){const i=yield Je(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Jt().supportPCSetConfiguration){const m=n.peerConnection.getConfiguration(),_=t===On.RELAY?"relay":"all";m.iceTransportPolicy!==_&&(I.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(_,"]")),m.iceTransportPolicy=_,n.peerConnection.setConfiguration(m))}else if(t===On.RELAY)return;t!==On.RELAY&&n.remoteSDP.updateCandidates(t);const s=yield Je(n.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const u=wa(s.sdp),{remoteIceParameters:d}=yield u.iceParameters;n.remoteSDP.restartICE(d);const h=n.remoteSDP.toString(),p=n.logSDPExchange(s.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Je(n.peerConnection.setLocalDescription(s)),p==null||p(h),yield Je(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(s){I.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),s)}finally{i()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const u=this.remoteSDP.toString(),d=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),d==null||d(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new V(P.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(s=>s.mid===t);i.length===1&&(this.isVP8Simulcast(n)?Bt()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(s=>s.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:s}=n.getSelectedCandidatePair();return{local:Uc(Uc({},Is),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Uc(Uc({},Is),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},H("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(nd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...Md.turnServerConfigToIceServers(t.turnServer.servers)),H("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Md.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),H("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),H("ENABLE_ENCODED_TRANSFORM")&&Jt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(qh(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!H("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var s;n!=null&&n.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,n.state))},n.onerror=s=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in s?s.error:s)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const s=n==null?void 0:n.iceTransport.state;var u;s&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,s))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:s,remote:u}=i.getSelectedCandidatePair();I.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async applySendEncodings(t,n){try{if(!Jt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let m=0;m<t.length;m++){const _=t[m],E=n[m];if(E&&E instanceof en){var i,s;if(this.isVP8Simulcast(E))continue;const y={},A={};switch(E._optimizationMode){case"motion":y.degradationPreference="maintain-framerate";break;case"detail":y.degradationPreference="maintain-resolution";break;default:y.degradationPreference="balanced"}var u,d,h,p;if((i=E._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&(A.maxBitrate=1e3*((u=E._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)),E._hints.includes(dn.LOW_STREAM)&&((d=E._encoderConfig)!==null&&d!==void 0&&d.frameRate&&(A.maxFramerate=Fo(E._encoderConfig.frameRate)),(h=E._encoderConfig)!==null&&h!==void 0&&h.scaleResolutionDownBy&&((p=E._encoderConfig)===null||p===void 0?void 0:p.scaleResolutionDownBy)>1&&(A.scaleResolutionDownBy=E._encoderConfig.scaleResolutionDownBy)),H("DSCP_TYPE")&&pa()){const x=H("DSCP_TYPE");["very-low","low","medium","high"].includes(x)&&(A.networkPriority=x)}const k=_.sender.getParameters(),L=(s=k.encodings)===null||s===void 0?void 0:s[0];Bt()&&!L&&(y.encodings=[A]),L&&Object.assign(L,A),Object.assign(k,y),await _.sender.setParameters(k)}}}catch{I.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const s=tn.exports.parse(t);return n.forEach((u,d)=>{const h=i[d],p=s.mediaDescriptions.find(m=>m.attributes.mid===h);p&&(Mc(p,u),GO(p,u,this.store.codec))}),tn.exports.print(s)}mungReceiveAnswerSDP(t,n,i){const s=tn.exports.parse(t),u=s.mediaDescriptions.find(d=>d.attributes.mid===n);return u&&i===je.AUDIO&&u.media.mediaType==="audio"&&Cs(u),tn.exports.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let h=0;h<t.length;h++){var i,s,u,d;const p=t[h],m=n[h];if(m instanceof en&&!m._hints.includes(dn.LOW_STREAM)&&(i=m._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=m._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(u=m._scalabiltyMode)!==null&&u!==void 0&&u.numSpatialLayers&&((d=m._scalabiltyMode)===null||d===void 0?void 0:d.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},E={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const y=p.sender.getParameters();await p.sender.setParameters(Object.assign(y,_))}}}async applySimulcastEncodings(t,n){if(!Bt()&&t.length===n.length)for(let i=0;i<t.length;i++){const s=n[i];if(s instanceof en&&this.isVP8Simulcast(s)){const u=t[i],d={},h={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:h.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:h.medium,scaleResolutionDownBy:4}];const p=u.sender.getParameters();await u.sender.setParameters(Object.assign(p,d))}}}isVP8Simulcast(t){var n,i,s,u;return!!(t instanceof en&&H("SIMULCAST")&&this.store.codec==="vp8"&&!t._hints.includes(dn.LOW_STREAM)&&(n=t._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabiltyMode)!==null&&s!==void 0&&s.numSpatialLayers&&((u=t._scalabiltyMode)===null||u===void 0?void 0:u.numSpatialLayers)>1)}logSDPExchange(t,n,i,s){if(H("SDP_LOGGING"))return I.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(s,`
`),t),n==="offer"?u=>{this.logSDPExchange(u,"answer",i==="local"?"remote":"local",s)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Jt().supportPCSetConfiguration){const n=Md.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[hi],Object.getOwnPropertyDescriptor(mt.prototype,"connect"),mt.prototype),ne(mt.prototype,"receive",[hi],Object.getOwnPropertyDescriptor(mt.prototype,"receive"),mt.prototype),ne(mt.prototype,"batchReceive",[hi],Object.getOwnPropertyDescriptor(mt.prototype,"batchReceive"),mt.prototype),ne(mt.prototype,"stopReceiving",[hi],Object.getOwnPropertyDescriptor(mt.prototype,"stopReceiving"),mt.prototype),ne(mt.prototype,"muteRemote",[hi],Object.getOwnPropertyDescriptor(mt.prototype,"muteRemote"),mt.prototype),ne(mt.prototype,"unmuteRemote",[hi],Object.getOwnPropertyDescriptor(mt.prototype,"unmuteRemote"),mt.prototype),ne(mt.prototype,"muteLocal",[hi],Object.getOwnPropertyDescriptor(mt.prototype,"muteLocal"),mt.prototype),ne(mt.prototype,"unmuteLocal",[hi],Object.getOwnPropertyDescriptor(mt.prototype,"unmuteLocal"),mt.prototype),ne(mt.prototype,"close",[hi],Object.getOwnPropertyDescriptor(mt.prototype,"close"),mt.prototype),ne(mt.prototype,"updateEncoderConfig",[hi],Object.getOwnPropertyDescriptor(mt.prototype,"updateEncoderConfig"),mt.prototype),ne(mt.prototype,"updateSendParameters",[hi],Object.getOwnPropertyDescriptor(mt.prototype,"updateSendParameters"),mt.prototype),ne(mt.prototype,"replaceTrack",[hi],Object.getOwnPropertyDescriptor(mt.prototype,"replaceTrack"),mt.prototype),ne(mt.prototype,"getRemoteSSRC",[hi],Object.getOwnPropertyDescriptor(mt.prototype,"getRemoteSSRC"),mt.prototype),mt);function hi(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,u=await s.lock("From P2PConnection.".concat(t));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await i.apply(this,h)}finally{u()}},n}function cb(e,t){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=Fo(t.width),i.height=Fo(t.height);const s=Fo(t.framerate||15);document.body.append(n),document.body.append(i);let u=e._mediaStreamTrack;n.srcObject=new MediaStream([u]),n.play();const d=i.getContext("2d");if(!d)throw new V(P.UNEXPECTED_ERROR,"can not get canvas context");const h=Jt(),p=i.captureStream(h.supportRequestFrame?0:s).getVideoTracks()[0],m=PI(()=>(()=>{if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const E=n.videoWidth,y=n.videoHeight/E,A=i.width*y;Math.abs(A-i.height)>=2&&(I.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(A)),i.height=A)}d.drawImage(n,0,0,i.width,i.height),p.requestFrame&&p.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,n.srcObject=new MediaStream([u]))})(),s),_=p.stop;return p.stop=()=>{_.call(p),m(),n&&(n.remove(),n=null),i&&(i.width=0,i.remove(),i=null),I.debug("clean low stream renderer")},p}var ub,db,lb,hb,pi,pb,fb,_b,mb,Eb,vb,qn;function gb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function lp(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?gb(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gb(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Sb extends wI{getUserId(){return this._userId}constructor(t,n,i,s){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(s.clientId,"_").concat(bt(5,""))),g(this,"_userId",void 0),g(this,"_uintId",void 0),g(this,"_isDestroyed",!1),g(this,"store",void 0),g(this,"processor",void 0),g(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=s}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,I.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let hp=(ub=be({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),db=be({argsMap:e=>[e.getTrackId()]}),lb=be({argsMap:(e,t)=>[e.getTrackId(),t.name]}),hb=be({argsMap:e=>[e.getTrackId()]}),ne((pi=class extends Sb{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Mn.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,i){super(e,t,n,i),g(this,"_videoVisibleTimer",null),g(this,"_previousVideoVisibleStatus",void 0),g(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),g(this,"trackMediaType","video"),g(this,"_videoWidth",void 0),g(this,"_videoHeight",void 0),g(this,"_player",void 0),g(this,"processorDestination",void 0),g(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new GI(this.getTrackId(),"remote"),this.processorDestination=new FI(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return sd(()=>{I.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),qi(this,Le.GET_STATS)||lp({},sI)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const i=document.getElementById(e);i?e=i:(I.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}I.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=lp(lp({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new wE(n):this._player=new yw(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.emit(Cc.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.emit(Cc.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},H("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,I.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){VA(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(Xh)}_updatePlayerSource(){I.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:s,slot:u}=i;if(this.isPlaying&&s instanceof HTMLVideoElement&&u instanceof HTMLElement){const d=nO.checkOneElementVisible(s),h=Object.assign({},d);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;const p=we.reportApiInvoke(null,{tag:Ut.TRACER,name:rn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(n){throw new V(P.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new V(P.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Bn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Bn.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}).prototype,"play",[ub],Object.getOwnPropertyDescriptor(pi.prototype,"play"),pi.prototype),ne(pi.prototype,"stop",[db],Object.getOwnPropertyDescriptor(pi.prototype,"stop"),pi.prototype),ne(pi.prototype,"pipe",[lb],Object.getOwnPropertyDescriptor(pi.prototype,"pipe"),pi.prototype),ne(pi.prototype,"unpipe",[hb],Object.getOwnPropertyDescriptor(pi.prototype,"unpipe"),pi.prototype),pi),pp=(pb=be({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),fb=be({argsMap:(e,t)=>[e.getTrackId(),t]}),_b=be({argsMap:e=>[e.getTrackId()]}),mb=be({argsMap:e=>[e.getTrackId()]}),Eb=be({argsMap:(e,t)=>[e.getTrackId(),t.name]}),vb=be({argsMap:e=>[e.getTrackId()]}),ne((qn=class extends Sb{get isPlaying(){return this._useAudioElement?Nr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,i){super(e,t,n,i),g(this,"trackMediaType","audio"),g(this,"_source",void 0),g(this,"_useAudioElement",!0),g(this,"_volume",100),g(this,"processorContext",void 0),g(this,"processorDestination",void 0),g(this,"_played",!1),g(this,"_bypassWebAudio",!1),H("DISABLE_WEBAUDIO")?(this._source=new hE,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new uE(e,!0),H("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Er.RECEIVE_TRACK_BUFFER,()=>{this.emit(Cc.FIRST_FRAME_DECODED)}),this.processorContext=new HI(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new WI(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Er.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Er.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Er.ON_AUDIO_BUFFER),this._source.on(Er.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?Nr.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement)throw new V(P.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Nr.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return sd(()=>{I.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),qi(this,Le.GET_STATS)||lp({},oI)}play(){I.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(I.debug("[".concat(this.getTrackId(),"] use audio element to play")),Nr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){I.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Nr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];I.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Nr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new V(P.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new V(P.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new V(P.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Bn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Bn.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Bn.ON_TRACK),this.processorDestination.removeAllListeners(Bn.ON_NODE)}}).prototype,"setVolume",[pb],Object.getOwnPropertyDescriptor(qn.prototype,"setVolume"),qn.prototype),ne(qn.prototype,"setPlaybackDevice",[fb],Object.getOwnPropertyDescriptor(qn.prototype,"setPlaybackDevice"),qn.prototype),ne(qn.prototype,"play",[_b],Object.getOwnPropertyDescriptor(qn.prototype,"play"),qn.prototype),ne(qn.prototype,"stop",[mb],Object.getOwnPropertyDescriptor(qn.prototype,"stop"),qn.prototype),ne(qn.prototype,"pipe",[Eb],Object.getOwnPropertyDescriptor(qn.prototype,"pipe"),qn.prototype),ne(qn.prototype,"unpipe",[vb],Object.getOwnPropertyDescriptor(qn.prototype,"unpipe"),qn.prototype),qn);function Tb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function yb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Tb(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tb(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class u6 extends jt{constructor(){super(),g(this,"uplinkStatsUploadInterval",void 0),g(this,"uplinkRelatedStatsUploadInterval",void 0),g(this,"uplinkDenoiserStatsUploadInterval",void 0),g(this,"transportStatsUploadInterval",void 0),g(this,"uplinkExtensionStatsUploadInterval",void 0),g(this,"downlinkExtensionStatsUploadInterval",void 0),g(this,"extensionUsageStatsUploadInterval",void 0),g(this,"downlinkStatsUploadInterval",void 0),g(this,"downlinkRelatedStatsUploadInterval",void 0),g(this,"lastStats",void 0),g(this,"uploadUnplinkStarted",!1),g(this,"uploadDownlinkStarted",!1),g(this,"uploadTransportStarted",!1),g(this,"uploadExtensionUsageStarted",!1),g(this,"requestStats",void 0),g(this,"requestLocalMedia",void 0),g(this,"requestRemoteMedia",void 0),g(this,"requestAllTracks",void 0),g(this,"requestVideoIsReady",void 0),g(this,"requestUpload",void 0)}startUploadTransportStats(){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&this.uploadTransportStats(n)},1e3))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const t=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(async()=>{var n,i,s;const u=Date.now(),d={connectionInterval:H("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:u};let h=[];const p=((n=this.requestAllTracks)===null||n===void 0?void 0:n.call(this))||[];for(const y of p)!y.muted&&y.enabled&&(h=h.concat(await y.getProcessorUsage()));const m=((i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this))||[];for(const[y,A]of m)A.has(je.VIDEO)&&y.videoTrack&&(h=h.concat(await y.videoTrack.getProcessorUsage())),A.has(je.AUDIO)&&y.audioTrack&&(h=h.concat(await y.audioTrack.getProcessorUsage()));if(h.length===0)return;d.details=function(y,A){const k={};for(const{id:X,value:ie,level:Ie,direction:se}of y){var L;const de=(L=A.get(X))!==null&&L!==void 0?L:0,oe=ie===2?de+H("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:de;var x,z;A.set(X,oe),k[X]?(ie===2&&(k[X].value=ie),Ie>k[X].level&&(k[X].level=Ie),se==="remote"&&(k[X].remoteUidCount+=1),k[X].totalTs=(x=A.get(X))!==null&&x!==void 0?x:0):k[X]={value:ie,level:Ie,remoteUidCount:se==="local"?0:1,totalTs:(z=A.get(X))!==null&&z!==void 0?z:0}}return Object.keys(k).map(X=>{const{level:ie,value:Ie,totalTs:se}=k[X];return{id:X,level:ie,value:Ie,totalTs:se}})}(h,t);const _=Date.now(),E=_>u?_:u+1;(s=this.requestUpload)===null||s===void 0||s.call(this,br.EXTENSION_USAGE_STATS,{usageStats:d,sendTs:E})},H("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&(this.uploadUplinkStats(n),this.lastStats=n)},3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&this.uploadRelatedUplinkStats(n,this.lastStats),this.lastStats=n},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestAllTracks)===null||t===void 0?void 0:t.call(this);n&&this.uploadDenoiserStats(n)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestAllTracks)===null||t===void 0?void 0:t.call(this);n&&this.uploadExtensionStats(n)},2e3))}uploadTransportStats(t){Ji(()=>{var n;(n=this.requestUpload)===null||n===void 0||n.call(this,br.TRANSPORT_STATS,function(i){const s={connectionType:100,googRtt:i.rtt};if(i.selectedCandidatePair.localCandidate.candidateType==="relay"){const u=i.selectedCandidatePair.localCandidate.relayProtocol;u==="udp"&&(s.connectionType=101),u==="tcp"&&(s.connectionType=103),u==="tls"&&(s.connectionType=104)}return s}(t))})}uploadUplinkStats(t){var n;(((n=this.requestLocalMedia)===null||n===void 0?void 0:n.call(this))||[]).forEach(i=>{let[s,{track:u,ssrcs:d}]=i;switch(s){case Se.LocalVideoLowTrack:case Se.LocalVideoTrack:{const h=function(_,E,y){var A;const k=E.videoSend.find(x=>x.ssrc===_);if(!k)return null;const L={id:bt(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:k.ssrc.toString()};switch(L.A_vstd=y._originMediaStreamTrack&&!y._originMediaStreamTrack.enabled||y._mediaStreamTrack&&!y._mediaStreamTrack.enabled?"1":"0",k.sentFrame&&(L.A_fhs=k.sentFrame.height.toString(),L.A_frs=k.sentFrame.frameRate.toString(),L.A_fws=k.sentFrame.width.toString()),k.adaptionChangeReason){case"none":L.A_ac="0";break;case"cpu":L.A_ac="1";break;case"bandwidth":L.A_ac="2";break;case"other":L.A_ac="3"}return L.A_lvps=Hm[y._player?y._player.videoElementStatus:"uninit"].toString(),L.A_nr=(A=k.nacksCount)===null||A===void 0?void 0:A.toString(),k.avgEncodeMs&&(L.A_aem=k.avgEncodeMs.toFixed(0).toString()),L}(d[0].ssrcId,t,u),p=s===Se.LocalVideoTrack?function(_,E,y){var A,k,L,x,z,X,ie,Ie;const se=E.videoSend.find(Be=>Be.ssrc===_);if(!se)return null;const de={id:bt(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:se.ssrc.toString()},oe=(A=(k=(L=se.inputFrame)===null||L===void 0?void 0:L.height)!==null&&k!==void 0?k:y==null?void 0:y._videoHeight)!==null&&A!==void 0?A:0,ve=(x=(z=(X=se.inputFrame)===null||X===void 0?void 0:X.width)!==null&&z!==void 0?z:y==null?void 0:y._videoWidth)!==null&&x!==void 0?x:0,pt=(ie=(Ie=se.inputFrame)===null||Ie===void 0?void 0:Ie.frameRate)!==null&&ie!==void 0?ie:0;return oe&&(de.A_fhi=oe+""),ve&&(de.A_fwi=ve+""),pt&&(de.A_fri=pt+""),de}(d[0].ssrcId,t,u):null;h&&Ji(()=>{var _;return(_=this.requestUpload)===null||_===void 0?void 0:_.call(this,br.PUBLISH_STATS,{stream_type:s===Se.LocalVideoLowTrack?"low":"high",stats:yb(yb({},h),p)})});const m=function(_){const E={id:"bweforvideo",timestamp:new Date(_.timestamp).toISOString(),type:"VideoBwe"};return _.bitrate.retransmit&&(E.A_rb=_.bitrate.retransmit.toString()),_.bitrate.targetEncoded&&(E.A_teb=_.bitrate.targetEncoded.toString()),E.A_aeb=_.bitrate.actualEncoded.toString(),E.A_tb=_.bitrate.transmit.toString(),_.sendBandwidth!==void 0&&(E.A_asb=_.sendBandwidth.toString()),E}(t);m&&setTimeout(()=>{var _;return(_=this.requestUpload)===null||_===void 0?void 0:_.call(this,br.PUBLISH_STATS,{stream_type:s===Se.LocalVideoLowTrack?"low":"high",stats:m})},1e3);break}case Se.LocalAudioTrack:{const h=function(p,m,_){const E=m.audioSend.find(A=>A.ssrc===p);if(!E)return null;const y={id:bt(10,""),timestamp:new Date(m.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:E.ssrc.toString()};return y.A_astd=_._originMediaStreamTrack&&!_._originMediaStreamTrack.enabled||_._mediaStreamTrack&&!_._mediaStreamTrack.enabled?"1":"0",E.inputLevel?y.A_ail=Math.round(100*E.inputLevel).toString():y.A_ail=Math.round(100*_._source.getAccurateVolumeLevel()).toString(),y.A_apil=Math.round(100*_._source.getAccurateVolumeLevel()).toString(),E.aecReturnLoss&&(y.A_ecrl=Math.round(E.aecReturnLoss).toString()),E.aecReturnLossEnhancement&&(y.A_ecrle=Math.round(E.aecReturnLossEnhancement).toString()),y}(d[0].ssrcId,t,u);h&&Ji(()=>{var p;return(p=this.requestUpload)===null||p===void 0?void 0:p.call(this,br.PUBLISH_STATS,{stream_type:"high",stats:h})});break}}})}uploadRelatedUplinkStats(t,n){var i;(((i=this.requestLocalMedia)===null||i===void 0?void 0:i.call(this))||[]).filter(s=>{let[u]=s;return u===Se.LocalVideoLowTrack||u===Se.LocalVideoTrack}).forEach(s=>{let[u,{ssrcs:d}]=s;const h=function(p,m){const _=m.videoSend.find(E=>E.ssrc===p);return _?{mediaType:"video",isVideoMute:!1,frameRateInput:_.inputFrame&&_.inputFrame.frameRate.toString(),frameRateSent:_.sentFrame&&_.sentFrame.frameRate.toString(),googRtt:_.rttMs.toString(),qpSumPerFrame:Math.floor(_.qpSumPerFrame).toString()}:null}(d[0].ssrcId,t);h&&Ji(()=>{var p;(p=this.requestUpload)===null||p===void 0||p.call(this,br.PUBLISH_RELATED_STATS,{stream_type:u===Se.LocalVideoLowTrack?"low":"high",stats:h})})})}uploadDenoiserStats(t){for(let u=0;u<t.length;u++){const d=t[u];if(d instanceof zh){var n,i,s;const h=(n=(i=d._external).getDenoiserStats)===null||n===void 0?void 0:n.call(i);return void(h&&((s=this.requestUpload)===null||s===void 0||s.call(this,br.DENOISER_STATS,h)))}}}uploadExtensionStats(t){for(let n=0;n<t.length;n++)t[n].getProcessorStats().forEach(i=>{var s;(s=this.requestUpload)===null||s===void 0||s.call(this,i.type,i.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let t;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let n=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestStats)===null||i===void 0?void 0:i.call(this);s&&(this.uploadDownlinkStats(s,n,t),t=s),n=!n},3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestStats)===null||i===void 0?void 0:i.call(this);s&&(this.uploadRelatedDownlinkStats(s,this.lastStats),this.lastStats=s)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this);s&&this.uploadDownlinkExtensionStats(s)},2e3)}uploadDownlinkStats(t,n,i){var s;(((s=this.requestRemoteMedia)===null||s===void 0?void 0:s.call(this))||[]).forEach(u=>{let[d,h]=u;if(h.has(je.VIDEO)&&d.videoTrack){const p=d.videoTrack?function(m,_,E,y,A){const k=_.videoRecv.find(X=>X.ssrc===m);if(!k)return null;const L={id:bt(10,""),timestamp:new Date(_.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:k.ssrc.toString()};var x,z;if(L.bytesReceived=k.bytes.toString(),L.packetsLost=k.packetsLost.toString(),L.packetsReceived=k.packets.toString(),k.framesRateFirefox&&(L.A_frr=k.framesRateFirefox.toString()),k.receivedFrame?(L.A_frr=k.receivedFrame.frameRate.toString(),L.A_fhr=k.receivedFrame.height.toString(),L.A_fwr=k.receivedFrame.width.toString()):(L.A_fhr=(x=y._videoHeight)===null||x===void 0?void 0:x.toString(),L.A_fwr=(z=y._videoWidth)===null||z===void 0?void 0:z.toString()),L.A_frd=k.decodeFrameRate.toString(),k.outputFrame&&(L.A_fro=k.outputFrame.frameRate.toString()),k.jitterBufferMs!==void 0&&(L.A_jbm=Math.floor(k.jitterBufferMs).toString()),k.currentDelayMs!==void 0&&(L.A_cdm=Math.floor(k.currentDelayMs).toString()),L.A_fs=k.firsCount.toString(),L.A_ns=k.nacksCount.toString(),L.A_ps=k.plisCount.toString(),y&&(L.A_vrtd=y._originMediaStreamTrack.enabled&&y._mediaStreamTrack.enabled?"0":"1"),y._player&&y._player.freezeTimeCounterList.length>0&&(L.A_vrft=Math.round(y._player.freezeTimeCounterList.splice(0,1)[0]).toString()),A&&y._player&&jo.visibility==="visible"){const X=Math.min(6e3,y._player.renderFreezeAccTime);L.A_vrrft=Math.round(X).toString(),y._player.renderFreezeAccTime=Math.max(0,y._player.renderFreezeAccTime-X)}if(L.A_rvps=Hm[y._player?y._player.videoElementStatus:"uninit"].toString(),E){const X=E.videoRecv.find(ie=>ie.ssrc===m);if(X&&k.totalInterFrameDelay!==void 0&&k.totalSquaredInterFrameDelay!==void 0&&X.totalInterFrameDelay!==void 0&&X.totalSquaredInterFrameDelay!==void 0){const ie=k.totalInterFrameDelay-X.totalInterFrameDelay,Ie=k.totalSquaredInterFrameDelay-X.totalSquaredInterFrameDelay,se=k.framesDecodeCount-X.framesDecodeCount,de=ie/se*1e3,oe=Math.round(1e3*Math.sqrt((Ie-Math.pow(ie,2)/se)/se));!isNaN(oe)&&de+oe>Math.max(3*de,de+150)&&(L.A_ifdsd=oe.toString())}}return L}(d._videoSSRC,t,i,d.videoTrack,n):void 0;p&&Ji(()=>{var m;return(m=this.requestUpload)===null||m===void 0?void 0:m.call(this,br.SUBSCRIBE_STATS,{stream_id:d.uid,stats:p})})}if(h.has(je.AUDIO)&&d.audioTrack){const p=d.audioTrack?function(m,_,E,y){const A=_.audioRecv.find(L=>L.ssrc===m);if(!A)return null;const k={id:bt(10,""),timestamp:new Date(_.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:A.ssrc.toString()};if(k.bytesReceived=A.bytes.toString(),k.packetsLost=A.packetsLost.toString(),k.packetsReceived=A.packets.toString(),A.outputLevel?k.A_aol=Math.round(100*A.outputLevel).toString():k.A_aol=Math.round(100*y._source.getAccurateVolumeLevel()).toString(),k.A_apol=Math.round(100*y._source.getAccurateVolumeLevel()).toString(),y&&(k.A_artd=y._originMediaStreamTrack.enabled&&y._mediaStreamTrack.enabled?"0":"1"),k.A_jr=A.jitterMs.toString(),k.A_jbm=Math.floor(A.jitterBufferMs).toString(),k.A_cdm=Math.floor(A.jitterBufferMs).toString(),k.A_raps=Hm[Nr.getPlayerState(y.getTrackId())].toString(),E){const L=E.audioRecv.find(x=>x.ssrc===m);if(L){const x=A.concealedSamples-L.concealedSamples;x>0&&(k.A_cs=Math.round(x).toString())}}return k}(d._audioSSRC,t,i,d.audioTrack):void 0;p&&Ji(()=>{var m;return(m=this.requestUpload)===null||m===void 0?void 0:m.call(this,br.SUBSCRIBE_STATS,{stream_id:d.uid,stats:p})})}})}uploadRelatedDownlinkStats(t,n){var i;(((i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this))||[]).forEach(s=>{let[u,d]=s;if(d.has(je.VIDEO)&&u.videoTrack){var h;const p=(u._videoSSRC&&((h=this.requestVideoIsReady)===null||h===void 0?void 0:h.call(this,u._videoSSRC))||!1)===!0,m=function(_,E,y,A,k,L){const x=y.videoRecv.find(Ie=>Ie.ssrc===_),z=k?k.videoRecv.find(Ie=>Ie.ssrc===_):void 0;if(!x)return null;const X=bc.isRemoteVideoFreeze(L,x,z)&&E,ie={mediaType:"video",isVideoMute:!1,peerId:A,frameRateReceived:x.receivedFrame&&x.receivedFrame.frameRate.toString(),frameRateDecoded:x.decodedFrame&&x.decodedFrame.frameRate.toString(),isFreeze:X,bytesReceived:x.bytes.toString(),packetsReceived:x.packets.toString(),packetsLost:x.packetsLost.toString(),qpSumPerFrame:Math.floor(x.qpSumPerFrame).toString()};return x.framesRateFirefox&&(ie.frameRateDecoded=x.framesRateFirefox.toString(),ie.frameRateReceived=x.framesRateFirefox.toString()),ie}(u._videoSSRC,p,t,u.uid,n,u.videoTrack);m&&Ji(()=>{var _;(_=this.requestUpload)===null||_===void 0||_.call(this,br.SUBSCRIBE_RELATED_STATS,{stream_id:u.uid,stats:m})})}if(d.has(je.AUDIO)&&u.audioTrack){const p=function(m,_,E,y){const A=_.audioRecv.find(L=>L.ssrc===m);if(!A)return null;const k=bc.isRemoteAudioFreeze(y);return{mediaType:"audio",isAudioMute:!1,peerId:E,googJitterReceived:A.jitterMs.toString(),isFreeze:k,bytesReceived:A.bytes.toString(),packetsReceived:A.packets.toString(),packetsLost:A.packetsLost.toString(),frameReceived:A.receivedFrames.toString(),frameDropped:A.droppedFrames.toString()}}(u._audioSSRC,t,u.uid,u.audioTrack);p&&Ji(()=>{var m;(m=this.requestUpload)===null||m===void 0||m.call(this,br.SUBSCRIBE_RELATED_STATS,{stream_id:u.uid,stats:p})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(t){t.forEach(n=>{let[i,s]=n;s.has(je.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(u=>{var d;(d=this.requestUpload)===null||d===void 0||d.call(this,u.type,u.stats)}),s.has(je.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(u=>{var d;(d=this.requestUpload)===null||d===void 0||d.call(this,u.type,u.stats)})})}}function Rb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Cb(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Rb(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rb(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const Ib=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,fp="9",ZE=2e4,ev=4e4;class d6{get localCapabilities(){return Zt(this._localCapabilities)}get rtpCapabilities(){return Zt(this._rtpCapabilities)}get candidates(){return Zt(this._candidates)}get iceParameters(){return Zt(this._iceParameters)}get dtlsParameters(){return Zt(this._dtlsParameters)}constructor(t){g(this,"sessionDesc",void 0),g(this,"_localCapabilities",void 0),g(this,"_rtpCapabilities",void 0),g(this,"_candidates",void 0),g(this,"_iceParameters",void 0),g(this,"_dtlsParameters",void 0),g(this,"setup",void 0),g(this,"currentMidIndex",void 0),g(this,"cname",void 0),g(this,"firefoxSsrcMidMap",new Map),t=Zt(t);const{remoteIceParameters:n,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:u,remoteSetup:d,localCapabilities:h,cname:p}=t,m=tn.exports.parse(Ib);this._rtpCapabilities=u,this._candidates=s,this._iceParameters=n,this._dtlsParameters=i,this._localCapabilities=h,this.setup=d,this.cname=p;const _=this.rtpCapabilities.send;for(const E of m.mediaDescriptions){if(E.attributes.iceUfrag=n.iceUfrag,E.attributes.icePwd=n.icePwd,E.attributes.fingerprints=i.fingerprints,E.attributes.candidates=s,E.attributes.setup=d,E.media.mediaType==="application"&&(E.attributes.sctpPort="5000"),E.media.mediaType==="video"&&(E.media.fmts=_.videoCodecs.map(y=>y.payloadType.toString(10)),E.attributes.payloads=_.videoCodecs,E.attributes.extmaps=_.videoExtensions,H("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:y,ssrcGroups:A}=di([{ssrcId:ev,rtx:H("USE_SUB_RTX")?40001:void 0}],this.cname);E.attributes.ssrcs=y,E.attributes.ssrcGroups=A}if(E.media.mediaType==="audio"&&(E.media.fmts=_.audioCodecs.map(y=>y.payloadType.toString(10)),E.attributes.payloads=_.audioCodecs,E.attributes.extmaps=_.audioExtensions,Cs(E),H("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:y,ssrcGroups:A}=di([{ssrcId:ZE}],this.cname);E.attributes.ssrcs=y,E.attributes.ssrcGroups=A}}this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}updateRemoteRTPCapabilities(t){const n=tn.exports.parse(Ib);this._rtpCapabilities=t;const i=this.rtpCapabilities.send;for(const s of n.mediaDescriptions){if(s.attributes.iceUfrag=this._iceParameters.iceUfrag,s.attributes.icePwd=this._iceParameters.icePwd,s.attributes.fingerprints=this._dtlsParameters.fingerprints,s.attributes.candidates=this._candidates,s.attributes.setup=this.setup,s.media.mediaType==="application"&&(s.attributes.sctpPort="5000"),s.media.mediaType==="video"&&(s.media.fmts=i.videoCodecs.map(u=>u.payloadType.toString(10)),s.attributes.payloads=i.videoCodecs,s.attributes.extmaps=i.videoExtensions,H("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:u,ssrcGroups:d}=di([{ssrcId:ev,rtx:H("USE_SUB_RTX")?40001:void 0}],this.cname);s.attributes.ssrcs=u,s.attributes.ssrcGroups=d}if(s.media.mediaType==="audio"&&(s.media.fmts=i.audioCodecs.map(u=>u.payloadType.toString(10)),s.attributes.payloads=i.audioCodecs,s.attributes.extmaps=i.audioExtensions,H("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:u,ssrcGroups:d}=di([{ssrcId:ZE}],this.cname);s.attributes.ssrcs=u,s.attributes.ssrcGroups=d}}this.sessionDesc=n,this.currentMidIndex=n.mediaDescriptions.length-1}preloadRemoteMedia(t){this.rtpCapabilities;const n=this.candidates,i=this.dtlsParameters,s=this.iceParameters,u=this.rtpCapabilities.send;for(let d=1;d<t;d++){const h=2*d+ZE,p=2*d+ev,{ssrcs:m,ssrcGroups:_}=di([{ssrcId:h}],this.cname),{ssrcs:E,ssrcGroups:y}=di([{ssrcId:p,rtx:H("USE_SUB_RTX")?p+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:fp,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.videoCodecs.map(A=>A.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:s.iceUfrag,icePwd:s.icePwd,unrecognized:[],candidates:n,extmaps:u.videoExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:y,rtcpFeedbackWildcards:[],payloads:u.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*d-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:fp,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.audioCodecs.map(A=>A.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:s.iceUfrag,icePwd:s.icePwd,unrecognized:[],candidates:n,extmaps:u.audioExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:m,ssrcGroups:_,rtcpFeedbackWildcards:[],payloads:u.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*d)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return tn.exports.print(this.sessionDesc)}send(t,n,i,s){const{ssrcs:u,ssrcGroups:d}=di(n,this.cname,H("SYNC_GROUP")?i:void 0),h=this.findPreloadMediaDesc(u);if(h){if(Bt()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,h.attributes.mid),s&&(s.twcc||s.remb)){const p=this.sessionDesc.mediaDescriptions.indexOf(h);return this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(h,s),{mid:h.attributes.mid,needExchangeSDP:!0}}return{mid:h.attributes.mid,needExchangeSDP:!1}}{const p=this.findAvailableMediaIndex(t,u);let m;return p===-1||$n()||Zn()||tC()||p===0&&H("USE_SUB_RTX")?(m=this.createOrRecycleSendMedia(t,u,d,"sendonly",s),this.updateBundleMids()):(m=Zt(this.sessionDesc.mediaDescriptions[p]),m.attributes.direction="sendonly",m.attributes.ssrcs=u,m.attributes.ssrcGroups=d,this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(m,s)),Bt()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),{mid:m.attributes.mid,needExchangeSDP:!0}}}batchSend(t){const n=t.map(u=>{let{kind:d,ssrcMsg:h,mslabel:p}=u;return this.send(d,h,p)}),i=[];let s=!1;return n.forEach(u=>{let{mid:d,needExchangeSDP:h}=u;h&&(s=!0),i.push(d)}),{mids:i,needExchangeSDP:s}}stopSending(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(i=>{i.attributes.mid==="0"||Bt()||$n()||Zn()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.includes(i.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.includes(i.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="recvonly"})}receive(t,n,i,s){t.forEach((u,d)=>{this.createOrRecycleRecvMedia(u,[],"recvonly",n,i,s[d])}),this.updateBundleMids()}stopReceiving(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(t){t===On.TCP?this._candidates.forEach(n=>{this._candidates.findIndex(i=>i.transport==="tcp"&&i.connectionAddress===n.connectionAddress&&i.port===n.port)===-1&&this._candidates.push(Cb(Cb({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}):this._candidates=this._candidates.filter(n=>n.transport!=="tcp");for(const n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(t){t=Zt(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}findAvailableMediaIndex(t,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const s=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(Bt()){if(s){const u=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(u||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!u||u!==i.attributes.mid)}return!1}return s})}createOrRecycleRecvMedia(t,n,i,s,u,d){const h=t._mediaStreamTrack.kind,p=this.rtpCapabilities.recv,m=this.localCapabilities.send;let _=[];if(h===je.VIDEO){var E,y;if(H("H264_PROFILE_LEVEL_ID")&&s==="h264"&&(_=p.videoCodecs.filter(z=>{var X,ie;return(((X=z.rtpMap)===null||X===void 0?void 0:X.encodingName.toLowerCase())||"").includes(s)&&(z==null||(ie=z.fmtp)===null||ie===void 0?void 0:ie.parameters["profile-level-id"])===H("H264_PROFILE_LEVEL_ID")})),!_||((E=_)===null||E===void 0?void 0:E.length)===0){const z=m.videoCodecs.filter(X=>{var ie;return(((ie=X.rtpMap)===null||ie===void 0?void 0:ie.encodingName.toLowerCase())||"").includes(s)});z.length!==0&&(_=p.videoCodecs.filter(X=>z.some(ie=>ie.payloadType===X.payloadType)))}if(H("USE_PUB_RTX")){const z=_.map(ie=>ie.payloadType.toString()),X=p.videoCodecs.filter(ie=>{var Ie,se;return((Ie=ie.rtpMap)===null||Ie===void 0?void 0:Ie.encodingName)==="rtx"&&z.includes(((se=ie.fmtp)===null||se===void 0?void 0:se.parameters.apt)||"")});_=[..._,...X]}_.length===0&&(I.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat((y=p.videoCodecs[0].rtpMap)===null||y===void 0?void 0:y.encodingName)),_=p.videoCodecs)}else _=p.audioCodecs.filter(z=>{var X;return(((X=z.rtpMap)===null||X===void 0?void 0:X.encodingName.toLowerCase())||"").includes(u)}),_.length===0&&(I.warning("codec ".concat(u," not included in rtpCapabilities, fallback to opus")),_=p.audioCodecs.filter(z=>{var X;return(((X=z.rtpMap)===null||X===void 0?void 0:X.encodingName.toLowerCase())||"").includes("opus")}));const A=h===je.VIDEO?p.videoExtensions:p.audioExtensions;this.currentMidIndex+=1;const k="".concat(this.currentMidIndex);let L={media:{mediaType:h,port:fp,protos:["UDP","TLS","RTP","SAVPF"],fmts:_.map(z=>z.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:_,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(k)}};L=this.mungRecvMediaDsec(L,t,d);const x=this.findFirstClosedMedia(h);if(x){const z=this.sessionDesc.mediaDescriptions.indexOf(x);this.sessionDesc.mediaDescriptions[z]=L}else this.sessionDesc.mediaDescriptions.push(L);return L}createOrRecycleSendMedia(t,n,i,s,u){const d=this.rtpCapabilities.send,h=t===je.VIDEO?d.videoCodecs:d.audioCodecs,p=t===je.VIDEO?d.videoExtensions:d.audioExtensions;this.currentMidIndex+=1;const m="".concat(this.currentMidIndex);let _={media:{mediaType:t,port:fp,protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};_=this.mungSendMediaDesc(_,u);const E=this.findFirstClosedMedia(t);if(E){const y=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[y]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,n,i){const s=Zt(t);return YE(s),Mc(s,n),qE(s,n),FO(s),cp(s,i,this.localCapabilities.send),s}mungSendMediaDesc(t,n){const i=Zt(t);return cp(i,n,this.localCapabilities.recv),Cs(i),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===t);if(i!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=s}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(n=>Bt()?n.media.port==="0"&&n.media.mediaType===t:n.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(n=>{var i,s;return((i=n.attributes)===null||i===void 0||(s=i.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===t[0].ssrcId})}getSSRC(t){var n;return(n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t))===null||n===void 0?void 0:n.attributes.ssrcs}}var lt;function Ab(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function _p(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ab(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ab(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let l6=(ne((lt=class ef extends jh{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,n,i){super(t,n),g(this,"store",void 0),g(this,"peerConnection",void 0),g(this,"remoteSDP",void 0),g(this,"initialOffer",void 0),g(this,"transportEventReceiver",void 0),g(this,"statsFilter",void 0),g(this,"localCapabilities",void 0),g(this,"localCandidateCount",0),g(this,"allCandidatesReceived",!1),g(this,"establishPromise",void 0),g(this,"mutex",new nr("NVExtentionsConnection-mutex")),g(this,"rtcMedia",void 0),this.store=n,this.peerConnection=i,this.statsFilter=$E(this.peerConnection,void 0,void 0,Bt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(t){try{const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=wa(n.sdp),s=await WO(!H("USE_PUB_RTX")&&!H("USE_SUB_RTX"),H("FILTER_VIDEO_FEC"),H("FILTER_AUDIO_FEC"));return this.localCapabilities=s,this.initialOffer=n,_p(_p({},i),{},{rtpCapabilities:s,offerSDP:n.sdp})}catch(n){throw new V(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t,n,i,s,u,d){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new d6({remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:s,remoteSetup:u,localCapabilities:JE(this.localCapabilities),cname:d});const h=this.remoteSDP.toString(),p=tn.exports.parse(this.initialOffer.sdp),m=p.mediaDescriptions.find(y=>y.media.mediaType==="audio");m&&Cs(m);const _=tn.exports.print(p),E=this.logSDPExchange(_||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:_}),E==null||E(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(h){throw new V(P.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(h.toString()))}}async updateRemoteConnect(t){var n,i,s;(n=this.remoteSDP)===null||n===void 0||n.updateRemoteRTPCapabilities(t),(i=this.remoteSDP)===null||i===void 0||i.preloadRemoteMedia(2);const u=(s=this.remoteSDP)===null||s===void 0?void 0:s.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const d=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(d),I.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(t,n,i){var s=this;return wi(function*(){const u=yield Je(s.mutex.lock("From NVExtentionsConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const d=[];t.forEach(L=>{const x=s.peerConnection.addTransceiver(L._mediaStreamTrack,{direction:"sendonly"});d.push(x)}),Bt()&&H("SIMULCAST")===!0&&(yield Je(s.applySimulcastForFirefox(d,t)));const h=yield Je(s.peerConnection.createOffer()),p=s.remoteSDP.predictReceivingMids(t.length),m=s.mungSendOfferSDP(h.sdp,t,p),_=tn.exports.parse(m),E=p.map(L=>{const x=_.mediaDescriptions.find(z=>z.attributes.mid===L);if(!x)throw new Error("Cannot extract ssrc from mediaDescription.");return BO(x,H("USE_PUB_RTX"))});let y;try{y=yield E}catch(L){y=[],s.remoteSDP.receive(t,n,i,y);const x=s.remoteSDP.toString();throw yield Je(s.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Je(s.peerConnection.setRemoteDescription({type:"answer",sdp:x})),yield Je(s.stopSending(p,!0)),L}s.remoteSDP.receive(t,n,i,y);const A=s.remoteSDP.toString(),k=s.logSDPExchange(m,"offer","local","send");return yield Je(s.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Je(s.applySimulcastEncodings(d,t)),yield Je(s.applySendEncodings(d,t)),k==null||k(A),yield Je(s.peerConnection.setRemoteDescription({type:"answer",sdp:A})),d.map((L,x)=>{const z=p[x];return{localSSRC:E[x],id:z,transceiver:L}})}catch(d){throw d instanceof V?d:new V(P.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(d.toString()))}finally{u()}})()}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter(p=>t.indexOf(p.mid)!==-1);if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");s.map(p=>{var m;p.direction="inactive",(m=p.stop)===null||m===void 0||m.call(p)});const u=await this.peerConnection.createOffer(),d=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(t);const h=this.remoteSDP.toString();d==null||d(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new V(P.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async receive(t,n,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(t," before remoteSDP created."));const{mid:u,needExchangeSDP:d}=this.remoteSDP.send(t,n,i,s);if(d){const p=this.remoteSDP.toString(),m=this.logSDPExchange(p,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:p});const _=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(_.sdp,u,t);m==null||m(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),I.debug("[NVExtentionsConnection] receive ".concat(t," by exchanging SDP."))}else I.debug("[NVExtentionsConnection] receive ".concat(t," no need to exchange SDP."));const h=this.peerConnection.getTransceivers().find(p=>p.mid===u);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:u}}catch(u){throw new V(P.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(u.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);if(i){const s=this.remoteSDP.toString(),u=this.logSDPExchange(s,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=await this.peerConnection.createAnswer();u==null||u(d.sdp||""),await this.peerConnection.setLocalDescription(d),I.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else I.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return n.map(s=>{const u=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:s}})}catch(n){throw new V(P.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new V(P.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new V(P.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();i==null||i(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new V(P.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(d=>{d.direction="inactive"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const u=this.remoteSDP.toString();s==null||s(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(n){throw new V(P.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(d,h)=>{d.direction="sendonly"});const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const u=this.remoteSDP.toString();s==null||s(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(n){throw new V(P.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return wi(function*(){const i=yield Je(n.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Jt().supportPCSetConfiguration){const m=n.peerConnection.getConfiguration(),_=t===On.RELAY?"relay":"all";m.iceTransportPolicy!==_&&(I.debug("restartICE change iceTransportPolicy from [".concat(m.iceTransportPolicy,"] to [").concat(_,"]")),m.iceTransportPolicy=_,n.peerConnection.setConfiguration(m))}else if(t===On.RELAY)return;t!==On.RELAY&&n.remoteSDP.updateCandidates(t);const s=yield Je(n.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const u=wa(s.sdp),{remoteIceParameters:d}=yield u.iceParameters;n.remoteSDP.restartICE(d);const h=n.remoteSDP.toString(),p=n.logSDPExchange(s.sdp||"","offer","local","restartICE");yield Je(n.peerConnection.setLocalDescription(s)),p==null||p(h),yield Je(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(s){I.warning("restart ICE failed, abort operation",s)}finally{i()}})()}close(){var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const u=this.remoteSDP.toString(),d=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),d==null||d(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new V(P.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(s=>s.mid===t);i.length===1&&(this.isVP8Simulcast(n)?Bt()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(s=>s.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}getP2PConnectionParams(){var t;if((t=this.peerConnection.currentLocalDescription)===null||t===void 0||!t.sdp||!this.localCapabilities)throw new Error;return _p(_p({},wa(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},H("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(nd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...ef.turnServerConfigToIceServers(t.turnServer.servers)),H("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...ef.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),H("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(qh(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!H("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async applySendEncodings(t,n){try{if(!Jt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let m=0;m<t.length;m++){const _=t[m],E=n[m];if(E&&E instanceof en){var i,s;if(this.isVP8Simulcast(E))continue;const y={},A={};switch(E._optimizationMode){case"motion":y.degradationPreference="maintain-framerate";break;case"detail":y.degradationPreference="maintain-resolution";break;default:y.degradationPreference="balanced"}var u,d,h,p;if((i=E._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&(A.maxBitrate=1e3*((u=E._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)),E._hints.includes(dn.LOW_STREAM)&&((d=E._encoderConfig)!==null&&d!==void 0&&d.frameRate&&(A.maxFramerate=Fo(E._encoderConfig.frameRate)),(h=E._encoderConfig)!==null&&h!==void 0&&h.scaleResolutionDownBy&&((p=E._encoderConfig)===null||p===void 0?void 0:p.scaleResolutionDownBy)>1&&(A.scaleResolutionDownBy=E._encoderConfig.scaleResolutionDownBy)),H("DSCP_TYPE")&&pa()){const x=H("DSCP_TYPE");["very-low","low","medium","high"].includes(x)&&(A.networkPriority=x)}const k=_.sender.getParameters(),L=(s=k.encodings)===null||s===void 0?void 0:s[0];Bt()&&!L&&(y.encodings=[A]),L&&Object.assign(L,A),Object.assign(k,y),await _.sender.setParameters(k)}}}catch{I.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,n,i){const s=tn.exports.parse(t);return n.forEach((u,d)=>{const h=i[d],p=s.mediaDescriptions.find(m=>m.attributes.mid===h);p&&(Mc(p,u),GO(p,u,this.store.codec))}),tn.exports.print(s)}mungReceiveAnswerSDP(t,n,i){const s=tn.exports.parse(t),u=s.mediaDescriptions.find(d=>d.attributes.mid===n);return u&&i===je.AUDIO&&u.media.mediaType==="audio"&&Cs(u),tn.exports.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let h=0;h<t.length;h++){var i,s,u,d;const p=t[h],m=n[h];if(m instanceof en&&!m._hints.includes(dn.LOW_STREAM)&&(i=m._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=m._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(u=m._scalabiltyMode)!==null&&u!==void 0&&u.numSpatialLayers&&((d=m._scalabiltyMode)===null||d===void 0?void 0:d.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},E={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const y=p.sender.getParameters();await p.sender.setParameters(Object.assign(y,_))}}}async applySimulcastEncodings(t,n){if(!Bt()&&t.length===n.length)for(let i=0;i<t.length;i++){const s=n[i];if(s instanceof en&&this.isVP8Simulcast(s)){const u=t[i],d={},h={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:h.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:h.medium,scaleResolutionDownBy:4}];const p=u.sender.getParameters();await u.sender.setParameters(Object.assign(p,d))}}}isVP8Simulcast(t){var n,i,s,u;return!!(t instanceof en&&H("SIMULCAST")&&this.store.codec==="vp8"&&!t._hints.includes(dn.LOW_STREAM)&&(n=t._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=t._scalabiltyMode)!==null&&s!==void 0&&s.numSpatialLayers&&((u=t._scalabiltyMode)===null||u===void 0?void 0:u.numSpatialLayers)>1)}logSDPExchange(t,n,i,s){if(H("SDP_LOGGING"))return I.upload("exchanging ".concat(i," ").concat(n," SDP during NVExtentionsConnection.").concat(s,`
`),t),n==="offer"?u=>{this.logSDPExchange(u,"answer",i==="local"?"remote":"local",s)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Jt().supportPCSetConfiguration){const n=ef.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[qr],Object.getOwnPropertyDescriptor(lt.prototype,"connect"),lt.prototype),ne(lt.prototype,"updateRemoteConnect",[qr],Object.getOwnPropertyDescriptor(lt.prototype,"updateRemoteConnect"),lt.prototype),ne(lt.prototype,"receive",[qr],Object.getOwnPropertyDescriptor(lt.prototype,"receive"),lt.prototype),ne(lt.prototype,"batchReceive",[qr],Object.getOwnPropertyDescriptor(lt.prototype,"batchReceive"),lt.prototype),ne(lt.prototype,"stopReceiving",[qr],Object.getOwnPropertyDescriptor(lt.prototype,"stopReceiving"),lt.prototype),ne(lt.prototype,"muteRemote",[qr],Object.getOwnPropertyDescriptor(lt.prototype,"muteRemote"),lt.prototype),ne(lt.prototype,"unmuteRemote",[qr],Object.getOwnPropertyDescriptor(lt.prototype,"unmuteRemote"),lt.prototype),ne(lt.prototype,"muteLocal",[qr],Object.getOwnPropertyDescriptor(lt.prototype,"muteLocal"),lt.prototype),ne(lt.prototype,"unmuteLocal",[qr],Object.getOwnPropertyDescriptor(lt.prototype,"unmuteLocal"),lt.prototype),ne(lt.prototype,"close",[qr],Object.getOwnPropertyDescriptor(lt.prototype,"close"),lt.prototype),ne(lt.prototype,"updateEncoderConfig",[qr],Object.getOwnPropertyDescriptor(lt.prototype,"updateEncoderConfig"),lt.prototype),ne(lt.prototype,"updateSendParameters",[qr],Object.getOwnPropertyDescriptor(lt.prototype,"updateSendParameters"),lt.prototype),ne(lt.prototype,"replaceTrack",[qr],Object.getOwnPropertyDescriptor(lt.prototype,"replaceTrack"),lt.prototype),ne(lt.prototype,"getRemoteSSRC",[qr],Object.getOwnPropertyDescriptor(lt.prototype,"getRemoteSSRC"),lt.prototype),lt);function qr(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,u=await s.lock("From NVExtentionsConnection.".concat(t));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await i.apply(this,h)}finally{u()}},n}var yt;function wb(e){var t,n,i,s=2;for(typeof Symbol<"u"&&(n=MO,i=Symbol.iterator);s--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new tv(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function tv(e){function t(n){if(Object(n)!==n)return Ee.reject(new TypeError(n+" is not an object."));var i=n.done;return Ee.resolve(n.value).then(function(s){return{value:s,done:i}})}return(tv=function(n){this.s=n,this.n=n.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?Ee.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?Ee.reject(n):t(i.apply(this.s,arguments))}},new tv(e)}let As=(ne((yt=class tf extends jh{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,n){super(t,n),g(this,"store",void 0),g(this,"peerConnection",void 0),g(this,"cname",void 0),g(this,"mutex",new nr("DataChannelConnection-mutex")),g(this,"dataChannel",void 0),g(this,"_p2pConnection",void 0),g(this,"establishPromise",void 0),g(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(tf.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new l6(t,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var t;const n=(t=this._nvMedia)===null||t===void 0?void 0:t.getLocalRtpCapabilities();return await this._p2pConnection.establish(n)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(t,n,i,s,u,d){return this.cname=d,await this._p2pConnection.connect(t,n,i,s,u,d),await new Ee((h,p)=>{const m=setTimeout(()=>{this.closeSignal(),p(new V(P.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(i))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(m),void h()},this.dataChannel.onerror=_=>{this.closeSignal(),p(_)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}send(t,n,i){var s=this;return wi(function*(){const u=yield Je(s.mutex.lock("From DataChannelConnection.send"));try{return yield*ap(wb(s._p2pConnection.send(t,n,i)),Je)}finally{u()}})()}async stopSending(t,n){return this._p2pConnection.stopSending(t,n)}async receive(t,n,i,s){return this._nvMedia?(I.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,n,this.cname)):(I.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,n,i,s))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var n=this;return wi(function*(){return yield*ap(wb(n._p2pConnection.restartICE(t)),Je)})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var n;(n=this._nvMedia)===null||n===void 0||n.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,n){return await this._p2pConnection.updateEncoderConfig(t,n)}async updateSendParameters(t,n){return await this._p2pConnection.updateSendParameters(t,n)}setStatsRemoteVideoIsReady(t,n){this._p2pConnection.setStatsRemoteVideoIsReady(t,n)}async replaceTrack(t,n){return await this._p2pConnection.replaceTrack(t,n)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,n,i,s){if(H("SDP_LOGGING"))return I.upload("exchanging ".concat(i," ").concat(n," SDP during DataChannelConnection.").concat(s,`
`),t),n==="offer"?u=>{this.logSDPExchange(u,"answer",i==="local"?"remote":"local",s)}:void 0}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(nd(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...tf.turnServerConfigToIceServers(t.turnServer.servers)),H("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...tf.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),H("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(qh(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!H("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var n;return(n=this.onICEConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var n;return(n=this.onConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var n;return(n=this.onDTLSTransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var n;return(n=this.onDTLSTransportError)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var n;return(n=this.onICETransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var n;return(n=this.onFirstAudioReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var n;return(n=this.onFirstVideoReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var n;return(n=this.onFirstAudioDecoded)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,n,i)=>{var s;return(s=this.onFirstVideoDecoded)===null||s===void 0?void 0:s.call(this,t,n,i)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var n;return(n=this.onFirstVideoDecodedTimeout)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,n)=>{var i;return(i=this.onSelectedLocalCandidateChanged)===null||i===void 0?void 0:i.call(this,t,n)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,n)=>{var i;return(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0?void 0:i.call(this,t,n)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}}).prototype,"connect",[bi],Object.getOwnPropertyDescriptor(yt.prototype,"connect"),yt.prototype),ne(yt.prototype,"receive",[bi],Object.getOwnPropertyDescriptor(yt.prototype,"receive"),yt.prototype),ne(yt.prototype,"stopReceiving",[bi],Object.getOwnPropertyDescriptor(yt.prototype,"stopReceiving"),yt.prototype),ne(yt.prototype,"muteRemote",[bi],Object.getOwnPropertyDescriptor(yt.prototype,"muteRemote"),yt.prototype),ne(yt.prototype,"unmuteRemote",[bi],Object.getOwnPropertyDescriptor(yt.prototype,"unmuteRemote"),yt.prototype),ne(yt.prototype,"muteLocal",[bi],Object.getOwnPropertyDescriptor(yt.prototype,"muteLocal"),yt.prototype),ne(yt.prototype,"unmuteLocal",[bi],Object.getOwnPropertyDescriptor(yt.prototype,"unmuteLocal"),yt.prototype),ne(yt.prototype,"close",[bi],Object.getOwnPropertyDescriptor(yt.prototype,"close"),yt.prototype),ne(yt.prototype,"updateEncoderConfig",[bi],Object.getOwnPropertyDescriptor(yt.prototype,"updateEncoderConfig"),yt.prototype),ne(yt.prototype,"updateSendParameters",[bi],Object.getOwnPropertyDescriptor(yt.prototype,"updateSendParameters"),yt.prototype),ne(yt.prototype,"replaceTrack",[bi],Object.getOwnPropertyDescriptor(yt.prototype,"replaceTrack"),yt.prototype),ne(yt.prototype,"getRemoteSSRC",[bi],Object.getOwnPropertyDescriptor(yt.prototype,"getRemoteSSRC"),yt.prototype),yt);function bi(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,u=await s.lock("From DataChannelConnection.".concat(t));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await i.apply(this,h)}finally{u()}},n}var rt;function Ob(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function ws(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ob(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ob(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function bb(e){var t,n,i,s=2;for(typeof Symbol<"u"&&(n=MO,i=Symbol.iterator);s--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new nv(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function nv(e){function t(n){if(Object(n)!==n)return Ee.reject(new TypeError(n+" is not an object."));var i=n.done;return Ee.resolve(n.value).then(function(s){return{value:s,done:i}})}return(nv=function(n){this.s=n,this.n=n.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?Ee.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?Ee.reject(n):t(i.apply(this.s,arguments))}},new nv(e)}let h6=(ne((rt=class extends jt{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Ze.StateChange,t,this._state)}constructor(e,t){super(),g(this,"store",void 0),g(this,"statsUploader",void 0),g(this,"connection",void 0),g(this,"localTrackMap",new Map),g(this,"remoteUserMap",new Map),g(this,"pendingLocalTracks",[]),g(this,"pendingRemoteTracks",[]),g(this,"statsCollector",void 0),g(this,"isPlanB",!1),g(this,"shouldForwardP2PCreation",void 0),g(this,"iceFailedCount",0),g(this,"dtlsFailedCount",0),g(this,"mutex",new nr("P2PChannel-mutex")),g(this,"_state",ln.Disconnected),g(this,"_pcStatsUploadType",H("NEW_ICE_RESTART")?Ki.FIRST_CONNECTION:Ki.OLD_FIRST_CONNECTION),g(this,"_isInRestartIce",!1),g(this,"_isStartRestartIce",!1),g(this,"_restartStates",["disconnected","failed"]),g(this,"_restartTimer",void 0),g(this,"_isFirstConnected",!0),g(this,"handleMuteLocalTrack",async(n,i,s)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==ln.Connected)return void s(new V(P.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const d=this.filterTobeMutedTracks(n);if(d.length===0)return void i();const h=d.find(m=>m[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(d.map(m=>{let[,{id:_}]=m;return _}));const p=this.createMuteMessage(d);await Wt(this,Ze.RequestMuteLocal,p),i()}catch(d){s(d)}finally{u()}}),g(this,"handleUnmuteLocalTrack",async(n,i,s)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==ln.Connected)return void s(new V(P.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const d=this.filterTobeUnmutedTracks(n);if(d.length===0)return void i();const h=d.find(m=>m[0]==="videoLowTrack");if(h){const m=h[1];if(m.track._originMediaStreamTrack.stop(),Jt().supportDualStreamEncoding){const _=n._mediaStreamTrack.clone();m.track._mediaStreamTrack=_,m.track._originMediaStreamTrack=_}else{const _=cb(n,Ca(this,Ze.RequestLowStreamParameter));m.track._mediaStreamTrack=_,m.track._originMediaStreamTrack=_}await new Ee((_,E)=>{this.handleReplaceTrack(m.track,_,E,!0)})}await this.connection.unmuteLocal(d.map(m=>{let[,{id:_}]=m;return _}));const p=this.createUnmuteMessage(d);await Wt(this,Ze.RequestUnmuteLocal,p),i()}catch(d){s(d)}finally{u()}}),g(this,"handleUpdateVideoEncoder",async(n,i,s)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const d=this.localTrackMap.get(Se.LocalVideoTrack);if(!this.connection||!d||d.track!==n||this.state!==ln.Connected)return void i();const{id:h,track:p}=d;await this.connection.updateSendParameters(h,p),await this.connection.updateEncoderConfig(h,p),this.emit(Ze.UpdateVideoEncoder,p),i()}catch(d){s(d)}finally{u()}}),g(this,"handleSetOptimizationMode",async(n,i,s)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const d=this.localTrackMap.get(Se.LocalVideoTrack);if(!this.connection||!d||d.track!==n||this.state!==ln.Connected)return;const{id:h,track:p}=d;await this.connection.updateSendParameters(h,p),i()}catch(d){s(d)}finally{u()}}),g(this,"handleReplaceTrack",async(n,i,s,u)=>{let d;I.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof u=="boolean"&&u||(d=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var h;const m=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:E}]=_;return n===E});if(!this.connection||!m||this.state!==ln.Connected)return void i();if(await((h=this.connection)===null||h===void 0?void 0:h.replaceTrack(n,m[1].id)),this.isPlanB){const _=m[1];_.id=n._mediaStreamTrack.id,this.localTrackMap.set(m[0],_)}if(m[0]===Se.LocalVideoTrack&&Jt().supportDualStreamEncoding){const _=this.localTrackMap.get(Se.LocalVideoLowTrack);if(_){const E=n._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=E,_.track._originMediaStreamTrack=E,await new Ee((y,A)=>{this.handleReplaceTrack(_.track,y,A,!0)})}}i()}catch(m){s(m)}finally{var p;(p=d)===null||p===void 0||p()}}),g(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),g(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),g(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),g(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new u6,this.bindStatsUploaderEvents(),this.isPlanB=!Jt().supportUnifiedPlan||H("CHROME_FORCE_PLAN_B")&&pa(),this.shouldForwardP2PCreation=H("FORWARD_P2P_CREATION")&&Jt().supportPCSetConfiguration,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new As({},this.store):this.isPlanB?new gd({},this.store):new Ho({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=ln.New;const i=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(I.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new As(e,this.store):this.isPlanB?new gd(e,this.store):new Ho(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new V(P.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=H("NEW_ICE_RESTART")?Ki.FIRST_CONNECTION:Ki.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e,t,n,i,s,u){if(!this.connection)throw new V(P.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof As?this.connection.updateRemoteConnect(i):(this.store.peerConnectionStart(),await this.connection.connect(e,t,n,i,s,u),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ln.Connected)}async preConnect(e,t,n,i,s,u){if(!this.connection)throw new V(P.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const d=await this.connection.connect(e,t,n,i,s,u);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ln.Connected,d}getEstablishParams(){if(this.connection instanceof As)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publish(e,t,n){var i=this;return wi(function*(){const s=yield Je(i.mutex.lock("From P2PChannel.publish"));try{if(!i.connection||i.state!==ln.Connected){if(i.state===ln.Disconnected)throw new V(P.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);const d=e.filter(h=>i.pendingLocalTracks.indexOf(h)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(d))}i.store.pubId=i.store.pubId+1,ai.markPublishStart(i.store.clientId,i.store.pubId);const u=i.filterTobePublishedTracks(e,t,n);if(u.length===0)return void(yield Je(i.tryToUnmuteAudio(e)));yield*ap(bb(i.doPublish(i.connection,u)),Je)}finally{s()}})()}doPublish(e,t){var n=this;return wi(function*(){t.forEach(m=>{let{track:_,type:E}=m;const y=Date.now();n.store.publish(_.getTrackId(),E===Se.LocalAudioTrack?"audio":"video",y)}),n.bindLocalTrackEvents(t);const i=yield Je(e.send(t.map(m=>{let{track:_}=m;return _}),n.store.codec,n.store.audioCodec)),s=(yield Je(i.next())).value,u=n.createGatewayPublishMessage(t,s);let d;try{d=yield u}catch(m){throw i.throw(m),(m==null?void 0:m.code)===P.WS_ABORT&&t.forEach(_=>{let{track:E}=_;n.pendingLocalTracks.indexOf(E)===-1&&n.pendingLocalTracks.push(E)}),n.unbindLocalTrackEvents(t),m}const h=n.mapPubResToRemoteConfig(u,d),p=(yield Je(i.next(h))).value;t.forEach(m=>{let{type:_}=m;n.statsCollector.addLocalStats(_)}),n.assignLocalTracks(t,p),n.statsUploader.startUploadUplinkStats(),t.forEach(m=>{let{track:_,type:E}=m;const y=Date.now();n.store.publish(_.getTrackId(),E===Se.LocalAudioTrack?"audio":"video",void 0,y)})})()}publishLowStream(e){var t=this;return wi(function*(){if(!t.connection||t.state!==ln.Connected)return;const n=yield Je(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const s=t.localTrackMap.get(Se.LocalVideoTrack);if(!s)throw new V(P.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Se.LocalVideoLowTrack))throw new V(P.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:t.getLowVideoTrack(s.track,e),type:Se.LocalVideoLowTrack}];if(yield*ap(bb(t.doPublish(t.connection,u)),Je),s.track.muted||!s.track.enabled){var i;const d=(i=t.localTrackMap.get(Se.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;d!==void 0&&(yield Je(t.connection.muteLocal([d])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(I.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Gn(this,Ze.RequestRePublish,this.pendingLocalTracks),this.emit(Ze.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:i}=this.pendingRemoteTracks[t];(i!==je.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==je.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Gn(this,Ze.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===je.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(Ze.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==ln.Connected)return void e.forEach(i=>{const s=this.pendingLocalTracks.indexOf(i);s!==-1&&this.pendingLocalTracks.splice(s,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishLowStream(){if(!this.connection||this.state!==ln.Connected)return;const e=this.localTrackMap.get(Se.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[Se.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(i=>{let[,{id:s}]=i;return s})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[s,{track:u}]=i;return{type:s,track:u}})),t.forEach(i=>{let[s]=i;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats(),n}async subscribe(e,t,n,i,s){var u;if(!this.connection||this.state!==ln.Connected)throw new V(P.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(t))return;let d,h,p;if(s){const E=s.find(A=>{let{stream_type:k}=A;return k===t});if(!E)throw new V(P.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const y=await this.connection.receive(t,E.ssrcs,String(e._uintid),E.attributes);this.connection instanceof Ho&&(p=y.transceiver),d=y.track,h=y.id}else{const E=await this.connection.receive(t,[{ssrcId:n,rtx:i}],String(e._uintid),void 0);this.connection instanceof Ho&&(p=E.transceiver),d=E.track,h=E.id}t===je.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(d):(e._audioTrack=new pp(d,e.uid,e._uintid,this.store),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),p&&e._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(d):(e._videoTrack=new hp(d,e.uid,e._uintid,this.store),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),p&&e._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._videoTrack));const m=this.remoteUserMap.get(e);m?m.set(t,h):this.remoteUserMap.set(e,new Map([[t,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadDownlinkStats();const _=this.pendingRemoteTracks.findIndex(E=>{let{user:y,kind:A}=E;return y.uid===e.uid&&t===A});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(Ze.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==ln.Connected)throw new V(P.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(n=>{var i;let{user:s,mediaType:u}=n;return!((i=this.remoteUserMap.get(s))!==null&&i!==void 0&&i.has(u))});const t=await this.connection.batchReceive(e.map(n=>{let{user:i,mediaType:s,ssrcId:u,rtxSsrcId:d}=n;return{kind:s,ssrcMsg:[{ssrcId:u,rtx:d}],mslabel:String(i._uintid)}}));e.forEach((n,i)=>{let{user:s,mediaType:u}=n;const{track:d,id:h,transceiver:p}=t[i];u===je.AUDIO?(s._audioTrack?s._audioTrack._updateOriginMediaStreamTrack(d):(s._audioTrack=new pp(d,s.uid,s._uintid,this.store),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(s._audioTrack.getTrackId()))),p&&s._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(s,s._audioTrack)):(s._videoTrack?s._videoTrack._updateOriginMediaStreamTrack(d):(s._videoTrack=new hp(d,s.uid,s._uintid,this.store),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(s._videoTrack.getTrackId()))),p&&s._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(s,s._videoTrack));const m=this.remoteUserMap.get(s);m?m.set(u,h):this.remoteUserMap.set(s,new Map([[u,h]])),this.statsCollector.addRemoteStats(s.uid),this.statsUploader.startUploadDownlinkStats();const _=this.pendingRemoteTracks.findIndex(E=>{let{user:y,kind:A}=E;return y.uid===s.uid&&u===A});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(Ze.MediaReconnectEnd,s.uid))})}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(d=>{let{user:h,kind:p}=d;return t!==void 0?h.uid===e.uid&&t===p:h.uid===e.uid});if(i.forEach(d=>{const h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)}),this.connection&&this.state===ln.Connected||n||i.forEach(d=>{let{kind:h}=d;var p;if(h===je.AUDIO)(p=e._audioTrack)===null||p===void 0||p._destroy(),e._audioTrack=void 0;else if(h===je.VIDEO){var m;(m=e._videoTrack)===null||m===void 0||m._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==ln.Connected)return;const s=this.filterTobeUnSubscribedTracks(e,t);if(s.length===0)return;await this.connection.stopReceiving(s.map(d=>{let[,{id:h}]=d;return h}));const u=this.createUnsubscribeMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),s.forEach(d=>{let[h,{kind:p}]=d;var m,_;if(p===je.VIDEO&&h._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),p===je.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),n||((_=h._videoTrack)===null||_===void 0||_._destroy(),h._videoTrack=void 0);else if(p===je.AUDIO){var E;this.unbindRemoteTrackEvents(h._audioTrack),!n&&((E=h._audioTrack)===null||E===void 0||E._destroy(),h._audioTrack=void 0)}}),u}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:s,mediaType:u}of e){const d=this.pendingRemoteTracks.filter(h=>{let{user:p,kind:m}=h;return u!==void 0?p.uid===s.uid&&u===m:p.uid===s.uid});d.forEach(h=>{const p=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(p,1)}),t=t.concat(d)}if(!this.connection||this.state!==ln.Connected)return void t.forEach(s=>{let{user:u,kind:d}=s;var h;if(d===je.AUDIO)(h=u._audioTrack)===null||h===void 0||h._destroy(),u._audioTrack=void 0;else if(d===je.VIDEO){var p;(p=u._videoTrack)===null||p===void 0||p._destroy(),u._videoTrack=void 0}});const n=hs(e).call(e,(s,u)=>{let{user:d,mediaType:h}=u;const p=this.filterTobeUnSubscribedTracks(d,h);return s.concat(p)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(s=>{let[,{id:u}]=s;return u}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),n.forEach(s=>{let[u,{kind:d}]=s;var h,p;if(d===je.VIDEO&&u._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),d===je.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(p=u._videoTrack)===null||p===void 0||p._destroy(),u._videoTrack=void 0;else if(d===je.AUDIO){var m;this.unbindRemoteTrackEvents(u._audioTrack),(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0}}),i}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void I.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void I.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===je.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void I.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||I.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(Se.LocalAudioTrack);if((t==null?void 0:t.track)instanceof gr){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[s]=i;return s!==Se.LocalAudioTrack}).filter(i=>{let[s]=i;return!(e&&s===Se.LocalVideoLowTrack)}).map(i=>{let[,{track:s}]=i;return s}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===Se.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(e,t,n,i,s){if(e){const d=this.localTrackMap.get(Se.LocalAudioTrack),h=i?this.localTrackMap.get(Se.LocalVideoLowTrack):this.localTrackMap.get(Se.LocalVideoTrack);we.publish(this.store.sessionId,{eventElapse:ai.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.track.getTrackLabel(),videoName:h==null?void 0:h.track.getTrackLabel(),screenshare:(h==null?void 0:h.track._hints.indexOf(dn.SCREEN_TRACK))!==-1,audio:!!d,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}else{var u;n||(n=[]);const d=n.find(p=>p instanceof jn),h=i?(u=this.localTrackMap.get(Se.LocalVideoTrack))===null||u===void 0?void 0:u.track:n.find(p=>p instanceof en);we.publish(this.store.sessionId,{eventElapse:ai.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.getTrackLabel(),videoName:h==null?void 0:h.getTrackLabel(),screenshare:(h==null?void 0:h._hints.indexOf(dn.SCREEN_TRACK))!==-1,audio:!!d,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}}reportSubscribeEvent(e,t,n,i){const s=i===je.VIDEO?n._videoSSRC:n._audioSSRC;s&&we.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===je.VIDEO,audio:i===je.AUDIO,peerid:n.uid,subscribeRequestid:i===je.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:ai.measureFromSubscribeStart(this.store.clientId,s)})}reset(){I.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new nr("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new As({},this.store):this.isPlanB?new gd({},this.store):new Ho({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Se.LocalAudioTrack);if((e==null?void 0:e.track)instanceof gr){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=ln.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Se.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Se.LocalVideoTrack);if(e)return{width:e.track._videoWidth||0,height:e.track._videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof en||t&&t.track instanceof jn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Sa(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(Se.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=jm(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.connection&&(I.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=ln.Reconnecting,H("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new As({},this.store):this.isPlanB?new gd({},this.store):new Ho({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;switch(t){case Se.LocalVideoTrack:n._hints.includes(dn.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case Se.LocalAudioTrack:n instanceof gr?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);break;case Se.LocalVideoLowTrack:}}),this.emit(Ze.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Sa(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Ze.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),I.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:s}=n;if((e instanceof OE?e.uid:e)===i.uid&&t===s)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return wi(function*(){if(!t.connection||t.state!==ln.Connected||t.connection instanceof As)return;const n=yield Je(t.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield Je(t.connection.restartICE(e));const u=yield Je(i.next());if(u.done)return;const d=u.value,h=yield d;switch(t.reportPCDisconnectedOrFailed(e),e){case On.TCP:t._pcStatsUploadType=Ki.TCP_RESTART;break;case On.RELAY:t._pcStatsUploadType=Ki.RELAY_RESTART;break;default:t._pcStatsUploadType=Ki.OLD_RESTART}t._isInRestartIce=!0,i.next(h)}catch(u){var s;(s=i)===null||s===void 0||s.throw(u)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(Se.LocalVideoTrack),n=this.localTrackMap.get(Se.LocalAudioTrack),i=e.videoSend.find(A=>A.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),s=e.audioSend.find(A=>A.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!s)return 1;const u=qi(this,Ze.NeedSignalRTT),d=i?i.rttMs:void 0,h=s?s.rttMs:void 0,p=d&&h?(d+h)/2:d||h,m=(p&&u?(p+u)/2:p||u)||0,_=100*e.sendPacketLossRate*.7/50+.3*m/1500,E=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,y=t==null?void 0:t.track;if(y&&y._encoderConfig&&y._hints.indexOf(dn.SCREEN_TRACK)===-1){const A=y._encoderConfig.bitrateMax,k=e.bitrate.actualEncoded;if(A&&k){const L=(1e3*A-k)/(1e3*A);return Gj[L<.15?0:L<.3?1:L<.45?2:L<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const s=i._audioSSRC,u=i._videoSSRC,d=e.audioRecv.find(k=>k.ssrc===s),h=e.videoRecv.find(k=>k.ssrc===u);if(!d&&!h)return void(t+=1);const p=qi(this,Ze.NeedSignalRTT),m=e.rtt,_=(m&&p?(m+p)/2:m||p)||0,E=d?d.jitterMs:void 0,y=e.recvPacketLossRate;let A=.7*y*100/50+.3*_/1500;E&&(A=.6*y*100/50+.2*_/1500+.2*E/400),t+=A<.1?1:A<.17?2:A<.36?3:A<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Ee((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const i=[],s=Jt(),u=this.getAllTracks();e=BA(e=e.filter(p=>u.indexOf(p)===-1));let d=!1,h=!1;for(const p of e){if(p instanceof en&&(this.localTrackMap.has(Se.LocalVideoTrack)||d?new V(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:p,type:Se.LocalVideoTrack}),d=!0),t)){const m=this.getLowVideoTrack(p,n);i.push({track:m,type:Se.LocalVideoLowTrack})}if(p instanceof jn){const m=this.localTrackMap.get(Se.LocalAudioTrack);if(m){if(!(m.track instanceof gr))throw new V(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(p._bypassWebAudio)throw new V(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(p),this.bindLocalAudioTrackEvents(p,!0)}else if(h){const _=i.find(E=>{let{type:y}=E;return y===Se.LocalAudioTrack});if(!(_.track instanceof gr))throw new V(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(p._bypassWebAudio)throw new V(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(p)}else{if(!s.webAudioMediaStreamDest||p instanceof gr||p._bypassWebAudio)i.push({track:p,type:Se.LocalAudioTrack});else{const _=new gr;_.addAudioTrack(p),i.push({track:_,type:Se.LocalAudioTrack})}h=!0}}}return i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=BA(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof jn){const s=this.localTrackMap.get(Se.LocalAudioTrack);if(!s)continue;s.track instanceof gr?(s.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),s.track.trackList.length===0&&(t.push([Se.LocalAudioTrack,s]),s.track.close())):t.push([Se.LocalAudioTrack,s])}if(i instanceof en){const s=this.localTrackMap.get(Se.LocalVideoTrack);if(!s)continue;t.push([Se.LocalVideoTrack,s]);const u=this.localTrackMap.get(Se.LocalVideoLowTrack);u&&t.push([Se.LocalVideoLowTrack,u])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case Se.LocalVideoTrack:n.addListener(Le.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Le.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Le.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),n.addListener(Le.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Se.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);break;case Se.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof gr?e.trackList.forEach(n=>{n.addListener(Le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Le.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Le.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Le.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case Se.LocalVideoTrack:n.off(Le.GET_STATS,this.handleGetLocalVideoStats),n.off(Le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Le.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Le.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),n.off(Le.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Se.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);break;case Se.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof gr?e.trackList.forEach(t=>{t.off(Le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Le.GET_STATS,this.handleGetLocalAudioStats),t.off(Le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Le.GET_STATS,this.handleGetLocalAudioStats),e.off(Le.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Le.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Le.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Le.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Le.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof hp&&t.addListener(Le.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof pp&&t.addListener(Le.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Le.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(je.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(je.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{let s,u,{track:d,type:h}=n;switch(h){case Se.LocalAudioTrack:s=sn.Audio,u={dtx:d instanceof zh&&d._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Se.LocalVideoTrack:s=d._hints.includes(dn.SCREEN_TRACK)?sn.Screen:sn.High,u=ws(ws({},xA(d)),{},{codec:this.store.codec});break;case Se.LocalVideoLowTrack:s=sn.Low,u=ws(ws({},xA(d)),{},{codec:this.store.codec})}return{stream_type:s,attributes:u,ssrcs:t[i]}})}createGatewayUnpublishMessage(e){return e.map(t=>{let n,[i,{track:s,ssrcs:u,id:d}]=t;switch(i){case Se.LocalVideoTrack:n=s._hints.includes(dn.SCREEN_TRACK)?sn.Screen:sn.High;break;case Se.LocalAudioTrack:n=sn.Audio;break;case Se.LocalVideoLowTrack:n=sn.Low}return{stream_type:n,ssrcs:u,mid:d}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:s,type:u}=n;this.localTrackMap.set(u,{track:s,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Ze.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),H("NEW_ICE_RESTART")){if(this._restartStates.includes(t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=u=>{(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")&&(I.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(u)),qi(this,Ze.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ze.RequestRestartICE,u))},i=()=>{e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="checking"&&e.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),I.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Ze.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},s=H("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(H("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Jt().supportPCSetConfiguration)n(On.RELAY),this._restartTimer=window.setTimeout(i,s);else if(Bt())n(On.UDP),this._restartTimer=window.setTimeout(i,4e3);else{if(n(On.TCP),Jt().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{n(On.RELAY),this._restartTimer=window.setTimeout(i,s)},s));this._restartTimer=window.setTimeout(i,s)}},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&H("ICE_RESTART")&&qi(this,Ze.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ze.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(Ze.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(Ze.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),we.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Ut.TRACER}).onSuccess(),this.emit(Ze.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(Sa(n=this.remoteUserMap).call(n)).find(u=>u._audioSSRC===t);var s;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(s=i.audioTrack)===null||s===void 0||s.emit(Cc.FIRST_FRAME_DECODED),we.firstRemoteFrame(this.store.sessionId,wn.FIRST_AUDIO_DECODE,Mt.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:ai.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(Sa(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===t);i&&we.firstRemoteFrame(this.store.sessionId,wn.FIRST_AUDIO_RECEIVED,Mt.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:ai.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoReceived=t=>{var n;const i=Array.from(Sa(n=this.remoteUserMap).call(n)).find(s=>s._videoSSRC===t);i&&we.firstRemoteFrame(this.store.sessionId,wn.FIRST_VIDEO_RECEIVED,Mt.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:ai.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",s=n.candidateType==="relay";n.candidateType!=="unknown"&&i===s||this.emit(Ze.ConnectionTypeChange,i),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Jh(n))," -> ").concat(JSON.stringify(Jh(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Jh(n))," -> ").concat(JSON.stringify(Jh(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(Se.LocalAudioTrack);if(e instanceof jn&&(n==null?void 0:n.track)instanceof gr)return n.track.isActive||t.push([Se.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:u}]=s;return e===u});if(i&&(t.push(i),i[0]===Se.LocalVideoTrack)){const s=this.localTrackMap.get(Se.LocalVideoLowTrack);s&&t.push([Se.LocalVideoLowTrack,s])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(Se.LocalAudioTrack);if(e instanceof jn&&(n==null?void 0:n.track)instanceof gr)return n.track.isActive&&t.push([Se.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:u}]=s;return e===u});if(i)if(i[0]===Se.LocalVideoTrack){t.push(i);const s=this.localTrackMap.get(Se.LocalVideoLowTrack);s&&t.push([Se.LocalVideoLowTrack,s])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{let n,[i,{track:s,ssrcs:u,id:d}]=t;switch(i){case Se.LocalAudioTrack:n=sn.Audio;break;case Se.LocalVideoTrack:n=s._hints.includes(dn.SCREEN_TRACK)?sn.Screen:sn.High;break;case Se.LocalVideoLowTrack:n=sn.Low}return{stream_type:n,ssrcs:u,mid:d}})}createUnmuteMessage(e){return e.map(t=>{let n,[i,{track:s,ssrcs:u,id:d}]=t;switch(i){case Se.LocalAudioTrack:n=sn.Audio;break;case Se.LocalVideoTrack:n=s._hints.includes(dn.SCREEN_TRACK)?sn.Screen:sn.High;break;case Se.LocalVideoLowTrack:n=sn.Low}return{stream_type:n,ssrcs:u,mid:d}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const s=i.get(t);if(!s)return n;n.push([e,{kind:t,id:s}])}else Array.from(i.entries()).forEach(s=>{let[u,d]=s;n.push([e,{kind:u,id:d}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:s,id:u}]=n;switch(s){case je.VIDEO:return void(i._videoSSRC&&t.push({stream_type:je.VIDEO,ssrcId:i._videoSSRC}));case je.AUDIO:return void(i._audioSSRC&&t.push({stream_type:je.AUDIO,ssrcId:i._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[i,{kind:s}]=n;if(t.has(i)){let u=t.get(i);s===je.VIDEO?u|=Qt.Video:u|=Qt.Audio,t.set(i,u)}else s===je.VIDEO?t.set(i,Qt.Video):t.set(i,Qt.Audio)}),{users:Array.from(t.entries()).map(n=>{let[i,s]=n;return{stream_id:i.uid,stream_type:s}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const s=this.remoteUserMap.get(n);s&&(s.delete(i),Array.from(s.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(Se.LocalVideoTrack),n=this.localTrackMap.get(Se.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t){return e.map((n,i)=>{var s;let{stream_type:u}=n;return(s=t.find(d=>{let{stream_type:h}=d;return u===h}))===null||s===void 0?void 0:s.attributes})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof jn){var t;const i=this.filterTobeUnmutedTracks(e[n]);if(i.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(i.map(u=>{let[,{id:d}]=u;return d})));const s=this.createUnmuteMessage(i);return void await Wt(this,Ze.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Ze.RequestUploadStats,e,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Fn(Nm(this.dtlsFailedCount,un)),this.emit(Ze.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Gn(this,Ze.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Ze.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Se.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof en)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof en).length>1)throw new V(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof jn).length>1&&(e.some(t=>t instanceof jn&&t._bypassWebAudio)||!Jt().webAudioMediaStreamDest))throw new V(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof en&&this.pendingLocalTracks.some(n=>n instanceof en))throw new V(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof jn&&this.pendingLocalTracks.some(n=>n instanceof jn)&&(!Jt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof jn&&n._bypassWebAudio)))throw new V(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=Jt().supportDualStreamEncoding,i=ws(ws({},{width:160,height:120,framerate:15,bitrate:50}),t);let s;s=n?e._mediaStreamTrack.clone():cb(e,i);const u=bt(8,"track-low-"),d=new en(s,ws(ws({},n&&{scaleResolutionDownBy:K3(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,u);return d.on(rd.TRANSCEIVER_UPDATED,h=>{e._updateRtpTransceiver(h,Rc.LOW_STREAM)}),d._hints.push(dn.LOW_STREAM),e.addListener(Le.NEED_CLOSE,()=>{d.close()}),d}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ho){var s,u,d,h;const p=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:m,dtlsTransportState:_,peerConnectionState:E}=this.connection,{local:y,remote:A}=await this.connection.getSelectedCandidatePair();we.pcStats(this.store.sessionId,{startTime:p,eventElapse:e-p||0,iceconnectionsate:m,dtlsstate:_,connectionstate:E,intSucc:t?1:2,error:i,selectedLocalCandidateProtocol:(s=y==null?void 0:y.protocol)!==null&&s!==void 0?s:"",selectedLocalCandidateType:(u=y.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(y.address,":").concat(y.port),selectedRemoteCandidateProtocol:(d=A.protocol)!==null&&d!==void 0?d:"",selectedRemoteCandidateType:(h=A.candidateType)!==null&&h!==void 0?h:"",selectedRemoteCandidateAddress:"".concat(A.address,":").concat(A.port),restartCnt:n})}}reportVideoFirstFrameDecoded(e,t,n,i){var s;const u=Array.from(Sa(s=this.remoteUserMap).call(s)).find(d=>d._videoSSRC===e);if(u){i||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const d=this.store.keyMetrics,h=d.subscribe.find(p=>p.userId===u.uid&&p.type==="video");we.firstRemoteVideoDecode(this.store.sessionId,wn.FIRST_VIDEO_DECODE,Mt.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:t,videoheight:n,subscribeElapse:ai.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:d.requestAPEnd||0,apStart:d.requestAPStart||0,joinGwEnd:d.joinGatewayEnd||0,joinGwStart:d.joinGatewayStart||0,pcEnd:d.peerConnectionEnd||0,pcStart:d.peerConnectionStart||0,subscriberEnd:(h==null?void 0:h.subscribeEnd)||0,subscriberStart:(h==null?void 0:h.subscribeStart)||0,videoAddNotify:(h==null?void 0:h.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const s=i.get(t);if(!s)return!1;const u=await this.connection.getRemoteSSRC(s);return u!==void 0&&u!==n}resetConnection(e){I.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(e)),this.state===ln.Connected?(I.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===Vh.datachannel?new As({},this.store):this.isPlanB?new gd({},this.store):new Ho({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===Se.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Rc.LOW_STREAM):n._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof Ho&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===Ki.TCP_RESTART&&e===On.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,Ki.DISCONNECTED_OR_FAILED)))}}).prototype,"startP2PConnection",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"startP2PConnection"),rt.prototype),ne(rt.prototype,"connect",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"connect"),rt.prototype),ne(rt.prototype,"preConnect",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"preConnect"),rt.prototype),ne(rt.prototype,"unpublish",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"unpublish"),rt.prototype),ne(rt.prototype,"unpublishLowStream",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"unpublishLowStream"),rt.prototype),ne(rt.prototype,"subscribe",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"subscribe"),rt.prototype),ne(rt.prototype,"massSubscribe",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"massSubscribe"),rt.prototype),ne(rt.prototype,"unsubscribe",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"unsubscribe"),rt.prototype),ne(rt.prototype,"massUnsubscribe",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"massUnsubscribe"),rt.prototype),ne(rt.prototype,"muteRemote",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"muteRemote"),rt.prototype),ne(rt.prototype,"unmuteRemote",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"unmuteRemote"),rt.prototype),ne(rt.prototype,"hasRemoteMediaWithLock",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"hasRemoteMediaWithLock"),rt.prototype),ne(rt.prototype,"disconnectForReconnect",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"disconnectForReconnect"),rt.prototype),ne(rt.prototype,"updateBitrateLimit",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"updateBitrateLimit"),rt.prototype),ne(rt.prototype,"remoteMediaSsrcChanged",[Pr],Object.getOwnPropertyDescriptor(rt.prototype,"remoteMediaSsrcChanged"),rt.prototype),rt);function Pr(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,u=await s.lock("From P2PChannel.".concat(t));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await i.apply(this,h)}finally{u()}},n}function Nb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function ye(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Nb(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nb(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var ze;(function(e){e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL"})(ze||(ze={}));class p6{constructor(t,n,i,s){g(this,"state",void 0),this.state={codec:t,audioCodec:n,mode:i,clientId:s,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1}}dispatch(t){this.state=function(n,i){switch(i.type){case ze.SET_SESSION_ID:return ye(ye({},n),{},{sessionId:i.sessionId});case ze.SET_P2P_ID:return ye(ye({},n),{},{p2pId:i.p2pId});case ze.SET_UID:return ye(ye({},n),{},{uid:i.uid});case ze.SET_PUB_ID:return ye(ye({},n),{},{pubId:i.pubId});case ze.KEY_METRIC_CLIENT_CREATED:return ye(ye({},n),{},{keyMetrics:ye(ye({},n.keyMetrics),{},{clientCreated:i.metric})});case ze.KEY_METRIC_JOIN_START:return ye(ye({},n),{},{keyMetrics:ye(ye({},n.keyMetrics),{},{joinStart:i.metric})});case ze.AVOID_JOIN_START:return ye(ye({},n),{},{avoidJoinStart:i.avoidJoinStart});case ze.KEY_METRIC_JOIN_END:return ye(ye({},n),{},{keyMetrics:ye(ye({},n.keyMetrics),{},{joinEnd:i.metric})});case ze.KEY_METRIC_REQUEST_AP_START:return ye(ye({},n),{},{keyMetrics:ye(ye({},n.keyMetrics),{},{requestAPStart:i.metric})});case ze.KEY_METRIC_REQUEST_AP_END:return ye(ye({},n),{},{keyMetrics:ye(ye({},n.keyMetrics),{},{requestAPEnd:i.metric})});case ze.KEY_METRIC_JOIN_GATEWAY_START:return ye(ye({},n),{},{keyMetrics:ye(ye({},n.keyMetrics),{},{joinGatewayStart:i.metric})});case ze.KEY_METRIC_JOIN_GATEWAY_END:return ye(ye({},n),{},{keyMetrics:ye(ye({},n.keyMetrics),{},{joinGatewayEnd:i.metric})});case ze.KEY_METRIC_PEER_CONNECTION_START:return ye(ye({},n),{},{keyMetrics:ye(ye({},n.keyMetrics),{},{peerConnectionStart:i.metric})});case ze.KEY_METRIC_PEER_CONNECTION_END:return ye(ye({},n),{},{keyMetrics:ye(ye({},n.keyMetrics),{},{peerConnectionEnd:i.metric})});case ze.KEY_METRIC_DESCRIPTION_START:return ye(ye({},n),{},{keyMetrics:ye(ye({},n.keyMetrics),{},{descriptionStart:i.metric})});case ze.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ye(ye({},n),{},{keyMetrics:ye(ye({},n.keyMetrics),{},{signalChannelOpen:i.metric})});case ze.KEY_METRIC_ICE_CONNECTION_END:return ye(ye({},n),{},{keyMetrics:ye(ye({},n.keyMetrics),{},{iceConnectionEnd:i.metric})});case ze.KEY_METRIC_PUBLISH:{const s=n.keyMetrics.publish,u=s.findIndex(d=>d.trackId===i.metric.trackId);return u!==-1?(s[u]=ye(ye({},s[u]),i.metric),ye(ye({},n),{},{keyMetrics:ye(ye({},n.keyMetrics),{},{publish:[...s]})})):ye(ye({},n),{},{keyMetrics:ye(ye({},n.keyMetrics),{},{publish:[...n.keyMetrics.publish,i.metric]})})}case ze.KEY_METRIC_SUBSCRIBE:{const s=n.keyMetrics.subscribe,u=s.findIndex(d=>d.userId===i.metric.userId&&d.type===i.metric.type);return u!==-1?(s[u]=ye(ye({},s[u]),i.metric),ye(ye({},n),{},{keyMetrics:ye(ye({},n.keyMetrics),{},{subscribe:[...s]})})):ye(ye({},n),{},{keyMetrics:ye(ye({},n.keyMetrics),{},{subscribe:[...n.keyMetrics.subscribe,i.metric]})})}case ze.SET_CLOUD_PROXY_SERVER_MODE:return n.cloudProxyServerMode=i.mode,n;case ze.RECORD_JOIN_CHANNEL_SERVICE:return typeof i.index!="number"?n.joinChannelServiceRecords=[...n.joinChannelServiceRecords,i.record]:(n.joinChannelServiceRecords[i.index]=ye(ye({},n.joinChannelServiceRecords[i.index]),i.record),n.joinChannelServiceRecords=[...n.joinChannelServiceRecords]),n;case ze.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return n.joinChannelServiceRecords=[],n;case ze.RESET_KEY_METRICS:return n.keyMetrics={publish:[],subscribe:[]},n;case ze.SET_USE_DATACHANNEL:return ye(ye({},n),{},{useDataChannel:i.val});default:return n}}(this.state,t)}set sessionId(t){this.dispatch({type:ze.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:ze.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:ze.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:ze.SET_UID,uid:t})}get uid(){return this.state.uid}set pubId(t){this.dispatch({type:ze.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:ze.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(t){this.dispatch({type:ze.SET_USE_DATACHANNEL,val:t})}get useDataChannel(){return this.state.useDataChannel}clientCreated(){this.dispatch({type:ze.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ze.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:ze.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ze.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ze.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ze.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ze.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ze.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ze.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:ze.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ze.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ze.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,n,i,s){this.dispatch({type:ze.KEY_METRIC_PUBLISH,metric:ye(ye({trackId:t,type:n},i&&{publishStart:i}),s&&{publishEnd:s})})}subscribe(t,n,i,s,u,d,h){this.dispatch({type:ze.KEY_METRIC_SUBSCRIBE,metric:ye(ye(ye(ye(ye({userId:t,type:n},i&&{subscribeStart:i}),s&&{subscribeEnd:s}),u&&{firstFrame:u}),d&&{streamAdded:d}),h&&{firstDecoded:h})})}massSubscribe(t,n,i,s){t.forEach(u=>{this.dispatch({type:ze.KEY_METRIC_SUBSCRIBE,metric:ye(ye(ye({userId:u.userId,type:u.type},n&&{subscribeStart:n}),i&&{subscribeEnd:i}),s&&{firstFrame:s})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,n){t.service==="gateway"&&Array.isArray(t.urls)&&(t.urls=t.urls.map(i=>i.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof n!="number"?(this.dispatch({type:ze.RECORD_JOIN_CHANNEL_SERVICE,record:ye(ye({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(n<0||n>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ze.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:n}),n)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ze.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ze.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:ze.AVOID_JOIN_START,avoidJoinStart:t})}}let mp;const f6=()=>(mp||mp||(mp=(window.location.protocol.split(":")[0]||"").toUpperCase(),mp))==="HTTPS",Pb=()=>window.isSecureContext!==void 0;function _6(e){let t=Lb();return function(n,i){let s=n.appId;s!==void 0&&(it(i,10),vo(i,s));let u=n.cid;u!==void 0&&(it(i,16),it(i,u));let d=n.cname;d!==void 0&&(it(i,26),vo(i,d));let h=n.deviceId;h!==void 0&&(it(i,34),vo(i,h));let p=n.elapse;p!==void 0&&(it(i,40),Os(i,p));let m=n.fileSize;m!==void 0&&(it(i,48),Os(i,Vc(m)));let _=n.height;_!==void 0&&(it(i,56),Os(i,Vc(_)));let E=n.jpg;E!==void 0&&(it(i,66),it(i,E.length),function(Tr,Z){let re=Bc(Tr,Z.length);Tr.bytes.set(Z,re)}(i,E));let y=n.networkType;y!==void 0&&(it(i,72),Os(i,Vc(y)));let A=n.osType;A!==void 0&&(it(i,80),Os(i,Vc(A)));let k=n.requestId;k!==void 0&&(it(i,90),vo(i,k));let L=n.sdkVersion;L!==void 0&&(it(i,98),vo(i,L));let x=n.sequence;x!==void 0&&(it(i,104),Os(i,Vc(x)));let z=n.sid;z!==void 0&&(it(i,114),vo(i,z));let X=n.timestamp;X!==void 0&&(it(i,120),Os(i,X));let ie=n.uid;ie!==void 0&&(it(i,128),it(i,ie));let Ie=n.vid;Ie!==void 0&&(it(i,136),it(i,Ie));let se=n.width;se!==void 0&&(it(i,144),Os(i,Vc(se)));let de=n.service;de!==void 0&&(it(i,152),it(i,de));let oe=n.callbackData;oe!==void 0&&(it(i,162),vo(i,oe));let ve=n.jpgEncryption;ve!==void 0&&(it(i,168),it(i,ve));let pt=n.requestType;pt!==void 0&&(it(i,176),it(i,pt));let Be=n.scorePorn;Be!==void 0&&(it(i,185),av(i,Be));let At=n.scoreSexy;At!==void 0&&(it(i,193),av(i,At));let gt=n.scoreNeutral;gt!==void 0&&(it(i,201),av(i,gt));let Xt=n.scene;Xt!==void 0&&(it(i,208),it(i,Xt));let Nn=n.ossFilePrefix;Nn!==void 0&&(it(i,218),vo(i,Nn));let Yt=n.serviceVendor;if(Yt!==void 0)for(let Tr of Yt){it(i,226);let Z=Lb();v6(Tr,Z),it(i,Z.limit),y6(i,Z),T6(Z)}}(e,t),function(n){let i=n.bytes,s=n.limit;return i.length===s?i:i.subarray(0,s)}(t)}function m6(e){return function(n){let i={};e:for(;!xb(n);){let s=go(n);switch(s>>>3){case 0:break e;case 1:i.code=go(n);break;case 2:i.msg=Mb(n,go(n));break;case 3:{let u=g6(n);i.data=E6(n),n.limit=u;break}default:Db(n,7&s)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function E6(e){let t={};e:for(;!xb(e);){let n=go(e);switch(n>>>3){case 0:break e;case 1:t.requestId=Mb(e,go(e));break;case 2:t.requestType=go(e)>>>0;break;case 3:t.scorePorn=sv(e);break;case 4:t.scoreSexy=sv(e);break;case 5:t.scoreNeutral=sv(e);break;case 6:t.requestScene=go(e)>>>0;break;case 7:t.scene=go(e)>>>0;break;default:Db(e,7&n)}}return t}function v6(e,t){let n=e.service;n!==void 0&&(it(t,8),it(t,n));let i=e.vendor;i!==void 0&&(it(t,16),it(t,i));let s=e.token;s!==void 0&&(it(t,26),vo(t,s));let u=e.callbackUrl;u!==void 0&&(it(t,34),vo(t,u))}function g6(e){let t=go(e),n=e.limit;return e.limit=e.offset+t,n}function Db(e,t){switch(t){case 0:for(;128&Ub(e););break;case 2:iv(e,go(e));break;case 5:iv(e,4);break;case 1:iv(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let S6=new Float32Array(1);new Uint8Array(S6.buffer);let rv=new Float64Array(1),Sr=new Uint8Array(rv.buffer);function Vc(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let kb=[];function Lb(){const e=kb.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function T6(e){kb.push(e)}function iv(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function xb(e){return e.offset>=e.limit}function Bc(e,t){let n=e.bytes,i=e.offset,s=e.limit,u=i+t;if(u>n.length){let d=new Uint8Array(2*u);d.set(n),e.bytes=d}return e.offset=u,u>s&&(e.limit=u),i}function ov(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function Mb(e,t){let n=ov(e,t),i=String.fromCharCode,s=e.bytes,u="�",d="";for(let h=0;h<t;h++){let p,m,_,E,y=s[h+n];128&y?(224&y)==192?h+1>=t?d+=u:(p=s[h+n+1],(192&p)!=128?d+=u:(E=(31&y)<<6|63&p,E<128?d+=u:(d+=i(E),h++))):(240&y)==224?h+2>=t?d+=u:(p=s[h+n+1],m=s[h+n+2],(49344&(p|m<<8))!=32896?d+=u:(E=(15&y)<<12|(63&p)<<6|63&m,E<2048||E>=55296&&E<=57343?d+=u:(d+=i(E),h+=2))):(248&y)==240?h+3>=t?d+=u:(p=s[h+n+1],m=s[h+n+2],_=s[h+n+3],(12632256&(p|m<<8|_<<16))!=8421504?d+=u:(E=(7&y)<<18|(63&p)<<12|(63&m)<<6|63&_,E<65536||E>1114111?d+=u:(E-=65536,d+=i(55296+(E>>10),56320+(1023&E)),h+=3))):d+=u:d+=i(y)}return d}function vo(e,t){let n=t.length,i=0;for(let d=0;d<n;d++){let h=t.charCodeAt(d);h>=55296&&h<=56319&&d+1<n&&(h=(h<<10)+t.charCodeAt(++d)-56613888),i+=h<128?1:h<2048?2:h<65536?3:4}it(e,i);let s=Bc(e,i),u=e.bytes;for(let d=0;d<n;d++){let h=t.charCodeAt(d);h>=55296&&h<=56319&&d+1<n&&(h=(h<<10)+t.charCodeAt(++d)-56613888),h<128?u[s++]=h:(h<2048?u[s++]=h>>6&31|192:(h<65536?u[s++]=h>>12&15|224:(u[s++]=h>>18&7|240,u[s++]=h>>12&63|128),u[s++]=h>>6&63|128),u[s++]=63&h|128)}}function y6(e,t){let n=Bc(e,t.limit),i=e.bytes,s=t.bytes;for(let u=0,d=t.limit;u<d;u++)i[u+n]=s[u]}function Ub(e){return e.bytes[ov(e,1)]}function Vb(e,t){let n=Bc(e,1);e.bytes[n]=t}function sv(e){let t=ov(e,8),n=e.bytes;return Sr[0]=n[t++],Sr[1]=n[t++],Sr[2]=n[t++],Sr[3]=n[t++],Sr[4]=n[t++],Sr[5]=n[t++],Sr[6]=n[t++],Sr[7]=n[t++],rv[0]}function av(e,t){let n=Bc(e,8),i=e.bytes;rv[0]=t,i[n++]=Sr[0],i[n++]=Sr[1],i[n++]=Sr[2],i[n++]=Sr[3],i[n++]=Sr[4],i[n++]=Sr[5],i[n++]=Sr[6],i[n++]=Sr[7]}function go(e){let t,n=0,i=0;do t=Ub(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function it(e,t){for(t>>>=0;t>=128;)Vb(e,127&t|128),t>>>=7;Vb(e,t)}function Os(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,u=s===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:s<128?9:10,d=Bc(e,u),h=e.bytes;switch(u){case 10:h[d+9]=s>>>7&1;case 9:h[d+8]=u!==9?128|s:127&s;case 8:h[d+7]=u!==8?i>>>21|128:i>>>21&127;case 7:h[d+6]=u!==7?i>>>14|128:i>>>14&127;case 6:h[d+5]=u!==6?i>>>7|128:i>>>7&127;case 5:h[d+4]=u!==5?128|i:127&i;case 4:h[d+3]=u!==4?n>>>21|128:n>>>21&127;case 3:h[d+2]=u!==3?n>>>14|128:n>>>14&127;case 2:h[d+1]=u!==2?n>>>7|128:n>>>7&127;case 1:h[d]=u!==1?128|n:127&n}}const R6=async(e,t,n)=>{const i=function(d){const h=[];for(let p=0;p<d.length;p+=2)h.push(parseInt(d.slice(p,p+2),16));return Uint8Array.from(h)}(function(d){const h="0123456789abcdef";function p(pt){let Be,At="";for(Be=0;Be<=3;Be++)At+=h.charAt(pt>>8*Be+4&15)+h.charAt(pt>>8*Be&15);return At}function m(pt,Be){const At=(65535&pt)+(65535&Be);return(pt>>16)+(Be>>16)+(At>>16)<<16|65535&At}function _(pt,Be,At,gt,Xt,Nn){return m(function(Yt,Tr){return Yt<<Tr|Yt>>>32-Tr}(m(m(Be,pt),m(gt,Nn)),Xt),At)}function E(pt,Be,At,gt,Xt,Nn,Yt){return _(Be&At|~Be&gt,pt,Be,Xt,Nn,Yt)}function y(pt,Be,At,gt,Xt,Nn,Yt){return _(Be&gt|At&~gt,pt,Be,Xt,Nn,Yt)}function A(pt,Be,At,gt,Xt,Nn,Yt){return _(Be^At^gt,pt,Be,Xt,Nn,Yt)}function k(pt,Be,At,gt,Xt,Nn,Yt){return _(At^(Be|~gt),pt,Be,Xt,Nn,Yt)}const L=function(pt){let Be;const At=1+(pt.length+8>>6),gt=new Array(16*At);for(Be=0;Be<16*At;Be++)gt[Be]=0;for(Be=0;Be<pt.length;Be++)gt[Be>>2]|=pt.charCodeAt(Be)<<Be%4*8;return gt[Be>>2]|=128<<Be%4*8,gt[16*At-2]=8*pt.length,gt}(d);let x,z,X,ie,Ie,se=1732584193,de=-271733879,oe=-1732584194,ve=271733878;for(x=0;x<L.length;x+=16)z=se,X=de,ie=oe,Ie=ve,se=E(se,de,oe,ve,L[x+0],7,-680876936),ve=E(ve,se,de,oe,L[x+1],12,-389564586),oe=E(oe,ve,se,de,L[x+2],17,606105819),de=E(de,oe,ve,se,L[x+3],22,-1044525330),se=E(se,de,oe,ve,L[x+4],7,-176418897),ve=E(ve,se,de,oe,L[x+5],12,1200080426),oe=E(oe,ve,se,de,L[x+6],17,-1473231341),de=E(de,oe,ve,se,L[x+7],22,-45705983),se=E(se,de,oe,ve,L[x+8],7,1770035416),ve=E(ve,se,de,oe,L[x+9],12,-1958414417),oe=E(oe,ve,se,de,L[x+10],17,-42063),de=E(de,oe,ve,se,L[x+11],22,-1990404162),se=E(se,de,oe,ve,L[x+12],7,1804603682),ve=E(ve,se,de,oe,L[x+13],12,-40341101),oe=E(oe,ve,se,de,L[x+14],17,-1502002290),de=E(de,oe,ve,se,L[x+15],22,1236535329),se=y(se,de,oe,ve,L[x+1],5,-165796510),ve=y(ve,se,de,oe,L[x+6],9,-1069501632),oe=y(oe,ve,se,de,L[x+11],14,643717713),de=y(de,oe,ve,se,L[x+0],20,-373897302),se=y(se,de,oe,ve,L[x+5],5,-701558691),ve=y(ve,se,de,oe,L[x+10],9,38016083),oe=y(oe,ve,se,de,L[x+15],14,-660478335),de=y(de,oe,ve,se,L[x+4],20,-405537848),se=y(se,de,oe,ve,L[x+9],5,568446438),ve=y(ve,se,de,oe,L[x+14],9,-1019803690),oe=y(oe,ve,se,de,L[x+3],14,-187363961),de=y(de,oe,ve,se,L[x+8],20,1163531501),se=y(se,de,oe,ve,L[x+13],5,-1444681467),ve=y(ve,se,de,oe,L[x+2],9,-51403784),oe=y(oe,ve,se,de,L[x+7],14,1735328473),de=y(de,oe,ve,se,L[x+12],20,-1926607734),se=A(se,de,oe,ve,L[x+5],4,-378558),ve=A(ve,se,de,oe,L[x+8],11,-2022574463),oe=A(oe,ve,se,de,L[x+11],16,1839030562),de=A(de,oe,ve,se,L[x+14],23,-35309556),se=A(se,de,oe,ve,L[x+1],4,-1530992060),ve=A(ve,se,de,oe,L[x+4],11,1272893353),oe=A(oe,ve,se,de,L[x+7],16,-155497632),de=A(de,oe,ve,se,L[x+10],23,-1094730640),se=A(se,de,oe,ve,L[x+13],4,681279174),ve=A(ve,se,de,oe,L[x+0],11,-358537222),oe=A(oe,ve,se,de,L[x+3],16,-722521979),de=A(de,oe,ve,se,L[x+6],23,76029189),se=A(se,de,oe,ve,L[x+9],4,-640364487),ve=A(ve,se,de,oe,L[x+12],11,-421815835),oe=A(oe,ve,se,de,L[x+15],16,530742520),de=A(de,oe,ve,se,L[x+2],23,-995338651),se=k(se,de,oe,ve,L[x+0],6,-198630844),ve=k(ve,se,de,oe,L[x+7],10,1126891415),oe=k(oe,ve,se,de,L[x+14],15,-1416354905),de=k(de,oe,ve,se,L[x+5],21,-57434055),se=k(se,de,oe,ve,L[x+12],6,1700485571),ve=k(ve,se,de,oe,L[x+3],10,-1894986606),oe=k(oe,ve,se,de,L[x+10],15,-1051523),de=k(de,oe,ve,se,L[x+1],21,-2054922799),se=k(se,de,oe,ve,L[x+8],6,1873313359),ve=k(ve,se,de,oe,L[x+15],10,-30611744),oe=k(oe,ve,se,de,L[x+6],15,-1560198380),de=k(de,oe,ve,se,L[x+13],21,1309151649),se=k(se,de,oe,ve,L[x+4],6,-145523070),ve=k(ve,se,de,oe,L[x+11],10,-1120210379),oe=k(oe,ve,se,de,L[x+2],15,718787259),de=k(de,oe,ve,se,L[x+9],21,-343485551),se=m(se,z),de=m(de,X),oe=m(oe,ie),ve=m(ve,Ie);return p(se)+p(de)+p(oe)+p(ve)}(""+t+n)).slice(0,16),s=i.slice(0,12),u=await window.crypto.subtle.importKey("raw",i,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s},u,e))};function Bb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}const C6=new Map([["moderation",1],["supervise",2]]);class Ep extends jt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(an.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=hs(n=t.map(i=>C6.get(i)||0)).call(n,(i,s)=>i+s),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),g(this,"name","AgoraRTCVideoContentInspect"),g(this,"_connectionState",Gr.CONNECTING),g(this,"_innerConnectionState",void 0),g(this,"sequence",0),g(this,"inspectStartTime",void 0),g(this,"workerManagerConnection",void 0),g(this,"workerConnection",void 0),g(this,"workerMessageLengthLimit",void 0),g(this,"inspectIntervalMinimum",void 0),g(this,"qualityRatio",void 0),g(this,"_connectInfo",void 0),g(this,"_cancelTokenSource",Ri.CancelToken.source()),g(this,"_retryConfig",void 0),g(this,"wmSequence",0),g(this,"inspectInterval",void 0),g(this,"inspectTimer",null),g(this,"ossFilePrefix",void 0),g(this,"extraInfo",void 0),g(this,"_inspectType",void 0),g(this,"_inspectMode",void 0),g(this,"_quality",1),g(this,"qualityTimer",null),g(this,"_inspectId",void 0),g(this,"_needWorkUrlOnly",!1),g(this,"inspectImage",()=>{if(this.connectionState!==Gr.CONNECTED)throw new V(P.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Gr.CONNECTED?this.requestToInspectImage():I.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=bt(5,"inspect-"),this.workerMessageLengthLimit=H("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=H("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=H("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Dc("worker-manager-"+this._inspectId,un),this.on(an.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,I.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Wr[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Dc("worker-"+this._inspectId,un),this.handleWorkerEvents()}async init(t,n){this.emit(an.STATE_CHANGE,Wr.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new Ee((s,u)=>{this.on(an.CONNECTION_STATE_CHANGE,(d,h)=>{h===Gr.CONNECTED&&s()}),this.requestAP(t,i,n).then(d=>{this.connectWorkerManager(d)}).catch(d=>{u(d)})})}async requestAP(t,n,i){const s=H("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),u=await function(h,p,m,_){let{appId:E,areaCode:y,cname:A,sid:k,token:L,uid:x}=p;CE++;const z="image_moderation_api",X={service_name:z,json_body:JSON.stringify({appId:E,areaCode:y,cname:A,command:"allocateEdge",requestId:CE,seq:CE,sid:k,token:L,ts:Date.now(),uid:x+""})};let ie,Ie,se=h[0];return po(async()=>{ie=Date.now();const de=await Yi(se,{data:X,cancelToken:m,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Ie=Date.now()-ie,de.code!==0){const Be=new V(P.UNEXPECTED_RESPONSE,"image inspect ap error, code"+de.code,{retry:!0,responseTime:Ie});throw I.error(Be.toString()),Be}const oe=JSON.parse(de.json_body);if(oe.code!==200){const Be=new V(P.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(oe.code,", reason: ").concat(oe.reason),{code:oe.code,responseTime:Ie});throw I.error(Be.toString()),Be}if(!oe.servers||!Array.isArray(oe.servers)||oe.servers.length===0){const Be=new V(P.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:oe.code,responseTime:Ie});throw I.error(Be.toString()),Be}const ve=H("VIDEO_INSPECT_WORKER_MANAGER_HOST"),pt=H("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:oe.servers.map(Be=>{let{address:At,wss:gt}=Be;if(At&&gt)return"wss://".concat(At.replace(/\./g,"-"),".").concat(ve,":").concat(pt||gt)}).filter(Be=>!!Be),workerToken:oe.workerToken,vid:oe.vid,responseTime:Ie}},(de,oe)=>(we.apworkerEvent(k,{success:!0,sc:200,serviceName:z,responseDetail:JSON.stringify(de.addressList),firstSuccess:oe===0,responseTime:Ie,serverIp:h[oe%h.length]}),!1),(de,oe)=>(we.apworkerEvent(k,{success:!1,sc:de.data&&de.data.code||200,serviceName:z,responseTime:Ie,serverIp:h[oe%h.length]}),!!(de.code!==P.OPERATION_ABORTED&&de.code!==P.UNEXPECTED_RESPONSE||de.data&&de.data.retry)&&(se=h[(oe+1)%h.length],!0)),_)}(s,t,n,i);this.emit(an.STATE_CHANGE,Wr.AP_CONNECTED);const{addressList:d}=u;return this.wmSequence++,d}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(an.STATE_CHANGE,Wr.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Ge.CONNECTED,async()=>{this.emit(an.STATE_CHANGE,Wr.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.18.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Ge.CLOSED,()=>{this._innerConnectionState<Wr.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Ge.FAILED,()=>{this._innerConnectionState<Wr.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Ge.RECONNECTING,()=>{this._innerConnectionState<Wr.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Ge.ON_MESSAGE,async t=>{this.emit(an.STATE_CHANGE,Wr.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(t.data);if(i.code!==200)throw I.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new V(P.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw I.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new V(P.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const s=H("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,u=n.replace(/:\d+\/?$/,":".concat(s));this.emit(an.STATE_CHANGE,Wr.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(an.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(Ge.WILL_RECONNECT,(t,n)=>{n(t)}),this.workerManagerConnection.on(Ge.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(Ge.CONNECTED,async()=>{this.emit(an.STATE_CHANGE,Wr.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Gr.CONNECTED}),this.workerConnection.on(Ge.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const i=m6(new Uint8Array(t.data));if(H("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&I.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(an.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const s={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},u=hs(n=Object.keys(s)).call(n,(h,p)=>s[h]>s[p]?h:p,"porn"),d=Object.keys(s).find(h=>h===u);this.emit(an.INSPECT_RESULT,d)}else this.emit(an.INSPECT_RESULT,void 0,new V(P.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(an.INSPECT_RESULT,void 0,new V(P.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else I.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(an.INSPECT_RESULT,void 0,new V(P.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Ge.CLOSED,()=>{this.connectionState=Gr.CLOSED}),this.workerConnection.on(Ge.FAILED,()=>{this.connectionState=Gr.CLOSED}),this.workerConnection.on(Ge.RECONNECTING,()=>{this.connectionState=this.connectionState===Gr.CONNECTED?Gr.RECONNECTING:Gr.CONNECTING}),this.workerConnection.on(Ge.WILL_RECONNECT,(t,n)=>{t==="recover"&&n(t),n("tryNext")}),this.workerConnection.on(Ge.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(an.REQUEST_NEW_WORKER_URL,i=>{t([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){this.sequence++;const t=qi(this,an.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(an.INSPECT_RESULT,void 0,new V(P.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(t,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(an.INSPECT_RESULT,void 0,new V(P.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:i,cname:s,cid:u,vid:d,sid:h,uid:p}=n;const m=Date.now(),_=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await(async(L,x,z)=>await R6(L.buffer,x,z))(_,i,s),y=this.sequence+"-"+u+"-"+p+"-"+m+"-"+bt(12,""),A={appId:i,cid:u,cname:s,deviceId:"",elapse:Ep.intToLong(Number(m-this.inspectStartTime)),fileSize:E.byteLength,jpgEncryption:2,height:_.height,width:_.width,jpg:E,networkType:6,osType:7,requestId:y,sdkVersion:"4.18.0",sequence:this.sequence,sid:h,timestamp:Ep.intToLong(m),uid:p,vid:d,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete A.callbackData,this.ossFilePrefix===void 0&&delete A.ossFilePrefix;const k=_6(A);if(k.byteLength<this.workerMessageLengthLimit){if(H("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const L=function(x){for(var z=1;z<arguments.length;z++){var X=arguments[z]!=null?arguments[z]:{};z%2?Bb(Object(X),!0).forEach(function(ie){g(x,ie,X[ie])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(X)):Bb(Object(X)).forEach(function(ie){Object.defineProperty(x,ie,Object.getOwnPropertyDescriptor(X,ie))})}return x}({},A);delete L.jpg,I.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(L))}return k}{const L=this.quality*this.qualityRatio;return this.quality=L,await this.generateRequestData(t,{appId:i,cname:s,cid:u,vid:d,sid:h,uid:p})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ri.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Gr.CLOSED,this.emit(an.STATE_CHANGE,Wr.CLOSED)}}var jb,Fb,Gb,Wb,Hb,Kb,zb,Yb,qb,Jb,Xb,Qb,$b,Zb,eN,tN,nN,rN,iN,oN,sN,aN,cN,uN,dN,lN,hN,pN,fN,_N,mN,EN,vN,gN,SN,TN,yN,RN,fe;function CN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Sd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?CN(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CN(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let I6=(jb=be(),Fb=be({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),t.map(n=>n?Object(n).toString():"null"))}),Gb=be({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId()))}),Wb=be({argsMap:(e,t,n)=>[t.uid,n]}),Hb=be({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:s}=n;return[i==null?void 0:i.uid,s]})}),Kb=be({argsMap:(e,t,n)=>[t.uid,n]}),zb=be({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:s}=n;return{uid:i==null?void 0:i.uid,mediaType:s}})}),Yb=be(),qb=be(),Jb=be(),Xb=be(),Qb=be(),$b=be(),Zb=be(),eN=be(),tN=be(),nN=be(),rN=be(),iN=be(),oN=be(),sN=be(),aN=be({argsMap:(e,t)=>[t]}),cN=be(),uN=be(),dN=be(),lN=be(),hN=be(),pN=be(),fN=be(),_N=be(),mN=be(),EN=be(),vN=be({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),gN=be(),SN=be(),TN=be(),yN=be({reportResult:!0}),RN=be(),ne((fe=class extends jt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),g(this,"store",void 0),g(this,"_uid",void 0),g(this,"_channelName",void 0),g(this,"_uintUid",void 0),g(this,"_users",[]),g(this,"_codec",void 0),g(this,"_mode",void 0),g(this,"_config",void 0),g(this,"_clientId",void 0),g(this,"_appId",void 0),g(this,"_sessionId",null),g(this,"_key",void 0),g(this,"_joinInfo",void 0),g(this,"_gateway",void 0),g(this,"_statsCollector",void 0),g(this,"_configDistribute",void 0),g(this,"_leaveMutex",new nr("client-leave")),g(this,"_publishMutex",new nr("client-publish")),g(this,"_renewTokenMutex",new nr("client-renewtoken")),g(this,"_subscribeMutex",new nr("client-subscribe")),g(this,"_encryptionMode","none"),g(this,"_encryptionSecret",null),g(this,"_encryptionSalt",null),g(this,"_proxyServer",void 0),g(this,"_turnServer",{servers:[],mode:"auto"}),g(this,"_cloudProxyServerMode","disabled"),g(this,"_isDualStreamEnabled",!1),g(this,"_defaultStreamFallbackType",void 0),g(this,"_lowStreamParameter",void 0),g(this,"_streamFallbackTypeCacheMap",new Map),g(this,"_remoteStreamTypeCacheMap",new Map),g(this,"_axiosCancelSource",Ri.CancelToken.source()),g(this,"_audioVolumeIndicationInterval",void 0),g(this,"_networkQualityInterval",void 0),g(this,"_userOfflineTimeout",void 0),g(this,"_streamRemovedTimeout",void 0),g(this,"_injectStreamingClient",void 0),g(this,"_liveTranscodeStreamingClient",void 0),g(this,"_liveRawStreamingClient",void 0),g(this,"_channelMediaRelayClient",void 0),g(this,"_networkQualitySensitivity","normal"),g(this,"_p2pChannel",void 0),g(this,"_useLocalAccessPoint",!1),g(this,"_setLocalAPVersion",void 0),g(this,"_joinAndNotLeaveYet",!1),g(this,"_numberOfJoinCount",0),g(this,"_remoteDefaultVideoStreamType",void 0),g(this,"_inspect",void 0),g(this,"_license",void 0),g(this,"_handleLocalTrackEnable",(n,i,s)=>{this.publish(n,!1).then(i).catch(s)}),g(this,"_handleLocalTrackDisable",(n,i,s)=>{this.unpublish(n).then(i).catch(s)}),g(this,"_handleUserOnline",n=>{if(H("BLOCK_LOCAL_CLIENT")&&va(n.uid,this.channelName))return void I.debug("[".concat(n.uid,"] will be ignored in local"));this.isStringUID&&typeof n.uid!="string"&&I.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const i=this._users.find(s=>s.uid===n.uid);if(i)i._trust_in_room_=!0;else{const s=new OE(n.uid,n.uint_id||n.uid);this._users.push(s),I.debug("[".concat(this._clientId,"] user online"),n.uid),this.emit(Xe.USER_JOINED,s)}}),g(this,"_handleUserOffline",n=>{if(H("BLOCK_LOCAL_CLIENT")&&va(n.uid,this.channelName))return;const i=this._users.find(s=>s.uid===n.uid);i&&(this._handleRemoveStream(n),EE(this._users,i),this._remoteStreamTypeCacheMap.delete(i.uid),this._streamFallbackTypeCacheMap.delete(i.uid),I.debug("[".concat(this._clientId,"] user offline"),n.uid,"reason:",n.reason),this.emit(Xe.USER_LEAVED,i,n.reason))}),g(this,"_handleAddAudioOrVideoStream",(n,i,s,u,d,h,p)=>{if(H("BLOCK_LOCAL_CLIENT")&&va(i,this.channelName))return;const m=this._users.find(E=>E.uid===i);if(!m)return void I.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));I.debug("[".concat(this._clientId,"] stream added with uid ").concat(i,", type ").concat(n)),this.store.subscribe(m.uid,n,void 0,void 0,void 0,Date.now());const _=n==="audio"?m.hasAudio:m.hasVideo;m._uintid||(m._uintid=d||i),n==="audio"?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,n==="audio"?(m._audio_added_=!0,s!==void 0&&(m._audioSSRC=s),u!==void 0&&(m._cname=u),h&&(m._audioOrtc=h)):(m._video_added_=!0,s!==void 0&&(m._videoSSRC=s),u!==void 0&&(m._cname=u),p!==void 0&&(m._rtxSsrcId=p),h&&(m._videoOrtc=h)),(n==="audio"?m.hasAudio:m.hasVideo)&&!_&&(I.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(n)),this.emit(Xe.USER_PUBLISHED,m,n)),n==="video"?we.onGatewayStream(this._sessionId,wn.ON_ADD_VIDEO_STREAM,Mt.ON_ADD_VIDEO_STREAM,{peer:d||i}):we.onGatewayStream(this._sessionId,wn.ON_ADD_AUDIO_STREAM,Mt.ON_ADD_AUDIO_STREAM,{peer:d||i}),this._p2pChannel.remoteMediaSsrcChanged(m,n,s).then(E=>{if(E)return I.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(m.uid," after rejoin because SSRC id changed.")),this._p2pChannel.unsubscribe(m,n,!0).then(()=>this._subscribe(m,n,!0).catch(y=>{I.error("[".concat(this._clientId,"] resubscribe error"),y.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(m,n)&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,n,!0).catch(E=>{I.error("[".concat(this._clientId,"] resubscribe error"),E.toString())}))}),g(this,"_handleRemoveStream",n=>{if(H("BLOCK_LOCAL_CLIENT")&&va(n.uid,this.channelName))return;const i=this._users.find(u=>u.uid===n.uid);if(!i)return void I.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));I.debug("[".concat(this._clientId,"] stream removed with uid ").concat(n.uid));let s=()=>{};i.hasAudio&&i.hasVideo?s=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished audio track")),this.emit(Xe.USER_UNPUBLISHED,i,"audio"),I.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished video track")),this.emit(Xe.USER_UNPUBLISHED,i,"video")}:i.hasVideo?s=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished video track")),this.emit(Xe.USER_UNPUBLISHED,i,"video")}:i.hasAudio&&(s=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished audio track")),this.emit(Xe.USER_UNPUBLISHED,i,"audio")}),i._trust_audio_stream_added_state_=!0,i._trust_video_stream_added_state_=!0,i._audio_added_=!1,i._video_added_=!1,this._p2pChannel.unsubscribe(i).then(u=>{if(u)return this._gateway.unsubscribe(u,i.uid)}),i._audioSSRC=void 0,i._videoSSRC=void 0,i._audioOrtc=void 0,i._videoOrtc=void 0,i._rtxSsrcId=void 0,we.onGatewayStream(this._sessionId,wn.ON_REMOVE_STREAM,Mt.ON_REMOVE_STREAM,{peer:n.uint_id||n.uid}),s()}),g(this,"_handleSetStreamLocalEnable",(n,i,s)=>{if(H("BLOCK_LOCAL_CLIENT")&&va(i,this.channelName))return;const u=this._users.find(p=>p.uid===i);if(!u)return void I.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));I.debug("[".concat(this._clientId,"] local ").concat(n," ").concat(s?"enabled":"disabled"," with uid ").concat(i));const d=n==="audio"?u.hasAudio:u.hasVideo;if(n==="audio"){u._trust_audio_enabled_state_=!0;const p=u._audio_enabled_;if(u._audio_enabled_=s,u._audio_enabled_===p)return;{const m=u._audio_enabled_?"enable-local-audio":"disable-local-audio";I.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(i,", msg: ").concat(m)),this.emit(Xe.USER_INFO_UPDATED,i,m)}}else{u._trust_video_enabled_state_=!0;const p=u._video_enabled_;if(u._video_enabled_=s,u._video_enabled_===p)return;{const m=u._video_enabled_?"enable-local-video":"disable-local-video";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(m)),this.emit(Xe.USER_INFO_UPDATED,i,m)}}const h=n==="audio"?u.hasAudio:u.hasVideo;return d!==h?!d&&h?(I.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(n)),void this.emit(Xe.USER_PUBLISHED,u,n)):(n==="video"&&u._videoTrack&&u._videoTrack._destroy(),n==="audio"&&u._audioTrack,this._p2pChannel.muteRemote(u,n),I.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(n)),void this.emit(Xe.USER_UNPUBLISHED,u,n)):void 0}),g(this,"_handleMuteStream",(n,i,s)=>{if(H("BLOCK_LOCAL_CLIENT")&&va(n,this.channelName))return;I.debug("[".concat(this._clientId,"] receive mute message"),n,i,s);const u=this._users.find(p=>p.uid===n);if(!u)return void I.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(n));const d=i==="audio"?u.hasAudio:u.hasVideo;if(i==="audio"){u._trust_audio_mute_state_=!0;const p=u._audio_muted_;if(u._audio_muted_=s,u._audio_muted_===p)return;{const m=u._audio_muted_?"mute-audio":"unmute-audio";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(m)),this.emit(Xe.USER_INFO_UPDATED,n,m)}}else{u._trust_video_mute_state_=!0;const p=u._video_muted_;if(u._video_muted_=s,u._video_muted_===p)return;{const m=u._video_muted_?"mute-video":"unmute-video";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(m)),this.emit(Xe.USER_INFO_UPDATED,n,m)}}const h=i==="audio"?u.hasAudio:u.hasVideo;if(d!==h){if(!d&&h)return(i==="audio"?u._audioSSRC:u._videoSSRC)?(I.info("[".concat(this._clientId,"] remote user ").concat(n," published ").concat(i)),void this.emit(Xe.USER_PUBLISHED,u,i)):void I.warning("[".concat(this._clientId,"] remote user ").concat(n," receive ").concat(i," unmute message  before add stream message, ").concat(i," SSRC doesn't exist yet."));i==="video"&&u._videoTrack&&u._videoTrack._destroy(),i==="audio"&&u._audioTrack,this._p2pChannel.muteRemote(u,i),I.info("[".concat(this._clientId,"] remote user ").concat(n," unpublished ").concat(i)),this.emit(Xe.USER_UNPUBLISHED,u,i)}}),g(this,"_handleP2PLost",async n=>{I.debug("[".concat(this._clientId,"] receive p2p lost"),n),parseInt(n.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():I.warning("[".concat(this._clientId,"] P2PLost stream not found"),n)}),g(this,"_handleTokenWillExpire",()=>{I.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.emit(Xe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),g(this,"_handleBeforeUnload",n=>{n.type==="beforeunload"&&n.returnValue!==void 0&&n.returnValue!==""||(this.leave(),I.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),g(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.emit(Xe.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const n={downlinkNetworkQuality:0,uplinkNetworkQuality:0};n.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),n.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.emit(Xe.NETWORK_QUALITY,n)}),this._codec=e.codec,this._mode=e.mode,this._clientId=bt(5,"client-"),this.store=new p6(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),I.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(si," build: ").concat(Dm,", mode: ").concat(this._mode,", codec: ").concat(this._codec)),e.clientRoleOptions)try{iI(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(n){I.warning("[".concat(this._clientId,"] ").concat(n.toString()))}this._statsCollector=new bc(this.store),this._statsCollector.onStatsException=(n,i,s)=>{I.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(n,", msg: ").concat(i,", uid: ").concat(s)),this.emit(Xe.EXCEPTION,{code:n,msg:i,uid:s})},this._statsCollector.onUploadPublishDuration=(n,i,s,u)=>{const d=this._users.find(h=>h.uid===n);d&&we.peerPublishStatus(this._sessionId,{subscribeElapse:u,audioPublishDuration:i,videoPublishDuration:s,peer:d._uintid})},this.store.useDataChannel=Jt().supportDataChannel&&H("SIGNAL_CHANNEL"),this._gateway=new Q3(this.store,{clientId:this._clientId,mode:this._mode,codec:this._codec,websocketRetryConfig:e.websocketRetryConfig||un,httpRetryConfig:e.httpRetryConfig||un,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._config=e,this._configDistribute=new s8,this._p2pChannel=new h6(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async join(e,t,n,i,s){const u=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const d=f6(),h=Pb()?window.isSecureContext:"Browser Not Support";if(!Pb()&&!d||!window.isSecureContext){const A="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";I.warning(A)}const p=mE();this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),I.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const m=we.reportApiInvoke(p,{name:rn.JOIN,options:[e,t,n,i],states:{isHttps:d,isSecureContext:h},tag:Ut.TRACER});we.setAppId(e);try{if(!n&&n!==null)throw new V(P.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&xn(n,"token",1,2047),xn(e,"appid",1,2047),Gm(t),i&&Wm(i),s&&xn(s,"optionalInfo",1,2047)}catch(A){throw m.onError(A),A}if(I.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(u)),this._leaveMutex.isLocked&&(I.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),I.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const A=new V(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw m.onError(A),A}this._sessionId||(this._sessionId=p,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const _=Sd({clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:s,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(_.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(_.stringUid=i,this._uintUid?(_.uid=this._uintUid,this._uintUid=void 0):_.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(_.aesmode=this._encryptionMode,_.aespassword=await(async A=>{const k=vE(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),L=await window.crypto.subtle.importKey("spki",k,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),x=sE(A),z=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},L,x);return Qh(new Uint8Array(z))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new V(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(_.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:t,appId:e});const E=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&E===this._sessionId&&we.joinChannelTimeout(this._sessionId,5)},5e3);try{let A;const k=_.cloudProxyServer;if(["proxy3","proxy4","proxy5"].includes(k)){const X=H("PROXY_SERVER_TYPE3");Array.isArray(X)?_.proxyServer=X[0]:_.proxyServer=X}if(we.setProxyServer(_.proxyServer),I.setProxyServer(_.proxyServer),this.store.requestAPStart(),_.stringUid&&!_.uid){const X=await uw(_.stringUid,_,this._axiosCancelSource.token,this._config.httpRetryConfig||un,this.store);I.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(_.stringUid," => ").concat(X)),_.uid=X,A=await cw(_,this._axiosCancelSource.token,this._config.httpRetryConfig||un,!0,this.store)}else A=await cw(_,this._axiosCancelSource.token,this._config.httpRetryConfig||un,!0,this.store);if(!this._joinAndNotLeaveYet)throw new V(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(_,this._axiosCancelSource.token),this._configDistribute.on(id.UPDATE_BITRATE_LIMIT,X=>{this._p2pChannel.updateBitrateLimit(X)})},0),this._key=n||e;const L=A.gatewayInfo;this._joinInfo=Sd(Sd({},_),{},{cid:L.cid,uid:_.uid?_.uid:L.uid,vid:L.vid,apResponse:L.res,uni_lbs_ip:L.uni_lbs_ip,gatewayAddrs:L.gatewayAddrs});const x=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new V(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));m.onSuccess(x),this._appId=e,this._channelName=_.cname,this._uid=x,this.store.uid=x,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener($n()?"beforeunload":"pagehide",this._handleBeforeUnload)},0);const z=_.stringUid?"string uid: ".concat(_.stringUid,",uid: ").concat(_.uid):"uid: ".concat(this._uid);return I.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(z)),setTimeout(()=>{I.startUpload()},5e3),this.store.joinEnd(),y=this,Ea.includes(y)||Ea.push(y),x}catch(A){const k=Array.isArray(A)?A[0]:A;throw I.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),k),k.code!==P.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),m.onError(k),k}var y}_joinGateway(){if(!this._joinInfo||!this._key)throw new V(P.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!H("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(e=>e).catch(e=>{if(e.code===P.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,ct.FALLBACK),e;if(e.code===P.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,ct.FALLBACK),e;throw e}).then(e=>{if(e instanceof V){if(e.code===P.INIT_WEBSOCKET_TIMEOUT){if(I.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new V(P.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const t=H("PROXY_SERVER_TYPE3");if(Array.isArray(t))if(this._joinInfo.apUrl){const i=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),s=i.slice(i.length-2).join(".");t.forEach(u=>{this._joinInfo&&u.includes(s)&&(this._joinInfo.proxyServer=u)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=t[0])}else this._joinInfo.proxyServer=t[0];else this._joinInfo.proxyServer=t;const n=H("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return n&&n[1]&&n[1]!=="443"&&I.setProxyServer(this._joinInfo.proxyServer),H("STATS_COLLECTOR_PORT").toString()!=="443"&&we.setProxyServer(this._joinInfo.proxyServer),we.reportApiInvoke(this._sessionId,{name:rn.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:Ut.TRACER}).onSuccess(),this.emit(Xe.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),H("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(i=>{"forceturn"in i&&(i.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(I.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new V(P.INVALID_OPERATION);return we.reportApiInvoke(this._sessionId,{name:rn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Ut.TRACER}).onSuccess(),this._joinGateway()}return e}).then(e=>e)}async leave(){I.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener($n()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=Ea.indexOf(t);n!==-1&&Ea.splice(n,1)}(this);const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return I.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),I.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(Array.isArray(e)||(e=[e]),e.length===0)throw new V(P.INVALID_PARAMS,"track list is empty");if(this._gateway.role==="audience")throw new V(P.INVALID_OPERATION,"audience can not publish stream");for(const i of e){if(!(i instanceof aE))throw new V(P.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new V(P.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}I.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(e.map(i=>"".concat(i.getTrackId()," ")))),await this._configDistribute.awaitConfigDistributeComplete(),t&&e.forEach(i=>{const s=this._configDistribute.getBitrateLimit();i instanceof en&&s&&i.setBitrateLimit(s.uplink)});const n=await this._publishMutex.lock();try{await this._publishHighStream(e),I.info("[".concat(this._clientId,"] Publish success, id ").concat(e.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw I.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{n()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new V(P.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");e?Array.isArray(e)||(e=[e]):e=this._p2pChannel.getAllTracks(!0),I.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(n=>"".concat(n.getTrackId()," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublish(e);n&&await this._gateway.unpublish(n,this._uid),I.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(i=>"".concat(i.getTrackId()))))}catch(n){throw I.error("[".concat(this._clientId,"] unpublish error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t){return this._subscribe(e,t)}async _subscribe(e,t,n){if(gn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new V(P.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new V(P.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(p=>p===e)){const p=new V(P.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),p}if(!e.hasAudio&&!e.hasVideo){const p=new V(P.INVALID_REMOTE_USER,"user is not published");throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),p}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const p=new V(P.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),p}const i=t==="audio"?e._audioSSRC:e._videoSSRC,s=t==="audio"?e._audioOrtc:e._videoOrtc,u=t==="video"?e._rtxSsrcId:void 0,d={stream_type:t==="audio"?je.AUDIO:je.VIDEO,ssrcId:i},h=await this._subscribeMutex.lock();I.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{ai.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,u,s);try{await this._gateway.subscribe(e.uid,d,!0)}catch(m){if((m==null?void 0:m.code)!==P.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),m;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(m){throw this._p2pChannel.reportSubscribeEvent(!1,m==null?void 0:m.code,e,t),m}I.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(m=>{I.warning("[".concat(this._clientId,"] auto set fallback failed"),m)});const p=t==="audio"?e._audioTrack:e._videoTrack;if(!p)throw new V(P.UNEXPECTED_ERROR,"can not find remote track in user object");return p}catch(p){throw I.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),p),p}finally{h()}}async massSubscribe(e){if(Vo(e,"subscribeList"),!this._joinInfo)throw new V(P.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new V(P.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,i=await this._subscribeMutex.lock();I.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(h=>{let{user:p,mediaType:m}=h;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(m)}).join("; ")));const s=(e=[...e]).map(h=>{let{user:p,mediaType:m}=h;return{user:p,mediaType:m}}),u=await this._p2pChannel.globalLock();try{var d;for(let p=e.length-1;p>=0;p--){const m=e[p],{user:_,mediaType:E}=m;if(gn(E,"mediaType",["audio","video"]),!_){const k=new V(P.INVALID_PARAMS,"user property does not exist in subscribeList item");throw I.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),k}if(!this._users.find(k=>k===_)){const k=new V(P.INVALID_REMOTE_USER,"user is not in the channel");I.error("[".concat(this._clientId,"] can not massSubscribe ").concat(_.uid,", this user is not in the channel")),s[p].error=k,e.splice(p,1);continue}if(E==="audio"&&(!_.hasAudio||_._audioSSRC===void 0)||E==="video"&&(!_.hasVideo||_._videoSSRC===void 0)){const k=new V(P.REMOTE_USER_IS_NOT_PUBLISHED);I.error("[".concat(this._clientId,"] can not subscribe ").concat(_.uid," with mediaType ").concat(E,", remote user is not published")),s[p].error=k,e.splice(p,1);continue}const y=Qt.Video|Qt.LwoVideo,A=n.get(_);if(A){if(E==="video"?A&y:A&Qt.Audio){e.splice(p,1),I.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(_.uid,", mediaType:").concat(E," twice"));continue}n.set(_,A|(E==="video"?y:Qt.Audio))}else n.set(_,E==="video"?y:Qt.Audio)}for(let p=e.length-1;p>=0;p--){const m=e[p],{user:_,mediaType:E}=m,y=Qt.Video|Qt.LwoVideo;if(this._p2pChannel.hasRemoteMedia(_,E)){await this._p2pChannel.unmuteRemoteNoLock(_,E);const A=n.get(_);n.set(_,E==="video"?A^y:A^Qt.Audio),e.splice(p,1)}}this.store.massSubscribe(e.map(p=>({userId:p.user.uid,type:p.mediaType})),t);const h=hs(d=Array.from(n.entries())).call(d,(p,m)=>{let[_,E]=m;if(E===0)return p;const y={stream_id:_.uid,stream_type:E};return E&Qt.Audio&&(y.audio_ssrc=_._audioSSRC),E&Qt.Video&&(y.video_ssrc=_._videoSSRC),p.push(y),p},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(m=>{let{user:_,mediaType:E}=m;return{user:_,mediaType:E,ssrcId:E===je.VIDEO?_._videoSSRC:_._audioSSRC,rtxSsrcId:E===je.VIDEO?_._rtxSsrcId:void 0}}));const p=new Map;if(h.length>0){const m=await this._gateway.subscribeAll(h,!0);((m==null?void 0:m.users)||[]).forEach(_=>{let{stream_id:E,video_error_code:y,audio_error_code:A,error_code:k}=_;(y||A||k)&&p.set(E,{video_error_code:y,audio_error_code:A,error_code:k})})}if(Array.from(p.entries()).length>0){const m=Array.from(p.entries()).map(_=>{let E,[y,A]=_;return A.error_code||A.video_error_code&&A.audio_error_code?E=void 0:A.video_error_code?E=je.VIDEO:A.audio_error_code&&(E=je.AUDIO),{user:this.remoteUsers.find(k=>k.uid===y),mediaType:E}});await this._p2pChannel.massUnsubscribeNoLock(m)}for(const m of s){const _=p.get(m.user.uid);if(_){const E=_.error_code||m.mediaType==="audio"&&_.audio_error_code||m.mediaType==="video"&&_.video_error_code;if(E){const y=cd(E);I.error("user:".concat(m.user.uid," mediaType:").concat(m.mediaType," has massSubscribe error ").concat(y.desc)),m.error=new V(P.SUBSCRIBE_FAILED,"code ".concat(E,": ").concat(y.desc))}}m.error||(m.mediaType==="video"?m.track=m.user.videoTrack:m.track=m.user.audioTrack)}return this.store.massSubscribe(s.filter(m=>!m.error).map(m=>({userId:m.user.uid,type:m.mediaType})),void 0,Date.now()),s.forEach(m=>{var _;we.subscribe(this.store.sessionId,{succ:!!m.error,ec:((_=m.error)===null||_===void 0?void 0:_.code)||null,video:m.mediaType===je.VIDEO,audio:m.mediaType===je.AUDIO,peerid:m.user.uid,subscribeRequestid:m.mediaType===je.VIDEO?m.user._videoSSRC:m.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t)},!0)}),I.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(m=>{let{user:_,mediaType:E}=m;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(E)}).join("; "))),s}catch(p){throw await this._p2pChannel.massUnsubscribeNoLock(e),p}}finally{u(),i()}}async unsubscribe(e,t){if(t&&gn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new V(P.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(n=>n===e)){const n=new V(P.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),n}I.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));try{const n=await this._p2pChannel.unsubscribe(e,t);n&&await this._gateway.unsubscribe(n,e.uid),I.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}catch(n){if(n.code===P.DISCONNECT_P2P)return void I.warning("disconnecting p2p, abort unsubscribe request.");throw I.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),n.toString()),n}}async massUnsubscribe(e){if(Vo(e,"unsubscribeList"),!this._joinInfo)throw new V(P.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");I.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:i,mediaType:s}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(s,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:i,mediaType:s}=e[n];if(!i){const d=new V(P.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw I.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),d}if(gn(s,"mediaType",["video","audio",void 0]),!this._users.find(d=>d===i)){I.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),e.splice(n,1);continue}const u=Qt.Video|Qt.LwoVideo;if(t.has(i)){const d=t.get(i);let h;switch(s){case"video":h=d&u;break;case"audio":h=d&Qt.Audio;break;default:h=d&(Qt.Audio|u)}if(h){I.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(s," twice.")),e.splice(n,1);continue}s?s==="audio"?t.set(i,d|Qt.Audio):s==="video"&&t.set(i,d|u):t.set(i,d|Qt.Audio|u)}else s?s==="audio"?t.set(i,Qt.Audio):s==="video"&&t.set(i,u):t.set(i,Qt.Audio|u)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),I.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(i=>{let{user:s,mediaType:u}=i;return"user: ".concat(s==null?void 0:s.uid,", mediaType: ").concat(u,";")}).join()))}catch(n){if(n.code===P.DISCONNECT_P2P)return void I.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw I.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}setLowStreamParameter(e){(function(n){if(!n)throw new V(P.INVALID_PARAMS);Ot(n.width)||Fm(n.width,"streamParameter.width"),Ot(n.height)||Fm(n.height,"streamParameter.height"),Ot(n.framerate)||Fm(n.framerate,"streamParameter.framerate"),Ot(n.bitrate)||Ct(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&I.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),I.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e}async enableDualStream(){if(!Jt().supportDualStream)throw we.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new V(P.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new V(P.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw we.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,we.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),I.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new V(P.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Se.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw we.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,we.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),I.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(n){gn(n,"role",["audience","host"])}(e),t&&iI(t),this._mode==="rtc")throw I.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new V(P.INVALID_OPERATION,"rtc mode can not use setClientRole");if(t&&t.level&&e==="host")throw new V(P.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new V(P.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),I.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}setProxyServer(e,t){if(xn(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new V(P.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new V(P.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,we.setProxyServer(this._proxyServer),I.setProxyServer(this._proxyServer),I.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new V(P.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new V(P.INVALID_OPERATION,"You have already set the proxy")}if(nd(e))return this._turnServer={servers:e,mode:"original-manual"},void I.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>rI(n)),this._turnServer={servers:e,mode:"manual"},I.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new V(P.INVALID_OPERATION,"you should set license before join channel");if(xn(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new V(P.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,I.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new V(P.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new V(P.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new V(P.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new V(P.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,I.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new V(P.INVALID_OPERATION,"Stop proxy server after leave channel");we.setProxyServer(),I.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",I.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new V(P.INVALID_PARAMS,"accessPoints is required.");Vo(e.accessPoints.serverList,"accessPoints.serverList"),xn(e.accessPoints.domain,"accessPoints.domain");const t=(y,A)=>{Ct(y,A,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new V(P.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");H("CLOSE_AFB_FOR_LOCAL_AP")&&(Et("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Et("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,s=e.accessPoints.domain,u=e.accessPoints.serverList.map(y=>i.test(y)?"".concat(y.replace(/\./g,"-"),".").concat(s):y),d=u.map(y=>"".concat(y,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Et("WEBCS_DOMAIN",d),Et("WEBCS_DOMAIN_BACKUP_LIST",d),Et("GATEWAY_DOMAINS",[s]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Vo(e.report.hostname,"report.hostname"),Et("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Et("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Et("EVENT_REPORT_DOMAIN",u[0]),Et("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let h=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),h=e.report.port),Et("STATS_COLLECTOR_PORT",h),e.report?Et("ENABLE_EVENT_REPORT",!0):Et("ENABLE_EVENT_REPORT",!1);let p="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Vo(e.log.hostname,"log.hostname"),p=e.log.hostname[0]):p=u[0];let m=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),m=e.log.port),Et("LOG_UPLOAD_SERVER","".concat(p,":").concat(m));let _=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Vo(e.cds.hostname,"cds.hostname"),_=e.cds.hostname):_=u;let E=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),E=e.cds.port),Et("CDS_AP",_.map(y=>"".concat(y,":").concat(E))),e.cds?Et("ENABLE_CONFIG_DISTRIBUTE",!0):Et("ENABLE_CONFIG_DISTRIBUTE",!1),I.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Vo(e,"serverList"),xn(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new V(P.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(t):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Et("WEBCS_DOMAIN",e),Et("WEBCS_DOMAIN_BACKUP_LIST",e),Et("GATEWAY_DOMAINS",[t]),Et("EVENT_REPORT_DOMAIN",e[0]),Et("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Et("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),I.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(gn(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw I.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else I.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){gn(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(i=>i.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw I.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}I.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){gn(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw I.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}I.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n){if(function(i){gn(i,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),xn(t,"secret"),["aes-128-gcm2","aes-256-gcm2"].includes(e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new V(P.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new V(P.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||I.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Qh(n))}async renewToken(e){if(xn(e,"token",1,2047),!this._key||!this._joinInfo)throw new V(P.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(H("USE_NEW_TOKEN")){I.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await o8(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||un);I.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:i})}else I.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});I.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=t,this._joinInfo.token=t,I.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?I.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.emit(Xe.VOLUME_INDICATOR,e)},H("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this._codec!=="h264")throw new V(P.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new V(P.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new V(P.LIVE_STREAMING_TASK_CONFLICT);const n=t?on.TRANSCODE:on.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(on.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new V(P.INVALID_PARAMS,"can not find live streaming url to stop");await Ee.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async addInjectStreamUrl(e,t){if(!this._joinInfo)throw new V(P.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const n=this._createLiveStreamingClient(on.INJECT);n.setInjectStreamConfig(t,0),await n.startLiveStreamingTask(e,on.INJECT)}async removeInjectStreamUrl(){var e;const t=this._createLiveStreamingClient(on.INJECT),n=Array.from(_o(e=t.streamingTasks).call(e)).find(i=>i.mode===on.INJECT);if(!this._joinInfo||!n)throw new V(P.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await t.stopLiveStreamingTask(n.url)}async startChannelMediaRelay(e){Ew(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){Ew(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendStreamMessage(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new V(P.INVALID_OPERATION,"can not send data stream, not joined");if(typeof e=="string"&&(e=new TextEncoder().encode(e)),new Blob([e]).size>1024)throw new V(P.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(De.DATA_STREAM,{payload:Qh(e)},!t)}sendMetadata(e){if(!this._joinInfo)throw new V(P.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new V(P.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(De.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Qh(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(gF),!this._joinInfo)throw new V(P.INVALID_OPERATION,"can not send custom report, not joined");await we.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){gn(t.spatialLayer,"spatialLayer",[0,1,2,3]),gn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw I.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}_reset(){if(I.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Ri.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy()}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new nr("client-publish"),this._subscribeMutex=new nr("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}}_startSession(e,t){const n=e||mE();e?I.debug("[".concat(this._clientId,"] new Session ").concat(n)):I.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n)),this._sessionId=n,this.store.sessionId=n,t?we.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:t.channel,appid:t.appId,mode:this._mode}):this._joinInfo?we.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this._mode}):this._gateway.joinInfo&&we.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this._mode}),this._joinInfo&&(this._joinInfo.sid=n),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new V(P.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new V(P.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&H("FORCE_TURN")&&!H("TURN_ENABLE_TCP")&&!H("TURN_ENABLE_UDP"))throw new V(P.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");I.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter),i=(await n.next()).value;if(i){var t;let s;try{s=await this._gateway.publish(this._uid,i,!0)}catch(u){if(u.code!==P.DISCONNECT_P2P)throw n.throw(u),u}await n.next(((t=s)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const s of e)s instanceof en&&s._encoderConfig&&this._gateway.setVideoProfile(s._encoderConfig),!s.muted&&s.enabled||await this._p2pChannel.muteLocalTrack(s)}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===P.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new V(P.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new V(P.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));I.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var t;let s;try{s=await this._gateway.publish(this._uid,i,!0)}catch(u){if(u.code!==P.DISCONNECT_P2P)throw n.throw(u),u}n.next(((t=s)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===P.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new V(P.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const t=()=>new c8(this._joinInfo,this._config.websocketRetryConfig||un,this._config.httpRetryConfig||un),n=i=>{i.onLiveStreamError=(s,u)=>{we.reportApiInvoke(this._sessionId,{name:rn.ON_LIVE_STREAM_ERROR,options:[s,u],tag:Ut.TRACER}).onSuccess(),this.emit(Xe.LIVE_STREAMING_ERROR,s,u)},i.onLiveStreamWarning=(s,u)=>{we.reportApiInvoke(this._sessionId,{name:rn.ON_LIVE_STREAM_WARNING,options:[s,u],tag:Ut.TRACER}).onSuccess(),this.emit(Xe.LIVE_STREAMING_WARNING,s,u)},i.on(yc.REQUEST_WORKER_MANAGER_LIST,(s,u,d)=>{if(!this._joinInfo)return d(new V(P.INVALID_OPERATION,"can not find join info to get worker manager"));lw(s,this._joinInfo,this._axiosCancelSource.token,un).then(u).catch(d)})};switch(e){case on.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),n(this._liveRawStreamingClient)),this._liveRawStreamingClient;case on.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),n(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case on.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on(yc.REQUEST_WORKER_MANAGER_LIST,(i,s,u)=>{if(!this._joinInfo)return u(new V(P.INVALID_OPERATION,"can not find join info to get worker manager"));lw(i,this._joinInfo,this._axiosCancelSource.token,un).then(s).catch(u)}),this._injectStreamingClient.onInjectStatusChange=(i,s,u)=>{this.emit(Xe.INJECT_STREAM_STATUS,i,s,u)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new V(P.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:t}=this.getLocalVideoStats(),n={width:e,height:t};this._channelMediaRelayClient=new d8(this._joinInfo,this._clientId,this._config.websocketRetryConfig||un,this._config.httpRetryConfig||un,n),this._channelMediaRelayClient.on("state",i=>{i===tr.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.emit(Xe.CHANNEL_MEDIA_RELAY_STATE,i)}),this._channelMediaRelayClient.on("event",i=>{this.emit(Xe.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._statsCollector.onStatsChanged=(i,s)=>{var u;i==="resolution"&&((u=this._channelMediaRelayClient)===null||u===void 0||u.setVideoProfile(s))}}return this._channelMediaRelayClient}_handleGatewayEvents(){this._gateway.on(Lt.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Lt.CONNECTION_STATE_CHANGE,(e,t,n)=>{var i;if(n===ct.FALLBACK)return;const s=()=>{this.emit(Xe.CONNECTION_STATE_CHANGE,e,t,n)};if(we.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:rn.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:Ut.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),I.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void s();if(e==="RECONNECTING")this._users.forEach(d=>{d._trust_in_room_=!1,d._trust_audio_enabled_state_=!1,d._trust_video_enabled_state_=!1,d._trust_audio_mute_state_=!1,d._trust_video_mute_state_=!1,d._trust_audio_stream_added_state_=!1,d._trust_video_stream_added_state_=!1,d._audioSSRC=void 0,d._videoSSRC=void 0,d._videoOrtc=void 0,d._audioOrtc=void 0,d._cname=void 0,d._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((d,h)=>{this._gateway.setStreamFallbackOption(h,d).catch(p=>{I.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),p)})}),this._remoteStreamTypeCacheMap.forEach((d,h)=>{this._gateway.setRemoteVideoStreamType(h,d).catch(p=>{I.warning("[".concat(this._clientId,"] auto set remote stream type failed"),p)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{I.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(d=>{I.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(d))}),this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(d=>!d._trust_in_room_).forEach(d=>{I.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(d.uid)),this._handleUserOffline({uid:d.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(d=>{d._trust_audio_mute_state_||(I.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(d.uid)),this._handleMuteStream(d.uid,"audio",!1)),d._trust_video_mute_state_||(I.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(d.uid)),this._handleMuteStream(d.uid,"video",!1)),d._trust_audio_enabled_state_||(I.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(d.uid)),this._handleSetStreamLocalEnable("audio",d.uid,!0)),d._trust_video_enabled_state_||(I.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(d.uid)),this._handleSetStreamLocalEnable("video",d.uid,!0)),d._trust_video_stream_added_state_||(I.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(d.uid)),this._handleResetAddStream(d,"video")),d._trust_audio_stream_added_state_||(I.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(d.uid)),this._handleResetAddStream(d,"audio")),d._video_added_||d._audio_added_||(I.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(d.uid)),this._handleRemoveStream({uid:d.uid,uint_id:d._uintid}))}))},1e3)}s()}),this._gateway.on(Lt.REQUEST_NEW_GATEWAY_LIST,(e,t)=>{if(!this._joinInfo)return t(new V(P.UNEXPECTED_ERROR,"can not recover, no join info"));IE(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||un,this.store).then(n=>{this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip),e(n.gatewayInfo.gatewayAddrs.map(i=>{if(this._joinInfo&&this._joinInfo.proxyServer){const s=i.address.split(":");return"wss://".concat(this._joinInfo.proxyServer,"/ws/?h=").concat(s[0],"&p=").concat(s[1])}return"wss://".concat(i.address)}))}).catch(t)}),this._gateway.on(Lt.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.emit(Xe.NETWORK_QUALITY,e)}),this._gateway.on(Lt.STREAM_TYPE_CHANGE,(e,t)=>{this.emit(Xe.STREAM_TYPE_CHANGED,e,t),we.reportApiInvoke(this._sessionId,{name:rn.STREAM_TYPE_CHANGE,options:[e,t],tag:Ut.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(Lt.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Lt.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(Lt.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{t(await this._p2pChannel.startP2PConnection(e))}catch(i){n(i)}}),this._gateway.on(Lt.JOIN_RESPONSE,(e,t)=>{const{dtlsParameters:n,iceParameters:i,candidates:s,rtpCapabilities:u,setup:d,cname:h}=jO(e.ortc,t);this._p2pChannel.connect(i,n,s,u,d,h)}),this._gateway.on(Lt.REQUEST_DC_CONNECTION_PARAMS,e=>{e(this._p2pChannel.getEstablishParams())}),this._gateway.on(Lt.RESET_SIGNAL,e=>{this._p2pChannel.resetConnection(e),this._handleGatewaySignalEvents()}),this._gateway.on(Lt.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(Lt.DATACHANNEL_PRECONNECT,async(e,t,n,i)=>{var s,u,d,h,p,m;await this._p2pChannel.startP2PConnection({turnServer:(s=this._joinInfo)===null||s===void 0?void 0:s.turnServer},!0);const _=function(E,y){let A;return y&&y.ip&&typeof y.port=="number"?(A=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:y.ip,port:y.port.toString(),type:"host",extension:{}}],I.debug("Using remote candidate from AP ".concat(y.ip,":").concat(y.port)),y.ip6&&(A.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:y.ip6,port:y.port.toString(),type:"host",extension:{}}),I.debug("Using IPV6 remote candidate from AP ".concat(y.ip6,":").concat(y.port)))):A=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:E.ip,port:E.port.toString(),type:"host",extension:{}}],A}(e,t);return this._p2pChannel.preConnect({iceUfrag:"".concat((u=this._joinInfo)===null||u===void 0?void 0:u.apResponse.cid,"_").concat((d=this._joinInfo)===null||d===void 0?void 0:d.apResponse.cert),icePwd:"".concat((h=this._joinInfo)===null||h===void 0?void 0:h.apResponse.cid,"_").concat((p=this._joinInfo)===null||p===void 0?void 0:p.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(m=H("FINGERPRINT"))!==null&&m!==void 0?m:e.fingerprint}]},_,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(n).catch(i)})}_handleGatewaySignalEvents(){this._gateway.signal.on(Ke.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Ke.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Ke.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(Ke.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Ke.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Ke.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Ke.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,"audio",!0)),this._gateway.signal.on(Ke.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,"audio",!1)),this._gateway.signal.on(Ke.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,"video",!0)),this._gateway.signal.on(Ke.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,"video",!1)),this._gateway.signal.on(Ke.RECEIVE_METADATA,e=>{const t=vE(e.metadata);this.emit(Xe.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Ke.ON_DATA_STREAM,e=>{e.seq&&delete e.seq,e.payload=vE(e.payload),this.emit(Xe.STREAM_MESSAGE,e.uid,e.payload),this.onStreamMessage&&this.onStreamMessage(e)}),this._gateway.signal.on(Ke.ON_CRYPT_ERROR,()=>{sd(()=>{I.warning("[".concat(this._clientId,"] on crypt error")),this.emit(Xe.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Ke.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Ke.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{I.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0),this.emit(Xe.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Ke.ON_STREAM_FALLBACK_UPDATE,e=>{I.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.emit(Xe.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Ke.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),I.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Ke.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Ke.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Ae.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case De.PUBLISH:{if(!t)return;const d=(t=t).ortc;if(d){var n,i,s,u;const h=d.some(_=>{let{stream_type:E}=_;return E===sn.Audio}),p=d.some(_=>{let{stream_type:E}=_;return E!==sn.Audio}),m=d.some(_=>{let{stream_type:E}=_;return E===sn.Screen||E===sn.ScreenLow});t.state==="offer"&&we.publish(this._joinInfo.sid,{eventElapse:ai.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:P.TIMEOUT,audio:h,video:p,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:h?(n=d.find(_=>{let{stream_type:E}=_;return E===sn.Audio}))===null||n===void 0||(i=n.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:p?(s=d.find(_=>{let{stream_type:E}=_;return E!==sn.Audio}))===null||s===void 0||(u=s.ssrcs[0])===null||u===void 0?void 0:u.ssrcId.toString():void 0})}break}case De.SUBSCRIBE:(t=t)&&we.subscribe(this._joinInfo.sid,{succ:!1,ec:P.TIMEOUT,audio:t.stream_type===je.AUDIO,video:t.stream_type===je.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:ai.measureFromSubscribeStart(this.store.clientId,t.ssrcId)})}}),this._gateway.signal.on(Ke.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Ke.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;H("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(i=>!va(i.audio_ssrc,this.channelName)));const t=[],n=[];for(const i of e.users){let s=this._users.find(m=>m.uid===i.stream_id);s?s._trust_in_room_=!0:(s=new OE(i.stream_id,i.stream_id),this._users.push(s),this.getListeners(Xe.PUBLISHED_USER_LIST).length===0&&(I.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.emit(Xe.USER_JOINED,s)));const u=Qt.Audio&i.stream_type,d=(Qt.Video|Qt.LwoVideo)&i.stream_type,h=u&&s.hasAudio,p=d&&s.hasVideo;d&&(s._trust_video_stream_added_state_=!0,s._video_added_=!0,s._videoSSRC=i.video_ssrc,s._rtxSsrcId=i.video_rtx),u&&(s._trust_audio_stream_added_state_=!0,s._audio_added_=!0,s._audioSSRC=i.audio_ssrc),u&&!h&&this.getListeners(Xe.PUBLISHED_USER_LIST).length===0&&(I.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published audio")),this.emit(Xe.USER_PUBLISHED,s,"audio")),d&&!p&&this.getListeners(Xe.PUBLISHED_USER_LIST).length===0&&(I.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published video")),this.emit(Xe.USER_PUBLISHED,s,"video")),(u&&!h||d&&!p)&&t.push(s),d&&this._p2pChannel.hasPendingRemoteMedia(s,"video")&&n.push({user:s,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(s,"audio")&&n.push({user:s,mediaType:"audio"})}n.length>0&&(I.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{I.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(Xe.PUBLISHED_USER_LIST).length>0?(I.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(i=>i.uid).join(", "))),this.emit(Xe.PUBLISHED_USER_LIST,t)):I.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(i=>i.uid).join(", ")))})}_handleP2PChannelEvents(){this._p2pChannel.on(Ze.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===P.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Ze.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===P.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Ze.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(Ze.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:i,kind:s}of e)s===je.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");t()}catch(i){n(i)}}),this._p2pChannel.on(Ze.RequestUploadStats,(e,t)=>{this._gateway.uploadStats(e,t)}),this._p2pChannel.on(Ze.MediaReconnectStart,e=>{this.emit(Xe.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Ze.MediaReconnectEnd,e=>{this.emit(Xe.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Ze.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ze.RequestRestartICE,async e=>{const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const i=n.value;let s;try{s=await this._gateway.restartICE({iceParameters:i})}catch(d){return void t.throw(d)}const{iceParameters:u}=function(d){const h=d.iceParameters;return{iceParameters:{iceUfrag:h.iceUfrag,icePwd:h.icePwd}}}(s);await t.next({remoteIceParameters:u})}),this._p2pChannel.on(Ze.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Ze.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:s,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:i}),{dtlsParameters:d,iceParameters:h,candidates:p,rtpCapabilities:m,setup:_,cname:E}=jO(s,u);await this._p2pChannel.connect(h,d,p,m,_,E),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Ze.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(Ze.P2PLost,()=>{this.emit(Xe.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ze.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Ze.ConnectionTypeChange,e=>{this.emit(Xe.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Ze.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ze.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new V(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new V(P.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!e)throw new V(P.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!e.inspectType||!Array.isArray(e.inspectType))throw new V(P.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const t=[...new Set(e.inspectType)];t.forEach(n=>{if(!["supervise","moderation"].includes(n))throw new V(P.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(n," is not a valid inspect type."))}),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new V(P.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const t=new Ep(e);this._inspect=t,this.handleVideoInspectEvents(this._inspect),await t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},un)}catch(t){throw Array.isArray(t)?t[0]:t}}async disableContentInspect(){if(!this._inspect)throw new V(P.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}handleVideoInspectEvents(e){e.on(an.CONNECTION_STATE_CHANGE,(t,n)=>{switch(this.emit(Xe.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n){case Gr.CONNECTED:if(this.connectionState!=="CONNECTED")return void this.emit(Xe.CONTENT_INSPECT_ERROR,new V(P.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(an.INSPECT_RESULT,(t,n)=>{var i;if((n==null?void 0:n.code)===P.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return I.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.emit(Xe.CONTENT_INSPECT_RESULT,t,n)}),e.on(an.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return I.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){ed(e,"enabled"),Et("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}}).prototype,"leave",[jb],Object.getOwnPropertyDescriptor(fe.prototype,"leave"),fe.prototype),ne(fe.prototype,"publish",[Fb],Object.getOwnPropertyDescriptor(fe.prototype,"publish"),fe.prototype),ne(fe.prototype,"unpublish",[Gb],Object.getOwnPropertyDescriptor(fe.prototype,"unpublish"),fe.prototype),ne(fe.prototype,"subscribe",[Wb],Object.getOwnPropertyDescriptor(fe.prototype,"subscribe"),fe.prototype),ne(fe.prototype,"massSubscribe",[Hb],Object.getOwnPropertyDescriptor(fe.prototype,"massSubscribe"),fe.prototype),ne(fe.prototype,"unsubscribe",[Kb],Object.getOwnPropertyDescriptor(fe.prototype,"unsubscribe"),fe.prototype),ne(fe.prototype,"massUnsubscribe",[zb],Object.getOwnPropertyDescriptor(fe.prototype,"massUnsubscribe"),fe.prototype),ne(fe.prototype,"setLowStreamParameter",[Yb],Object.getOwnPropertyDescriptor(fe.prototype,"setLowStreamParameter"),fe.prototype),ne(fe.prototype,"enableDualStream",[qb],Object.getOwnPropertyDescriptor(fe.prototype,"enableDualStream"),fe.prototype),ne(fe.prototype,"disableDualStream",[Jb],Object.getOwnPropertyDescriptor(fe.prototype,"disableDualStream"),fe.prototype),ne(fe.prototype,"setClientRole",[Xb],Object.getOwnPropertyDescriptor(fe.prototype,"setClientRole"),fe.prototype),ne(fe.prototype,"setProxyServer",[Qb],Object.getOwnPropertyDescriptor(fe.prototype,"setProxyServer"),fe.prototype),ne(fe.prototype,"setTurnServer",[$b],Object.getOwnPropertyDescriptor(fe.prototype,"setTurnServer"),fe.prototype),ne(fe.prototype,"setLicense",[Zb],Object.getOwnPropertyDescriptor(fe.prototype,"setLicense"),fe.prototype),ne(fe.prototype,"startProxyServer",[eN],Object.getOwnPropertyDescriptor(fe.prototype,"startProxyServer"),fe.prototype),ne(fe.prototype,"stopProxyServer",[tN],Object.getOwnPropertyDescriptor(fe.prototype,"stopProxyServer"),fe.prototype),ne(fe.prototype,"setLocalAccessPointsV2",[nN],Object.getOwnPropertyDescriptor(fe.prototype,"setLocalAccessPointsV2"),fe.prototype),ne(fe.prototype,"setLocalAccessPoints",[rN],Object.getOwnPropertyDescriptor(fe.prototype,"setLocalAccessPoints"),fe.prototype),ne(fe.prototype,"setRemoteDefaultVideoStreamType",[iN],Object.getOwnPropertyDescriptor(fe.prototype,"setRemoteDefaultVideoStreamType"),fe.prototype),ne(fe.prototype,"setRemoteVideoStreamType",[oN],Object.getOwnPropertyDescriptor(fe.prototype,"setRemoteVideoStreamType"),fe.prototype),ne(fe.prototype,"setStreamFallbackOption",[sN],Object.getOwnPropertyDescriptor(fe.prototype,"setStreamFallbackOption"),fe.prototype),ne(fe.prototype,"setEncryptionConfig",[aN],Object.getOwnPropertyDescriptor(fe.prototype,"setEncryptionConfig"),fe.prototype),ne(fe.prototype,"renewToken",[cN],Object.getOwnPropertyDescriptor(fe.prototype,"renewToken"),fe.prototype),ne(fe.prototype,"enableAudioVolumeIndicator",[uN],Object.getOwnPropertyDescriptor(fe.prototype,"enableAudioVolumeIndicator"),fe.prototype),ne(fe.prototype,"startLiveStreaming",[dN],Object.getOwnPropertyDescriptor(fe.prototype,"startLiveStreaming"),fe.prototype),ne(fe.prototype,"setLiveTranscoding",[lN],Object.getOwnPropertyDescriptor(fe.prototype,"setLiveTranscoding"),fe.prototype),ne(fe.prototype,"stopLiveStreaming",[hN],Object.getOwnPropertyDescriptor(fe.prototype,"stopLiveStreaming"),fe.prototype),ne(fe.prototype,"addInjectStreamUrl",[pN],Object.getOwnPropertyDescriptor(fe.prototype,"addInjectStreamUrl"),fe.prototype),ne(fe.prototype,"removeInjectStreamUrl",[fN],Object.getOwnPropertyDescriptor(fe.prototype,"removeInjectStreamUrl"),fe.prototype),ne(fe.prototype,"startChannelMediaRelay",[_N],Object.getOwnPropertyDescriptor(fe.prototype,"startChannelMediaRelay"),fe.prototype),ne(fe.prototype,"updateChannelMediaRelay",[mN],Object.getOwnPropertyDescriptor(fe.prototype,"updateChannelMediaRelay"),fe.prototype),ne(fe.prototype,"stopChannelMediaRelay",[EN],Object.getOwnPropertyDescriptor(fe.prototype,"stopChannelMediaRelay"),fe.prototype),ne(fe.prototype,"sendCustomReportMessage",[vN],Object.getOwnPropertyDescriptor(fe.prototype,"sendCustomReportMessage"),fe.prototype),ne(fe.prototype,"pickSVCLayer",[gN],Object.getOwnPropertyDescriptor(fe.prototype,"pickSVCLayer"),fe.prototype),ne(fe.prototype,"enableContentInspect",[SN],Object.getOwnPropertyDescriptor(fe.prototype,"enableContentInspect"),fe.prototype),ne(fe.prototype,"disableContentInspect",[TN],Object.getOwnPropertyDescriptor(fe.prototype,"disableContentInspect"),fe.prototype),ne(fe.prototype,"getJoinChannelServiceRecords",[yN],Object.getOwnPropertyDescriptor(fe.prototype,"getJoinChannelServiceRecords"),fe.prototype),ne(fe.prototype,"setPublishAudioFilterEnabled",[RN],Object.getOwnPropertyDescriptor(fe.prototype,"setPublishAudioFilterEnabled"),fe.prototype),fe);class A6 extends kI{set currentState(t){t!==this._currentState&&(this._currentState=t,this.emit(Er.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),g(this,"audioBuffer",void 0),g(this,"sourceNode",void 0),g(this,"startPlayTime",0),g(this,"startPlayOffset",0),g(this,"pausePlayTime",0),g(this,"options",void 0),g(this,"currentLoopCount",0),g(this,"currentPlaybackSpeed",100),g(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):I.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const IN=new Map;async function w6(e,t){let n=null;if(typeof e=="string"){const s=IN.get(e);if(s)return I.debug("use cached audio resource: ",e),s;try{n=(await po(()=>Ri.get(e,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(u){throw new V(P.FETCH_AUDIO_FILE_FAILED,u.toString())}}else n=await new Ee((u,d)=>{const h=new FileReader;h.onload=p=>{p.target?u(p.target.result):d(new V(P.READ_LOCAL_AUDIO_FILE_ERROR))},h.onerror=()=>{d(new V(P.READ_LOCAL_AUDIO_FILE_ERROR))},h.readAsArrayBuffer(e)});const i=await function(s){const u=Ac();return new Ee((d,h)=>{u.decodeAudioData(s,p=>{d(p)},p=>{h(new V(P.DECODE_AUDIO_FILE_FAILED,p.toString()))})})}(n);return typeof e=="string"&&t&&IN.set(e,i),i}function AN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function vp(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?AN(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AN(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function cv(e,t,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=vp(vp({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?I.debug("[".concat(e,"] set content hint to"),n.optimizationMode):I.debug("[".concat(e,"] set content hint failed")))):I.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}const O6=at().name;function b6(e,t,n,i){let s,u=0,d=null;return new Ee((h,p)=>{setTimeout(()=>{s&&(s(),h(u))},t),s=PI(()=>{(function(){u>i&&s&&(s(),h(u));const m=n.getContext("2d");if(!m){const y=new V(P.UNEXPECTED_ERROR,"can not get canvas 2d context.");return I.error(y.toString()),void p(y)}m.drawImage(e,0,0,160,120);const _=m.getImageData(0,0,n.width,n.height),E=Math.floor(_.data.length/3);if(d){for(let y=0;y<E;y+=3)if(_.data[y]!==d[y])return u+=1,void(d=_.data);d=_.data}else d=_.data})()},30)})}class Td{constructor(t,n){g(this,"id",0),g(this,"element",void 0),g(this,"peerPair",void 0),g(this,"context",void 0),g(this,"audioPlayerElement",void 0),g(this,"audioTrack",void 0),Td.count+=1,this.id=Td.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(i,s)=>{const u=s==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(u),i.iceGatheringState==="complete"?i.localDescription:new Ee(d=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&d(i.localDescription)}})},n=async(i,s)=>await i.setRemoteDescription(s);try{const i=await t(this.peerPair[0],"offer");await n(this.peerPair[1],i);const s=await t(this.peerPair[1],"answer");await n(this.peerPair[0],s)}catch(i){throw new V(P.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(s){throw new V(P.LOCAL_AEC_ERROR,s.toString()).print()}if(!n)throw new V(P.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){I.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var wN,gp;g(Td,"count",0);const N6=window.AudioContext||window.webkitAudioContext,P6=new(wN=be({report:we}),ne((gp=class{constructor(){g(this,"units",[]),g(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return I.debug("the system does not need to process local aec"),-1;this.context||(this.context=new N6);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new Td(e,this.context),this.units.push(t)),t.startEchoCancellation(),I.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return at().name!==ht.SAFARI}}).prototype,"processExternalMediaAEC",[wN],Object.getOwnPropertyDescriptor(gp.prototype,"processExternalMediaAEC"),gp.prototype),gp);function ON(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function bN(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ON(Object(n),!0).forEach(function(i){g(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ON(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const uv=window||document;function NN(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!uv)return;const n=hn._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const i=s=>{if(!(s&&s.blockedURI&&(hn.onSecurityPolicyViolation||hn.getListeners(zi.SECURITY_POLICY_VIOLATION).length>0)))return;const u=s.blockedURI;H("CSP_DETECTED_HOSTNAME_LIST").some(d=>u.includes(d))&&(hn.onSecurityPolicyViolation&&typeof hn.onSecurityPolicyViolation=="function"&&hn.onSecurityPolicyViolation(s),hn.getListeners(zi.SECURITY_POLICY_VIOLATION).length>0&&hn.emit(zi.SECURITY_POLICY_VIOLATION,s))};n&&uv.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||hn.getListeners(zi.SECURITY_POLICY_VIOLATION).length>0)&&uv.addEventListener("securitypolicyviolation",i),hn._cspEventHandlerPointer=i}Et("PROCESS_ID","process-".concat(bt(8,""),"-").concat(bt(4,""),"-").concat(bt(4,""),"-").concat(bt(4,""),"-").concat(bt(12,""))),function(){const e=at();zn.getDisplayMedia=function(t){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),zn.getStreamFromExtension=e.name===ht.CHROME&&Number(e.version)>34,zn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),zn.supportMinBitrate=e.name===ht.CHROME||e.name===ht.EDGE,zn.supportSetRtpSenderParameters=function(){const t=at();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!pa()||!(!$n()&&!Ch())||t.name===ht.FIREFOX&&Number(t.version)>=64}(),e.name===ht.SAFARI&&(Number(e.version)>=14?zn.supportDualStream=!0:zn.supportDualStream=!1),zn.webAudioMediaStreamDest=function(){const t=at();return!(t.name===ht.SAFARI&&Number(t.version)<12)}(),zn.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),zn.supportWebGL=typeof WebGLRenderingContext<"u",zn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,pa()||(zn.webAudioWithAEC=!0),zn.supportShareAudio=function(){const t=at();return(t.os===Ln.WIN_10||t.os===Ln.WIN_81||t.os===Ln.WIN_7||t.os===Ln.LINUX||t.os===Ln.MAC_OS)&&t.name===ht.CHROME&&Number(t.version)>=74}(),zn.supportDualStreamEncoding=function(){const t=at();return H("DISABLE_WEBAUDIO")?!0:t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&H("CHROME_DUAL_STREAM_USE_ENCODING"))}(),zn.supportDataChannel=function(){return!!(pm(76)||function(t){const n=at();return!(n.name!==ht.FIREFOX||!n.osVersion)&&Number(n.version)>=t}(68)||function(t){const n=at();return!(n.name!==ht.SAFARI||!n.osVersion)&&Number(n.version)>=t}(14))}(),zn.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!Bt()&&!!t&&t.prototype.setConfiguration instanceof Function}(),zn.supportWebRTCEncodedTransform=function(){const t=at();return t.name==="Chrome"&&Number(t.version)>=86}(),I.info("browser compatibility",JSON.stringify(zn),JSON.stringify(e))}(),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void I.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();I.debug("Loading global parameters from cache",t),Object.keys(t).forEach(i=>{if(Object.prototype.hasOwnProperty.call(mr,i)){const{value:s,expires:u}=t[i];if(u&&u<=n)return;ma[i]=s,mr[i]=s}})}catch(t){I.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(ma.AREAS)&&ma.AREAS.length>0&&TE(ma.AREAS,!0);const hn=function(e){const t=new jt,n=e,i={getListeners:t.getListeners.bind(t),on:(s,u)=>(function(d,h){d===zi.SECURITY_POLICY_VIOLATION&&NN(h,!0)}(s,u),t.on.bind(t)(s,u)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t)};return bN(bN({},n),i)}({__CLIENT_LIST__:Ea,__TRACK_LIST__:Zu,VERSION:si,BUILD:Dm,setParameter:(e,t,n)=>{I.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Et(e,t,n)},getParameter:H,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"});const n=(await t.createOffer()).sdp;if(!n)return e;t.close(),t=null,e=function(i){const s={video:[],audio:[]};return i.match(/ VP8/i)&&s.video.push("VP8"),i.match(/ VP9/i)&&s.video.push("VP9"),i.match(/ AV1/i)&&s.video.push("AV1"),i.match(/ H264/i)&&s.video.push("H264"),i.match(/ H265/i)&&s.video.push("H265"),i.match(/ opus/i)&&s.audio.push("OPUS"),i.match(/ PCMU/i)&&s.audio.push("PCMU"),i.match(/ PCMA/i)&&s.audio.push("PCMA"),i.match(/ G722/i)&&s.audio.push("G722"),s}(n)}catch(t){throw new V(P.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=we.reportApiInvoke(null,{name:rn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Ut.TRACER});let t=!1;try{const u=window.RTCPeerConnection,d=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,h=window.WebSocket;t=!!(u&&d&&h)}catch(u){return I.error("check system requirement failed: ",u),!1}let n=!1;const i=at();i.name===ht.CHROME&&Number(i.version)>=58&&(!z4()||K4())&&(n=!0),i.name===ht.FIREFOX&&Number(i.version)>=56&&(n=!0),i.name===ht.OPERA&&Number(i.version)>=45&&(n=!0),i.name===ht.SAFARI&&Number(i.version)>=11&&(n=!0),(iC()||at().name===ht.QQ)&&(n=!0),I.debug("checkSystemRequirements, api:",t,"browser",n);const s=t&&n;return e.onSuccess(s),s},getDevices:function(e){return zr.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return zr.getRecordingDevices(e)},getCameras:function(e){return zr.getCamerasDevices(e)},getElectronScreenSources:xI,getPlaybackDevices:function(e){return zr.getSpeakers(e)},createClient:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const t=we.reportApiInvoke(null,{name:rn.CREATE_CLIENT,options:[e],tag:Ut.TRACER});try{TF(e)}catch(n){throw t.onError(n),n}return e.audioCodec===void 0&&(e.audioCodec="opus"),t.onSuccess(),new I6(Sd(Sd({forceWaitGatewayResponse:!0},e),{},{role:e.mode==="rtc"?"host":e.role}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=we.reportApiInvoke(null,{tag:Ut.TRACER,name:rn.CREATE_CAM_VIDEO_TRACK,options:[vp({},e)]}),n=tp(e),i=bt(8,"track-cam-");let s=null;I.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{s=(await Ai({video:n},i)).getVideoTracks()[0]||null}catch(d){throw t.onError(d),d}if(!s){const d=new V(P.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(d),d.throw()}e.optimizationMode&&cv(i,s,e,_a(e.encoderConfig));const u=new iO(s,e,n,e.scalabiltyMode?Mh(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return t.onSuccess(u.getTrackId()),I.info("create camera video success, trackId:",i),u},createCustomVideoTrack:function(e){const t=we.reportApiInvoke(null,{tag:Ut.TRACER,name:rn.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new en(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Mh(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,bt(8,"track-cus-"),[dn.CUSTOM_TRACK]);return t.onSuccess(n.getTrackId()),I.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=we.reportApiInvoke(null,{tag:Ut.TRACER,name:rn.CREATE_SCREEN_VIDEO_TRACK,options:[vp({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const i=l8(e),s=bt(8,"track-scr-v-");let u=null,d=null;const h=Jt();if(!h.supportShareAudio&&t==="enable"){const _=new V(P.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(_),_.throw()}I.info("start create screen video track with config",e,"withAudio",t,"trackId",s);try{const _=await Ai({screen:i,screenAudio:t==="auto"?h.supportShareAudio:t==="enable"},s);u=_.getVideoTracks()[0]||null,d=_.getAudioTracks()[0]||null}catch(_){throw n.onError(_),_}if(!u){const _=new V(P.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(_),_.throw()}if(!d&&t==="enable"){u&&u.stop();const _=new V(P.SHARE_AUDIO_NOT_ALLOWED);return n.onError(_),_.throw()}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(cv(s,u,e,e.encoderConfig&&Lm(e.encoderConfig)),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const p=new en(u,e.encoderConfig?Lm(e.encoderConfig):{},e.scalabiltyMode?Mh(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s,[dn.SCREEN_TRACK]);if(!d)return n.onSuccess(p.getTrackId()),I.info("create screen video track success","video:",p.getTrackId()),p;const m=new jn(d,void 0,bt(8,"track-scr-a-"),!1,!0);return n.onSuccess([p.getTrackId(),m.getTrackId()]),I.info("create screen video track success","video:",p.getTrackId(),"audio:",m.getTrackId()),[p,m]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=we.reportApiInvoke(null,{tag:Ut.TRACER,name:rn.CREATE_MIC_AND_CAM_TRACKS,options:[e,t]}),i=tp(t),s=Rw(e),u=bt(8,"track-mic-"),d=bt(8,"track-cam-");let h=null,p=null;I.info("start create camera video track(".concat(d,") and microphone audio track(").concat(u,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const E=await Ai({audio:s,video:i},"".concat(u,"-").concat(d));h=E.getAudioTracks()[0],p=E.getVideoTracks()[0]}catch(E){throw n.onError(E),E}if(!h||!p){const E=new V(P.UNEXPECTED_ERROR,"can not find tracks in media stream");return n.onError(E),E.throw()}t.optimizationMode&&cv(d,p,t,_a(t.encoderConfig));const m=new zh(h,e,s,u),_=new iO(p,t,i,t.scalabiltyMode?Mh(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,d);return n.onSuccess([m.getTrackId(),_.getTrackId()]),I.info("create camera video track(".concat(d,") and microphone audio track(").concat(u,") success")),[m,_]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=we.reportApiInvoke(null,{tag:Ut.TRACER,name:rn.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=Rw(e),i=bt(8,"track-mic-");let s=null;I.info("start create microphone audio track with config",JSON.stringify(e),"trackId",i);try{s=(await Ai({audio:n},i)).getAudioTracks()[0]||null}catch(d){throw t.onError(d),d}if(!s){const d=new V(P.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(d),d.throw()}const u=new zh(s,e,n,i);return t.onSuccess(u.getTrackId()),I.info("create microphone audio track success, trackId:",i),u},createCustomAudioTrack:function(e){const t=we.reportApiInvoke(null,{tag:Ut.TRACER,name:rn.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new jn(e.mediaStreamTrack,e.encoderConfig?Uh(e.encoderConfig):{},bt(8,"track-cus-"),!1,!0);return I.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(e){const t=we.reportApiInvoke(null,{tag:Ut.TRACER,name:rn.CREATE_BUFFER_AUDIO_TRACK,options:[e]});if(H("DISABLE_WEBAUDIO"))throw new V(P.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const n=bt(8,"track-buf-");I.info("start create buffer source audio track with config",JSON.stringify(e),"trackId",n);const i=e.source;if(!(e.source instanceof AudioBuffer))try{e.source=await w6(e.source,e.cacheOnlineFile)}catch(d){return t.onError(d),d.throw()}const s=new A6(e.source),u=new G3(i,s,e.encoderConfig?Uh(e.encoderConfig):{},n);return I.info("create buffer source audio track success, trackId:",n),t.onSuccess(u.getTrackId()),u},setAppType:function(e){if(I.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw I.debug("Invalid appType"),new V(P.INVALID_PARAMS,"invalid app type",e);Et("APP_TYPE",Math.floor(e))},setLogLevel:function(e){I.setLogLevel(e)},enableLogUpload:function(){H("USE_NEW_LOG")?Et("UPLOAD_LOG",!0):I.enableLogUpload()},disableLogUpload:function(){H("USE_NEW_LOG")?Et("UPLOAD_LOG",!1):I.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new mw},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=we.reportApiInvoke(null,{tag:Ut.TRACER,name:rn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof jn||e instanceof pp)){const p=new V(P.INVALID_TRACK,"the parameter is not a audio track");return n.onError(p),p.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof jn?e.getTrackLabel():"remote_track",s=e.getVolumeLevel();let u=s,d=s;const h=Date.now();return new Ee(p=>{const m=setInterval(()=>{const _=e.getVolumeLevel();u=_>u?_:u,d=_<d?_:d;const E=u-d>1e-4,y=Date.now()-h;if(E||y>t){clearInterval(m);const A=E,k={duration:y,deviceLabel:i,maxVolumeLevel:u,result:A};I.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(k))),n.onSuccess(k),p(A)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=we.reportApiInvoke(null,{tag:Ut.TRACER,name:rn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof en||e instanceof hp)){const y=new V(P.INVALID_TRACK,"the parameter is not a video track");return n.onError(y),y.throw()}const i=4;t&&t<1e3&&(t=1e3);const s=e instanceof en?e.getTrackLabel():"remote_track",u=e.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,($n()||Ch())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([u]),d.play();const h=document.createElement("canvas");h.width=160,h.height=120;let p=0,m=0;try{const y=Date.now();p=await b6(d,t,h,i),m=Date.now()-y}catch(y){throw n.onError(y),y}O6===ht.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;const _=p>i,E={duration:m,changedPicNum:p,deviceLabel:s,result:_};return I.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(E))),n.onSuccess(E),_},setArea:TE,audioElementPlayCenter:Nr,processExternalMediaAEC:function(e){P6.processExternalMediaAEC(e)},registerExtensions:function(e){e.forEach(t=>{const n=t;n.__registered__=!0,n.logger.hookLog=I.extLog,n.reporter.hookApiInvoke=we.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach(i=>{n.parameters[i]=H(i)})})},ChannelMediaRelayError:vs,ChannelMediaRelayEvent:Hi,ChannelMediaRelayState:tr,RemoteStreamFallbackType:$m,RemoteStreamType:Qm,ConnectionDisconnectedReason:ct,AudienceLatencyLevelType:zm,AREAS:$e});return Object.defineProperties(hn,{onAudioAutoplayFailed:{get:()=>Hr.onAudioAutoplayFailed,set:e=>{Hr.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Hr.onAutoplayFailed,set:e=>{Hr.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>hn._onSecurityPolicyViolation,set(e){hn._onSecurityPolicyViolation=e,NN(e)}}}),zr.on(Bo.CAMERA_DEVICE_CHANGED,e=>{I.info("camera device changed",JSON.stringify(e)),hn.onCameraChanged&&hn.onCameraChanged(e),hn.emit(zi.CAMERA_CHANGED,e)}),zr.on(Bo.RECORDING_DEVICE_CHANGED,e=>{I.info("microphone device changed",JSON.stringify(e)),hn.onMicrophoneChanged&&hn.onMicrophoneChanged(e),hn.emit(zi.MICROPHONE_CHANGED,e)}),zr.on(Bo.PLAYOUT_DEVICE_CHANGED,e=>{I.debug("playout device changed",JSON.stringify(e)),hn.onPlaybackDeviceChanged&&hn.onPlaybackDeviceChanged(e),hn.emit(zi.PLAYBACK_DEVICE_CHANGED,e)}),Nr.onAutoplayFailed=()=>{I.info("detect audio element autoplay failed"),Hr.onAudioAutoplayFailed&&Hr.onAudioAutoplayFailed()},ut.on("autoplay-failed",()=>{I.info("detect webaudio autoplay failed"),Hr.onAudioAutoplayFailed&&Hr.onAudioAutoplayFailed(),hn.emit(zi.AUTOPLAY_FAILED)}),window&&(window.__ARTC__=hn),hn})})(fW);const vu=qP(Mg);class F1 extends Error{constructor(a,c){var o=(...args)=>{super(...args);Tt(this,"rtcMethod");Tt(this,"rtcError");Tt(this,"name","AgoraRTCReactException")};o(typeof c=="string"?c:c.message),this.rtcMethod=a,this.rtcError=c}print(a){typeof this.rtcError=="string"?console[a](this.rtcError):console[a](this.rtcError.message)}}const cL=Ye.createContext(null);function _W({client:r,children:o}){return Re(cL.Provider,{value:r,children:o})}function mW(r){const o=Ye.useContext(cL);return r||o}function uL(r){const o=mW(r);if(!o)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return o}function EW(r){const o=uL(r),[a,c]=Ye.useState(o?o.connectionState==="CONNECTED":!1);return Ye.useEffect(()=>{if(o){c(o.connectionState==="CONNECTED");let l;return iL([Xo(o,"connection-state-change",f=>{l==null||l(),l=dW(()=>c(f==="CONNECTED"),0)}),()=>l==null?void 0:l()])}else c(!1)},[o]),a}function G1(r,o,a){const c=uL(a),l=o==="audio"?"audioTrack":"videoTrack",[f,v]=Ye.useState(r&&r[l]),R=EW(),T=Ye.useRef(),[C,O]=Ye.useState(!1),[N,w]=Ye.useState(null);return Ye.useEffect(()=>{if(!r||!R)return;let B=!1;B||w(null);const U=o==="audio"?"hasAudio":"hasVideo",W=r.uid,q=async(M,j)=>{if(M[l]&&c.remoteUsers.some(({uid:K})=>M.uid===K))try{B||O(!0),await c.unsubscribe(M,j)}catch(K){B||w(new F1("IAgoraRTCClient.unsubscribe",K)),console.error(K)}B||(v(void 0),O(!1))},G=async(M,j)=>{try{!M[l]&&c.remoteUsers.some(({uid:K})=>M.uid===K)&&(B||O(!0),await c.subscribe(M,j)),B||v(M[l])}catch(K){B||w(new F1("IAgoraRTCClient.subscribe",K)),console.error(K)}B||O(!1)},b=T.current||(T.current=lW());return!r[l]&&r[U]?b.run(()=>G(r,o)):v(r[l]),iL([()=>{B=!0,b.dispose()},Xo(c,"user-published",(M,j)=>{M.uid===W&&j===o&&b.run(()=>G(M,o))}),Xo(c,"user-unpublished",(M,j)=>{M.uid===W&&j===o&&b.run(()=>q(M,o))})])},[R,c,r,o,l]),{track:f,isLoading:C,error:N}}function vW(r){const[o,a]=Ye.useState(0);return Ye.useEffect(()=>{if(r)return uW(()=>{a(r.getVolumeLevel())},1e3)},[r]),o}const dL=Ye.createContext(void 0);function lL(r,o,a){const c=Ye.useContext(dL);Ye.useEffect(()=>{if(r)return a&&o?r.play(a):r.stop(),c?(c.onMount(r),()=>c.onUnmount(r)):()=>{r.isPlaying&&r.stop()}},[r,a,o,c])}function hL(r,o){const a=Ye.useContext(dL);oL(()=>{if(r)return o?r.play():r.stop(),a?(a.onMount(r),()=>a.onUnmount(r)):()=>{r.isPlaying&&r.stop()}},[r,o,a])}function gW({track:r,play:o=!1,volume:a,disabled:c,muted:l,children:f}){const v=M0(r);return hL(v,o),Ye.useEffect(()=>{v&&a!=null&&v.setVolume(a)},[v,a]),Ye.useEffect(()=>{v&&c!=null&&v.setEnabled(!c).catch(console.warn)},[c,v]),Ye.useEffect(()=>{v&&l!=null&&v.setMuted(l).catch(console.warn)},[l,v]),f?Re(S0,{children:f}):null}const pL={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},fL={width:"100%",height:"100%"},YS={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},U0=(r,o)=>Ye.useMemo(()=>({...r,...o}),[r,o]);function SW({track:r,play:o,disabled:a,muted:c,style:l,...f}){const v=U0(fL,l),[R,T]=Ye.useState(null),C=M0(r);return lL(C,o,R),Ye.useEffect(()=>{C&&a!=null&&C.setEnabled(!a).catch(console.warn)},[a,C]),Ye.useEffect(()=>{C&&c!=null&&C.setMuted(c).catch(console.warn)},[c,C]),Re("div",{...f,ref:T,style:v})}function TW({track:r,deviceId:o,...a}){const c=M0(r);return Ye.useEffect(()=>{c&&o!=null&&c.setDevice(o).catch(console.warn)},[o,c]),Re(gW,{track:r,...a})}function yW({track:r,deviceId:o,...a}){const c=M0(r);return Ye.useEffect(()=>{c&&o!=null&&c.setDevice(o).catch(console.warn)},[o,c]),Re(SW,{track:r,...a})}const RW={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},CW={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function _L({cover:r}){return Re("div",{style:YS,children:typeof r=="string"?Nt(S0,{children:[Re("div",{style:{...RW,backgroundImage:`url(${r})`}}),Re("img",{src:r,style:CW})]}):r()})}function IW({micOn:r,cameraOn:o,audioTrack:a,videoTrack:c,playAudio:l,playVideo:f,micDeviceId:v,cameraDeviceId:R,volume:T,cover:C,children:O,style:N,...w}){const B=U0(pL,N);return f=f??!!o,l=l??!!r,Nt("div",{...w,style:B,children:[Re(yW,{deviceId:R,disabled:!o,play:f,track:c}),Re(TW,{deviceId:v,disabled:!r,play:l,track:a,volume:T}),C&&!o&&Re(_L,{cover:C}),Re("div",{style:YS,children:O})]})}function AW({track:r,play:o=!1,playbackDeviceId:a,volume:c,children:l}){return hL(r,o),Ye.useEffect(()=>{r&&a!=null&&r.setPlaybackDevice(a).catch(console.warn)},[r,a]),Ye.useEffect(()=>{r&&c!=null&&r.setVolume(c)},[r,c]),l?Re(S0,{children:l}):null}function mL({track:r,play:o,style:a,...c}){const l=U0(fL,a),[f,v]=Ye.useState(null);return lL(r,o,f),Re("div",{...c,ref:v,style:l})}function wW({user:r,playVideo:o,playAudio:a,playbackDeviceId:c,volume:l,cover:f,style:v,children:R,...T}){const C=U0(pL,v),{track:O}=G1(r,"video"),{track:N}=G1(r,"audio");return o=o??(r==null?void 0:r.hasVideo),a=a??(r==null?void 0:r.hasAudio),Nt("div",{...T,style:C,children:[Re(mL,{play:o,track:O}),Re(AW,{play:a,playbackDeviceId:c,track:N,volume:l}),f&&!o&&Re(_L,{cover:f}),Re("div",{style:YS,children:R})]})}function Dt(r){for(var o=arguments.length,a=new Array(o>1?o-1:0),c=1;c<o;c++)a[c-1]=arguments[c];throw new Error(typeof r=="number"?"[MobX] minified error nr: "+r+(a.length?" "+a.map(String).join(","):"")+". Find the full error at: https://github.com/mobxjs/mobx/blob/main/packages/mobx/src/errors.ts":"[MobX] "+r)}var OW={};function qS(){return typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:OW}var EL=Object.assign,Pf=Object.getOwnPropertyDescriptor,wo=Object.defineProperty,V0=Object.prototype,Ug=[];Object.freeze(Ug);var vL={};Object.freeze(vL);var bW=typeof Proxy<"u",NW=Object.toString();function gL(){bW||Dt("Proxy not available")}function SL(r){var o=!1;return function(){if(!o)return o=!0,r.apply(this,arguments)}}var tu=function(){};function ao(r){return typeof r=="function"}function Ga(r){var o=typeof r;switch(o){case"string":case"symbol":case"number":return!0}return!1}function B0(r){return r!==null&&typeof r=="object"}function rs(r){if(!B0(r))return!1;var o=Object.getPrototypeOf(r);if(o==null)return!0;var a=Object.hasOwnProperty.call(o,"constructor")&&o.constructor;return typeof a=="function"&&a.toString()===NW}function TL(r){var o=r==null?void 0:r.constructor;return o?o.name==="GeneratorFunction"||o.displayName==="GeneratorFunction":!1}function Rl(r,o,a){wo(r,o,{enumerable:!1,writable:!0,configurable:!0,value:a})}function yL(r,o,a){wo(r,o,{enumerable:!1,writable:!1,configurable:!0,value:a})}function Ka(r,o){var a="isMobX"+r;return o.prototype[a]=!0,function(c){return B0(c)&&c[a]===!0}}function Au(r){return r instanceof Map}function Cl(r){return r instanceof Set}var RL=typeof Object.getOwnPropertySymbols<"u";function PW(r){var o=Object.keys(r);if(!RL)return o;var a=Object.getOwnPropertySymbols(r);return a.length?[].concat(o,a.filter(function(c){return V0.propertyIsEnumerable.call(r,c)})):o}var gu=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:RL?function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:Object.getOwnPropertyNames;function CL(r){return r===null?null:typeof r=="object"?""+r:r}function $o(r,o){return V0.hasOwnProperty.call(r,o)}var DW=Object.getOwnPropertyDescriptors||function(o){var a={};return gu(o).forEach(function(c){a[c]=Pf(o,c)}),a};function W1(r,o){for(var a=0;a<o.length;a++){var c=o[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,xW(c.key),c)}}function JS(r,o,a){return o&&W1(r.prototype,o),a&&W1(r,a),Object.defineProperty(r,"prototype",{writable:!1}),r}function Su(){return Su=Object.assign?Object.assign.bind():function(r){for(var o=1;o<arguments.length;o++){var a=arguments[o];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(r[c]=a[c])}return r},Su.apply(this,arguments)}function IL(r,o){r.prototype=Object.create(o.prototype),r.prototype.constructor=r,Vg(r,o)}function Vg(r,o){return Vg=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,l){return c.__proto__=l,c},Vg(r,o)}function Mv(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function kW(r,o){if(r){if(typeof r=="string")return H1(r,o);var a=Object.prototype.toString.call(r).slice(8,-1);if(a==="Object"&&r.constructor&&(a=r.constructor.name),a==="Map"||a==="Set")return Array.from(r);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return H1(r,o)}}function H1(r,o){(o==null||o>r.length)&&(o=r.length);for(var a=0,c=new Array(o);a<o;a++)c[a]=r[a];return c}function nu(r,o){var a=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(a)return(a=a.call(r)).next.bind(a);if(Array.isArray(r)||(a=kW(r))||o&&r&&typeof r.length=="number"){a&&(r=a);var c=0;return function(){return c>=r.length?{done:!0}:{done:!1,value:r[c++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LW(r,o){if(typeof r!="object"||r===null)return r;var a=r[Symbol.toPrimitive];if(a!==void 0){var c=a.call(r,o||"default");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(r)}function xW(r){var o=LW(r,"string");return typeof o=="symbol"?o:String(o)}var Co=Symbol("mobx-stored-annotations");function Oo(r){function o(a,c){Il(a,c,r)}return Object.assign(o,r)}function Il(r,o,a){$o(r,Co)||Rl(r,Co,Su({},r[Co])),HW(a)||(r[Co][o]=a)}function MW(r){return $o(r,Co)||Rl(r,Co,Su({},r[Co])),r[Co]}var ot=Symbol("mobx administration"),Al=function(){function r(a){a===void 0&&(a="Atom"),this.name_=void 0,this.isPendingUnobservation_=!1,this.isBeingObserved_=!1,this.observers_=new Set,this.diffValue_=0,this.lastAccessedBy_=0,this.lowestObserverState_=xt.NOT_TRACKING_,this.onBOL=void 0,this.onBUOL=void 0,this.name_=a}var o=r.prototype;return o.onBO=function(){this.onBOL&&this.onBOL.forEach(function(c){return c()})},o.onBUO=function(){this.onBUOL&&this.onBUOL.forEach(function(c){return c()})},o.reportObserved=function(){return KL(this)},o.reportChanged=function(){Qr(),zL(this),$r()},o.toString=function(){return this.name_},r}(),XS=Ka("Atom",Al);function AL(r,o,a){o===void 0&&(o=tu),a===void 0&&(a=tu);var c=new Al(r);return o!==tu&&HH(c,o),a!==tu&&ZL(c,a),c}function UW(r,o){return r===o}function VW(r,o){return nT(r,o)}function BW(r,o){return nT(r,o,1)}function jW(r,o){return Object.is?Object.is(r,o):r===o?r!==0||1/r===1/o:r!==r&&o!==o}var Df={identity:UW,structural:VW,default:jW,shallow:BW};function Tu(r,o,a){return ix(r)?r:Array.isArray(r)?ir.array(r,{name:a}):rs(r)?ir.object(r,void 0,{name:a}):Au(r)?ir.map(r,{name:a}):Cl(r)?ir.set(r,{name:a}):typeof r=="function"&&!ZS(r)&&!Mf(r)?TL(r)?_l(r):fl(a,r):r}function FW(r,o,a){if(r==null||ml(r)||H0(r)||za(r)||Ou(r))return r;if(Array.isArray(r))return ir.array(r,{name:a,deep:!1});if(rs(r))return ir.object(r,void 0,{name:a,deep:!1});if(Au(r))return ir.map(r,{name:a,deep:!1});if(Cl(r))return ir.set(r,{name:a,deep:!1})}function j0(r){return r}function GW(r,o){return nT(r,o)?o:r}var WW="override";function HW(r){return r.annotationType_===WW}function wl(r,o){return{annotationType_:r,options_:o,make_:KW,extend_:zW}}function KW(r,o,a,c){var l;if((l=this.options_)!=null&&l.bound)return this.extend_(r,o,a,!1)===null?0:1;if(c===r.target_)return this.extend_(r,o,a,!1)===null?0:2;if(ZS(a.value))return 1;var f=wL(r,this,o,a,!1);return wo(c,o,f),2}function zW(r,o,a,c){var l=wL(r,this,o,a);return r.defineProperty_(o,l,c)}function YW(r,o,a,c){o.annotationType_,c.value}function wL(r,o,a,c,l){var f,v,R,T,C,O,N;l===void 0&&(l=Ne.safeDescriptors),YW(r,o,a,c);var w=c.value;if((f=o.options_)!=null&&f.bound){var B;w=w.bind((B=r.proxy_)!=null?B:r.target_)}return{value:yu((v=(R=o.options_)==null?void 0:R.name)!=null?v:a.toString(),w,(T=(C=o.options_)==null?void 0:C.autoAction)!=null?T:!1,(O=o.options_)!=null&&O.bound?(N=r.proxy_)!=null?N:r.target_:void 0),configurable:l?r.isPlainObject_:!0,enumerable:!1,writable:!l}}function OL(r,o){return{annotationType_:r,options_:o,make_:qW,extend_:JW}}function qW(r,o,a,c){var l;if(c===r.target_)return this.extend_(r,o,a,!1)===null?0:2;if((l=this.options_)!=null&&l.bound&&(!$o(r.target_,o)||!Mf(r.target_[o]))&&this.extend_(r,o,a,!1)===null)return 0;if(Mf(a.value))return 1;var f=bL(r,this,o,a,!1,!1);return wo(c,o,f),2}function JW(r,o,a,c){var l,f=bL(r,this,o,a,(l=this.options_)==null?void 0:l.bound);return r.defineProperty_(o,f,c)}function XW(r,o,a,c){o.annotationType_,c.value}function bL(r,o,a,c,l,f){f===void 0&&(f=Ne.safeDescriptors),XW(r,o,a,c);var v=c.value;if(Mf(v)||(v=_l(v)),l){var R;v=v.bind((R=r.proxy_)!=null?R:r.target_),v.isMobXFlow=!0}return{value:v,configurable:f?r.isPlainObject_:!0,enumerable:!1,writable:!f}}function QS(r,o){return{annotationType_:r,options_:o,make_:QW,extend_:$W}}function QW(r,o,a){return this.extend_(r,o,a,!1)===null?0:1}function $W(r,o,a,c){return ZW(r,this,o,a),r.defineComputedProperty_(o,Su({},this.options_,{get:a.get,set:a.set}),c)}function ZW(r,o,a,c){o.annotationType_,c.get}function F0(r,o){return{annotationType_:r,options_:o,make_:eH,extend_:tH}}function eH(r,o,a){return this.extend_(r,o,a,!1)===null?0:1}function tH(r,o,a,c){var l,f;return nH(r,this),r.defineObservableProperty_(o,a.value,(l=(f=this.options_)==null?void 0:f.enhancer)!=null?l:Tu,c)}function nH(r,o,a,c){o.annotationType_}var rH="true",iH=NL();function NL(r){return{annotationType_:rH,options_:r,make_:oH,extend_:sH}}function oH(r,o,a,c){var l,f;if(a.get)return G0.make_(r,o,a,c);if(a.set){var v=yu(o.toString(),a.set);return c===r.target_?r.defineProperty_(o,{configurable:Ne.safeDescriptors?r.isPlainObject_:!0,set:v})===null?0:2:(wo(c,o,{configurable:!0,set:v}),2)}if(c!==r.target_&&typeof a.value=="function"){var R;if(TL(a.value)){var T,C=(T=this.options_)!=null&&T.autoBind?_l.bound:_l;return C.make_(r,o,a,c)}var O=(R=this.options_)!=null&&R.autoBind?fl.bound:fl;return O.make_(r,o,a,c)}var N=((l=this.options_)==null?void 0:l.deep)===!1?ir.ref:ir;if(typeof a.value=="function"&&(f=this.options_)!=null&&f.autoBind){var w;a.value=a.value.bind((w=r.proxy_)!=null?w:r.target_)}return N.make_(r,o,a,c)}function sH(r,o,a,c){var l,f;if(a.get)return G0.extend_(r,o,a,c);if(a.set)return r.defineProperty_(o,{configurable:Ne.safeDescriptors?r.isPlainObject_:!0,set:yu(o.toString(),a.set)},c);if(typeof a.value=="function"&&(l=this.options_)!=null&&l.autoBind){var v;a.value=a.value.bind((v=r.proxy_)!=null?v:r.target_)}var R=((f=this.options_)==null?void 0:f.deep)===!1?ir.ref:ir;return R.extend_(r,o,a,c)}var aH="observable",cH="observable.ref",uH="observable.shallow",dH="observable.struct",PL={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};Object.freeze(PL);function Up(r){return r||PL}var DL=F0(aH),lH=F0(cH,{enhancer:j0}),hH=F0(uH,{enhancer:FW}),pH=F0(dH,{enhancer:GW}),kL=Oo(DL);function Vp(r){return r.deep===!0?Tu:r.deep===!1?j0:_H(r.defaultDecorator)}function fH(r){var o;return r?(o=r.defaultDecorator)!=null?o:NL(r):void 0}function _H(r){var o,a;return r&&(o=(a=r.options_)==null?void 0:a.enhancer)!=null?o:Tu}function LL(r,o,a){if(Ga(o)){Il(r,o,DL);return}return ix(r)?r:rs(r)?ir.object(r,o,a):Array.isArray(r)?ir.array(r,o):Au(r)?ir.map(r,o):Cl(r)?ir.set(r,o):typeof r=="object"&&r!==null?r:ir.box(r,o)}EL(LL,kL);var mH={box:function(o,a){var c=Up(a);return new du(o,Vp(c),c.name,!0,c.equals)},array:function(o,a){var c=Up(a);return(Ne.useProxies===!1||c.proxy===!1?_K:sK)(o,Vp(c),c.name)},map:function(o,a){var c=Up(a);return new cx(o,Vp(c),c.name)},set:function(o,a){var c=Up(a);return new lx(o,Vp(c),c.name)},object:function(o,a,c){return tx(Ne.useProxies===!1||(c==null?void 0:c.proxy)===!1?kl({},c):nK({},c),o,a)},ref:Oo(lH),shallow:Oo(hH),deep:kL,struct:Oo(pH)},ir=EL(LL,mH),xL="computed",EH="computed.struct",ML=QS(xL),vH=QS(EH,{equals:Df.structural}),G0=function(o,a){if(Ga(a))return Il(o,a,ML);if(rs(o))return Oo(QS(xL,o));var c=rs(a)?a:{};return c.get=o,c.name||(c.name=o.name||""),new hl(c)};Object.assign(G0,ML);G0.struct=Oo(vH);var K1,z1,kf=0,gH=1,SH=(K1=(z1=Pf(function(){},"name"))==null?void 0:z1.configurable)!=null?K1:!1,Y1={value:"action",configurable:!0,writable:!1,enumerable:!1};function yu(r,o,a,c){a===void 0&&(a=!1);function l(){return TH(r,a,o,c||this,arguments)}return l.isMobxAction=!0,SH&&(Y1.value=r,wo(l,"name",Y1)),l}function TH(r,o,a,c,l){var f=yH(r,o);try{return a.apply(c,l)}catch(v){throw f.error_=v,v}finally{RH(f)}}function yH(r,o,a,c){var l=!1,f=0,v=Ne.trackingDerivation,R=!o||!v;Qr();var T=Ne.allowStateChanges;R&&(wu(),T=Ol(!0));var C=$S(!0),O={runAsAction_:R,prevDerivation_:v,prevAllowStateChanges_:T,prevAllowStateReads_:C,notifySpy_:l,startTime_:f,actionId_:gH++,parentActionId_:kf};return kf=O.actionId_,O}function RH(r){kf!==r.actionId_&&Dt(30),kf=r.parentActionId_,r.error_!==void 0&&(Ne.suppressReactionErrors=!0),bl(r.prevAllowStateChanges_),zd(r.prevAllowStateReads_),$r(),r.runAsAction_&&qs(r.prevDerivation_),Ne.suppressReactionErrors=!1}function CH(r,o){var a=Ol(r);try{return o()}finally{bl(a)}}function Ol(r){var o=Ne.allowStateChanges;return Ne.allowStateChanges=r,o}function bl(r){Ne.allowStateChanges=r}var UL;UL=Symbol.toPrimitive;var du=function(r){IL(o,r);function o(c,l,f,v,R){var T;return f===void 0&&(f="ObservableValue"),R===void 0&&(R=Df.default),T=r.call(this,f)||this,T.enhancer=void 0,T.name_=void 0,T.equals=void 0,T.hasUnreportedChange_=!1,T.interceptors_=void 0,T.changeListeners_=void 0,T.value_=void 0,T.dehancer=void 0,T.enhancer=l,T.name_=f,T.equals=R,T.value_=l(c,void 0,f),T}var a=o.prototype;return a.dehanceValue=function(l){return this.dehancer!==void 0?this.dehancer(l):l},a.set=function(l){this.value_,l=this.prepareNewValue_(l),l!==Ne.UNCHANGED&&this.setNewValue_(l)},a.prepareNewValue_=function(l){if(ki(this)){var f=Li(this,{object:this,type:bo,newValue:l});if(!f)return Ne.UNCHANGED;l=f.newValue}return l=this.enhancer(l,this.value_,this.name_),this.equals(this.value_,l)?Ne.UNCHANGED:l},a.setNewValue_=function(l){var f=this.value_;this.value_=l,this.reportChanged(),io(this)&&oo(this,{type:bo,object:this,newValue:l,oldValue:f})},a.get=function(){return this.reportObserved(),this.dehanceValue(this.value_)},a.intercept_=function(l){return Nl(this,l)},a.observe_=function(l,f){return f&&l({observableKind:"value",debugObjectName:this.name_,object:this,type:bo,newValue:this.value_,oldValue:void 0}),Pl(this,l)},a.raw=function(){return this.value_},a.toJSON=function(){return this.get()},a.toString=function(){return this.name_+"["+this.value_+"]"},a.valueOf=function(){return CL(this.get())},a[UL]=function(){return this.valueOf()},o}(Al),VL;VL=Symbol.toPrimitive;var hl=function(){function r(a){this.dependenciesState_=xt.NOT_TRACKING_,this.observing_=[],this.newObserving_=null,this.isBeingObserved_=!1,this.isPendingUnobservation_=!1,this.observers_=new Set,this.diffValue_=0,this.runId_=0,this.lastAccessedBy_=0,this.lowestObserverState_=xt.UP_TO_DATE_,this.unboundDepsCount_=0,this.value_=new Lf(null),this.name_=void 0,this.triggeredBy_=void 0,this.isComputing_=!1,this.isRunningSetter_=!1,this.derivation=void 0,this.setter_=void 0,this.isTracing_=Ma.NONE,this.scope_=void 0,this.equals_=void 0,this.requiresReaction_=void 0,this.keepAlive_=void 0,this.onBOL=void 0,this.onBUOL=void 0,a.get||Dt(31),this.derivation=a.get,this.name_=a.name||"ComputedValue",a.set&&(this.setter_=yu("ComputedValue-setter",a.set)),this.equals_=a.equals||(a.compareStructural||a.struct?Df.structural:Df.default),this.scope_=a.context,this.requiresReaction_=a.requiresReaction,this.keepAlive_=!!a.keepAlive}var o=r.prototype;return o.onBecomeStale_=function(){bH(this)},o.onBO=function(){this.onBOL&&this.onBOL.forEach(function(c){return c()})},o.onBUO=function(){this.onBUOL&&this.onBUOL.forEach(function(c){return c()})},o.get=function(){if(this.isComputing_&&Dt(32,this.name_,this.derivation),Ne.inBatch===0&&this.observers_.size===0&&!this.keepAlive_)Bg(this)&&(this.warnAboutUntrackedRead_(),Qr(),this.value_=this.computeValue_(!1),$r());else if(KL(this),Bg(this)){var c=Ne.trackingContext;this.keepAlive_&&!c&&(Ne.trackingContext=this),this.trackAndCompute()&&OH(this),Ne.trackingContext=c}var l=this.value_;if(nf(l))throw l.cause;return l},o.set=function(c){if(this.setter_){this.isRunningSetter_&&Dt(33,this.name_),this.isRunningSetter_=!0;try{this.setter_.call(this.scope_,c)}finally{this.isRunningSetter_=!1}}else Dt(34,this.name_)},o.trackAndCompute=function(){var c=this.value_,l=this.dependenciesState_===xt.NOT_TRACKING_,f=this.computeValue_(!0),v=l||nf(c)||nf(f)||!this.equals_(c,f);return v&&(this.value_=f),v},o.computeValue_=function(c){this.isComputing_=!0;var l=Ol(!1),f;if(c)f=BL(this,this.derivation,this.scope_);else if(Ne.disableErrorBoundaries===!0)f=this.derivation.call(this.scope_);else try{f=this.derivation.call(this.scope_)}catch(v){f=new Lf(v)}return bl(l),this.isComputing_=!1,f},o.suspend_=function(){this.keepAlive_||(jg(this),this.value_=void 0)},o.observe_=function(c,l){var f=this,v=!0,R=void 0;return BH(function(){var T=f.get();if(!v||l){var C=wu();c({observableKind:"computed",debugObjectName:f.name_,type:bo,object:f,newValue:T,oldValue:R}),qs(C)}v=!1,R=T})},o.warnAboutUntrackedRead_=function(){},o.toString=function(){return this.name_+"["+this.derivation.toString()+"]"},o.valueOf=function(){return CL(this.get())},o[VL]=function(){return this.valueOf()},r}(),W0=Ka("ComputedValue",hl),xt;(function(r){r[r.NOT_TRACKING_=-1]="NOT_TRACKING_",r[r.UP_TO_DATE_=0]="UP_TO_DATE_",r[r.POSSIBLY_STALE_=1]="POSSIBLY_STALE_",r[r.STALE_=2]="STALE_"})(xt||(xt={}));var Ma;(function(r){r[r.NONE=0]="NONE",r[r.LOG=1]="LOG",r[r.BREAK=2]="BREAK"})(Ma||(Ma={}));var Lf=function(o){this.cause=void 0,this.cause=o};function nf(r){return r instanceof Lf}function Bg(r){switch(r.dependenciesState_){case xt.UP_TO_DATE_:return!1;case xt.NOT_TRACKING_:case xt.STALE_:return!0;case xt.POSSIBLY_STALE_:{for(var o=$S(!0),a=wu(),c=r.observing_,l=c.length,f=0;f<l;f++){var v=c[f];if(W0(v)){if(Ne.disableErrorBoundaries)v.get();else try{v.get()}catch{return qs(a),zd(o),!0}if(r.dependenciesState_===xt.STALE_)return qs(a),zd(o),!0}}return FL(r),qs(a),zd(o),!1}}}function BL(r,o,a){var c=$S(!0);FL(r),r.newObserving_=new Array(r.observing_.length+100),r.unboundDepsCount_=0,r.runId_=++Ne.runId;var l=Ne.trackingDerivation;Ne.trackingDerivation=r,Ne.inBatch++;var f;if(Ne.disableErrorBoundaries===!0)f=o.call(a);else try{f=o.call(a)}catch(v){f=new Lf(v)}return Ne.inBatch--,Ne.trackingDerivation=l,IH(r),zd(c),f}function IH(r){for(var o=r.observing_,a=r.observing_=r.newObserving_,c=xt.UP_TO_DATE_,l=0,f=r.unboundDepsCount_,v=0;v<f;v++){var R=a[v];R.diffValue_===0&&(R.diffValue_=1,l!==v&&(a[l]=R),l++),R.dependenciesState_>c&&(c=R.dependenciesState_)}for(a.length=l,r.newObserving_=null,f=o.length;f--;){var T=o[f];T.diffValue_===0&&WL(T,r),T.diffValue_=0}for(;l--;){var C=a[l];C.diffValue_===1&&(C.diffValue_=0,wH(C,r))}c!==xt.UP_TO_DATE_&&(r.dependenciesState_=c,r.onBecomeStale_())}function jg(r){var o=r.observing_;r.observing_=[];for(var a=o.length;a--;)WL(o[a],r);r.dependenciesState_=xt.NOT_TRACKING_}function jL(r){var o=wu();try{return r()}finally{qs(o)}}function wu(){var r=Ne.trackingDerivation;return Ne.trackingDerivation=null,r}function qs(r){Ne.trackingDerivation=r}function $S(r){var o=Ne.allowStateReads;return Ne.allowStateReads=r,o}function zd(r){Ne.allowStateReads=r}function FL(r){if(r.dependenciesState_!==xt.UP_TO_DATE_){r.dependenciesState_=xt.UP_TO_DATE_;for(var o=r.observing_,a=o.length;a--;)o[a].lowestObserverState_=xt.UP_TO_DATE_}}var rf=function(){this.version=6,this.UNCHANGED={},this.trackingDerivation=null,this.trackingContext=null,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!1,this.allowStateReads=!0,this.enforceActions=!0,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1,this.useProxies=!0,this.verifyProxies=!1,this.safeDescriptors=!0},of=!0,GL=!1,Ne=function(){var r=qS();return r.__mobxInstanceCount>0&&!r.__mobxGlobals&&(of=!1),r.__mobxGlobals&&r.__mobxGlobals.version!==new rf().version&&(of=!1),of?r.__mobxGlobals?(r.__mobxInstanceCount+=1,r.__mobxGlobals.UNCHANGED||(r.__mobxGlobals.UNCHANGED={}),r.__mobxGlobals):(r.__mobxInstanceCount=1,r.__mobxGlobals=new rf):(setTimeout(function(){GL||Dt(35)},1),new rf)}();function AH(){if((Ne.pendingReactions.length||Ne.inBatch||Ne.isRunningReactions)&&Dt(36),GL=!0,of){var r=qS();--r.__mobxInstanceCount===0&&(r.__mobxGlobals=void 0),Ne=new rf}}function wH(r,o){r.observers_.add(o),r.lowestObserverState_>o.dependenciesState_&&(r.lowestObserverState_=o.dependenciesState_)}function WL(r,o){r.observers_.delete(o),r.observers_.size===0&&HL(r)}function HL(r){r.isPendingUnobservation_===!1&&(r.isPendingUnobservation_=!0,Ne.pendingUnobservations.push(r))}function Qr(){Ne.inBatch++}function $r(){if(--Ne.inBatch===0){YL();for(var r=Ne.pendingUnobservations,o=0;o<r.length;o++){var a=r[o];a.isPendingUnobservation_=!1,a.observers_.size===0&&(a.isBeingObserved_&&(a.isBeingObserved_=!1,a.onBUO()),a instanceof hl&&a.suspend_())}Ne.pendingUnobservations=[]}}function KL(r){var o=Ne.trackingDerivation;return o!==null?(o.runId_!==r.lastAccessedBy_&&(r.lastAccessedBy_=o.runId_,o.newObserving_[o.unboundDepsCount_++]=r,!r.isBeingObserved_&&Ne.trackingContext&&(r.isBeingObserved_=!0,r.onBO())),r.isBeingObserved_):(r.observers_.size===0&&Ne.inBatch>0&&HL(r),!1)}function zL(r){r.lowestObserverState_!==xt.STALE_&&(r.lowestObserverState_=xt.STALE_,r.observers_.forEach(function(o){o.dependenciesState_===xt.UP_TO_DATE_&&o.onBecomeStale_(),o.dependenciesState_=xt.STALE_}))}function OH(r){r.lowestObserverState_!==xt.STALE_&&(r.lowestObserverState_=xt.STALE_,r.observers_.forEach(function(o){o.dependenciesState_===xt.POSSIBLY_STALE_?o.dependenciesState_=xt.STALE_:o.dependenciesState_===xt.UP_TO_DATE_&&(r.lowestObserverState_=xt.UP_TO_DATE_)}))}function bH(r){r.lowestObserverState_===xt.UP_TO_DATE_&&(r.lowestObserverState_=xt.POSSIBLY_STALE_,r.observers_.forEach(function(o){o.dependenciesState_===xt.UP_TO_DATE_&&(o.dependenciesState_=xt.POSSIBLY_STALE_,o.onBecomeStale_())}))}var pl=function(){function r(a,c,l,f){a===void 0&&(a="Reaction"),this.name_=void 0,this.onInvalidate_=void 0,this.errorHandler_=void 0,this.requiresObservable_=void 0,this.observing_=[],this.newObserving_=[],this.dependenciesState_=xt.NOT_TRACKING_,this.diffValue_=0,this.runId_=0,this.unboundDepsCount_=0,this.isDisposed_=!1,this.isScheduled_=!1,this.isTrackPending_=!1,this.isRunning_=!1,this.isTracing_=Ma.NONE,this.name_=a,this.onInvalidate_=c,this.errorHandler_=l,this.requiresObservable_=f}var o=r.prototype;return o.onBecomeStale_=function(){this.schedule_()},o.schedule_=function(){this.isScheduled_||(this.isScheduled_=!0,Ne.pendingReactions.push(this),YL())},o.isScheduled=function(){return this.isScheduled_},o.runReaction_=function(){if(!this.isDisposed_){Qr(),this.isScheduled_=!1;var c=Ne.trackingContext;if(Ne.trackingContext=this,Bg(this)){this.isTrackPending_=!0;try{this.onInvalidate_()}catch(l){this.reportExceptionInDerivation_(l)}}Ne.trackingContext=c,$r()}},o.track=function(c){if(!this.isDisposed_){Qr(),this.isRunning_=!0;var l=Ne.trackingContext;Ne.trackingContext=this;var f=BL(this,c,void 0);Ne.trackingContext=l,this.isRunning_=!1,this.isTrackPending_=!1,this.isDisposed_&&jg(this),nf(f)&&this.reportExceptionInDerivation_(f.cause),$r()}},o.reportExceptionInDerivation_=function(c){var l=this;if(this.errorHandler_){this.errorHandler_(c,this);return}if(Ne.disableErrorBoundaries)throw c;var f="[mobx] uncaught error in '"+this+"'";Ne.suppressReactionErrors||console.error(f,c),Ne.globalReactionErrorHandlers.forEach(function(v){return v(c,l)})},o.dispose=function(){this.isDisposed_||(this.isDisposed_=!0,this.isRunning_||(Qr(),jg(this),$r()))},o.getDisposer_=function(){var c=this.dispose.bind(this);return c[ot]=this,c},o.toString=function(){return"Reaction["+this.name_+"]"},o.trace=function(c){c===void 0&&(c=!1),ZH(this,c)},r}(),NH=100,Fg=function(o){return o()};function YL(){Ne.inBatch>0||Ne.isRunningReactions||Fg(PH)}function PH(){Ne.isRunningReactions=!0;for(var r=Ne.pendingReactions,o=0;r.length>0;){++o===NH&&(console.error("[mobx] cycle in reaction: "+r[0]),r.splice(0));for(var a=r.splice(0),c=0,l=a.length;c<l;c++)a[c].runReaction_()}Ne.isRunningReactions=!1}var xf=Ka("Reaction",pl);function DH(r){var o=Fg;Fg=function(c){return r(function(){return o(c)})}}function Yd(){return!1}function kH(r){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}}var qL="action",LH="action.bound",JL="autoAction",xH="autoAction.bound",MH="<unnamed action>",XL=wl(qL),UH=wl(LH,{bound:!0}),QL=wl(JL,{autoAction:!0}),VH=wl(xH,{autoAction:!0,bound:!0});function $L(r){var o=function(c,l){if(ao(c))return yu(c.name||MH,c,r);if(ao(l))return yu(c,l,r);if(Ga(l))return Il(c,l,r?QL:XL);if(Ga(c))return Oo(wl(r?JL:qL,{name:c,autoAction:r}))};return o}var ru=$L(!1);Object.assign(ru,XL);var fl=$L(!0);Object.assign(fl,QL);ru.bound=Oo(UH);fl.bound=Oo(VH);function ZS(r){return ao(r)&&r.isMobxAction===!0}function BH(r,o){var a,c;o===void 0&&(o=vL);var l=(a=(c=o)==null?void 0:c.name)!=null?a:"Autorun",f=!o.scheduler&&!o.delay,v;if(f)v=new pl(l,function(){this.track(C)},o.onError,o.requiresObservable);else{var R=FH(o),T=!1;v=new pl(l,function(){T||(T=!0,R(function(){T=!1,v.isDisposed_||v.track(C)}))},o.onError,o.requiresObservable)}function C(){r(v)}return v.schedule_(),v.getDisposer_()}var jH=function(o){return o()};function FH(r){return r.scheduler?r.scheduler:r.delay?function(o){return setTimeout(o,r.delay)}:jH}var GH="onBO",WH="onBUO";function HH(r,o,a){return ex(GH,r,o,a)}function ZL(r,o,a){return ex(WH,r,o,a)}function ex(r,o,a,c){var l=typeof c=="function"?Qs(o,a):Qs(o),f=ao(c)?c:a,v=r+"L";return l[v]?l[v].add(f):l[v]=new Set([f]),function(){var R=l[v];R&&(R.delete(f),R.size===0&&delete l[v])}}var KH="never",Bp="always",zH="observed";function YH(r){r.isolateGlobalState===!0&&AH();var o=r.useProxies,a=r.enforceActions;if(o!==void 0&&(Ne.useProxies=o===Bp?!0:o===KH?!1:typeof Proxy<"u"),o==="ifavailable"&&(Ne.verifyProxies=!0),a!==void 0){var c=a===Bp?Bp:a===zH;Ne.enforceActions=c,Ne.allowStateChanges=!(c===!0||c===Bp)}["computedRequiresReaction","reactionRequiresObservable","observableRequiresReaction","disableErrorBoundaries","safeDescriptors"].forEach(function(l){l in r&&(Ne[l]=!!r[l])}),Ne.allowStateReads=!Ne.observableRequiresReaction,r.reactionScheduler&&DH(r.reactionScheduler)}function tx(r,o,a,c){var l=DW(o),f=kl(r,c)[ot];Qr();try{gu(l).forEach(function(v){f.extend_(v,l[v],a&&v in a?a[v]:!0)})}finally{$r()}return r}function qH(r,o){return nx(Qs(r,o))}function nx(r){var o={name:r.name_};return r.observing_&&r.observing_.length>0&&(o.dependencies=JH(r.observing_).map(nx)),o}function JH(r){return Array.from(new Set(r))}var XH=0;function rx(){this.message="FLOW_CANCELLED"}rx.prototype=Object.create(Error.prototype);var q1=OL("flow"),QH=OL("flow.bound",{bound:!0}),_l=Object.assign(function(o,a){if(Ga(a))return Il(o,a,q1);var c=o,l=c.name||"<unnamed flow>",f=function(){var R=this,T=arguments,C=++XH,O=ru(l+" - runid: "+C+" - init",c).apply(R,T),N,w=void 0,B=new Promise(function(U,W){var q=0;N=W;function G(j){w=void 0;var K;try{K=ru(l+" - runid: "+C+" - yield "+q++,O.next).call(O,j)}catch(Y){return W(Y)}M(K)}function b(j){w=void 0;var K;try{K=ru(l+" - runid: "+C+" - yield "+q++,O.throw).call(O,j)}catch(Y){return W(Y)}M(K)}function M(j){if(ao(j==null?void 0:j.then)){j.then(M,W);return}return j.done?U(j.value):(w=Promise.resolve(j.value),w.then(G,b))}G(void 0)});return B.cancel=ru(l+" - runid: "+C+" - cancel",function(){try{w&&J1(w);var U=O.return(void 0),W=Promise.resolve(U.value);W.then(tu,tu),J1(W),N(new rx)}catch(q){N(q)}}),B};return f.isMobXFlow=!0,f},q1);_l.bound=Oo(QH);function J1(r){ao(r.cancel)&&r.cancel()}function Mf(r){return(r==null?void 0:r.isMobXFlow)===!0}function $H(r,o){return r?o!==void 0?ml(r)?r[ot].values_.has(o):!1:ml(r)||!!r[ot]||XS(r)||xf(r)||W0(r):!1}function ix(r){return $H(r)}function ZH(){Dt("trace() is not available in production builds");for(var r=!1,o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];typeof a[a.length-1]=="boolean"&&(r=a.pop());var l=eK(a);if(!l)return Dt("'trace(break?)' can only be used inside a tracked computed value or a Reaction. Consider passing in the computed value or reaction explicitly");l.isTracing_===Ma.NONE&&console.log("[mobx.trace] '"+l.name_+"' tracing enabled"),l.isTracing_=r?Ma.BREAK:Ma.LOG}function eK(r){switch(r.length){case 0:return Ne.trackingDerivation;case 1:return Qs(r[0]);case 2:return Qs(r[0],r[1])}}function Yo(r,o){o===void 0&&(o=void 0),Qr();try{return r.apply(o)}finally{$r()}}function Gc(r){return r[ot]}var tK={has:function(o,a){return Gc(o).has_(a)},get:function(o,a){return Gc(o).get_(a)},set:function(o,a,c){var l;return Ga(a)?(l=Gc(o).set_(a,c,!0))!=null?l:!0:!1},deleteProperty:function(o,a){var c;return Ga(a)?(c=Gc(o).delete_(a,!0))!=null?c:!0:!1},defineProperty:function(o,a,c){var l;return(l=Gc(o).defineProperty_(a,c))!=null?l:!0},ownKeys:function(o){return Gc(o).ownKeys_()},preventExtensions:function(o){Dt(13)}};function nK(r,o){var a,c;return gL(),r=kl(r,o),(c=(a=r[ot]).proxy_)!=null?c:a.proxy_=new Proxy(r,tK)}function ki(r){return r.interceptors_!==void 0&&r.interceptors_.length>0}function Nl(r,o){var a=r.interceptors_||(r.interceptors_=[]);return a.push(o),SL(function(){var c=a.indexOf(o);c!==-1&&a.splice(c,1)})}function Li(r,o){var a=wu();try{for(var c=[].concat(r.interceptors_||[]),l=0,f=c.length;l<f&&(o=c[l](o),o&&!o.type&&Dt(14),!!o);l++);return o}finally{qs(a)}}function io(r){return r.changeListeners_!==void 0&&r.changeListeners_.length>0}function Pl(r,o){var a=r.changeListeners_||(r.changeListeners_=[]);return a.push(o),SL(function(){var c=a.indexOf(o);c!==-1&&a.splice(c,1)})}function oo(r,o){var a=wu(),c=r.changeListeners_;if(c){c=c.slice();for(var l=0,f=c.length;l<f;l++)c[l](o);qs(a)}}function rK(r,o,a){var c=kl(r,a)[ot];Qr();try{var l;(l=o)!=null||(o=MW(r)),gu(o).forEach(function(f){return c.make_(f,o[f])})}finally{$r()}return r}var Uv=Symbol("mobx-keys");function Dl(r,o,a){if(rs(r))return tx(r,r,o,a);var c=kl(r,a)[ot];if(!r[Uv]){var l=Object.getPrototypeOf(r),f=new Set([].concat(gu(r),gu(l)));f.delete("constructor"),f.delete(ot),Rl(l,Uv,f)}Qr();try{r[Uv].forEach(function(v){return c.make_(v,o&&v in o?o[v]:!0)})}finally{$r()}return r}var X1="splice",bo="update",iK=1e4,oK={get:function(o,a){var c=o[ot];return a===ot?c:a==="length"?c.getArrayLength_():typeof a=="string"&&!isNaN(a)?c.get_(parseInt(a)):$o(Uf,a)?Uf[a]:o[a]},set:function(o,a,c){var l=o[ot];return a==="length"&&l.setArrayLength_(c),typeof a=="symbol"||isNaN(a)?o[a]=c:l.set_(parseInt(a),c),!0},preventExtensions:function(){Dt(15)}},eT=function(){function r(a,c,l,f){a===void 0&&(a="ObservableArray"),this.owned_=void 0,this.legacyMode_=void 0,this.atom_=void 0,this.values_=[],this.interceptors_=void 0,this.changeListeners_=void 0,this.enhancer_=void 0,this.dehancer=void 0,this.proxy_=void 0,this.lastKnownLength_=0,this.owned_=l,this.legacyMode_=f,this.atom_=new Al(a),this.enhancer_=function(v,R){return c(v,R,"ObservableArray[..]")}}var o=r.prototype;return o.dehanceValue_=function(c){return this.dehancer!==void 0?this.dehancer(c):c},o.dehanceValues_=function(c){return this.dehancer!==void 0&&c.length>0?c.map(this.dehancer):c},o.intercept_=function(c){return Nl(this,c)},o.observe_=function(c,l){return l===void 0&&(l=!1),l&&c({observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:"splice",index:0,added:this.values_.slice(),addedCount:this.values_.length,removed:[],removedCount:0}),Pl(this,c)},o.getArrayLength_=function(){return this.atom_.reportObserved(),this.values_.length},o.setArrayLength_=function(c){(typeof c!="number"||isNaN(c)||c<0)&&Dt("Out of range: "+c);var l=this.values_.length;if(c!==l)if(c>l){for(var f=new Array(c-l),v=0;v<c-l;v++)f[v]=void 0;this.spliceWithArray_(l,0,f)}else this.spliceWithArray_(c,l-c)},o.updateArrayLength_=function(c,l){c!==this.lastKnownLength_&&Dt(16),this.lastKnownLength_+=l,this.legacyMode_&&l>0&&_x(c+l+1)},o.spliceWithArray_=function(c,l,f){var v=this;this.atom_;var R=this.values_.length;if(c===void 0?c=0:c>R?c=R:c<0&&(c=Math.max(0,R+c)),arguments.length===1?l=R-c:l==null?l=0:l=Math.max(0,Math.min(l,R-c)),f===void 0&&(f=Ug),ki(this)){var T=Li(this,{object:this.proxy_,type:X1,index:c,removedCount:l,added:f});if(!T)return Ug;l=T.removedCount,f=T.added}if(f=f.length===0?f:f.map(function(N){return v.enhancer_(N,void 0)}),this.legacyMode_){var C=f.length-l;this.updateArrayLength_(R,C)}var O=this.spliceItemsIntoValues_(c,l,f);return(l!==0||f.length!==0)&&this.notifyArraySplice_(c,f,O),this.dehanceValues_(O)},o.spliceItemsIntoValues_=function(c,l,f){if(f.length<iK){var v;return(v=this.values_).splice.apply(v,[c,l].concat(f))}else{var R=this.values_.slice(c,c+l),T=this.values_.slice(c+l);this.values_.length+=f.length-l;for(var C=0;C<f.length;C++)this.values_[c+C]=f[C];for(var O=0;O<T.length;O++)this.values_[c+f.length+O]=T[O];return R}},o.notifyArrayChildUpdate_=function(c,l,f){var v=!this.owned_&&Yd(),R=io(this),T=R||v?{observableKind:"array",object:this.proxy_,type:bo,debugObjectName:this.atom_.name_,index:c,newValue:l,oldValue:f}:null;this.atom_.reportChanged(),R&&oo(this,T)},o.notifyArraySplice_=function(c,l,f){var v=!this.owned_&&Yd(),R=io(this),T=R||v?{observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:X1,index:c,removed:f,added:l,removedCount:f.length,addedCount:l.length}:null;this.atom_.reportChanged(),R&&oo(this,T)},o.get_=function(c){if(this.legacyMode_&&c>=this.values_.length){console.warn("[mobx] Out of bounds read: "+c);return}return this.atom_.reportObserved(),this.dehanceValue_(this.values_[c])},o.set_=function(c,l){var f=this.values_;if(this.legacyMode_&&c>f.length&&Dt(17,c,f.length),c<f.length){this.atom_;var v=f[c];if(ki(this)){var R=Li(this,{type:bo,object:this.proxy_,index:c,newValue:l});if(!R)return;l=R.newValue}l=this.enhancer_(l,v);var T=l!==v;T&&(f[c]=l,this.notifyArrayChildUpdate_(c,l,v))}else{for(var C=new Array(c+1-f.length),O=0;O<C.length-1;O++)C[O]=void 0;C[C.length-1]=l,this.spliceWithArray_(f.length,0,C)}},r}();function sK(r,o,a,c){a===void 0&&(a="ObservableArray"),c===void 0&&(c=!1),gL();var l=new eT(a,o,c,!1);yL(l.values_,ot,l);var f=new Proxy(l.values_,oK);if(l.proxy_=f,r&&r.length){var v=Ol(!0);l.spliceWithArray_(0,0,r),bl(v)}return f}var Uf={clear:function(){return this.splice(0)},replace:function(o){var a=this[ot];return a.spliceWithArray_(0,a.values_.length,o)},toJSON:function(){return this.slice()},splice:function(o,a){for(var c=arguments.length,l=new Array(c>2?c-2:0),f=2;f<c;f++)l[f-2]=arguments[f];var v=this[ot];switch(arguments.length){case 0:return[];case 1:return v.spliceWithArray_(o);case 2:return v.spliceWithArray_(o,a)}return v.spliceWithArray_(o,a,l)},spliceWithArray:function(o,a,c){return this[ot].spliceWithArray_(o,a,c)},push:function(){for(var o=this[ot],a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return o.spliceWithArray_(o.values_.length,0,c),o.values_.length},pop:function(){return this.splice(Math.max(this[ot].values_.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var o=this[ot],a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return o.spliceWithArray_(0,0,c),o.values_.length},reverse:function(){return Ne.trackingDerivation&&Dt(37,"reverse"),this.replace(this.slice().reverse()),this},sort:function(){Ne.trackingDerivation&&Dt(37,"sort");var o=this.slice();return o.sort.apply(o,arguments),this.replace(o),this},remove:function(o){var a=this[ot],c=a.dehanceValues_(a.values_).indexOf(o);return c>-1?(this.splice(c,1),!0):!1}};Qn("concat",os);Qn("flat",os);Qn("includes",os);Qn("indexOf",os);Qn("join",os);Qn("lastIndexOf",os);Qn("slice",os);Qn("toString",os);Qn("toLocaleString",os);Qn("every",ta);Qn("filter",ta);Qn("find",ta);Qn("findIndex",ta);Qn("flatMap",ta);Qn("forEach",ta);Qn("map",ta);Qn("some",ta);Qn("reduce",ox);Qn("reduceRight",ox);function Qn(r,o){typeof Array.prototype[r]=="function"&&(Uf[r]=o(r))}function os(r){return function(){var o=this[ot];o.atom_.reportObserved();var a=o.dehanceValues_(o.values_);return a[r].apply(a,arguments)}}function ta(r){return function(o,a){var c=this,l=this[ot];l.atom_.reportObserved();var f=l.dehanceValues_(l.values_);return f[r](function(v,R){return o.call(a,v,R,c)})}}function ox(r){return function(){var o=this,a=this[ot];a.atom_.reportObserved();var c=a.dehanceValues_(a.values_),l=arguments[0];return arguments[0]=function(f,v,R){return l(f,v,R,o)},c[r].apply(c,arguments)}}var aK=Ka("ObservableArrayAdministration",eT);function H0(r){return B0(r)&&aK(r[ot])}var sx,ax,cK={},Bs="add",Vf="delete";sx=Symbol.iterator;ax=Symbol.toStringTag;var cx=function(){function r(a,c,l){var f=this;c===void 0&&(c=Tu),l===void 0&&(l="ObservableMap"),this.enhancer_=void 0,this.name_=void 0,this[ot]=cK,this.data_=void 0,this.hasMap_=void 0,this.keysAtom_=void 0,this.interceptors_=void 0,this.changeListeners_=void 0,this.dehancer=void 0,this.enhancer_=c,this.name_=l,ao(Map)||Dt(18),this.keysAtom_=AL("ObservableMap.keys()"),this.data_=new Map,this.hasMap_=new Map,CH(!0,function(){f.merge(a)})}var o=r.prototype;return o.has_=function(c){return this.data_.has(c)},o.has=function(c){var l=this;if(!Ne.trackingDerivation)return this.has_(c);var f=this.hasMap_.get(c);if(!f){var v=f=new du(this.has_(c),j0,"ObservableMap.key?",!1);this.hasMap_.set(c,v),ZL(v,function(){return l.hasMap_.delete(c)})}return f.get()},o.set=function(c,l){var f=this.has_(c);if(ki(this)){var v=Li(this,{type:f?bo:Bs,object:this,newValue:l,name:c});if(!v)return this;l=v.newValue}return f?this.updateValue_(c,l):this.addValue_(c,l),this},o.delete=function(c){var l=this;if(this.keysAtom_,ki(this)){var f=Li(this,{type:Vf,object:this,name:c});if(!f)return!1}if(this.has_(c)){var v=Yd(),R=io(this),T=R||v?{observableKind:"map",debugObjectName:this.name_,type:Vf,object:this,oldValue:this.data_.get(c).value_,name:c}:null;return Yo(function(){var C;l.keysAtom_.reportChanged(),(C=l.hasMap_.get(c))==null||C.setNewValue_(!1);var O=l.data_.get(c);O.setNewValue_(void 0),l.data_.delete(c)}),R&&oo(this,T),!0}return!1},o.updateValue_=function(c,l){var f=this.data_.get(c);if(l=f.prepareNewValue_(l),l!==Ne.UNCHANGED){var v=Yd(),R=io(this),T=R||v?{observableKind:"map",debugObjectName:this.name_,type:bo,object:this,oldValue:f.value_,name:c,newValue:l}:null;f.setNewValue_(l),R&&oo(this,T)}},o.addValue_=function(c,l){var f=this;this.keysAtom_,Yo(function(){var C,O=new du(l,f.enhancer_,"ObservableMap.key",!1);f.data_.set(c,O),l=O.value_,(C=f.hasMap_.get(c))==null||C.setNewValue_(!0),f.keysAtom_.reportChanged()});var v=Yd(),R=io(this),T=R||v?{observableKind:"map",debugObjectName:this.name_,type:Bs,object:this,name:c,newValue:l}:null;R&&oo(this,T)},o.get=function(c){return this.has(c)?this.dehanceValue_(this.data_.get(c).get()):this.dehanceValue_(void 0)},o.dehanceValue_=function(c){return this.dehancer!==void 0?this.dehancer(c):c},o.keys=function(){return this.keysAtom_.reportObserved(),this.data_.keys()},o.values=function(){var c=this,l=this.keys();return El({next:function(){var v=l.next(),R=v.done,T=v.value;return{done:R,value:R?void 0:c.get(T)}}})},o.entries=function(){var c=this,l=this.keys();return El({next:function(){var v=l.next(),R=v.done,T=v.value;return{done:R,value:R?void 0:[T,c.get(T)]}}})},o[sx]=function(){return this.entries()},o.forEach=function(c,l){for(var f=nu(this),v;!(v=f()).done;){var R=v.value,T=R[0],C=R[1];c.call(l,C,T,this)}},o.merge=function(c){var l=this;return za(c)&&(c=new Map(c)),Yo(function(){rs(c)?PW(c).forEach(function(f){return l.set(f,c[f])}):Array.isArray(c)?c.forEach(function(f){var v=f[0],R=f[1];return l.set(v,R)}):Au(c)?(c.constructor!==Map&&Dt(19,c),c.forEach(function(f,v){return l.set(v,f)})):c!=null&&Dt(20,c)}),this},o.clear=function(){var c=this;Yo(function(){jL(function(){for(var l=nu(c.keys()),f;!(f=l()).done;){var v=f.value;c.delete(v)}})})},o.replace=function(c){var l=this;return Yo(function(){for(var f=uK(c),v=new Map,R=!1,T=nu(l.data_.keys()),C;!(C=T()).done;){var O=C.value;if(!f.has(O)){var N=l.delete(O);if(N)R=!0;else{var w=l.data_.get(O);v.set(O,w)}}}for(var B=nu(f.entries()),U;!(U=B()).done;){var W=U.value,q=W[0],G=W[1],b=l.data_.has(q);if(l.set(q,G),l.data_.has(q)){var M=l.data_.get(q);v.set(q,M),b||(R=!0)}}if(!R)if(l.data_.size!==v.size)l.keysAtom_.reportChanged();else for(var j=l.data_.keys(),K=v.keys(),Y=j.next(),Q=K.next();!Y.done;){if(Y.value!==Q.value){l.keysAtom_.reportChanged();break}Y=j.next(),Q=K.next()}l.data_=v}),this},o.toString=function(){return"[object ObservableMap]"},o.toJSON=function(){return Array.from(this)},o.observe_=function(c,l){return Pl(this,c)},o.intercept_=function(c){return Nl(this,c)},JS(r,[{key:"size",get:function(){return this.keysAtom_.reportObserved(),this.data_.size}},{key:ax,get:function(){return"Map"}}]),r}(),za=Ka("ObservableMap",cx);function uK(r){if(Au(r)||za(r))return r;if(Array.isArray(r))return new Map(r);if(rs(r)){var o=new Map;for(var a in r)o.set(a,r[a]);return o}else return Dt(21,r)}var ux,dx,dK={};ux=Symbol.iterator;dx=Symbol.toStringTag;var lx=function(){function r(a,c,l){c===void 0&&(c=Tu),l===void 0&&(l="ObservableSet"),this.name_=void 0,this[ot]=dK,this.data_=new Set,this.atom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.dehancer=void 0,this.enhancer_=void 0,this.name_=l,ao(Set)||Dt(22),this.atom_=AL(this.name_),this.enhancer_=function(f,v){return c(f,v,l)},a&&this.replace(a)}var o=r.prototype;return o.dehanceValue_=function(c){return this.dehancer!==void 0?this.dehancer(c):c},o.clear=function(){var c=this;Yo(function(){jL(function(){for(var l=nu(c.data_.values()),f;!(f=l()).done;){var v=f.value;c.delete(v)}})})},o.forEach=function(c,l){for(var f=nu(this),v;!(v=f()).done;){var R=v.value;c.call(l,R,R,this)}},o.add=function(c){var l=this;if(this.atom_,ki(this)){var f=Li(this,{type:Bs,object:this,newValue:c});if(!f)return this}if(!this.has(c)){Yo(function(){l.data_.add(l.enhancer_(c,void 0)),l.atom_.reportChanged()});var v=!1,R=io(this),T=R||v?{observableKind:"set",debugObjectName:this.name_,type:Bs,object:this,newValue:c}:null;R&&oo(this,T)}return this},o.delete=function(c){var l=this;if(ki(this)){var f=Li(this,{type:Vf,object:this,oldValue:c});if(!f)return!1}if(this.has(c)){var v=!1,R=io(this),T=R||v?{observableKind:"set",debugObjectName:this.name_,type:Vf,object:this,oldValue:c}:null;return Yo(function(){l.atom_.reportChanged(),l.data_.delete(c)}),R&&oo(this,T),!0}return!1},o.has=function(c){return this.atom_.reportObserved(),this.data_.has(this.dehanceValue_(c))},o.entries=function(){var c=0,l=Array.from(this.keys()),f=Array.from(this.values());return El({next:function(){var R=c;return c+=1,R<f.length?{value:[l[R],f[R]],done:!1}:{done:!0}}})},o.keys=function(){return this.values()},o.values=function(){this.atom_.reportObserved();var c=this,l=0,f=Array.from(this.data_.values());return El({next:function(){return l<f.length?{value:c.dehanceValue_(f[l++]),done:!1}:{done:!0}}})},o.replace=function(c){var l=this;return Ou(c)&&(c=new Set(c)),Yo(function(){Array.isArray(c)?(l.clear(),c.forEach(function(f){return l.add(f)})):Cl(c)?(l.clear(),c.forEach(function(f){return l.add(f)})):c!=null&&Dt("Cannot initialize set from "+c)}),this},o.observe_=function(c,l){return Pl(this,c)},o.intercept_=function(c){return Nl(this,c)},o.toJSON=function(){return Array.from(this)},o.toString=function(){return"[object ObservableSet]"},o[ux]=function(){return this.values()},JS(r,[{key:"size",get:function(){return this.atom_.reportObserved(),this.data_.size}},{key:dx,get:function(){return"Set"}}]),r}(),Ou=Ka("ObservableSet",lx),Q1=Object.create(null),$1="remove",hx=function(){function r(a,c,l,f){c===void 0&&(c=new Map),f===void 0&&(f=iH),this.target_=void 0,this.values_=void 0,this.name_=void 0,this.defaultAnnotation_=void 0,this.keysAtom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.proxy_=void 0,this.isPlainObject_=void 0,this.appliedAnnotations_=void 0,this.pendingKeys_=void 0,this.target_=a,this.values_=c,this.name_=l,this.defaultAnnotation_=f,this.keysAtom_=new Al("ObservableObject.keys"),this.isPlainObject_=rs(this.target_)}var o=r.prototype;return o.getObservablePropValue_=function(c){return this.values_.get(c).get()},o.setObservablePropValue_=function(c,l){var f=this.values_.get(c);if(f instanceof hl)return f.set(l),!0;if(ki(this)){var v=Li(this,{type:bo,object:this.proxy_||this.target_,name:c,newValue:l});if(!v)return null;l=v.newValue}if(l=f.prepareNewValue_(l),l!==Ne.UNCHANGED){var R=io(this),T=!1,C=R||T?{type:bo,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,oldValue:f.value_,name:c,newValue:l}:null;f.setNewValue_(l),R&&oo(this,C)}return!0},o.get_=function(c){return Ne.trackingDerivation&&!$o(this.target_,c)&&this.has_(c),this.target_[c]},o.set_=function(c,l,f){return f===void 0&&(f=!1),$o(this.target_,c)?this.values_.has(c)?this.setObservablePropValue_(c,l):f?Reflect.set(this.target_,c,l):(this.target_[c]=l,!0):this.extend_(c,{value:l,enumerable:!0,writable:!0,configurable:!0},this.defaultAnnotation_,f)},o.has_=function(c){if(!Ne.trackingDerivation)return c in this.target_;this.pendingKeys_||(this.pendingKeys_=new Map);var l=this.pendingKeys_.get(c);return l||(l=new du(c in this.target_,j0,"ObservableObject.key?",!1),this.pendingKeys_.set(c,l)),l.get()},o.make_=function(c,l){if(l===!0&&(l=this.defaultAnnotation_),l!==!1){if(!(c in this.target_)){var f;if((f=this.target_[Co])!=null&&f[c])return;Dt(1,l.annotationType_,this.name_+"."+c.toString())}for(var v=this.target_;v&&v!==V0;){var R=Pf(v,c);if(R){var T=l.make_(this,c,R,v);if(T===0)return;if(T===1)break}v=Object.getPrototypeOf(v)}eP(this,l,c)}},o.extend_=function(c,l,f,v){if(v===void 0&&(v=!1),f===!0&&(f=this.defaultAnnotation_),f===!1)return this.defineProperty_(c,l,v);var R=f.extend_(this,c,l,v);return R&&eP(this,f,c),R},o.defineProperty_=function(c,l,f){f===void 0&&(f=!1);try{Qr();var v=this.delete_(c);if(!v)return v;if(ki(this)){var R=Li(this,{object:this.proxy_||this.target_,name:c,type:Bs,newValue:l.value});if(!R)return null;var T=R.newValue;l.value!==T&&(l=Su({},l,{value:T}))}if(f){if(!Reflect.defineProperty(this.target_,c,l))return!1}else wo(this.target_,c,l);this.notifyPropertyAddition_(c,l.value)}finally{$r()}return!0},o.defineObservableProperty_=function(c,l,f,v){v===void 0&&(v=!1);try{Qr();var R=this.delete_(c);if(!R)return R;if(ki(this)){var T=Li(this,{object:this.proxy_||this.target_,name:c,type:Bs,newValue:l});if(!T)return null;l=T.newValue}var C=Z1(c),O={configurable:Ne.safeDescriptors?this.isPlainObject_:!0,enumerable:!0,get:C.get,set:C.set};if(v){if(!Reflect.defineProperty(this.target_,c,O))return!1}else wo(this.target_,c,O);var N=new du(l,f,"ObservableObject.key",!1);this.values_.set(c,N),this.notifyPropertyAddition_(c,N.value_)}finally{$r()}return!0},o.defineComputedProperty_=function(c,l,f){f===void 0&&(f=!1);try{Qr();var v=this.delete_(c);if(!v)return v;if(ki(this)){var R=Li(this,{object:this.proxy_||this.target_,name:c,type:Bs,newValue:void 0});if(!R)return null}l.name||(l.name="ObservableObject.key"),l.context=this.proxy_||this.target_;var T=Z1(c),C={configurable:Ne.safeDescriptors?this.isPlainObject_:!0,enumerable:!1,get:T.get,set:T.set};if(f){if(!Reflect.defineProperty(this.target_,c,C))return!1}else wo(this.target_,c,C);this.values_.set(c,new hl(l)),this.notifyPropertyAddition_(c,void 0)}finally{$r()}return!0},o.delete_=function(c,l){if(l===void 0&&(l=!1),!$o(this.target_,c))return!0;if(ki(this)){var f=Li(this,{object:this.proxy_||this.target_,name:c,type:$1});if(!f)return null}try{var v,R;Qr();var T=io(this),C=!1,O=this.values_.get(c),N=void 0;if(!O&&(T||C)){var w;N=(w=Pf(this.target_,c))==null?void 0:w.value}if(l){if(!Reflect.deleteProperty(this.target_,c))return!1}else delete this.target_[c];if(O&&(this.values_.delete(c),O instanceof du&&(N=O.value_),zL(O)),this.keysAtom_.reportChanged(),(v=this.pendingKeys_)==null||(R=v.get(c))==null||R.set(c in this.target_),T||C){var B={type:$1,observableKind:"object",object:this.proxy_||this.target_,debugObjectName:this.name_,oldValue:N,name:c};T&&oo(this,B)}}finally{$r()}return!0},o.observe_=function(c,l){return Pl(this,c)},o.intercept_=function(c){return Nl(this,c)},o.notifyPropertyAddition_=function(c,l){var f,v,R=io(this),T=!1;if(R||T){var C=R||T?{type:Bs,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,name:c,newValue:l}:null;R&&oo(this,C)}(f=this.pendingKeys_)==null||(v=f.get(c))==null||v.set(!0),this.keysAtom_.reportChanged()},o.ownKeys_=function(){return this.keysAtom_.reportObserved(),gu(this.target_)},o.keys_=function(){return this.keysAtom_.reportObserved(),Object.keys(this.target_)},r}();function kl(r,o){var a;if($o(r,ot))return r;var c=(a=o==null?void 0:o.name)!=null?a:"ObservableObject",l=new hx(r,new Map,String(c),fH(o));return Rl(r,ot,l),r}var lK=Ka("ObservableObjectAdministration",hx);function Z1(r){return Q1[r]||(Q1[r]={get:function(){return this[ot].getObservablePropValue_(r)},set:function(a){return this[ot].setObservablePropValue_(r,a)}})}function ml(r){return B0(r)?lK(r[ot]):!1}function eP(r,o,a){var c;(c=r.target_[Co])==null||delete c[a]}var hK=fx(0),Vv=0,px=function(){};function pK(r,o){Object.setPrototypeOf?Object.setPrototypeOf(r.prototype,o):r.prototype.__proto__!==void 0?r.prototype.__proto__=o:r.prototype=o}pK(px,Array.prototype);var tT=function(r,o,a){IL(c,r);function c(f,v,R,T){var C;R===void 0&&(R="ObservableArray"),T===void 0&&(T=!1),C=r.call(this)||this;var O=new eT(R,v,T,!0);if(O.proxy_=Mv(C),yL(Mv(C),ot,O),f&&f.length){var N=Ol(!0);C.spliceWithArray(0,0,f),bl(N)}return Object.defineProperty(Mv(C),"0",hK),C}var l=c.prototype;return l.concat=function(){this[ot].atom_.reportObserved();for(var v=arguments.length,R=new Array(v),T=0;T<v;T++)R[T]=arguments[T];return Array.prototype.concat.apply(this.slice(),R.map(function(C){return H0(C)?C.slice():C}))},l[a]=function(){var f=this,v=0;return El({next:function(){return v<f.length?{value:f[v++],done:!1}:{done:!0,value:void 0}}})},JS(c,[{key:"length",get:function(){return this[ot].getArrayLength_()},set:function(v){this[ot].setArrayLength_(v)}},{key:o,get:function(){return"Array"}}]),c}(px,Symbol.toStringTag,Symbol.iterator);Object.entries(Uf).forEach(function(r){var o=r[0],a=r[1];o!=="concat"&&Rl(tT.prototype,o,a)});function fx(r){return{enumerable:!1,configurable:!0,get:function(){return this[ot].get_(r)},set:function(a){this[ot].set_(r,a)}}}function fK(r){wo(tT.prototype,""+r,fx(r))}function _x(r){if(r>Vv){for(var o=Vv;o<r+100;o++)fK(o);Vv=r}}_x(1e3);function _K(r,o,a){return new tT(r,o,a)}function Qs(r,o){if(typeof r=="object"&&r!==null){if(H0(r))return o!==void 0&&Dt(23),r[ot].atom_;if(Ou(r))return r.atom_;if(za(r)){if(o===void 0)return r.keysAtom_;var a=r.data_.get(o)||r.hasMap_.get(o);return a||Dt(25,o,Gg(r)),a}if(ml(r)){if(!o)return Dt(26);var c=r[ot].values_.get(o);return c||Dt(27,o,Gg(r)),c}if(XS(r)||W0(r)||xf(r))return r}else if(ao(r)&&xf(r[ot]))return r[ot];Dt(28)}function mx(r,o){if(r||Dt(29),o!==void 0)return mx(Qs(r,o));if(XS(r)||W0(r)||xf(r)||za(r)||Ou(r))return r;if(r[ot])return r[ot];Dt(24,r)}function Gg(r,o){var a;if(o!==void 0)a=Qs(r,o);else{if(ZS(r))return r.name;ml(r)||za(r)||Ou(r)?a=mx(r):a=Qs(r)}return a.name_}var tP=V0.toString;function nT(r,o,a){return a===void 0&&(a=-1),Wg(r,o,a)}function Wg(r,o,a,c,l){if(r===o)return r!==0||1/r===1/o;if(r==null||o==null)return!1;if(r!==r)return o!==o;var f=typeof r;if(f!=="function"&&f!=="object"&&typeof o!="object")return!1;var v=tP.call(r);if(v!==tP.call(o))return!1;switch(v){case"[object RegExp]":case"[object String]":return""+r==""+o;case"[object Number]":return+r!=+r?+o!=+o:+r==0?1/+r===1/o:+r==+o;case"[object Date]":case"[object Boolean]":return+r==+o;case"[object Symbol]":return typeof Symbol<"u"&&Symbol.valueOf.call(r)===Symbol.valueOf.call(o);case"[object Map]":case"[object Set]":a>=0&&a++;break}r=nP(r),o=nP(o);var R=v==="[object Array]";if(!R){if(typeof r!="object"||typeof o!="object")return!1;var T=r.constructor,C=o.constructor;if(T!==C&&!(ao(T)&&T instanceof T&&ao(C)&&C instanceof C)&&"constructor"in r&&"constructor"in o)return!1}if(a===0)return!1;a<0&&(a=-1),c=c||[],l=l||[];for(var O=c.length;O--;)if(c[O]===r)return l[O]===o;if(c.push(r),l.push(o),R){if(O=r.length,O!==o.length)return!1;for(;O--;)if(!Wg(r[O],o[O],a-1,c,l))return!1}else{var N=Object.keys(r),w;if(O=N.length,Object.keys(o).length!==O)return!1;for(;O--;)if(w=N[O],!($o(o,w)&&Wg(r[w],o[w],a-1,c,l)))return!1}return c.pop(),l.pop(),!0}function nP(r){return H0(r)?r.slice():Au(r)||za(r)||Cl(r)||Ou(r)?Array.from(r.entries()):r}function El(r){return r[Symbol.iterator]=mK,r}function mK(){return this}["Symbol","Map","Set"].forEach(function(r){var o=qS();typeof o[r]>"u"&&Dt("MobX requires global '"+r+"' to be available or polyfilled")});typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__=="object"&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:kH,extras:{getDebugName:Gg},$mobx:ot});if(!Ye.useState)throw new Error("mobx-react-lite requires React with Hooks support");if(!rK)throw new Error("mobx-react-lite@3 requires mobx at least version 6 to be available");function EK(r){r()}function vK(r){r||(r=EK),YH({reactionScheduler:r})}function gK(r){return qH(r)}var SK=1e4,TK=1e4,yK=function(){function r(o){var a=this;Object.defineProperty(this,"finalize",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"registrations",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"sweepTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sweep",{enumerable:!0,configurable:!0,writable:!0,value:function(c){c===void 0&&(c=SK),clearTimeout(a.sweepTimeout),a.sweepTimeout=void 0;var l=Date.now();a.registrations.forEach(function(f,v){l-f.registeredAt>=c&&(a.finalize(f.value),a.registrations.delete(v))}),a.registrations.size>0&&a.scheduleSweep()}}),Object.defineProperty(this,"finalizeAllImmediately",{enumerable:!0,configurable:!0,writable:!0,value:function(){a.sweep(0)}})}return Object.defineProperty(r.prototype,"register",{enumerable:!1,configurable:!0,writable:!0,value:function(o,a,c){this.registrations.set(c,{value:a,registeredAt:Date.now()}),this.scheduleSweep()}}),Object.defineProperty(r.prototype,"unregister",{enumerable:!1,configurable:!0,writable:!0,value:function(o){this.registrations.delete(o)}}),Object.defineProperty(r.prototype,"scheduleSweep",{enumerable:!1,configurable:!0,writable:!0,value:function(){this.sweepTimeout===void 0&&(this.sweepTimeout=setTimeout(this.sweep,TK))}}),r}(),RK=typeof FinalizationRegistry<"u"?FinalizationRegistry:yK,Hg=new RK(function(r){var o;(o=r.reaction)===null||o===void 0||o.dispose(),r.reaction=null}),rP=globalThis&&globalThis.__read||function(r,o){var a=typeof Symbol=="function"&&r[Symbol.iterator];if(!a)return r;var c=a.call(r),l,f=[],v;try{for(;(o===void 0||o-- >0)&&!(l=c.next()).done;)f.push(l.value)}catch(R){v={error:R}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(v)throw v.error}}return f};function iP(r){return"observer".concat(r)}var CK=function(){function r(){}return r}();function IK(){return new CK}function AK(r,o){o===void 0&&(o="observed");var a=rP(yd.useState(IK),1),c=a[0],l=rP(yd.useState(),2),f=l[1],v=function(){return f([])},R=yd.useRef(null);R.current||(R.current={reaction:null,mounted:!1,changedBeforeMount:!1});var T=R.current;T.reaction||(T.reaction=new pl(iP(o),function(){T.mounted?v():T.changedBeforeMount=!0}),Hg.register(c,T,T)),yd.useDebugValue(T.reaction,gK),yd.useEffect(function(){return Hg.unregister(T),T.mounted=!0,T.reaction?T.changedBeforeMount&&(T.changedBeforeMount=!1,v()):(T.reaction=new pl(iP(o),function(){v()}),v()),function(){T.reaction.dispose(),T.reaction=null,T.mounted=!1,T.changedBeforeMount=!1}},[]);var C,O;if(T.reaction.track(function(){try{C=r()}catch(N){O=N}}),O)throw O;return C}var Ex=typeof Symbol=="function"&&Symbol.for,oP=Ex?Symbol.for("react.forward_ref"):typeof Ye.forwardRef=="function"&&Ye.forwardRef(function(r){return null}).$$typeof,sP=Ex?Symbol.for("react.memo"):typeof Ye.memo=="function"&&Ye.memo(function(r){return null}).$$typeof;function Ya(r,o){var a;if(sP&&r.$$typeof===sP)throw new Error("[mobx-react-lite] You are trying to use `observer` on a function component wrapped in either another `observer` or `React.memo`. The observer already applies 'React.memo' for you.");var c=(a=o==null?void 0:o.forwardRef)!==null&&a!==void 0?a:!1,l=r,f=r.displayName||r.name;if(oP&&r.$$typeof===oP&&(c=!0,l=r.render,typeof l!="function"))throw new Error("[mobx-react-lite] `render` property of ForwardRef was not a function");var v=function(R,T){return AK(function(){return l(R,T)},f)};return f!==""&&(v.displayName=f),r.contextTypes&&(v.contextTypes=r.contextTypes),c&&(v=Ye.forwardRef(v)),v=Ye.memo(v),OK(r,v),v}var wK={$$typeof:!0,render:!0,compare:!0,type:!0,displayName:!0};function OK(r,o){Object.keys(r).forEach(function(a){wK[a]||Object.defineProperty(o,a,Object.getOwnPropertyDescriptor(r,a))})}globalThis&&globalThis.__read;var Bv;vK(sf.unstable_batchedUpdates);Bv=Hg.finalizeAllImmediately;var bK="!#%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",NK=87,PK=20,aP=[],DK=()=>{for(let r=0;r<PK;r++)aP[r]=bK.charAt(Math.random()*NK);return aP.join("")};function vx(r){try{return r()}catch(o){console.error(o)}}var gx=class{constructor(){this.push=this.addDisposer,this.disposers=new Map}addDisposer(r,o=this.genUID()){return this.flush(o),this.disposers.set(o,Array.isArray(r)?kK(r):r),o}add(r,o=this.genUID()){const a=r();return a?this.addDisposer(a,o):o}addEventListener(r,o,a,c,l=this.genUID()){return r.addEventListener(o,a,c),this.addDisposer(()=>r.removeEventListener(o,a,c),l),l}setTimeout(r,o,a=this.genUID()){const c=window.setTimeout(()=>{this.remove(a),r()},o);return this.addDisposer(()=>window.clearTimeout(c),a)}setInterval(r,o,a=this.genUID()){const c=window.setInterval(r,o);return this.addDisposer(()=>window.clearInterval(c),a)}remove(r){const o=this.disposers.get(r);return this.disposers.delete(r),o}flush(r){const o=this.remove(r);o&&o()}flushAll(){this.disposers.forEach(vx),this.disposers.clear()}genUID(){let r;do r=DK();while(this.disposers.has(r));return r}};function kK(r){return()=>r.forEach(vx)}var Kg={},LK={get exports(){return Kg},set exports(r){Kg=r}};function xK(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Bf={},MK={get exports(){return Bf},set exports(r){Bf=r}};const UK={},VK=Object.freeze(Object.defineProperty({__proto__:null,default:UK},Symbol.toStringTag,{value:"Module"})),BK=L6(VK);var cP;function wt(){return cP||(cP=1,function(r,o){(function(a,c){r.exports=c()})(tt,function(){var a=a||function(c,l){var f;if(typeof window<"u"&&window.crypto&&(f=window.crypto),typeof self<"u"&&self.crypto&&(f=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(f=globalThis.crypto),!f&&typeof window<"u"&&window.msCrypto&&(f=window.msCrypto),!f&&typeof tt<"u"&&tt.crypto&&(f=tt.crypto),!f&&typeof xK=="function")try{f=BK}catch{}var v=function(){if(f){if(typeof f.getRandomValues=="function")try{return f.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof f.randomBytes=="function")try{return f.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},R=Object.create||function(){function b(){}return function(M){var j;return b.prototype=M,j=new b,b.prototype=null,j}}(),T={},C=T.lib={},O=C.Base=function(){return{extend:function(b){var M=R(this);return b&&M.mixIn(b),(!M.hasOwnProperty("init")||this.init===M.init)&&(M.init=function(){M.$super.init.apply(this,arguments)}),M.init.prototype=M,M.$super=this,M},create:function(){var b=this.extend();return b.init.apply(b,arguments),b},init:function(){},mixIn:function(b){for(var M in b)b.hasOwnProperty(M)&&(this[M]=b[M]);b.hasOwnProperty("toString")&&(this.toString=b.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),N=C.WordArray=O.extend({init:function(b,M){b=this.words=b||[],M!=l?this.sigBytes=M:this.sigBytes=b.length*4},toString:function(b){return(b||B).stringify(this)},concat:function(b){var M=this.words,j=b.words,K=this.sigBytes,Y=b.sigBytes;if(this.clamp(),K%4)for(var Q=0;Q<Y;Q++){var $=j[Q>>>2]>>>24-Q%4*8&255;M[K+Q>>>2]|=$<<24-(K+Q)%4*8}else for(var ue=0;ue<Y;ue+=4)M[K+ue>>>2]=j[ue>>>2];return this.sigBytes+=Y,this},clamp:function(){var b=this.words,M=this.sigBytes;b[M>>>2]&=4294967295<<32-M%4*8,b.length=c.ceil(M/4)},clone:function(){var b=O.clone.call(this);return b.words=this.words.slice(0),b},random:function(b){for(var M=[],j=0;j<b;j+=4)M.push(v());return new N.init(M,b)}}),w=T.enc={},B=w.Hex={stringify:function(b){for(var M=b.words,j=b.sigBytes,K=[],Y=0;Y<j;Y++){var Q=M[Y>>>2]>>>24-Y%4*8&255;K.push((Q>>>4).toString(16)),K.push((Q&15).toString(16))}return K.join("")},parse:function(b){for(var M=b.length,j=[],K=0;K<M;K+=2)j[K>>>3]|=parseInt(b.substr(K,2),16)<<24-K%8*4;return new N.init(j,M/2)}},U=w.Latin1={stringify:function(b){for(var M=b.words,j=b.sigBytes,K=[],Y=0;Y<j;Y++){var Q=M[Y>>>2]>>>24-Y%4*8&255;K.push(String.fromCharCode(Q))}return K.join("")},parse:function(b){for(var M=b.length,j=[],K=0;K<M;K++)j[K>>>2]|=(b.charCodeAt(K)&255)<<24-K%4*8;return new N.init(j,M)}},W=w.Utf8={stringify:function(b){try{return decodeURIComponent(escape(U.stringify(b)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(b){return U.parse(unescape(encodeURIComponent(b)))}},q=C.BufferedBlockAlgorithm=O.extend({reset:function(){this._data=new N.init,this._nDataBytes=0},_append:function(b){typeof b=="string"&&(b=W.parse(b)),this._data.concat(b),this._nDataBytes+=b.sigBytes},_process:function(b){var M,j=this._data,K=j.words,Y=j.sigBytes,Q=this.blockSize,$=Q*4,ue=Y/$;b?ue=c.ceil(ue):ue=c.max((ue|0)-this._minBufferSize,0);var J=ue*Q,te=c.min(J*4,Y);if(J){for(var le=0;le<J;le+=Q)this._doProcessBlock(K,le);M=K.splice(0,J),j.sigBytes-=te}return new N.init(M,te)},clone:function(){var b=O.clone.call(this);return b._data=this._data.clone(),b},_minBufferSize:0});C.Hasher=q.extend({cfg:O.extend(),init:function(b){this.cfg=this.cfg.extend(b),this.reset()},reset:function(){q.reset.call(this),this._doReset()},update:function(b){return this._append(b),this._process(),this},finalize:function(b){b&&this._append(b);var M=this._doFinalize();return M},blockSize:16,_createHelper:function(b){return function(M,j){return new b.init(j).finalize(M)}},_createHmacHelper:function(b){return function(M,j){return new G.HMAC.init(b,j).finalize(M)}}});var G=T.algo={};return T}(Math);return a})}(MK)),Bf}var jf={},jK={get exports(){return jf},set exports(r){jf=r}},uP;function K0(){return uP||(uP=1,function(r,o){(function(a,c){r.exports=c(wt())})(tt,function(a){return function(c){var l=a,f=l.lib,v=f.Base,R=f.WordArray,T=l.x64={};T.Word=v.extend({init:function(C,O){this.high=C,this.low=O}}),T.WordArray=v.extend({init:function(C,O){C=this.words=C||[],O!=c?this.sigBytes=O:this.sigBytes=C.length*8},toX32:function(){for(var C=this.words,O=C.length,N=[],w=0;w<O;w++){var B=C[w];N.push(B.high),N.push(B.low)}return R.create(N,this.sigBytes)},clone:function(){for(var C=v.clone.call(this),O=C.words=this.words.slice(0),N=O.length,w=0;w<N;w++)O[w]=O[w].clone();return C}})}(),a})}(jK)),jf}var Ff={},FK={get exports(){return Ff},set exports(r){Ff=r}},dP;function GK(){return dP||(dP=1,function(r,o){(function(a,c){r.exports=c(wt())})(tt,function(a){return function(){if(typeof ArrayBuffer=="function"){var c=a,l=c.lib,f=l.WordArray,v=f.init,R=f.init=function(T){if(T instanceof ArrayBuffer&&(T=new Uint8Array(T)),(T instanceof Int8Array||typeof Uint8ClampedArray<"u"&&T instanceof Uint8ClampedArray||T instanceof Int16Array||T instanceof Uint16Array||T instanceof Int32Array||T instanceof Uint32Array||T instanceof Float32Array||T instanceof Float64Array)&&(T=new Uint8Array(T.buffer,T.byteOffset,T.byteLength)),T instanceof Uint8Array){for(var C=T.byteLength,O=[],N=0;N<C;N++)O[N>>>2]|=T[N]<<24-N%4*8;v.call(this,O,C)}else v.apply(this,arguments)};R.prototype=f}}(),a.lib.WordArray})}(FK)),Ff}var Gf={},WK={get exports(){return Gf},set exports(r){Gf=r}},lP;function HK(){return lP||(lP=1,function(r,o){(function(a,c){r.exports=c(wt())})(tt,function(a){return function(){var c=a,l=c.lib,f=l.WordArray,v=c.enc;v.Utf16=v.Utf16BE={stringify:function(T){for(var C=T.words,O=T.sigBytes,N=[],w=0;w<O;w+=2){var B=C[w>>>2]>>>16-w%4*8&65535;N.push(String.fromCharCode(B))}return N.join("")},parse:function(T){for(var C=T.length,O=[],N=0;N<C;N++)O[N>>>1]|=T.charCodeAt(N)<<16-N%2*16;return f.create(O,C*2)}},v.Utf16LE={stringify:function(T){for(var C=T.words,O=T.sigBytes,N=[],w=0;w<O;w+=2){var B=R(C[w>>>2]>>>16-w%4*8&65535);N.push(String.fromCharCode(B))}return N.join("")},parse:function(T){for(var C=T.length,O=[],N=0;N<C;N++)O[N>>>1]|=R(T.charCodeAt(N)<<16-N%2*16);return f.create(O,C*2)}};function R(T){return T<<8&4278255360|T>>>8&16711935}}(),a.enc.Utf16})}(WK)),Gf}var Wf={},KK={get exports(){return Wf},set exports(r){Wf=r}},hP;function bu(){return hP||(hP=1,function(r,o){(function(a,c){r.exports=c(wt())})(tt,function(a){return function(){var c=a,l=c.lib,f=l.WordArray,v=c.enc;v.Base64={stringify:function(T){var C=T.words,O=T.sigBytes,N=this._map;T.clamp();for(var w=[],B=0;B<O;B+=3)for(var U=C[B>>>2]>>>24-B%4*8&255,W=C[B+1>>>2]>>>24-(B+1)%4*8&255,q=C[B+2>>>2]>>>24-(B+2)%4*8&255,G=U<<16|W<<8|q,b=0;b<4&&B+b*.75<O;b++)w.push(N.charAt(G>>>6*(3-b)&63));var M=N.charAt(64);if(M)for(;w.length%4;)w.push(M);return w.join("")},parse:function(T){var C=T.length,O=this._map,N=this._reverseMap;if(!N){N=this._reverseMap=[];for(var w=0;w<O.length;w++)N[O.charCodeAt(w)]=w}var B=O.charAt(64);if(B){var U=T.indexOf(B);U!==-1&&(C=U)}return R(T,C,N)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function R(T,C,O){for(var N=[],w=0,B=0;B<C;B++)if(B%4){var U=O[T.charCodeAt(B-1)]<<B%4*2,W=O[T.charCodeAt(B)]>>>6-B%4*2,q=U|W;N[w>>>2]|=q<<24-w%4*8,w++}return f.create(N,w)}}(),a.enc.Base64})}(KK)),Wf}var Hf={},zK={get exports(){return Hf},set exports(r){Hf=r}},pP;function YK(){return pP||(pP=1,function(r,o){(function(a,c){r.exports=c(wt())})(tt,function(a){return function(){var c=a,l=c.lib,f=l.WordArray,v=c.enc;v.Base64url={stringify:function(T,C=!0){var O=T.words,N=T.sigBytes,w=C?this._safe_map:this._map;T.clamp();for(var B=[],U=0;U<N;U+=3)for(var W=O[U>>>2]>>>24-U%4*8&255,q=O[U+1>>>2]>>>24-(U+1)%4*8&255,G=O[U+2>>>2]>>>24-(U+2)%4*8&255,b=W<<16|q<<8|G,M=0;M<4&&U+M*.75<N;M++)B.push(w.charAt(b>>>6*(3-M)&63));var j=w.charAt(64);if(j)for(;B.length%4;)B.push(j);return B.join("")},parse:function(T,C=!0){var O=T.length,N=C?this._safe_map:this._map,w=this._reverseMap;if(!w){w=this._reverseMap=[];for(var B=0;B<N.length;B++)w[N.charCodeAt(B)]=B}var U=N.charAt(64);if(U){var W=T.indexOf(U);W!==-1&&(O=W)}return R(T,O,w)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function R(T,C,O){for(var N=[],w=0,B=0;B<C;B++)if(B%4){var U=O[T.charCodeAt(B-1)]<<B%4*2,W=O[T.charCodeAt(B)]>>>6-B%4*2,q=U|W;N[w>>>2]|=q<<24-w%4*8,w++}return f.create(N,w)}}(),a.enc.Base64url})}(zK)),Hf}var Kf={},qK={get exports(){return Kf},set exports(r){Kf=r}},fP;function Nu(){return fP||(fP=1,function(r,o){(function(a,c){r.exports=c(wt())})(tt,function(a){return function(c){var l=a,f=l.lib,v=f.WordArray,R=f.Hasher,T=l.algo,C=[];(function(){for(var W=0;W<64;W++)C[W]=c.abs(c.sin(W+1))*4294967296|0})();var O=T.MD5=R.extend({_doReset:function(){this._hash=new v.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(W,q){for(var G=0;G<16;G++){var b=q+G,M=W[b];W[b]=(M<<8|M>>>24)&16711935|(M<<24|M>>>8)&4278255360}var j=this._hash.words,K=W[q+0],Y=W[q+1],Q=W[q+2],$=W[q+3],ue=W[q+4],J=W[q+5],te=W[q+6],le=W[q+7],he=W[q+8],Pe=W[q+9],We=W[q+10],He=W[q+11],kt=W[q+12],Te=W[q+13],Me=W[q+14],ke=W[q+15],ae=j[0],pe=j[1],ge=j[2],me=j[3];ae=N(ae,pe,ge,me,K,7,C[0]),me=N(me,ae,pe,ge,Y,12,C[1]),ge=N(ge,me,ae,pe,Q,17,C[2]),pe=N(pe,ge,me,ae,$,22,C[3]),ae=N(ae,pe,ge,me,ue,7,C[4]),me=N(me,ae,pe,ge,J,12,C[5]),ge=N(ge,me,ae,pe,te,17,C[6]),pe=N(pe,ge,me,ae,le,22,C[7]),ae=N(ae,pe,ge,me,he,7,C[8]),me=N(me,ae,pe,ge,Pe,12,C[9]),ge=N(ge,me,ae,pe,We,17,C[10]),pe=N(pe,ge,me,ae,He,22,C[11]),ae=N(ae,pe,ge,me,kt,7,C[12]),me=N(me,ae,pe,ge,Te,12,C[13]),ge=N(ge,me,ae,pe,Me,17,C[14]),pe=N(pe,ge,me,ae,ke,22,C[15]),ae=w(ae,pe,ge,me,Y,5,C[16]),me=w(me,ae,pe,ge,te,9,C[17]),ge=w(ge,me,ae,pe,He,14,C[18]),pe=w(pe,ge,me,ae,K,20,C[19]),ae=w(ae,pe,ge,me,J,5,C[20]),me=w(me,ae,pe,ge,We,9,C[21]),ge=w(ge,me,ae,pe,ke,14,C[22]),pe=w(pe,ge,me,ae,ue,20,C[23]),ae=w(ae,pe,ge,me,Pe,5,C[24]),me=w(me,ae,pe,ge,Me,9,C[25]),ge=w(ge,me,ae,pe,$,14,C[26]),pe=w(pe,ge,me,ae,he,20,C[27]),ae=w(ae,pe,ge,me,Te,5,C[28]),me=w(me,ae,pe,ge,Q,9,C[29]),ge=w(ge,me,ae,pe,le,14,C[30]),pe=w(pe,ge,me,ae,kt,20,C[31]),ae=B(ae,pe,ge,me,J,4,C[32]),me=B(me,ae,pe,ge,he,11,C[33]),ge=B(ge,me,ae,pe,He,16,C[34]),pe=B(pe,ge,me,ae,Me,23,C[35]),ae=B(ae,pe,ge,me,Y,4,C[36]),me=B(me,ae,pe,ge,ue,11,C[37]),ge=B(ge,me,ae,pe,le,16,C[38]),pe=B(pe,ge,me,ae,We,23,C[39]),ae=B(ae,pe,ge,me,Te,4,C[40]),me=B(me,ae,pe,ge,K,11,C[41]),ge=B(ge,me,ae,pe,$,16,C[42]),pe=B(pe,ge,me,ae,te,23,C[43]),ae=B(ae,pe,ge,me,Pe,4,C[44]),me=B(me,ae,pe,ge,kt,11,C[45]),ge=B(ge,me,ae,pe,ke,16,C[46]),pe=B(pe,ge,me,ae,Q,23,C[47]),ae=U(ae,pe,ge,me,K,6,C[48]),me=U(me,ae,pe,ge,le,10,C[49]),ge=U(ge,me,ae,pe,Me,15,C[50]),pe=U(pe,ge,me,ae,J,21,C[51]),ae=U(ae,pe,ge,me,kt,6,C[52]),me=U(me,ae,pe,ge,$,10,C[53]),ge=U(ge,me,ae,pe,We,15,C[54]),pe=U(pe,ge,me,ae,Y,21,C[55]),ae=U(ae,pe,ge,me,he,6,C[56]),me=U(me,ae,pe,ge,ke,10,C[57]),ge=U(ge,me,ae,pe,te,15,C[58]),pe=U(pe,ge,me,ae,Te,21,C[59]),ae=U(ae,pe,ge,me,ue,6,C[60]),me=U(me,ae,pe,ge,He,10,C[61]),ge=U(ge,me,ae,pe,Q,15,C[62]),pe=U(pe,ge,me,ae,Pe,21,C[63]),j[0]=j[0]+ae|0,j[1]=j[1]+pe|0,j[2]=j[2]+ge|0,j[3]=j[3]+me|0},_doFinalize:function(){var W=this._data,q=W.words,G=this._nDataBytes*8,b=W.sigBytes*8;q[b>>>5]|=128<<24-b%32;var M=c.floor(G/4294967296),j=G;q[(b+64>>>9<<4)+15]=(M<<8|M>>>24)&16711935|(M<<24|M>>>8)&4278255360,q[(b+64>>>9<<4)+14]=(j<<8|j>>>24)&16711935|(j<<24|j>>>8)&4278255360,W.sigBytes=(q.length+1)*4,this._process();for(var K=this._hash,Y=K.words,Q=0;Q<4;Q++){var $=Y[Q];Y[Q]=($<<8|$>>>24)&16711935|($<<24|$>>>8)&4278255360}return K},clone:function(){var W=R.clone.call(this);return W._hash=this._hash.clone(),W}});function N(W,q,G,b,M,j,K){var Y=W+(q&G|~q&b)+M+K;return(Y<<j|Y>>>32-j)+q}function w(W,q,G,b,M,j,K){var Y=W+(q&b|G&~b)+M+K;return(Y<<j|Y>>>32-j)+q}function B(W,q,G,b,M,j,K){var Y=W+(q^G^b)+M+K;return(Y<<j|Y>>>32-j)+q}function U(W,q,G,b,M,j,K){var Y=W+(G^(q|~b))+M+K;return(Y<<j|Y>>>32-j)+q}l.MD5=R._createHelper(O),l.HmacMD5=R._createHmacHelper(O)}(Math),a.MD5})}(qK)),Kf}var zf={},JK={get exports(){return zf},set exports(r){zf=r}},_P;function rT(){return _P||(_P=1,function(r,o){(function(a,c){r.exports=c(wt())})(tt,function(a){return function(){var c=a,l=c.lib,f=l.WordArray,v=l.Hasher,R=c.algo,T=[],C=R.SHA1=v.extend({_doReset:function(){this._hash=new f.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(O,N){for(var w=this._hash.words,B=w[0],U=w[1],W=w[2],q=w[3],G=w[4],b=0;b<80;b++){if(b<16)T[b]=O[N+b]|0;else{var M=T[b-3]^T[b-8]^T[b-14]^T[b-16];T[b]=M<<1|M>>>31}var j=(B<<5|B>>>27)+G+T[b];b<20?j+=(U&W|~U&q)+1518500249:b<40?j+=(U^W^q)+1859775393:b<60?j+=(U&W|U&q|W&q)-1894007588:j+=(U^W^q)-899497514,G=q,q=W,W=U<<30|U>>>2,U=B,B=j}w[0]=w[0]+B|0,w[1]=w[1]+U|0,w[2]=w[2]+W|0,w[3]=w[3]+q|0,w[4]=w[4]+G|0},_doFinalize:function(){var O=this._data,N=O.words,w=this._nDataBytes*8,B=O.sigBytes*8;return N[B>>>5]|=128<<24-B%32,N[(B+64>>>9<<4)+14]=Math.floor(w/4294967296),N[(B+64>>>9<<4)+15]=w,O.sigBytes=N.length*4,this._process(),this._hash},clone:function(){var O=v.clone.call(this);return O._hash=this._hash.clone(),O}});c.SHA1=v._createHelper(C),c.HmacSHA1=v._createHmacHelper(C)}(),a.SHA1})}(JK)),zf}var Yf={},XK={get exports(){return Yf},set exports(r){Yf=r}},mP;function Sx(){return mP||(mP=1,function(r,o){(function(a,c){r.exports=c(wt())})(tt,function(a){return function(c){var l=a,f=l.lib,v=f.WordArray,R=f.Hasher,T=l.algo,C=[],O=[];(function(){function B(G){for(var b=c.sqrt(G),M=2;M<=b;M++)if(!(G%M))return!1;return!0}function U(G){return(G-(G|0))*4294967296|0}for(var W=2,q=0;q<64;)B(W)&&(q<8&&(C[q]=U(c.pow(W,1/2))),O[q]=U(c.pow(W,1/3)),q++),W++})();var N=[],w=T.SHA256=R.extend({_doReset:function(){this._hash=new v.init(C.slice(0))},_doProcessBlock:function(B,U){for(var W=this._hash.words,q=W[0],G=W[1],b=W[2],M=W[3],j=W[4],K=W[5],Y=W[6],Q=W[7],$=0;$<64;$++){if($<16)N[$]=B[U+$]|0;else{var ue=N[$-15],J=(ue<<25|ue>>>7)^(ue<<14|ue>>>18)^ue>>>3,te=N[$-2],le=(te<<15|te>>>17)^(te<<13|te>>>19)^te>>>10;N[$]=J+N[$-7]+le+N[$-16]}var he=j&K^~j&Y,Pe=q&G^q&b^G&b,We=(q<<30|q>>>2)^(q<<19|q>>>13)^(q<<10|q>>>22),He=(j<<26|j>>>6)^(j<<21|j>>>11)^(j<<7|j>>>25),kt=Q+He+he+O[$]+N[$],Te=We+Pe;Q=Y,Y=K,K=j,j=M+kt|0,M=b,b=G,G=q,q=kt+Te|0}W[0]=W[0]+q|0,W[1]=W[1]+G|0,W[2]=W[2]+b|0,W[3]=W[3]+M|0,W[4]=W[4]+j|0,W[5]=W[5]+K|0,W[6]=W[6]+Y|0,W[7]=W[7]+Q|0},_doFinalize:function(){var B=this._data,U=B.words,W=this._nDataBytes*8,q=B.sigBytes*8;return U[q>>>5]|=128<<24-q%32,U[(q+64>>>9<<4)+14]=c.floor(W/4294967296),U[(q+64>>>9<<4)+15]=W,B.sigBytes=U.length*4,this._process(),this._hash},clone:function(){var B=R.clone.call(this);return B._hash=this._hash.clone(),B}});l.SHA256=R._createHelper(w),l.HmacSHA256=R._createHmacHelper(w)}(Math),a.SHA256})}(XK)),Yf}var qf={},QK={get exports(){return qf},set exports(r){qf=r}},EP;function $K(){return EP||(EP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),Sx())})(tt,function(a){return function(){var c=a,l=c.lib,f=l.WordArray,v=c.algo,R=v.SHA256,T=v.SHA224=R.extend({_doReset:function(){this._hash=new f.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var C=R._doFinalize.call(this);return C.sigBytes-=4,C}});c.SHA224=R._createHelper(T),c.HmacSHA224=R._createHmacHelper(T)}(),a.SHA224})}(QK)),qf}var Jf={},ZK={get exports(){return Jf},set exports(r){Jf=r}},vP;function Tx(){return vP||(vP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),K0())})(tt,function(a){return function(){var c=a,l=c.lib,f=l.Hasher,v=c.x64,R=v.Word,T=v.WordArray,C=c.algo;function O(){return R.create.apply(R,arguments)}var N=[O(1116352408,3609767458),O(1899447441,602891725),O(3049323471,3964484399),O(3921009573,2173295548),O(961987163,4081628472),O(1508970993,3053834265),O(2453635748,2937671579),O(2870763221,3664609560),O(3624381080,2734883394),O(310598401,1164996542),O(607225278,1323610764),O(1426881987,3590304994),O(1925078388,4068182383),O(2162078206,991336113),O(2614888103,633803317),O(3248222580,3479774868),O(3835390401,2666613458),O(4022224774,944711139),O(264347078,2341262773),O(604807628,2007800933),O(770255983,1495990901),O(1249150122,1856431235),O(1555081692,3175218132),O(1996064986,2198950837),O(2554220882,3999719339),O(2821834349,766784016),O(2952996808,2566594879),O(3210313671,3203337956),O(3336571891,1034457026),O(3584528711,2466948901),O(113926993,3758326383),O(338241895,168717936),O(666307205,1188179964),O(773529912,1546045734),O(1294757372,1522805485),O(1396182291,2643833823),O(1695183700,2343527390),O(1986661051,1014477480),O(2177026350,1206759142),O(2456956037,344077627),O(2730485921,1290863460),O(2820302411,3158454273),O(3259730800,3505952657),O(3345764771,106217008),O(3516065817,3606008344),O(3600352804,1432725776),O(4094571909,1467031594),O(275423344,851169720),O(430227734,3100823752),O(506948616,1363258195),O(659060556,3750685593),O(883997877,3785050280),O(958139571,3318307427),O(1322822218,3812723403),O(1537002063,2003034995),O(1747873779,3602036899),O(1955562222,1575990012),O(2024104815,1125592928),O(2227730452,2716904306),O(2361852424,442776044),O(2428436474,593698344),O(2756734187,3733110249),O(3204031479,2999351573),O(3329325298,3815920427),O(3391569614,3928383900),O(3515267271,566280711),O(3940187606,3454069534),O(4118630271,4000239992),O(116418474,1914138554),O(174292421,2731055270),O(289380356,3203993006),O(460393269,320620315),O(685471733,587496836),O(852142971,1086792851),O(1017036298,365543100),O(1126000580,2618297676),O(1288033470,3409855158),O(1501505948,4234509866),O(1607167915,987167468),O(1816402316,1246189591)],w=[];(function(){for(var U=0;U<80;U++)w[U]=O()})();var B=C.SHA512=f.extend({_doReset:function(){this._hash=new T.init([new R.init(1779033703,4089235720),new R.init(3144134277,2227873595),new R.init(1013904242,4271175723),new R.init(2773480762,1595750129),new R.init(1359893119,2917565137),new R.init(2600822924,725511199),new R.init(528734635,4215389547),new R.init(1541459225,327033209)])},_doProcessBlock:function(U,W){for(var q=this._hash.words,G=q[0],b=q[1],M=q[2],j=q[3],K=q[4],Y=q[5],Q=q[6],$=q[7],ue=G.high,J=G.low,te=b.high,le=b.low,he=M.high,Pe=M.low,We=j.high,He=j.low,kt=K.high,Te=K.low,Me=Y.high,ke=Y.low,ae=Q.high,pe=Q.low,ge=$.high,me=$.low,Vt=ue,vt=J,An=te,st=le,na=he,ss=Pe,Ti=We,ra=He,_n=kt,Cn=Te,as=Me,Po=ke,Xa=ae,cs=pe,Mr=ge,ni=me,Ur=0;Ur<80;Ur++){var _r,Bi,ia=w[Ur];if(Ur<16)Bi=ia.high=U[W+Ur*2]|0,_r=ia.low=U[W+Ur*2+1]|0;else{var Pu=w[Ur-15],Do=Pu.high,yi=Pu.low,Ll=(Do>>>1|yi<<31)^(Do>>>8|yi<<24)^Do>>>7,xl=(yi>>>1|Do<<31)^(yi>>>8|Do<<24)^(yi>>>7|Do<<25),Qa=w[Ur-2],ko=Qa.high,oa=Qa.low,z0=(ko>>>19|oa<<13)^(ko<<3|oa>>>29)^ko>>>6,Ml=(oa>>>19|ko<<13)^(oa<<3|ko>>>29)^(oa>>>6|ko<<26),Ul=w[Ur-7],Y0=Ul.high,Du=Ul.low,Vl=w[Ur-16],$a=Vl.high,Bl=Vl.low;_r=xl+Du,Bi=Ll+Y0+(_r>>>0<xl>>>0?1:0),_r=_r+Ml,Bi=Bi+z0+(_r>>>0<Ml>>>0?1:0),_r=_r+Bl,Bi=Bi+$a+(_r>>>0<Bl>>>0?1:0),ia.high=Bi,ia.low=_r}var q0=_n&as^~_n&Xa,jl=Cn&Po^~Cn&cs,ji=Vt&An^Vt&na^An&na,J0=vt&st^vt&ss^st&ss,ku=(Vt>>>28|vt<<4)^(Vt<<30|vt>>>2)^(Vt<<25|vt>>>7),Za=(vt>>>28|Vt<<4)^(vt<<30|Vt>>>2)^(vt<<25|Vt>>>7),Lu=(_n>>>14|Cn<<18)^(_n>>>18|Cn<<14)^(_n<<23|Cn>>>9),xu=(Cn>>>14|_n<<18)^(Cn>>>18|_n<<14)^(Cn<<23|_n>>>9),Fl=N[Ur],ec=Fl.high,Mu=Fl.low,wr=ni+xu,co=Mr+Lu+(wr>>>0<ni>>>0?1:0),wr=wr+jl,co=co+q0+(wr>>>0<jl>>>0?1:0),wr=wr+Mu,co=co+ec+(wr>>>0<Mu>>>0?1:0),wr=wr+_r,co=co+Bi+(wr>>>0<_r>>>0?1:0),Uu=Za+J0,Vu=ku+ji+(Uu>>>0<Za>>>0?1:0);Mr=Xa,ni=cs,Xa=as,cs=Po,as=_n,Po=Cn,Cn=ra+wr|0,_n=Ti+co+(Cn>>>0<ra>>>0?1:0)|0,Ti=na,ra=ss,na=An,ss=st,An=Vt,st=vt,vt=wr+Uu|0,Vt=co+Vu+(vt>>>0<wr>>>0?1:0)|0}J=G.low=J+vt,G.high=ue+Vt+(J>>>0<vt>>>0?1:0),le=b.low=le+st,b.high=te+An+(le>>>0<st>>>0?1:0),Pe=M.low=Pe+ss,M.high=he+na+(Pe>>>0<ss>>>0?1:0),He=j.low=He+ra,j.high=We+Ti+(He>>>0<ra>>>0?1:0),Te=K.low=Te+Cn,K.high=kt+_n+(Te>>>0<Cn>>>0?1:0),ke=Y.low=ke+Po,Y.high=Me+as+(ke>>>0<Po>>>0?1:0),pe=Q.low=pe+cs,Q.high=ae+Xa+(pe>>>0<cs>>>0?1:0),me=$.low=me+ni,$.high=ge+Mr+(me>>>0<ni>>>0?1:0)},_doFinalize:function(){var U=this._data,W=U.words,q=this._nDataBytes*8,G=U.sigBytes*8;W[G>>>5]|=128<<24-G%32,W[(G+128>>>10<<5)+30]=Math.floor(q/4294967296),W[(G+128>>>10<<5)+31]=q,U.sigBytes=W.length*4,this._process();var b=this._hash.toX32();return b},clone:function(){var U=f.clone.call(this);return U._hash=this._hash.clone(),U},blockSize:1024/32});c.SHA512=f._createHelper(B),c.HmacSHA512=f._createHmacHelper(B)}(),a.SHA512})}(ZK)),Jf}var Xf={},ez={get exports(){return Xf},set exports(r){Xf=r}},gP;function tz(){return gP||(gP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),K0(),Tx())})(tt,function(a){return function(){var c=a,l=c.x64,f=l.Word,v=l.WordArray,R=c.algo,T=R.SHA512,C=R.SHA384=T.extend({_doReset:function(){this._hash=new v.init([new f.init(3418070365,3238371032),new f.init(1654270250,914150663),new f.init(2438529370,812702999),new f.init(355462360,4144912697),new f.init(1731405415,4290775857),new f.init(2394180231,1750603025),new f.init(3675008525,1694076839),new f.init(1203062813,3204075428)])},_doFinalize:function(){var O=T._doFinalize.call(this);return O.sigBytes-=16,O}});c.SHA384=T._createHelper(C),c.HmacSHA384=T._createHmacHelper(C)}(),a.SHA384})}(ez)),Xf}var Qf={},nz={get exports(){return Qf},set exports(r){Qf=r}},SP;function rz(){return SP||(SP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),K0())})(tt,function(a){return function(c){var l=a,f=l.lib,v=f.WordArray,R=f.Hasher,T=l.x64,C=T.Word,O=l.algo,N=[],w=[],B=[];(function(){for(var q=1,G=0,b=0;b<24;b++){N[q+5*G]=(b+1)*(b+2)/2%64;var M=G%5,j=(2*q+3*G)%5;q=M,G=j}for(var q=0;q<5;q++)for(var G=0;G<5;G++)w[q+5*G]=G+(2*q+3*G)%5*5;for(var K=1,Y=0;Y<24;Y++){for(var Q=0,$=0,ue=0;ue<7;ue++){if(K&1){var J=(1<<ue)-1;J<32?$^=1<<J:Q^=1<<J-32}K&128?K=K<<1^113:K<<=1}B[Y]=C.create(Q,$)}})();var U=[];(function(){for(var q=0;q<25;q++)U[q]=C.create()})();var W=O.SHA3=R.extend({cfg:R.cfg.extend({outputLength:512}),_doReset:function(){for(var q=this._state=[],G=0;G<25;G++)q[G]=new C.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(q,G){for(var b=this._state,M=this.blockSize/2,j=0;j<M;j++){var K=q[G+2*j],Y=q[G+2*j+1];K=(K<<8|K>>>24)&16711935|(K<<24|K>>>8)&4278255360,Y=(Y<<8|Y>>>24)&16711935|(Y<<24|Y>>>8)&4278255360;var Q=b[j];Q.high^=Y,Q.low^=K}for(var $=0;$<24;$++){for(var ue=0;ue<5;ue++){for(var J=0,te=0,le=0;le<5;le++){var Q=b[ue+5*le];J^=Q.high,te^=Q.low}var he=U[ue];he.high=J,he.low=te}for(var ue=0;ue<5;ue++)for(var Pe=U[(ue+4)%5],We=U[(ue+1)%5],He=We.high,kt=We.low,J=Pe.high^(He<<1|kt>>>31),te=Pe.low^(kt<<1|He>>>31),le=0;le<5;le++){var Q=b[ue+5*le];Q.high^=J,Q.low^=te}for(var Te=1;Te<25;Te++){var J,te,Q=b[Te],Me=Q.high,ke=Q.low,ae=N[Te];ae<32?(J=Me<<ae|ke>>>32-ae,te=ke<<ae|Me>>>32-ae):(J=ke<<ae-32|Me>>>64-ae,te=Me<<ae-32|ke>>>64-ae);var pe=U[w[Te]];pe.high=J,pe.low=te}var ge=U[0],me=b[0];ge.high=me.high,ge.low=me.low;for(var ue=0;ue<5;ue++)for(var le=0;le<5;le++){var Te=ue+5*le,Q=b[Te],Vt=U[Te],vt=U[(ue+1)%5+5*le],An=U[(ue+2)%5+5*le];Q.high=Vt.high^~vt.high&An.high,Q.low=Vt.low^~vt.low&An.low}var Q=b[0],st=B[$];Q.high^=st.high,Q.low^=st.low}},_doFinalize:function(){var q=this._data,G=q.words;this._nDataBytes*8;var b=q.sigBytes*8,M=this.blockSize*32;G[b>>>5]|=1<<24-b%32,G[(c.ceil((b+1)/M)*M>>>5)-1]|=128,q.sigBytes=G.length*4,this._process();for(var j=this._state,K=this.cfg.outputLength/8,Y=K/8,Q=[],$=0;$<Y;$++){var ue=j[$],J=ue.high,te=ue.low;J=(J<<8|J>>>24)&16711935|(J<<24|J>>>8)&4278255360,te=(te<<8|te>>>24)&16711935|(te<<24|te>>>8)&4278255360,Q.push(te),Q.push(J)}return new v.init(Q,K)},clone:function(){for(var q=R.clone.call(this),G=q._state=this._state.slice(0),b=0;b<25;b++)G[b]=G[b].clone();return q}});l.SHA3=R._createHelper(W),l.HmacSHA3=R._createHmacHelper(W)}(Math),a.SHA3})}(nz)),Qf}var $f={},iz={get exports(){return $f},set exports(r){$f=r}},TP;function oz(){return TP||(TP=1,function(r,o){(function(a,c){r.exports=c(wt())})(tt,function(a){/** @preserve
			(c) 2012 by Cédric Mesnil. All rights reserved.

			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
			*/return function(c){var l=a,f=l.lib,v=f.WordArray,R=f.Hasher,T=l.algo,C=v.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),O=v.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),N=v.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),w=v.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),B=v.create([0,1518500249,1859775393,2400959708,2840853838]),U=v.create([1352829926,1548603684,1836072691,2053994217,0]),W=T.RIPEMD160=R.extend({_doReset:function(){this._hash=v.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(Y,Q){for(var $=0;$<16;$++){var ue=Q+$,J=Y[ue];Y[ue]=(J<<8|J>>>24)&16711935|(J<<24|J>>>8)&4278255360}var te=this._hash.words,le=B.words,he=U.words,Pe=C.words,We=O.words,He=N.words,kt=w.words,Te,Me,ke,ae,pe,ge,me,Vt,vt,An;ge=Te=te[0],me=Me=te[1],Vt=ke=te[2],vt=ae=te[3],An=pe=te[4];for(var st,$=0;$<80;$+=1)st=Te+Y[Q+Pe[$]]|0,$<16?st+=q(Me,ke,ae)+le[0]:$<32?st+=G(Me,ke,ae)+le[1]:$<48?st+=b(Me,ke,ae)+le[2]:$<64?st+=M(Me,ke,ae)+le[3]:st+=j(Me,ke,ae)+le[4],st=st|0,st=K(st,He[$]),st=st+pe|0,Te=pe,pe=ae,ae=K(ke,10),ke=Me,Me=st,st=ge+Y[Q+We[$]]|0,$<16?st+=j(me,Vt,vt)+he[0]:$<32?st+=M(me,Vt,vt)+he[1]:$<48?st+=b(me,Vt,vt)+he[2]:$<64?st+=G(me,Vt,vt)+he[3]:st+=q(me,Vt,vt)+he[4],st=st|0,st=K(st,kt[$]),st=st+An|0,ge=An,An=vt,vt=K(Vt,10),Vt=me,me=st;st=te[1]+ke+vt|0,te[1]=te[2]+ae+An|0,te[2]=te[3]+pe+ge|0,te[3]=te[4]+Te+me|0,te[4]=te[0]+Me+Vt|0,te[0]=st},_doFinalize:function(){var Y=this._data,Q=Y.words,$=this._nDataBytes*8,ue=Y.sigBytes*8;Q[ue>>>5]|=128<<24-ue%32,Q[(ue+64>>>9<<4)+14]=($<<8|$>>>24)&16711935|($<<24|$>>>8)&4278255360,Y.sigBytes=(Q.length+1)*4,this._process();for(var J=this._hash,te=J.words,le=0;le<5;le++){var he=te[le];te[le]=(he<<8|he>>>24)&16711935|(he<<24|he>>>8)&4278255360}return J},clone:function(){var Y=R.clone.call(this);return Y._hash=this._hash.clone(),Y}});function q(Y,Q,$){return Y^Q^$}function G(Y,Q,$){return Y&Q|~Y&$}function b(Y,Q,$){return(Y|~Q)^$}function M(Y,Q,$){return Y&$|Q&~$}function j(Y,Q,$){return Y^(Q|~$)}function K(Y,Q){return Y<<Q|Y>>>32-Q}l.RIPEMD160=R._createHelper(W),l.HmacRIPEMD160=R._createHmacHelper(W)}(),a.RIPEMD160})}(iz)),$f}var Zf={},sz={get exports(){return Zf},set exports(r){Zf=r}},yP;function iT(){return yP||(yP=1,function(r,o){(function(a,c){r.exports=c(wt())})(tt,function(a){(function(){var c=a,l=c.lib,f=l.Base,v=c.enc,R=v.Utf8,T=c.algo;T.HMAC=f.extend({init:function(C,O){C=this._hasher=new C.init,typeof O=="string"&&(O=R.parse(O));var N=C.blockSize,w=N*4;O.sigBytes>w&&(O=C.finalize(O)),O.clamp();for(var B=this._oKey=O.clone(),U=this._iKey=O.clone(),W=B.words,q=U.words,G=0;G<N;G++)W[G]^=1549556828,q[G]^=909522486;B.sigBytes=U.sigBytes=w,this.reset()},reset:function(){var C=this._hasher;C.reset(),C.update(this._iKey)},update:function(C){return this._hasher.update(C),this},finalize:function(C){var O=this._hasher,N=O.finalize(C);O.reset();var w=O.finalize(this._oKey.clone().concat(N));return w}})})()})}(sz)),Zf}var e0={},az={get exports(){return e0},set exports(r){e0=r}},RP;function cz(){return RP||(RP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),rT(),iT())})(tt,function(a){return function(){var c=a,l=c.lib,f=l.Base,v=l.WordArray,R=c.algo,T=R.SHA1,C=R.HMAC,O=R.PBKDF2=f.extend({cfg:f.extend({keySize:128/32,hasher:T,iterations:1}),init:function(N){this.cfg=this.cfg.extend(N)},compute:function(N,w){for(var B=this.cfg,U=C.create(B.hasher,N),W=v.create(),q=v.create([1]),G=W.words,b=q.words,M=B.keySize,j=B.iterations;G.length<M;){var K=U.update(w).finalize(q);U.reset();for(var Y=K.words,Q=Y.length,$=K,ue=1;ue<j;ue++){$=U.finalize($),U.reset();for(var J=$.words,te=0;te<Q;te++)Y[te]^=J[te]}W.concat(K),b[0]++}return W.sigBytes=M*4,W}});c.PBKDF2=function(N,w,B){return O.create(B).compute(N,w)}}(),a.PBKDF2})}(az)),e0}var t0={},uz={get exports(){return t0},set exports(r){t0=r}},CP;function qa(){return CP||(CP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),rT(),iT())})(tt,function(a){return function(){var c=a,l=c.lib,f=l.Base,v=l.WordArray,R=c.algo,T=R.MD5,C=R.EvpKDF=f.extend({cfg:f.extend({keySize:128/32,hasher:T,iterations:1}),init:function(O){this.cfg=this.cfg.extend(O)},compute:function(O,N){for(var w,B=this.cfg,U=B.hasher.create(),W=v.create(),q=W.words,G=B.keySize,b=B.iterations;q.length<G;){w&&U.update(w),w=U.update(O).finalize(N),U.reset();for(var M=1;M<b;M++)w=U.finalize(w),U.reset();W.concat(w)}return W.sigBytes=G*4,W}});c.EvpKDF=function(O,N,w){return C.create(w).compute(O,N)}}(),a.EvpKDF})}(uz)),t0}var n0={},dz={get exports(){return n0},set exports(r){n0=r}},IP;function fr(){return IP||(IP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),qa())})(tt,function(a){a.lib.Cipher||function(c){var l=a,f=l.lib,v=f.Base,R=f.WordArray,T=f.BufferedBlockAlgorithm,C=l.enc;C.Utf8;var O=C.Base64,N=l.algo,w=N.EvpKDF,B=f.Cipher=T.extend({cfg:v.extend(),createEncryptor:function(J,te){return this.create(this._ENC_XFORM_MODE,J,te)},createDecryptor:function(J,te){return this.create(this._DEC_XFORM_MODE,J,te)},init:function(J,te,le){this.cfg=this.cfg.extend(le),this._xformMode=J,this._key=te,this.reset()},reset:function(){T.reset.call(this),this._doReset()},process:function(J){return this._append(J),this._process()},finalize:function(J){J&&this._append(J);var te=this._doFinalize();return te},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function J(te){return typeof te=="string"?ue:Y}return function(te){return{encrypt:function(le,he,Pe){return J(he).encrypt(te,le,he,Pe)},decrypt:function(le,he,Pe){return J(he).decrypt(te,le,he,Pe)}}}}()});f.StreamCipher=B.extend({_doFinalize:function(){var J=this._process(!0);return J},blockSize:1});var U=l.mode={},W=f.BlockCipherMode=v.extend({createEncryptor:function(J,te){return this.Encryptor.create(J,te)},createDecryptor:function(J,te){return this.Decryptor.create(J,te)},init:function(J,te){this._cipher=J,this._iv=te}}),q=U.CBC=function(){var J=W.extend();J.Encryptor=J.extend({processBlock:function(le,he){var Pe=this._cipher,We=Pe.blockSize;te.call(this,le,he,We),Pe.encryptBlock(le,he),this._prevBlock=le.slice(he,he+We)}}),J.Decryptor=J.extend({processBlock:function(le,he){var Pe=this._cipher,We=Pe.blockSize,He=le.slice(he,he+We);Pe.decryptBlock(le,he),te.call(this,le,he,We),this._prevBlock=He}});function te(le,he,Pe){var We,He=this._iv;He?(We=He,this._iv=c):We=this._prevBlock;for(var kt=0;kt<Pe;kt++)le[he+kt]^=We[kt]}return J}(),G=l.pad={},b=G.Pkcs7={pad:function(J,te){for(var le=te*4,he=le-J.sigBytes%le,Pe=he<<24|he<<16|he<<8|he,We=[],He=0;He<he;He+=4)We.push(Pe);var kt=R.create(We,he);J.concat(kt)},unpad:function(J){var te=J.words[J.sigBytes-1>>>2]&255;J.sigBytes-=te}};f.BlockCipher=B.extend({cfg:B.cfg.extend({mode:q,padding:b}),reset:function(){var J;B.reset.call(this);var te=this.cfg,le=te.iv,he=te.mode;this._xformMode==this._ENC_XFORM_MODE?J=he.createEncryptor:(J=he.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==J?this._mode.init(this,le&&le.words):(this._mode=J.call(he,this,le&&le.words),this._mode.__creator=J)},_doProcessBlock:function(J,te){this._mode.processBlock(J,te)},_doFinalize:function(){var J,te=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(te.pad(this._data,this.blockSize),J=this._process(!0)):(J=this._process(!0),te.unpad(J)),J},blockSize:128/32});var M=f.CipherParams=v.extend({init:function(J){this.mixIn(J)},toString:function(J){return(J||this.formatter).stringify(this)}}),j=l.format={},K=j.OpenSSL={stringify:function(J){var te,le=J.ciphertext,he=J.salt;return he?te=R.create([1398893684,1701076831]).concat(he).concat(le):te=le,te.toString(O)},parse:function(J){var te,le=O.parse(J),he=le.words;return he[0]==1398893684&&he[1]==1701076831&&(te=R.create(he.slice(2,4)),he.splice(0,4),le.sigBytes-=16),M.create({ciphertext:le,salt:te})}},Y=f.SerializableCipher=v.extend({cfg:v.extend({format:K}),encrypt:function(J,te,le,he){he=this.cfg.extend(he);var Pe=J.createEncryptor(le,he),We=Pe.finalize(te),He=Pe.cfg;return M.create({ciphertext:We,key:le,iv:He.iv,algorithm:J,mode:He.mode,padding:He.padding,blockSize:J.blockSize,formatter:he.format})},decrypt:function(J,te,le,he){he=this.cfg.extend(he),te=this._parse(te,he.format);var Pe=J.createDecryptor(le,he).finalize(te.ciphertext);return Pe},_parse:function(J,te){return typeof J=="string"?te.parse(J,this):J}}),Q=l.kdf={},$=Q.OpenSSL={execute:function(J,te,le,he){he||(he=R.random(64/8));var Pe=w.create({keySize:te+le}).compute(J,he),We=R.create(Pe.words.slice(te),le*4);return Pe.sigBytes=te*4,M.create({key:Pe,iv:We,salt:he})}},ue=f.PasswordBasedCipher=Y.extend({cfg:Y.cfg.extend({kdf:$}),encrypt:function(J,te,le,he){he=this.cfg.extend(he);var Pe=he.kdf.execute(le,J.keySize,J.ivSize);he.iv=Pe.iv;var We=Y.encrypt.call(this,J,te,Pe.key,he);return We.mixIn(Pe),We},decrypt:function(J,te,le,he){he=this.cfg.extend(he),te=this._parse(te,he.format);var Pe=he.kdf.execute(le,J.keySize,J.ivSize,te.salt);he.iv=Pe.iv;var We=Y.decrypt.call(this,J,te,Pe.key,he);return We}})}()})}(dz)),n0}var r0={},lz={get exports(){return r0},set exports(r){r0=r}},AP;function hz(){return AP||(AP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),fr())})(tt,function(a){return a.mode.CFB=function(){var c=a.lib.BlockCipherMode.extend();c.Encryptor=c.extend({processBlock:function(f,v){var R=this._cipher,T=R.blockSize;l.call(this,f,v,T,R),this._prevBlock=f.slice(v,v+T)}}),c.Decryptor=c.extend({processBlock:function(f,v){var R=this._cipher,T=R.blockSize,C=f.slice(v,v+T);l.call(this,f,v,T,R),this._prevBlock=C}});function l(f,v,R,T){var C,O=this._iv;O?(C=O.slice(0),this._iv=void 0):C=this._prevBlock,T.encryptBlock(C,0);for(var N=0;N<R;N++)f[v+N]^=C[N]}return c}(),a.mode.CFB})}(lz)),r0}var i0={},pz={get exports(){return i0},set exports(r){i0=r}},wP;function fz(){return wP||(wP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),fr())})(tt,function(a){return a.mode.CTR=function(){var c=a.lib.BlockCipherMode.extend(),l=c.Encryptor=c.extend({processBlock:function(f,v){var R=this._cipher,T=R.blockSize,C=this._iv,O=this._counter;C&&(O=this._counter=C.slice(0),this._iv=void 0);var N=O.slice(0);R.encryptBlock(N,0),O[T-1]=O[T-1]+1|0;for(var w=0;w<T;w++)f[v+w]^=N[w]}});return c.Decryptor=l,c}(),a.mode.CTR})}(pz)),i0}var o0={},_z={get exports(){return o0},set exports(r){o0=r}},OP;function mz(){return OP||(OP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),fr())})(tt,function(a){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return a.mode.CTRGladman=function(){var c=a.lib.BlockCipherMode.extend();function l(R){if((R>>24&255)===255){var T=R>>16&255,C=R>>8&255,O=R&255;T===255?(T=0,C===255?(C=0,O===255?O=0:++O):++C):++T,R=0,R+=T<<16,R+=C<<8,R+=O}else R+=1<<24;return R}function f(R){return(R[0]=l(R[0]))===0&&(R[1]=l(R[1])),R}var v=c.Encryptor=c.extend({processBlock:function(R,T){var C=this._cipher,O=C.blockSize,N=this._iv,w=this._counter;N&&(w=this._counter=N.slice(0),this._iv=void 0),f(w);var B=w.slice(0);C.encryptBlock(B,0);for(var U=0;U<O;U++)R[T+U]^=B[U]}});return c.Decryptor=v,c}(),a.mode.CTRGladman})}(_z)),o0}var s0={},Ez={get exports(){return s0},set exports(r){s0=r}},bP;function vz(){return bP||(bP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),fr())})(tt,function(a){return a.mode.OFB=function(){var c=a.lib.BlockCipherMode.extend(),l=c.Encryptor=c.extend({processBlock:function(f,v){var R=this._cipher,T=R.blockSize,C=this._iv,O=this._keystream;C&&(O=this._keystream=C.slice(0),this._iv=void 0),R.encryptBlock(O,0);for(var N=0;N<T;N++)f[v+N]^=O[N]}});return c.Decryptor=l,c}(),a.mode.OFB})}(Ez)),s0}var a0={},gz={get exports(){return a0},set exports(r){a0=r}},NP;function Sz(){return NP||(NP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),fr())})(tt,function(a){return a.mode.ECB=function(){var c=a.lib.BlockCipherMode.extend();return c.Encryptor=c.extend({processBlock:function(l,f){this._cipher.encryptBlock(l,f)}}),c.Decryptor=c.extend({processBlock:function(l,f){this._cipher.decryptBlock(l,f)}}),c}(),a.mode.ECB})}(gz)),a0}var c0={},Tz={get exports(){return c0},set exports(r){c0=r}},PP;function yz(){return PP||(PP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),fr())})(tt,function(a){return a.pad.AnsiX923={pad:function(c,l){var f=c.sigBytes,v=l*4,R=v-f%v,T=f+R-1;c.clamp(),c.words[T>>>2]|=R<<24-T%4*8,c.sigBytes+=R},unpad:function(c){var l=c.words[c.sigBytes-1>>>2]&255;c.sigBytes-=l}},a.pad.Ansix923})}(Tz)),c0}var u0={},Rz={get exports(){return u0},set exports(r){u0=r}},DP;function Cz(){return DP||(DP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),fr())})(tt,function(a){return a.pad.Iso10126={pad:function(c,l){var f=l*4,v=f-c.sigBytes%f;c.concat(a.lib.WordArray.random(v-1)).concat(a.lib.WordArray.create([v<<24],1))},unpad:function(c){var l=c.words[c.sigBytes-1>>>2]&255;c.sigBytes-=l}},a.pad.Iso10126})}(Rz)),u0}var d0={},Iz={get exports(){return d0},set exports(r){d0=r}},kP;function Az(){return kP||(kP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),fr())})(tt,function(a){return a.pad.Iso97971={pad:function(c,l){c.concat(a.lib.WordArray.create([2147483648],1)),a.pad.ZeroPadding.pad(c,l)},unpad:function(c){a.pad.ZeroPadding.unpad(c),c.sigBytes--}},a.pad.Iso97971})}(Iz)),d0}var l0={},wz={get exports(){return l0},set exports(r){l0=r}},LP;function Oz(){return LP||(LP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),fr())})(tt,function(a){return a.pad.ZeroPadding={pad:function(c,l){var f=l*4;c.clamp(),c.sigBytes+=f-(c.sigBytes%f||f)},unpad:function(c){for(var l=c.words,f=c.sigBytes-1,f=c.sigBytes-1;f>=0;f--)if(l[f>>>2]>>>24-f%4*8&255){c.sigBytes=f+1;break}}},a.pad.ZeroPadding})}(wz)),l0}var h0={},bz={get exports(){return h0},set exports(r){h0=r}},xP;function Nz(){return xP||(xP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),fr())})(tt,function(a){return a.pad.NoPadding={pad:function(){},unpad:function(){}},a.pad.NoPadding})}(bz)),h0}var p0={},Pz={get exports(){return p0},set exports(r){p0=r}},MP;function Dz(){return MP||(MP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),fr())})(tt,function(a){return function(c){var l=a,f=l.lib,v=f.CipherParams,R=l.enc,T=R.Hex,C=l.format;C.Hex={stringify:function(O){return O.ciphertext.toString(T)},parse:function(O){var N=T.parse(O);return v.create({ciphertext:N})}}}(),a.format.Hex})}(Pz)),p0}var f0={},kz={get exports(){return f0},set exports(r){f0=r}},UP;function Lz(){return UP||(UP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),bu(),Nu(),qa(),fr())})(tt,function(a){return function(){var c=a,l=c.lib,f=l.BlockCipher,v=c.algo,R=[],T=[],C=[],O=[],N=[],w=[],B=[],U=[],W=[],q=[];(function(){for(var M=[],j=0;j<256;j++)j<128?M[j]=j<<1:M[j]=j<<1^283;for(var K=0,Y=0,j=0;j<256;j++){var Q=Y^Y<<1^Y<<2^Y<<3^Y<<4;Q=Q>>>8^Q&255^99,R[K]=Q,T[Q]=K;var $=M[K],ue=M[$],J=M[ue],te=M[Q]*257^Q*16843008;C[K]=te<<24|te>>>8,O[K]=te<<16|te>>>16,N[K]=te<<8|te>>>24,w[K]=te;var te=J*16843009^ue*65537^$*257^K*16843008;B[Q]=te<<24|te>>>8,U[Q]=te<<16|te>>>16,W[Q]=te<<8|te>>>24,q[Q]=te,K?(K=$^M[M[M[J^$]]],Y^=M[M[Y]]):K=Y=1}})();var G=[0,1,2,4,8,16,32,64,128,27,54],b=v.AES=f.extend({_doReset:function(){var M;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var j=this._keyPriorReset=this._key,K=j.words,Y=j.sigBytes/4,Q=this._nRounds=Y+6,$=(Q+1)*4,ue=this._keySchedule=[],J=0;J<$;J++)J<Y?ue[J]=K[J]:(M=ue[J-1],J%Y?Y>6&&J%Y==4&&(M=R[M>>>24]<<24|R[M>>>16&255]<<16|R[M>>>8&255]<<8|R[M&255]):(M=M<<8|M>>>24,M=R[M>>>24]<<24|R[M>>>16&255]<<16|R[M>>>8&255]<<8|R[M&255],M^=G[J/Y|0]<<24),ue[J]=ue[J-Y]^M);for(var te=this._invKeySchedule=[],le=0;le<$;le++){var J=$-le;if(le%4)var M=ue[J];else var M=ue[J-4];le<4||J<=4?te[le]=M:te[le]=B[R[M>>>24]]^U[R[M>>>16&255]]^W[R[M>>>8&255]]^q[R[M&255]]}}},encryptBlock:function(M,j){this._doCryptBlock(M,j,this._keySchedule,C,O,N,w,R)},decryptBlock:function(M,j){var K=M[j+1];M[j+1]=M[j+3],M[j+3]=K,this._doCryptBlock(M,j,this._invKeySchedule,B,U,W,q,T);var K=M[j+1];M[j+1]=M[j+3],M[j+3]=K},_doCryptBlock:function(M,j,K,Y,Q,$,ue,J){for(var te=this._nRounds,le=M[j]^K[0],he=M[j+1]^K[1],Pe=M[j+2]^K[2],We=M[j+3]^K[3],He=4,kt=1;kt<te;kt++){var Te=Y[le>>>24]^Q[he>>>16&255]^$[Pe>>>8&255]^ue[We&255]^K[He++],Me=Y[he>>>24]^Q[Pe>>>16&255]^$[We>>>8&255]^ue[le&255]^K[He++],ke=Y[Pe>>>24]^Q[We>>>16&255]^$[le>>>8&255]^ue[he&255]^K[He++],ae=Y[We>>>24]^Q[le>>>16&255]^$[he>>>8&255]^ue[Pe&255]^K[He++];le=Te,he=Me,Pe=ke,We=ae}var Te=(J[le>>>24]<<24|J[he>>>16&255]<<16|J[Pe>>>8&255]<<8|J[We&255])^K[He++],Me=(J[he>>>24]<<24|J[Pe>>>16&255]<<16|J[We>>>8&255]<<8|J[le&255])^K[He++],ke=(J[Pe>>>24]<<24|J[We>>>16&255]<<16|J[le>>>8&255]<<8|J[he&255])^K[He++],ae=(J[We>>>24]<<24|J[le>>>16&255]<<16|J[he>>>8&255]<<8|J[Pe&255])^K[He++];M[j]=Te,M[j+1]=Me,M[j+2]=ke,M[j+3]=ae},keySize:256/32});c.AES=f._createHelper(b)}(),a.AES})}(kz)),f0}var _0={},xz={get exports(){return _0},set exports(r){_0=r}},VP;function Mz(){return VP||(VP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),bu(),Nu(),qa(),fr())})(tt,function(a){return function(){var c=a,l=c.lib,f=l.WordArray,v=l.BlockCipher,R=c.algo,T=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],C=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],O=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],N=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],w=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],B=R.DES=v.extend({_doReset:function(){for(var G=this._key,b=G.words,M=[],j=0;j<56;j++){var K=T[j]-1;M[j]=b[K>>>5]>>>31-K%32&1}for(var Y=this._subKeys=[],Q=0;Q<16;Q++){for(var $=Y[Q]=[],ue=O[Q],j=0;j<24;j++)$[j/6|0]|=M[(C[j]-1+ue)%28]<<31-j%6,$[4+(j/6|0)]|=M[28+(C[j+24]-1+ue)%28]<<31-j%6;$[0]=$[0]<<1|$[0]>>>31;for(var j=1;j<7;j++)$[j]=$[j]>>>(j-1)*4+3;$[7]=$[7]<<5|$[7]>>>27}for(var J=this._invSubKeys=[],j=0;j<16;j++)J[j]=Y[15-j]},encryptBlock:function(G,b){this._doCryptBlock(G,b,this._subKeys)},decryptBlock:function(G,b){this._doCryptBlock(G,b,this._invSubKeys)},_doCryptBlock:function(G,b,M){this._lBlock=G[b],this._rBlock=G[b+1],U.call(this,4,252645135),U.call(this,16,65535),W.call(this,2,858993459),W.call(this,8,16711935),U.call(this,1,1431655765);for(var j=0;j<16;j++){for(var K=M[j],Y=this._lBlock,Q=this._rBlock,$=0,ue=0;ue<8;ue++)$|=N[ue][((Q^K[ue])&w[ue])>>>0];this._lBlock=Q,this._rBlock=Y^$}var J=this._lBlock;this._lBlock=this._rBlock,this._rBlock=J,U.call(this,1,1431655765),W.call(this,8,16711935),W.call(this,2,858993459),U.call(this,16,65535),U.call(this,4,252645135),G[b]=this._lBlock,G[b+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function U(G,b){var M=(this._lBlock>>>G^this._rBlock)&b;this._rBlock^=M,this._lBlock^=M<<G}function W(G,b){var M=(this._rBlock>>>G^this._lBlock)&b;this._lBlock^=M,this._rBlock^=M<<G}c.DES=v._createHelper(B);var q=R.TripleDES=v.extend({_doReset:function(){var G=this._key,b=G.words;if(b.length!==2&&b.length!==4&&b.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var M=b.slice(0,2),j=b.length<4?b.slice(0,2):b.slice(2,4),K=b.length<6?b.slice(0,2):b.slice(4,6);this._des1=B.createEncryptor(f.create(M)),this._des2=B.createEncryptor(f.create(j)),this._des3=B.createEncryptor(f.create(K))},encryptBlock:function(G,b){this._des1.encryptBlock(G,b),this._des2.decryptBlock(G,b),this._des3.encryptBlock(G,b)},decryptBlock:function(G,b){this._des3.decryptBlock(G,b),this._des2.encryptBlock(G,b),this._des1.decryptBlock(G,b)},keySize:192/32,ivSize:64/32,blockSize:64/32});c.TripleDES=v._createHelper(q)}(),a.TripleDES})}(xz)),_0}var m0={},Uz={get exports(){return m0},set exports(r){m0=r}},BP;function Vz(){return BP||(BP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),bu(),Nu(),qa(),fr())})(tt,function(a){return function(){var c=a,l=c.lib,f=l.StreamCipher,v=c.algo,R=v.RC4=f.extend({_doReset:function(){for(var O=this._key,N=O.words,w=O.sigBytes,B=this._S=[],U=0;U<256;U++)B[U]=U;for(var U=0,W=0;U<256;U++){var q=U%w,G=N[q>>>2]>>>24-q%4*8&255;W=(W+B[U]+G)%256;var b=B[U];B[U]=B[W],B[W]=b}this._i=this._j=0},_doProcessBlock:function(O,N){O[N]^=T.call(this)},keySize:256/32,ivSize:0});function T(){for(var O=this._S,N=this._i,w=this._j,B=0,U=0;U<4;U++){N=(N+1)%256,w=(w+O[N])%256;var W=O[N];O[N]=O[w],O[w]=W,B|=O[(O[N]+O[w])%256]<<24-U*8}return this._i=N,this._j=w,B}c.RC4=f._createHelper(R);var C=v.RC4Drop=R.extend({cfg:R.cfg.extend({drop:192}),_doReset:function(){R._doReset.call(this);for(var O=this.cfg.drop;O>0;O--)T.call(this)}});c.RC4Drop=f._createHelper(C)}(),a.RC4})}(Uz)),m0}var E0={},Bz={get exports(){return E0},set exports(r){E0=r}},jP;function jz(){return jP||(jP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),bu(),Nu(),qa(),fr())})(tt,function(a){return function(){var c=a,l=c.lib,f=l.StreamCipher,v=c.algo,R=[],T=[],C=[],O=v.Rabbit=f.extend({_doReset:function(){for(var w=this._key.words,B=this.cfg.iv,U=0;U<4;U++)w[U]=(w[U]<<8|w[U]>>>24)&16711935|(w[U]<<24|w[U]>>>8)&4278255360;var W=this._X=[w[0],w[3]<<16|w[2]>>>16,w[1],w[0]<<16|w[3]>>>16,w[2],w[1]<<16|w[0]>>>16,w[3],w[2]<<16|w[1]>>>16],q=this._C=[w[2]<<16|w[2]>>>16,w[0]&4294901760|w[1]&65535,w[3]<<16|w[3]>>>16,w[1]&4294901760|w[2]&65535,w[0]<<16|w[0]>>>16,w[2]&4294901760|w[3]&65535,w[1]<<16|w[1]>>>16,w[3]&4294901760|w[0]&65535];this._b=0;for(var U=0;U<4;U++)N.call(this);for(var U=0;U<8;U++)q[U]^=W[U+4&7];if(B){var G=B.words,b=G[0],M=G[1],j=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360,K=(M<<8|M>>>24)&16711935|(M<<24|M>>>8)&4278255360,Y=j>>>16|K&4294901760,Q=K<<16|j&65535;q[0]^=j,q[1]^=Y,q[2]^=K,q[3]^=Q,q[4]^=j,q[5]^=Y,q[6]^=K,q[7]^=Q;for(var U=0;U<4;U++)N.call(this)}},_doProcessBlock:function(w,B){var U=this._X;N.call(this),R[0]=U[0]^U[5]>>>16^U[3]<<16,R[1]=U[2]^U[7]>>>16^U[5]<<16,R[2]=U[4]^U[1]>>>16^U[7]<<16,R[3]=U[6]^U[3]>>>16^U[1]<<16;for(var W=0;W<4;W++)R[W]=(R[W]<<8|R[W]>>>24)&16711935|(R[W]<<24|R[W]>>>8)&4278255360,w[B+W]^=R[W]},blockSize:128/32,ivSize:64/32});function N(){for(var w=this._X,B=this._C,U=0;U<8;U++)T[U]=B[U];B[0]=B[0]+1295307597+this._b|0,B[1]=B[1]+3545052371+(B[0]>>>0<T[0]>>>0?1:0)|0,B[2]=B[2]+886263092+(B[1]>>>0<T[1]>>>0?1:0)|0,B[3]=B[3]+1295307597+(B[2]>>>0<T[2]>>>0?1:0)|0,B[4]=B[4]+3545052371+(B[3]>>>0<T[3]>>>0?1:0)|0,B[5]=B[5]+886263092+(B[4]>>>0<T[4]>>>0?1:0)|0,B[6]=B[6]+1295307597+(B[5]>>>0<T[5]>>>0?1:0)|0,B[7]=B[7]+3545052371+(B[6]>>>0<T[6]>>>0?1:0)|0,this._b=B[7]>>>0<T[7]>>>0?1:0;for(var U=0;U<8;U++){var W=w[U]+B[U],q=W&65535,G=W>>>16,b=((q*q>>>17)+q*G>>>15)+G*G,M=((W&4294901760)*W|0)+((W&65535)*W|0);C[U]=b^M}w[0]=C[0]+(C[7]<<16|C[7]>>>16)+(C[6]<<16|C[6]>>>16)|0,w[1]=C[1]+(C[0]<<8|C[0]>>>24)+C[7]|0,w[2]=C[2]+(C[1]<<16|C[1]>>>16)+(C[0]<<16|C[0]>>>16)|0,w[3]=C[3]+(C[2]<<8|C[2]>>>24)+C[1]|0,w[4]=C[4]+(C[3]<<16|C[3]>>>16)+(C[2]<<16|C[2]>>>16)|0,w[5]=C[5]+(C[4]<<8|C[4]>>>24)+C[3]|0,w[6]=C[6]+(C[5]<<16|C[5]>>>16)+(C[4]<<16|C[4]>>>16)|0,w[7]=C[7]+(C[6]<<8|C[6]>>>24)+C[5]|0}c.Rabbit=f._createHelper(O)}(),a.Rabbit})}(Bz)),E0}var v0={},Fz={get exports(){return v0},set exports(r){v0=r}},FP;function Gz(){return FP||(FP=1,function(r,o){(function(a,c,l){r.exports=c(wt(),bu(),Nu(),qa(),fr())})(tt,function(a){return function(){var c=a,l=c.lib,f=l.StreamCipher,v=c.algo,R=[],T=[],C=[],O=v.RabbitLegacy=f.extend({_doReset:function(){var w=this._key.words,B=this.cfg.iv,U=this._X=[w[0],w[3]<<16|w[2]>>>16,w[1],w[0]<<16|w[3]>>>16,w[2],w[1]<<16|w[0]>>>16,w[3],w[2]<<16|w[1]>>>16],W=this._C=[w[2]<<16|w[2]>>>16,w[0]&4294901760|w[1]&65535,w[3]<<16|w[3]>>>16,w[1]&4294901760|w[2]&65535,w[0]<<16|w[0]>>>16,w[2]&4294901760|w[3]&65535,w[1]<<16|w[1]>>>16,w[3]&4294901760|w[0]&65535];this._b=0;for(var q=0;q<4;q++)N.call(this);for(var q=0;q<8;q++)W[q]^=U[q+4&7];if(B){var G=B.words,b=G[0],M=G[1],j=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360,K=(M<<8|M>>>24)&16711935|(M<<24|M>>>8)&4278255360,Y=j>>>16|K&4294901760,Q=K<<16|j&65535;W[0]^=j,W[1]^=Y,W[2]^=K,W[3]^=Q,W[4]^=j,W[5]^=Y,W[6]^=K,W[7]^=Q;for(var q=0;q<4;q++)N.call(this)}},_doProcessBlock:function(w,B){var U=this._X;N.call(this),R[0]=U[0]^U[5]>>>16^U[3]<<16,R[1]=U[2]^U[7]>>>16^U[5]<<16,R[2]=U[4]^U[1]>>>16^U[7]<<16,R[3]=U[6]^U[3]>>>16^U[1]<<16;for(var W=0;W<4;W++)R[W]=(R[W]<<8|R[W]>>>24)&16711935|(R[W]<<24|R[W]>>>8)&4278255360,w[B+W]^=R[W]},blockSize:128/32,ivSize:64/32});function N(){for(var w=this._X,B=this._C,U=0;U<8;U++)T[U]=B[U];B[0]=B[0]+1295307597+this._b|0,B[1]=B[1]+3545052371+(B[0]>>>0<T[0]>>>0?1:0)|0,B[2]=B[2]+886263092+(B[1]>>>0<T[1]>>>0?1:0)|0,B[3]=B[3]+1295307597+(B[2]>>>0<T[2]>>>0?1:0)|0,B[4]=B[4]+3545052371+(B[3]>>>0<T[3]>>>0?1:0)|0,B[5]=B[5]+886263092+(B[4]>>>0<T[4]>>>0?1:0)|0,B[6]=B[6]+1295307597+(B[5]>>>0<T[5]>>>0?1:0)|0,B[7]=B[7]+3545052371+(B[6]>>>0<T[6]>>>0?1:0)|0,this._b=B[7]>>>0<T[7]>>>0?1:0;for(var U=0;U<8;U++){var W=w[U]+B[U],q=W&65535,G=W>>>16,b=((q*q>>>17)+q*G>>>15)+G*G,M=((W&4294901760)*W|0)+((W&65535)*W|0);C[U]=b^M}w[0]=C[0]+(C[7]<<16|C[7]>>>16)+(C[6]<<16|C[6]>>>16)|0,w[1]=C[1]+(C[0]<<8|C[0]>>>24)+C[7]|0,w[2]=C[2]+(C[1]<<16|C[1]>>>16)+(C[0]<<16|C[0]>>>16)|0,w[3]=C[3]+(C[2]<<8|C[2]>>>24)+C[1]|0,w[4]=C[4]+(C[3]<<16|C[3]>>>16)+(C[2]<<16|C[2]>>>16)|0,w[5]=C[5]+(C[4]<<8|C[4]>>>24)+C[3]|0,w[6]=C[6]+(C[5]<<16|C[5]>>>16)+(C[4]<<16|C[4]>>>16)|0,w[7]=C[7]+(C[6]<<8|C[6]>>>24)+C[5]|0}c.RabbitLegacy=f._createHelper(O)}(),a.RabbitLegacy})}(Fz)),v0}(function(r,o){(function(a,c,l){r.exports=c(wt(),K0(),GK(),HK(),bu(),YK(),Nu(),rT(),Sx(),$K(),Tx(),tz(),rz(),oz(),iT(),cz(),qa(),fr(),hz(),fz(),mz(),vz(),Sz(),yz(),Cz(),Az(),Oz(),Nz(),Dz(),Lz(),Mz(),Vz(),jz(),Gz())})(tt,function(a){return a})})(LK);const GP=Kg;let yx="U2FsdGVkX1/nIO3//tPu/+LNS4S4tsxT3MzmKKuvXDxFFYxlol+eYrZkKcLoUBHMNoDedcuF62hF/qfPSSy59Q==";{const r=GP.AES.decrypt("U2FsdGVkX1/nIO3//tPu/+LNS4S4tsxT3MzmKKuvXDxFFYxlol+eYrZkKcLoUBHMNoDedcuF62hF/qfPSSy59Q==","U2FsdGVkX1/fp5K6GAphzVxz");yx=JSON.parse(r.toString(GP.enc.Utf8))}const Rx=yx,Cx={}.AGORA_CHANNEL||"test",Ix={}.AGORA_TOKEN?{}.AGORA_TOKEN:null,WP=10;class Wz{constructor(){Tt(this,"_sideEffect",new gx);Tt(this,"uid",WP);Tt(this,"client",vu.createClient({mode:"rtc",codec:"vp8"}));Tt(this,"enabled",!1);Tt(this,"localAudioTrack",null);Tt(this,"localVideoTrack",null);Tt(this,"remoteAudioTrack",null);Tt(this,"remoteVideoTrack",null);Tt(this,"_pTogglingShareScreen");Dl(this)}get isRunning(){return this.enabled||this.remoteVideoTrack!=null}updateMainClient(o){this._sideEffect.add(()=>o&&o.uid?[Xo(o,"user-published",async(a,c)=>{if(a.uid!==this.uid||this.enabled)return;const l=await o.subscribe(a,c);this.setRemoteTrack(l,c)}),Xo(o,"user-unpublished",(a,c)=>{a.uid===this.uid&&this.setRemoteTrack(null,c)})]:null,"update-client")}setRemoteTrack(o,a){a==="audio"?this.remoteAudioTrack=o:this.remoteVideoTrack=o}async dispose(){this._sideEffect.flushAll(),this.remoteVideoTrack&&(this.remoteVideoTrack.stop(),this.remoteVideoTrack=null),this.remoteAudioTrack&&(this.remoteAudioTrack.stop(),this.remoteAudioTrack=null),await this.disable()}async enable(){if(this.remoteVideoTrack)throw new Error("remote screen video track already exists");if(this._pTogglingShareScreen&&await this._pTogglingShareScreen,!this.localVideoTrack){let o;this._pTogglingShareScreen=new Promise(a=>{o=a});try{await this.createLocalTracks()}catch{o(),this._pTogglingShareScreen=void 0;return}await this.client.join(Rx,Cx,Ix,WP),await this.client.publish(this._getLocalTracks()),o(),this._pTogglingShareScreen=void 0}this.enabled=!0}async disable(){if(this.enabled=!1,this._pTogglingShareScreen&&await this._pTogglingShareScreen,this.localVideoTrack){let o;this._pTogglingShareScreen=new Promise(a=>{o=a}),await this.client.unpublish(this._getLocalTracks()),this.localVideoTrack.close(),this.localVideoTrack=null,this.localAudioTrack&&(this.localAudioTrack.close(),this.localAudioTrack=null),await this.client.leave(),o(),this._pTogglingShareScreen=void 0}}async createLocalTracks(){const o=await vu.createScreenVideoTrack({},"auto");Array.isArray(o)?[this.localVideoTrack,this.localAudioTrack]=o:(this.localVideoTrack=o,this.localAudioTrack=null),this.localVideoTrack.once("track-ended",()=>this.disable())}_getLocalTracks(){return[this.localAudioTrack,this.localVideoTrack].filter(Boolean)}}var zg={},Hz={get exports(){return zg},set exports(r){zg=r}};(function(r){(function(o,a,c){function l(T){var C=this,O=R();C.next=function(){var N=2091639*C.s0+C.c*23283064365386963e-26;return C.s0=C.s1,C.s1=C.s2,C.s2=N-(C.c=N|0)},C.c=1,C.s0=O(" "),C.s1=O(" "),C.s2=O(" "),C.s0-=O(T),C.s0<0&&(C.s0+=1),C.s1-=O(T),C.s1<0&&(C.s1+=1),C.s2-=O(T),C.s2<0&&(C.s2+=1),O=null}function f(T,C){return C.c=T.c,C.s0=T.s0,C.s1=T.s1,C.s2=T.s2,C}function v(T,C){var O=new l(T),N=C&&C.state,w=O.next;return w.int32=function(){return O.next()*4294967296|0},w.double=function(){return w()+(w()*2097152|0)*11102230246251565e-32},w.quick=w,N&&(typeof N=="object"&&f(N,O),w.state=function(){return f(O,{})}),w}function R(){var T=4022871197,C=function(O){O=String(O);for(var N=0;N<O.length;N++){T+=O.charCodeAt(N);var w=.02519603282416938*T;T=w>>>0,w-=T,w*=T,T=w>>>0,w-=T,T+=w*4294967296}return(T>>>0)*23283064365386963e-26};return C}a&&a.exports?a.exports=v:c&&c.amd?c(function(){return v}):this.alea=v})(tt,r,!1)})(Hz);var Yg={},Kz={get exports(){return Yg},set exports(r){Yg=r}};(function(r){(function(o,a,c){function l(R){var T=this,C="";T.x=0,T.y=0,T.z=0,T.w=0,T.next=function(){var N=T.x^T.x<<11;return T.x=T.y,T.y=T.z,T.z=T.w,T.w^=T.w>>>19^N^N>>>8},R===(R|0)?T.x=R:C+=R;for(var O=0;O<C.length+64;O++)T.x^=C.charCodeAt(O)|0,T.next()}function f(R,T){return T.x=R.x,T.y=R.y,T.z=R.z,T.w=R.w,T}function v(R,T){var C=new l(R),O=T&&T.state,N=function(){return(C.next()>>>0)/4294967296};return N.double=function(){do var w=C.next()>>>11,B=(C.next()>>>0)/4294967296,U=(w+B)/(1<<21);while(U===0);return U},N.int32=C.next,N.quick=N,O&&(typeof O=="object"&&f(O,C),N.state=function(){return f(C,{})}),N}a&&a.exports?a.exports=v:c&&c.amd?c(function(){return v}):this.xor128=v})(tt,r,!1)})(Kz);var qg={},zz={get exports(){return qg},set exports(r){qg=r}};(function(r){(function(o,a,c){function l(R){var T=this,C="";T.next=function(){var N=T.x^T.x>>>2;return T.x=T.y,T.y=T.z,T.z=T.w,T.w=T.v,(T.d=T.d+362437|0)+(T.v=T.v^T.v<<4^(N^N<<1))|0},T.x=0,T.y=0,T.z=0,T.w=0,T.v=0,R===(R|0)?T.x=R:C+=R;for(var O=0;O<C.length+64;O++)T.x^=C.charCodeAt(O)|0,O==C.length&&(T.d=T.x<<10^T.x>>>4),T.next()}function f(R,T){return T.x=R.x,T.y=R.y,T.z=R.z,T.w=R.w,T.v=R.v,T.d=R.d,T}function v(R,T){var C=new l(R),O=T&&T.state,N=function(){return(C.next()>>>0)/4294967296};return N.double=function(){do var w=C.next()>>>11,B=(C.next()>>>0)/4294967296,U=(w+B)/(1<<21);while(U===0);return U},N.int32=C.next,N.quick=N,O&&(typeof O=="object"&&f(O,C),N.state=function(){return f(C,{})}),N}a&&a.exports?a.exports=v:c&&c.amd?c(function(){return v}):this.xorwow=v})(tt,r,!1)})(zz);var Jg={},Yz={get exports(){return Jg},set exports(r){Jg=r}};(function(r){(function(o,a,c){function l(R){var T=this;T.next=function(){var O=T.x,N=T.i,w,B;return w=O[N],w^=w>>>7,B=w^w<<24,w=O[N+1&7],B^=w^w>>>10,w=O[N+3&7],B^=w^w>>>3,w=O[N+4&7],B^=w^w<<7,w=O[N+7&7],w=w^w<<13,B^=w^w<<9,O[N]=B,T.i=N+1&7,B};function C(O,N){var w,B=[];if(N===(N|0))B[0]=N;else for(N=""+N,w=0;w<N.length;++w)B[w&7]=B[w&7]<<15^N.charCodeAt(w)+B[w+1&7]<<13;for(;B.length<8;)B.push(0);for(w=0;w<8&&B[w]===0;++w);for(w==8?B[7]=-1:B[w],O.x=B,O.i=0,w=256;w>0;--w)O.next()}C(T,R)}function f(R,T){return T.x=R.x.slice(),T.i=R.i,T}function v(R,T){R==null&&(R=+new Date);var C=new l(R),O=T&&T.state,N=function(){return(C.next()>>>0)/4294967296};return N.double=function(){do var w=C.next()>>>11,B=(C.next()>>>0)/4294967296,U=(w+B)/(1<<21);while(U===0);return U},N.int32=C.next,N.quick=N,O&&(O.x&&f(O,C),N.state=function(){return f(C,{})}),N}a&&a.exports?a.exports=v:c&&c.amd?c(function(){return v}):this.xorshift7=v})(tt,r,!1)})(Yz);var Xg={},qz={get exports(){return Xg},set exports(r){Xg=r}};(function(r){(function(o,a,c){function l(R){var T=this;T.next=function(){var O=T.w,N=T.X,w=T.i,B,U;return T.w=O=O+1640531527|0,U=N[w+34&127],B=N[w=w+1&127],U^=U<<13,B^=B<<17,U^=U>>>15,B^=B>>>12,U=N[w]=U^B,T.i=w,U+(O^O>>>16)|0};function C(O,N){var w,B,U,W,q,G=[],b=128;for(N===(N|0)?(B=N,N=null):(N=N+"\0",B=0,b=Math.max(b,N.length)),U=0,W=-32;W<b;++W)N&&(B^=N.charCodeAt((W+32)%N.length)),W===0&&(q=B),B^=B<<10,B^=B>>>15,B^=B<<4,B^=B>>>13,W>=0&&(q=q+1640531527|0,w=G[W&127]^=B+q,U=w==0?U+1:0);for(U>=128&&(G[(N&&N.length||0)&127]=-1),U=127,W=4*128;W>0;--W)B=G[U+34&127],w=G[U=U+1&127],B^=B<<13,w^=w<<17,B^=B>>>15,w^=w>>>12,G[U]=B^w;O.w=q,O.X=G,O.i=U}C(T,R)}function f(R,T){return T.i=R.i,T.w=R.w,T.X=R.X.slice(),T}function v(R,T){R==null&&(R=+new Date);var C=new l(R),O=T&&T.state,N=function(){return(C.next()>>>0)/4294967296};return N.double=function(){do var w=C.next()>>>11,B=(C.next()>>>0)/4294967296,U=(w+B)/(1<<21);while(U===0);return U},N.int32=C.next,N.quick=N,O&&(O.X&&f(O,C),N.state=function(){return f(C,{})}),N}a&&a.exports?a.exports=v:c&&c.amd?c(function(){return v}):this.xor4096=v})(tt,r,!1)})(qz);var Qg={},Jz={get exports(){return Qg},set exports(r){Qg=r}};(function(r){(function(o,a,c){function l(R){var T=this,C="";T.next=function(){var N=T.b,w=T.c,B=T.d,U=T.a;return N=N<<25^N>>>7^w,w=w-B|0,B=B<<24^B>>>8^U,U=U-N|0,T.b=N=N<<20^N>>>12^w,T.c=w=w-B|0,T.d=B<<16^w>>>16^U,T.a=U-N|0},T.a=0,T.b=0,T.c=-1640531527,T.d=1367130551,R===Math.floor(R)?(T.a=R/4294967296|0,T.b=R|0):C+=R;for(var O=0;O<C.length+20;O++)T.b^=C.charCodeAt(O)|0,T.next()}function f(R,T){return T.a=R.a,T.b=R.b,T.c=R.c,T.d=R.d,T}function v(R,T){var C=new l(R),O=T&&T.state,N=function(){return(C.next()>>>0)/4294967296};return N.double=function(){do var w=C.next()>>>11,B=(C.next()>>>0)/4294967296,U=(w+B)/(1<<21);while(U===0);return U},N.int32=C.next,N.quick=N,O&&(typeof O=="object"&&f(O,C),N.state=function(){return f(C,{})}),N}a&&a.exports?a.exports=v:c&&c.amd?c(function(){return v}):this.tychei=v})(tt,r,!1)})(Jz);var $g={},Xz={get exports(){return $g},set exports(r){$g=r}};(function(r){(function(o,a,c){var l=256,f=6,v=52,R="random",T=c.pow(l,f),C=c.pow(2,v),O=C*2,N=l-1,w;function B(j,K,Y){var Q=[];K=K==!0?{entropy:!0}:K||{};var $=G(q(K.entropy?[j,M(a)]:j??b(),3),Q),ue=new U(Q),J=function(){for(var te=ue.g(f),le=T,he=0;te<C;)te=(te+he)*l,le*=l,he=ue.g(1);for(;te>=O;)te/=2,le/=2,he>>>=1;return(te+he)/le};return J.int32=function(){return ue.g(4)|0},J.quick=function(){return ue.g(4)/4294967296},J.double=J,G(M(ue.S),a),(K.pass||Y||function(te,le,he,Pe){return Pe&&(Pe.S&&W(Pe,ue),te.state=function(){return W(ue,{})}),he?(c[R]=te,le):te})(J,$,"global"in K?K.global:this==c,K.state)}function U(j){var K,Y=j.length,Q=this,$=0,ue=Q.i=Q.j=0,J=Q.S=[];for(Y||(j=[Y++]);$<l;)J[$]=$++;for($=0;$<l;$++)J[$]=J[ue=N&ue+j[$%Y]+(K=J[$])],J[ue]=K;(Q.g=function(te){for(var le,he=0,Pe=Q.i,We=Q.j,He=Q.S;te--;)le=He[Pe=N&Pe+1],he=he*l+He[N&(He[Pe]=He[We=N&We+le])+(He[We]=le)];return Q.i=Pe,Q.j=We,he})(l)}function W(j,K){return K.i=j.i,K.j=j.j,K.S=j.S.slice(),K}function q(j,K){var Y=[],Q=typeof j,$;if(K&&Q=="object")for($ in j)try{Y.push(q(j[$],K-1))}catch{}return Y.length?Y:Q=="string"?j:j+"\0"}function G(j,K){for(var Y=j+"",Q,$=0;$<Y.length;)K[N&$]=N&(Q^=K[N&$]*19)+Y.charCodeAt($++);return M(K)}function b(){try{var j;return w&&(j=w.randomBytes)||(j=new Uint8Array(l),(o.crypto||o.msCrypto).getRandomValues(j)),M(j)}catch{var K=o.navigator,Y=K&&K.plugins;return[+new Date,o,Y,o.screen,M(a)]}}function M(j){return String.fromCharCode.apply(0,j)}G(c.random(),a),r.exports?r.exports=B:c["seed"+R]=B})(typeof self<"u"?self:tt,[],Math)})(Xz);var Qz=zg,$z=Yg,Zz=qg,e7=Jg,t7=Xg,n7=Qg,Ja=$g;Ja.alea=Qz;Ja.xor128=$z;Ja.xorwow=Zz;Ja.xorshift7=e7;Ja.xor4096=t7;Ja.tychei=n7;var r7=Ja;const Ax=r7;let wx=Ax();function i7(){return wx()}function HP(r){wx=Ax(r)}function Ox(r,o){const a=Array.isArray(r)?()=>o7(r):r;return(o==null?void 0:o.length)===void 0?a(0):Array.from({length:o.length},(c,l)=>a(l))}function o7(r){return r[Math.floor(i7()*r.length)]}function s7(r,o){return Ox(r,o)}var KP={withAccents:{male:["Adrián","Ægir","Álvaro","André","Andrés","Árni","Asbjørn","Björn","César","Daníel","Davíð","Emílio","Fañch","François","František","Gísli","Götz","Guðjón","Guðmundur","Günter","Halldór","Hans-Jörg","Hans-Jürgen","Hüseyin","Iñaki","János","Jesús","Jiří","Jóhann","Jóhannes","Jokūbas","Jón","José","Jörn","Julião","Jürgen","Kristján","Maël","Magnús","Mathéo","Mátyás","Michał","Noël","Nuñez","Ólafur","Óscar","Øyvind","Páll","Paweł","Pétur","Ramón","Raúl","René","Ruairí","Rubén","Seán","Sérgio","Sigurður","Sönke","Stefán","Tomáš","Þorsteinn"],female:["Ædel","Agnès","Alícia","Änne","Antónia","Ásta","Auður","Cäcilia","Chloë","Claúdia","Dörte","Elín","Elísabet","Eliška","Františka","Glória","Grażyna","Guðbjörg","Guðný","Guðrún","Henriëtte","Ingibjörg","Íris","Jóhanna","Jóna","Júlia","Käte","Katrín","Kolbrún","Kristín","KŠthe","Letícia","Lídia","Lúcia","Małgorzata","Margrét","María","Mónica","Natália","Ólöf","Patrícia","Ragnheiður","Renée","Ružena","Siân","Sigríður","Sigrún","Sílvia","Sørina","Věra","Virgínia","Zoë","Þóra","Þórunn"]},withoutAccents:{male:["Abdul","Abdullahi","Abubakar","Adam","Adamu","Adiy","Ahmad","Ajay","Akira","Alan","Alberto","Alejandro","Aleksander","Aleksandr","Aleksey","Alex","Alexander","Alexey","Ali","Aliyu","Aminu","Amit","Amiyr","Amiyt","Amnuai","Amphon","Anah","Anan","Andreas","Andrew","Andrey","Andri","Andries","Andrzej","Anil","Anthony","Anton","Antonio","Arnar","Artur","Artyom","Arun","Ashok","Atli","Avraham","Bartosz","Bello","Bernd","Bin","Birgir","Bjarni","Blessing","Bongani","Brian","Bunmi","Carlos","Carol","Chan","Chao","Charles","Charoen","Chen","Cheng","Christian","Christopher","Colin","Daniel","Daniyel","Dariusz","David","Denis","Dennis","Diego","Dieter","Dilip","Dinesh","Dmitriy","Dmitry","Einar","Eliyahu","Emmanuel","Evgeniy","Fernando","Fran","Francis","Francisco","Francisco-Javier","Frank","Franz","Gang","Gareth","Gary","George","Gerhard","Graham","Grzegorz","Gunnar","Guy","Haim","Haiyan","Hans","Hans-Ulrich","Haruna","Hassan","Heike","Heinz","Helgi","Helmut","Hendrik","Herbert","Hideo","Hiromi","Hiroshi","Hong","Horst","Hui","Ian","Ibrahim","Idris","Igor","Ilya","Isa","Isaac","Isah","Ivan","Jabulani","Jacek","Jacobus","Jakub","James","Jan","Janusz","Javier","Jean","Jerzy","Jesus","Jason","Jianguo","Jianhua","Jianjun","Jianping","Jin","Joan","Johan","Johannes","John","Jonathan","Jorge","Jose","Jose-Antonio","Jose-Luis","Jose-Manuel","Jose-Maria","Josef","Joseph","Joyce","Juan","Kabiru","Kai","Kamil","Karen","Karl","Karl-Heinz","Katsumi","Kazuo","Kelvin","Kenji","Kenneth","Kevin","Kiran","Kirill","Kiyoshi","Kjartan","Klaus","Ko","Koichi","Koji","Konstantin","Koshi","Krishna","Kristinn","Krzysztof","Kun","Lakshmi","Lan","Laxmi","Lei","Li","Lihua","Lijun","Lilian","Lin","Ling","Liping","Liyor","Luis","Lukasz","Maciej","Mahmood","Maksim","Manfred","Manoj","Manuel","Marcin","Mardkhay","Marek","Mariusz","Mark","Martin","Masami","Masao","Mateusz","Matt","Matthew","Meiyr","Michael","Michal","Miguel","Miguel-Angel","Mikhail","Min","Ming","Mitsuo","Miykhael","Miykhal","Mo","Mohamed","Mohammad","Mohammed","Mohan","Moses","Moshe","Mpho","Muhammad","Muhammed","Mukesh","Musa","Narong","Nathan","Nicola","Nikita","Nikolay","Ning","Nkosinathi","Noam","Oleg","Omer","Otieno","Pablo","Patrick","Paul","Pavel","Pawel","Pedro","Peng","Peter","Petrus","Philip","Pieter","Ping","Piotr","Prasit","Prasoet","Pricha","Pushpa","Qiang","Qing","Radha","Rafael","Ragnar","Raj","Rajendra","Rajesh","Raju","Rakesh","Ram","Ramesh","Raphael","Rattana","Ravi","Richard","Robert","Roman","Rong","Roy","Ryan","Salisu","Saman","Samran","Samuel","Sani","Sanjay","Santosh","Sam","Sammy","Sawat","Sebastian","Sergey","Sergio","Shankar","Shay","Shigeru","Shimon","Shlomo","Shoji","Sibusiso","Simon","Sipho","Sombat","Sombun","Somchai","Somchit","Somkhit","Somkiat","Sommai","Somnuek","Somphon","Somphong","Somsak","Sri","Stefan","Stephen","Steve","Steven","Suman","Sunday","Sunil","Sunthon","Suresh","Sushila","Suwit","Sveinn","Tadashi","Takashi","Takeshi","Tal","Tebogo","Thabo","Thawi","Themba","Thomas","Thulani","Tomasz","Toshio","Udom","Umar","Uriy","Usman","Uwe","Victor","Vijay","Viktor","Vincent","Vinod","Vladimir","Walter","Wanchai","Waraphon","Wei","Werner","Wichai","Wichian","Willem","William","Winai","Wirat","Wirot","Wojciech","Wolfgang","Xiang","Xiaohong","Xiaoli","Xiaoping","Xiaoyan","Xin","Xolani","Yaakv","Yahaya","Yakubu","Yan","Yasuo","Yhudah","Ying","Yisrael","Yong","Yosef","Yoshie","Yoshimi","Yoshio","Yu","Yue","Yukio","Yun","Yuriy","Yusuf","Yuval","Zbigniew","Zhen","Zhiqiang"],female:["Agata","Agnieszka","Aisha","Akira","Aleksandra","Alina","Alyona","Amina","Amnuai","Ana","Ana-Maria","Anah","Anan","Anastasiya","Andrea","Angela","Anita","Ann","Anna","Anong","Antonia","Asha","Barbara","Beata","Berglind","Bin","Birgit","Birna","Blessing","Brigitte","Bunmi","Busisiwe","Carmen","Carol","Caroline","Catherine","Chan","Chanah","Chao","Charoen","Chayah","Chen","Cheng","Christa","Christine","Claire","Claudia","Cristina","Darya","Dolores","Dorota","Edda","Ekaterina","Elena","Elisabeth","Elizabeth","Elke","Emiko","Emma","Erika","Erla","Erna","Ester","Esther","Eunice","Eva","Eugenia","Ewa","Faith","Fatima","Fiona","Fran","Francisca","Fumiko","Galina","Gabra","Gisela","Gita","Grace","Hadiza","Haiyan","Hanna","Haruna","Hauwa","Heike","Helen","Helga","Hildur","Hiroko","Hiromi","Hisako","Hong","Hui","Hulda","Inga","Ingrid","Irina","Isa","Isabel","Isah","Iwona","Jackline","Jan","Jane","Janet","Jean","Jennifer","Jianhua","Jianping","Jin","Joan","Joanna","Johanna","Josefa","Joy","Joyce","Juan","Julie","Justyna","Kai","Kanchana","Karen","Karin","Karolina","Kasia","Katarzyna","Katsumi","Keiko","Kiran","Kiyoko","Kristina","Kseniya","Kun","Lakshmi","Lalita","Lan","Latda","Laura","Laxmi","Leah","Lei","Li","Lihua","Lijun","Lilian","Lilja","Lin","Linda","Lindiwe","Ling","Liping","Lisa","Lucia","Lucy","Lyubov","Lyudmila","Magda","Magdalena","Mali","Manju","Margaret","Maria","Maria-Isabel","Maria-Jose","Maria-Pilar","Marina","Mariya","Marta","Martha","Mary","Maryam","Masako","Masami","Mei","Mercy","Michal","Michiko","Mieko","Min","Mina","Ming","Miriam","Miyoko","Mo","Monika","Mpho","Na","Nadezhda","Nan","Nancy","Natalya","Ngozi","Nicola","Ning","Nittaya","Noam","Nobuko","Nokuthula","Nonhlanhla","Noriko","Nushi","Olga","Omer","Patricia","Paula","Paulina","Peng","Petra","Phonthip","Pilar","Ping","Prani","Purity","Pushpa","Qing","Rachel","Radha","Rattana","Rebecca","Reiko","Rekha","Renate","Rita","Rong","Rosa","Rose","Rut","Ruth","Ryoko","Sabine","Sachiko","Samran","Santosh","Sara","Sarah","Sam","Sammy","Sawat","Shanti","Sharon","Shay","Shizuko","Shoshanah","Sibongile","Sita","Sombat","Sombun","Somchit","Somkhit","Sommai","Somnuek","Somphon","Somphong","Sri","Steinunn","Sukanya","Suman","Sunday","Sunita","Suphaphon","Susan","Susanne","Sushila","Svetlana","Takako","Tamar","Tatyana","Tal","Tebogo","Teruko","Thawi","Tomiko","Toshiko","Unnur","Urai","Urmila","Ursula","Usha","Valentina","Victoria","Wanjiru","Wanphen","Watsana","Wei","Wilai","Xiang","Xiaohong","Xiaoli","Xiaoping","Xiaoyan","Xin","Yael","Yan","Yasuko","Yelena","Yhudiyt","Ying","Yoko","Yong","Yoshie","Yoshiko","Yoshimi","Yu","Yue","Yuko","Yuliya","Yun","Yuval","Zainab","Zandile","Zanele","Zhen"]}};function a7(r){var o,a;const c=(o=r==null?void 0:r.withAccents)!=null&&o,l=(a=r==null?void 0:r.gender)!=null?a:s7(["male","female"]),f=r==null?void 0:r.locale;return Ox(c?f?f==null?void 0:f.withAccents[l]:KP.withAccents[l]:f?f==null?void 0:f.withoutAccents[l]:KP.withoutAccents[l],r)}var c7={china:["Peking roasted duck","Kung pao chicken","Sweet and sour pork","Hot pot","Dim sum","Dumplings","Ma po tofu","Char siu","Chicken chow mein","Beef chow mein","vegetable chow mein","Chicken fried rice","Beef fried rice","Vegetable fried Rice","Special fried Rice","Sichuan pork","Xiaolongbao","Zhajiangmian","Wonton soup","Sweet and sour pork","Duck spring Rolls","Vegetable spring Rolls","Wonton","Peking duck","Lamb hot pot","Spicy crayfish","Guilin rice noodles","Lanzhou hand-pulled noodles","Steamed crab","Shredded pork with garlic sauce","Red braised pork","Sweet and sour Ribs","Xinjiang","Braised pork with vermicelli"],italy:["Butternut squash risotto","Mushroom risotto","Beetroot risotto","Courgette risotto","Pizza","Gnocchi","Spaghetti bolognese","Spaghetti carbonara","Pesto alla Genovese","Beef lasagne","Vegetable lasagne","Gelato","Prosciutto di Parma","Ribollita","Bagna cauda","Polenta","Tortelli and ravioli","Focaccia","Garlic bread","Arancini","Il tartufo","Panzerotto fritto","Fiorentina","Minestrone","Frico","Arrosticini","Olive ascolante","Fritto misto piemontes","Tiramisù"],india:["Biryani","Dosa","Tandoori chicken","Samosas","Chaat","Plain naan","Garlic naan","Pilau rice","Steamed rice","Chicken madras","Vegetable madras","Chicken vindaloo","Chicken jalfrezi","Chicken roghan josh","Lamb roghan josh","Beef roghan josh","Butter chicken","Dosa","Gulab jamun","Chicken korma","Mutter paneer","Papadum","Paratha","Raita","Saag paneer","Tandoori chicken","Chicken tikka masala","Pakora","Dal","Chapati","Pasanda","Aloo gobi","Kofta","Chicken makhani","Paneer naan","Chana Aloo Curry"],mexico:["Chilaquiles","Pozole","Tacos al pastor","Tostadas","Chiles en nogada","Elote","Enchiladas","Mole","Guacamole","Tamales","Huevos rancheros","Machaca","Discada","Beef Burrito","Chicken Burrito","Pozole de pollo o duajolote","Menudo","Cochinita pibil","Tamale","Quesadilla","Frijoles puercos","Chile en nogada","Esquites","Alegria de amaranto","Pipián","Aguachile","Ceviche","Pescado zarandeado","Camarones a la diabla","Birria de chivo","Tlayuda","Guacamole con chapulines","Flautas","Torta Ahogada","Carnitas","Caldo Azteca","Gorditas de Nata"],japan:["Sushi","Udon","Tofu","Tempura","Yakitori","Sashimi","Ramen","Donburi","Natto","Oden","Tamagoyaki","Soba","Tonkatsu","Kashipan","Sukiyaki","Miso soup","Okonomiyaki","Mentaiko","Nikujaga","Unagi no kabayaki","Shabu Shabu","Onigiri","Gyoza","Takoyaki","aiseki ryori","Edamame","Yakisoba","Chawanmushi","Wagashi"],france:["Foie gras","Huîtres","Cassoulet","Poulet basquaise","Escargots au beurre persillé","Mouclade charentaise","Galettes bretonnes","Flemish carbonnade","Quiche lorraine","Raclette","Cheese fondue","Beef fondue","Gratin dauphinois","Tartiflette","Bouillabaisse","Ratatouille","Boeuf bourguignon","Blanquette de veau","Pot-au-feu","Coq-au-vin","Hachis parmentier","Steak tartare","Choucroute","Soufflé au fromage","Cuisses de grenouilles","Soupe à l’oignon","Baguette","Croissant","French cheeses","Fondant au chocolat","Tarte tatin","Macarons","Crème brûlée","Île flottante","Profiteroles","Pain au chocolat"],lebanon:["Kibbeh","Kafta","Kanafeh","Hummus","Rice pilaf","Fattoush","Manakish","Tabbouleh","Sfeeha","Fattoush","Labneh","Muhammara","Lahm bi ajin","Kaak","Chanklich","Mssabaha","Shawarma","Kebbe","Falafel","Halewit el jeben","Namoura","Maamoul","Foul mdammas","Balila","Kawarma","Fattouch"],thailand:["Pad kra pao moo","Tom kha gai","Khao Pad","Chicken pad Thai","Vegetable pad Thai","Moo satay","Tom yum goong","Khao niew mamuang","Kai yad sai","Khao soi","Pad see ew","Laab moo","Gaeng panang","Gai pad med ma muang","Som tam","Poh pia tod","Gaeng massaman","Pla kapung nueng manao","Tod mun pla","Gaeng ped","Gaeng garee","Gaeng keow wan","Moo ping","Durian","Sai ooah","Hoy tod","Kuay teow reua","Mu kratha","Kao ka moo","Yam nua"],greece:["Moussaka","Papoutsakia","Pastitsio","Souvlaki","Soutzoukakia","Stifado","Tomatokeftedes","Tzatziki","Kolokithokeftedes","Giouvetsi","Choriatiki","Kleftiko","Gemista","Fasolada","Bougatsa","Tiropita","Spanakopita","Feta Cheese with Honey","Horta","Tirokroketes","Briam","Saganaki","Gigantes","Dolmades","Fasolatha","Koulouri","Loukoumades","Gyros","Galaktoboureko","Baklava"],turkey:["Şiş kebap","Döner","Köfte","Pide","Kumpir","Meze","Mantı","Lahmacun","Menemen","Şiş kebap","İskender kebab","Corba","Kuzu tandir","Çiğ Köfte","Pilav","Yaprak sarma","Dolma","İmam bayıldı","Borek","Durum","Kumpir","Balik ekmek","Simit","Kunefe","Baklava","Lokum","Halva","Mozzaik pasta","Güllaç","Mercimek Köftesi","Haydari","Tursu suyu","Kahvalti","Kazan dibi","Hunkar begendi","Islak burgers","Salep","Yogurtlu kebab"],spain:["Tortilla de patatas","Fabada asturiana","Calçots","Boquerones al vinagre","Empanada gallega","Paella","Gazpacho","Gachas","Migas","Bocadillo de calamares","Pulpo a feira","Caldo gallego","Lentejas con chorizo","Cocido madrileño","Cachopo","Caracoles"],venezuela:["Pabellón criollo","Arepa","Mondongo","Empanadas","Quesillo","Chicha andina","Tequeños","Cachapa","Hallaca","Perico","Pasticho","Mandocas","Caraotas negras","Patacones","Dulce de leche","Pan de Jamón"],chile:["Humitas","Empanadas","Porotos con riendas","Completos","Manjar","Cordero al palo","Pastel de choclo","Mote con huesillos","Sopaipillas","Curanto"],argentina:["Milanesas","Empanadas","Pizza fugazeta","Asado","Choripan","Bondiola","Bife de chorizo"],colombia:["Bandeja paisa","Chuleta valluna","Sancocho trifásico","Empanada valluna","Salpicon de frutas","Pastel de garbanzo","Ajiaco","Arepas","Arroz de lisa","Sancocho","Pan de bono","Cuchuco","Oblea","Cazuela de mariscos","Pan de yuca","Bollo Limpio","Almojábana","Empanadas","Arroz con Coco","Sopa de mondongo","Cazuela de Mariscos","Arroz con Pollo","Arepa de Huevo","Mote de Queso"],ecuador:["Encebollado","Ceviche","Tigrillo","Bolon de verde","Llapingacho","Mote pillo","Locro de papa","Churrasco"],peru:["Ceviche","Arroz con pollo","Aji de gallina","Llunca de gallina"],"el salvador":["Pupusa","Sopa de patas","Rigua","Flor de izote con huevo","Gallo en chicha"],romania:["Sarmale","Mici","Pomana porcului","Ciorbă de fasole cu ciolan","Ciorbă de burtă","Ciorbă rădăuțeană","Plăcintă cu brânză","Ciorbă de potroace","Mămăligă cu brânză și smântână","Tochitură","Piftie","Iahnie de fasole","Slănină afumată","Cârnați afumați","Varză a la Cluj","Gulaș de cartofi cu afumătură","Cozonac de casă","Ciorbă ardelenească de porc","Mucenici moldovenești","Salată de boeuf","Dovleac copt","Papanași cu brânză de vacă și afine","Drob de miel","Pârjoale moldovenești","Zacuscă de vinete","Zacuscă de fasole","Turtă dulce","Clătitele cu gem","Clătitele cu brânza de vacă","Balmoș","Cozonac","Chiftele"]},zP;(zP=Object.keys(c7))==null||zP.length;var YP,u7={olympic:["Archery","Artistic Gymnastics","Artistic Swimming","Athletics","Badminton","Baseball Softball","Basketball","Beach Volleyball","BMX Freestyle","BMX Racing","Boxing","Kayak Flatwater","Kayak Slalom","Diving","Equestrian","Fencing","Football","Golf","Handball","Hockey","Judo","Karate","Marathon Swimming","Modern Pentathlon","Mountain Bike","Rhythmic Gymnastics","Road Cycling","Rowing","Rugby","Sailing","Shooting","Skateboarding","Sport Climbing","Surfing","Swimming","Table Tennis","Taekwondo","Tennis","Track Cycling","Trampoline","Triathlon","Volleyball","Water Polo","Weightlifting","Wrestling"],winterOlympic:["Alpine Skiing","Biathlon","Bobsleigh","Cross-Country Skiing","Curling","Figure Skating","Freestyle Skiing","Ice Hockey","Luge","Nordic Combined","Short Track Speed Skating","Skeleton","Ski Jumping","Snowboard","Speed Skating"],outdoor:["Archery","Athletics","Badminton","Baseball","Basketball","Bowling","Boxing","Camping","Canoeing","Climbing","Cricket","Curling","Cycling","Equestrian","Fencing","Football","Golf","Gymnastics","Handball","Hang Gliding","High Jumping","Hockey","Ice Hockey","Judo","Karate","Kite Flying","Monkey Bars","Motorsports","Netball","Rowing","Rugby","Running","Sailing","Skateboarding","Slide","Snow Skiing","Soccer","Street Hockey","Surfing","Swimming","Table Tennis","Tennis","Trekking","Triathlon","Volleyball","Weightlifting","Wrestling"]};(YP=Object.keys(u7))==null||YP.length;const bx=r=>{HP(String(r));const o=a7();return HP(),o},Nx=()=>"https://www.agora.io/en/wp-content/uploads/2022/10/3d-spatial-audio-icon.svg";class d7{constructor({client:o,uid:a}){Tt(this,"client");Tt(this,"uid");Tt(this,"name");Tt(this,"avatar");Tt(this,"micOn");Tt(this,"cameraOn");Tt(this,"micTrack");Tt(this,"cameraTrack");Tt(this,"setMic",o=>{this.micOn=o,o&&!this.micTrack&&this.createLocalMicTrack().then(()=>this.setMic(this.micOn)),this.micTrack&&this.micTrack.setEnabled(o)});Tt(this,"setCamera",o=>{this.cameraOn=o,o&&!this.cameraTrack&&this.createLocalCameraTrack().then(()=>this.setCamera(this.cameraOn)),this.cameraTrack&&this.cameraTrack.setEnabled(o)});this.client=o,this.uid=a,this.name=bx(this.uid),this.avatar=Nx(),this.micOn=!1,this.cameraOn=!1,this.micTrack=void 0,this.cameraTrack=void 0,Dl(this)}async createLocalMicTrack(){if(this.client&&!this.micTrack){const o=await vu.createMicrophoneAudioTrack({AEC:!0,ANS:!0});await this.client.publish(o),this.updateLocalMicTrack(o)}return this.micTrack?this.micTrack:Promise.reject()}updateLocalMicTrack(o){this.micTrack=o}async createLocalCameraTrack(){if(this.client&&!this.cameraTrack){const o=await vu.createCameraVideoTrack();await this.client.publish(o),this.updateLocalCameraTrack(o)}return this.cameraTrack?this.cameraTrack:Promise.reject()}updateLocalCameraTrack(o){this.cameraTrack=o}dispose(){this.micTrack&&(this.micTrack.stop(),this.micTrack.close(),this.micTrack=void 0),this.cameraTrack&&(this.cameraTrack.stop(),this.cameraTrack.close(),this.cameraTrack=void 0)}}class l7{constructor(o){Tt(this,"uid");Tt(this,"name");Tt(this,"avatar");Tt(this,"rtcUser");Tt(this,"cameraOn");Tt(this,"micOn");Tt(this,"videoTrack");Tt(this,"audioTrack");this.uid=o.uid,this.name=bx(o.uid),this.avatar=Nx(),this.rtcUser=o,this.micOn=o.hasAudio,this.cameraOn=o.hasVideo,this.audioTrack=o.audioTrack,this.videoTrack=o.videoTrack,Dl(this)}update(o){this.rtcUser=o,this.micOn=o.hasAudio,this.cameraOn=o.hasVideo,this.audioTrack=o.audioTrack,this.videoTrack=o.videoTrack}}let h7=class{constructor(){Tt(this,"_remoteUsersMap",ir.map());Tt(this,"_sideEffect",new gx);Tt(this,"localUIDs",[]);Tt(this,"localUser",null);Dl(this)}get remoteUsers(){return[...this._remoteUsersMap.values()]}updateClient(o){this._sideEffect.add(()=>{if(o&&o.uid){const a=new d7({client:o,uid:o.uid});return this.localUser=a,[()=>{a.dispose(),this.localUser=null},Xo(o,"user-joined",c=>{this.localUIDs.includes(c.uid)||this._updateRemoteUser(c,!0)}),Xo(o,"user-left",c=>{this.localUIDs.includes(c.uid)||this._deleteRemoteUser(c.uid)}),Xo(o,"user-published",c=>{c.uid!==o.uid&&(this.localUIDs.includes(c.uid)||this._updateRemoteUser(c))}),Xo(o,"user-unpublished",c=>{c.uid!==o.uid&&(this.localUIDs.includes(c.uid)||this._updateRemoteUser(c))})]}else return null},"update-client")}dispose(){this._sideEffect.flushAll(),this.remoteUsers.forEach(({rtcUser:o})=>{var a,c;(a=o.audioTrack)==null||a.stop(),(c=o.videoTrack)==null||c.stop()}),this._remoteUsersMap.clear()}_updateRemoteUser(o,a){const c=this._remoteUsersMap.get(o.uid);c?c.update(o):a&&this._remoteUsersMap.set(o.uid,new l7(o))}_deleteRemoteUser(o){this._remoteUsersMap.delete(o)}};vu.setLogLevel(2);class p7{constructor(){Tt(this,"client",null);Tt(this,"users",new h7);Tt(this,"shareScreen",new Wz);this.users.localUIDs.push(this.shareScreen.uid),Dl(this)}get uid(){var o;return(o=this.client)==null?void 0:o.uid}async join(o,a,c){const l=vu.createClient({mode:"rtc",codec:"vp8"});await l.join(o,a,c,null),this._updateClient(l)}async leave(){this.users.dispose(),await this.shareScreen.dispose();const o=this.client;o&&(await o.leave(),this._updateClient(null))}_updateClient(o){this.client=o,this.users.updateClient(o),this.shareScreen.updateMainClient(o)}}const No=new p7;function f7({onJoin:r}){const[o,a]=Ye.useState(Date.now());Ye.useEffect(()=>{const v=setInterval(()=>a(Date.now()),1e3);return()=>clearInterval(v)},[]);const c=new Date(o),l=c&&c.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}),f=c&&c.toLocaleDateString("en-US",{year:"numeric",month:"numeric",day:"numeric",weekday:"long"});return Nt("div",{className:"room-info",children:[Nt("div",{className:"datetime",children:[Re("div",{className:"time",children:l}),Re("div",{className:"date",children:f})]}),Nt("div",{className:"actions",children:[Nt("article",{className:"info",children:[Re("h3",{className:"info-title",children:"Example Meeting"}),Re("p",{className:"info-time",children:"11:00~16:00"})]}),Re("button",{className:"action-start",onClick:r,children:"Start"})]})]})}function _7({onClick:r,isLoading:o}){return Nt("button",{className:"btn",disabled:o,onClick:r,children:[Re("div",{className:"btn-icon",children:o?Re("i",{className:"i-mdi-loading"}):Re("i",{className:"i-mdi-plus-box"})}),Re("div",{className:"btn-text",children:"Join"})]})}function m7(){return Nt("button",{className:"btn",disabled:!0,children:[Re("div",{className:"btn-icon new",children:Re("i",{className:"i-mdi-video"})}),Re("div",{className:"btn-text",children:"New"})]})}function E7(){return Nt("button",{className:"btn",disabled:!0,children:[Re("div",{className:"btn-icon",children:Re("i",{className:"i-mdi-calendar"})}),Re("div",{className:"btn-text",children:"Schedule"})]})}function v7(){return Nt("button",{className:"btn",disabled:!0,children:[Re("div",{className:"btn-icon",children:Re("i",{className:"i-mdi-arrow-up-bold-box"})}),Re("div",{className:"btn-text",children:"Share Screen"})]})}const g7=Ya(function(){const o=sL(),[a,c]=Ye.useState(!1),l=()=>{c(!0),o(No.join(Rx,Cx,Ix)).then(()=>c(!1))};return Nt("div",{className:"home",hidden:!!No.client,children:[Nt("div",{className:"bg",children:[Re("div",{className:"bg-row",children:"Agora"}),Re("div",{className:"bg-row",children:"RTC"}),Re("div",{className:"bg-row",children:"React"})]}),Nt("div",{className:"buttons",children:[Re(m7,{}),Re(_7,{isLoading:a,onClick:l}),Re(E7,{}),Re(v7,{})]}),Re(f7,{onJoin:l})]})}),jp=14,Fp=8,jv=8,Fv=4;function S7({volumeLevel:r=0,noise:o=.075,...a}){const[c,l]=Ye.useState(0);return Ye.useEffect(()=>{if(r&&o){const f=Math.max(0,Math.min(1,o)),v=setInterval(()=>{l(r+Math.random()*f*(Math.random()>.5?1:-1))},50);return()=>clearInterval(v)}},[r,o]),Nt("svg",{fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...a,children:[Re("defs",{children:Re("clipPath",{id:"icon-mic-v-clip",children:Re("rect",{height:jp,rx:Fp/2,width:Fp,x:jv,y:Fv})})}),Re("path",{d:"M0 0h24v24H0z",fill:"#999CA3",opacity:".01"}),Re("rect",{clipPath:"url(#icon-mic-v-clip)",fill:"#fff",height:jp,width:Fp,x:jv,y:Fv}),Re("path",{d:"M4 16.625h2v-1.25H4v1.25Zm6 4h4v-1.25h-4v1.25Zm8-4h2v-1.25h-2v1.25Zm-4 4A4.625 4.625 0 0 0 18.625 16h-1.25A3.375 3.375 0 0 1 14 19.375v1.25ZM5.375 16A4.625 4.625 0 0 0 10 20.625v-1.25A3.375 3.375 0 0 1 6.625 16h-1.25Z",fill:"#fff"}),Re("g",{clipPath:"url(#icon-mic-v-clip)",children:Re("rect",{fill:"#44AD00",height:jp*2,style:{transform:`translateY(${(1-c)*jp}px)`,transition:"transform .1s"},width:Fp,x:jv,y:Fv})})]})}const T7=Ye.memo(function(o){return Nt("svg",{fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",...o,children:[Re("path",{d:"m5 5 14 14",stroke:"rgb(225, 225, 225, 0.35)",strokeLinejoin:"round",strokeWidth:"1.25"}),Re("path",{clipRule:"evenodd",d:"M19.277 16.625H20v-1.25h-1.973l1.25 1.25Zm-3.239 2.065.89.89a4.602 4.602 0 0 1-2.716 1.04l-.212.005h-4a4.626 4.626 0 0 1-4.55-3.787l-.033-.213H4v-1.25h2c.345 0 .625.28.625.625a3.375 3.375 0 0 0 3.19 3.37l.185.005h4a3.36 3.36 0 0 0 2.038-.685Zm.587-4.717V8a4.625 4.625 0 0 0-8.5-2.526l.911.91a3.374 3.374 0 0 1 6.281.991H14v1.25h1.375v.75H14v1.25h1.375v.75h-1.348l1.25 1.25h.098v.098l1.25 1.25Zm-2.587 2.717.89.89A4.625 4.625 0 0 1 7.375 14v-3.973l1.25 1.25v.098h.098l1.25 1.25H8.625V14a3.375 3.375 0 0 0 5.413 2.69Z",fill:"rgb(225, 225, 225, 0.35)",fillRule:"evenodd"})]})});function Px({noise:r,audioTrack:o,micOn:a,onMicChange:c,onClick:l,className:f="",...v}){const R=vW(o),T=Ye.useCallback(C=>{c==null||c(!a),l==null||l(C)},[c,l,a]);return Re("button",{...v,className:`arr-user-control ${f}`,onClick:T,children:a?Re(S7,{noise:r,volumeLevel:R}):Re(T7,{})})}function Dx(r){var o,a,c="";if(typeof r=="string"||typeof r=="number")c+=r;else if(typeof r=="object")if(Array.isArray(r))for(o=0;o<r.length;o++)r[o]&&(a=Dx(r[o]))&&(c&&(c+=" "),c+=a);else for(o in r)r[o]&&(c&&(c+=" "),c+=o);return c}function Gv(){for(var r,o,a=0,c="";a<arguments.length;)(r=arguments[a++])&&(o=Dx(r))&&(c&&(c+=" "),c+=o);return c}const y7=Ya(function({localUser:o}){const{shareScreen:a}=No;return Nt("div",{className:"controls",children:[Nt("button",{className:Gv("btn",{active:o.micOn}),onClick:()=>o.setMic(!o.micOn),children:[o.micOn?Re("i",{className:"i-mdi-microphone"}):Re("i",{className:"i-mdi-microphone-off"}),Re("span",{className:"btn-text",children:o.micOn?"Mute":"Unmute"})]}),Nt("button",{className:Gv("btn",{active:o.cameraOn}),onClick:()=>o.setCamera(!o.cameraOn),children:[o.cameraOn?Re("i",{className:"i-mdi-video"}):Re("i",{className:"i-mdi-video-off"}),Re("span",{className:"btn-text",children:"Video"})]}),Re("div",{className:"flex-1"}),Nt("button",{className:Gv("btn",{active:a.enabled}),disabled:a.remoteVideoTrack!=null,onClick:()=>a.enabled?a.disable():a.enable(),children:[Re("i",{className:"i-mdi-arrow-up-bold-box"}),Re("span",{className:"btn-text",children:"Share Screen"})]}),Re("div",{className:"flex-1"}),Nt("button",{className:"btn btn-quit",onClick:()=>No.leave(),children:[Re("i",{className:"i-mdi-exit-to-app"}),Re("span",{className:"btn-text",children:"Quit"})]})]})}),R7=Ya(function({className:o,localUser:a}){return Re("div",{className:o,children:Nt(IW,{audioTrack:a.micTrack,cameraOn:a.cameraOn,cover:a.avatar,micOn:a.micOn,playVideo:a.cameraOn,videoTrack:a.cameraTrack,children:[Re("span",{className:"user-name",children:a.name}),a.micOn&&Re(Px,{audioTrack:a.micTrack,disabled:!0,micOn:!0})]})})}),C7=Ya(function(){const{shareScreen:o}=No;return Re(mL,{className:"share-screen",play:!0,track:o.remoteVideoTrack})}),I7=Ya(function(){const{localUser:o,remoteUsers:a}=No.users;return Nt("div",{className:"tab2",children:[Nt("h3",{className:"users-title",children:["Users (",a.length+1,")"]}),Nt("div",{className:"users",children:[Nt("div",{className:"user local",children:[Re("i",{className:"i-mdi-account"}),Nt("span",{children:[o==null?void 0:o.name," (You)"]}),(o==null?void 0:o.micOn)&&Re("i",{className:"i-mdi-microphone"}),(o==null?void 0:o.cameraOn)&&Re("i",{className:"i-mdi-video"})]},No.uid),a.map(c=>Nt("div",{className:"user",children:[Re("i",{className:"i-mdi-account"}),Re("span",{children:c.name}),c.micOn&&Re("i",{className:"i-mdi-microphone"}),c.cameraOn&&Re("i",{className:"i-mdi-video"})]},c.uid))]})]})}),A7=Ya(function(){const{localUser:o,remoteUsers:a}=No.users;return Re("div",{className:"room",children:Nt("div",{className:"tabs",children:[Nt("div",{className:"tab",children:[Nt("div",{className:"tracks layout","data-size":a.length+(o?1:0),children:[o&&Re(R7,{className:"layout-item",localUser:o}),a.map(c=>Re("div",{className:"layout-item",children:Nt(wW,{cover:c.avatar,playAudio:c.micOn,playVideo:c.cameraOn,user:c.rtcUser,children:[Re("span",{className:"user-name",children:c.name}),c.micOn&&Re(Px,{audioTrack:c.audioTrack,disabled:!0,micOn:!0})]})},c.uid)),Re(C7,{})]}),o&&Re(y7,{localUser:o})]}),Re(I7,{})]})})}),w7=Ya(function(){return Nt(S0,{children:[Re(g7,{}),No.client&&Re(_W,{client:No.client,children:Re(A7,{})})]})});rL(document.getElementById("root")).render(Re(Ye.StrictMode,{children:Re(w7,{})}));
