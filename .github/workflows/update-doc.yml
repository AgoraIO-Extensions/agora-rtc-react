name: Update Docs

on:
  workflow_dispatch:
jobs:
  generate-docs:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v3

      - name: Install pnpm ğŸ¤ğŸ»
        uses: pnpm/action-setup@v2.2.4
        with:
          version: latest

      - name: Setup Node ğŸ’š
        uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: "pnpm"

      - name: Update Docs ğŸ“–
        run: |
          pnpm install
          pnpm gene-docs
      - name: Check for Changes and Commit ğŸ“
        run: |
          if git diff --quiet; then echo "No changes, no need to update docs."; exit 0;
          else
            git config --global user.email "${{ secrets.GIT_EMAIL }}"
            git config --global user.name "${{ secrets.GIT_USERNAME }}"
            git checkout -b doc/update-doc
            git add .
            git commit -m "Update doc"
            git push origin doc/update-doc
            gh pr create -B main -H doc/update-doc --title 'update-doc' --body 'Created by Github action'
          fi
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
